
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.CBC.Definitions</title>
<meta name="description" content="Documentation of Coq module CasperCBC.CBC.Definitions" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.CBC.Definitions</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Reals.html">Reals</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relations.html">Relations</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html">RelationClasses</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Setoids.Setoid.html">Setoid</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.EqdepFacts.html">EqdepFacts</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.ChoiceFacts.html">ChoiceFacts</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical.html">Classical</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lib.Preamble</span> <span class="id">Lib.ListExtras</span> <span class="id">Lib.ListSetExtras</span> <span class="id">Lib.RealsExtras</span> <span class="id"><a href="CasperCBC.CBC.Common.html">CBC.Common</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="state">state</a></span> {<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Empty">Empty</a></span> : <span class="id">state</span><br/>
&nbsp;&nbsp;| <span class="kwd">Next</span> : <span class="id">C</span> -&gt;  <span class="id">V</span> -&gt; <span class="id">state</span> -&gt; <span class="id">state</span> -&gt; <span class="id">state</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state0">state0</a></span> (<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>) : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<br/>
<span class="kwd">Notation</span> "'<span class="id">add</span>' ( <span class="id">c</span> , <span class="id">v</span> , <span class="id">j</span> ) '<span class="id">to</span>' <span class="id">sigma</span>" :=<br/>
&nbsp;&nbsp;(<span class="kwd">Next</span> <span class="id">c</span> <span class="id">v</span> <span class="id">j</span> <span class="id">sigma</span>)<br/>
&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 20).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_inhabited">state_inhabited</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state0">state0</a></span> <span class="id">C</span> <span class="id">V</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="state_compare">state_compare</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison">comparison</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sigma1</span>, <span class="id">sigma2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>, <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Lt">Lt</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Gt">Gt</a></span><br/>
&nbsp;&nbsp;| <span class="id">add</span> (<span class="id">c1</span>, <span class="id">v1</span>, <span class="id">j1</span>) <span class="id">to</span> <span class="id">sigma1</span>, <span class="id">add</span> (<span class="id">c2</span>, <span class="id">v2</span>, <span class="id">j2</span>) <span class="id">to</span> <span class="id">sigma2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare</span> <span class="id">c1</span> <span class="id">c2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare</span> <span class="id">v1</span> <span class="id">v2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">state_compare</span> <span class="id">j1</span> <span class="id">j2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt; <span class="id">state_compare</span> <span class="id">sigma1</span> <span class="id">sigma2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">cmp_j</span> =&gt; <span class="id">cmp_j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">cmp_v</span> =&gt; <span class="id">cmp_v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">cmp_c</span> =&gt; <span class="id">cmp_c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_compare_reflexive">state_compare_reflexive</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">CompareReflexive</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">C</span> <span class="id">about_C</span> <span class="id">V</span> <span class="id">about_V</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">x</span>. <span class="tactic">induction</span> <span class="id">x</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">c</span> <span class="id">c0</span>) <span class="id">eqn</span>:<span class="id">Hcmp</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StrictOrder_Reflexive</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">v</span> <span class="id">v0</span>) <span class="id">eqn</span>:<span class="id">Hcmp</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">StrictOrder_Reflexive</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">x1</span> <span class="id">y1</span>) <span class="id">eqn</span>:<span class="id">Hcmp</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHx1</span> <span class="kwd">in</span> <span class="id">Hcmp</span>. <span class="tactic">apply</span> <span class="id">IHx2</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">y1</span> <span class="id">y1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHx1</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">y2</span> <span class="id">y2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHx2</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_compare_transitive">state_compare_transitive</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">CompareTransitive</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">C</span> <span class="id">about_C</span> <span class="id">V</span> <span class="id">about_V</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare_strictorder</span> <span class="id">C</span> <span class="id">about_C</span>) <span class="kwd">as</span> [<span class="id">Rc</span> <span class="id">Tc</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare_strictorder</span> <span class="id">V</span> <span class="id">about_V</span>) <span class="kwd">as</span> [<span class="id">Rv</span> <span class="id">Tv</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">y</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">z</span>; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">comp</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">c0</span> <span class="id">c</span>) <span class="id">eqn</span>:<span class="id">Hc0</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">c</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RiemannInt.html#c1">c1</a></span>) <span class="id">eqn</span>:<span class="id">Hc1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">Tc</span> <span class="id">c0</span> <span class="id">c</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RiemannInt.html#c1">c1</a></span> <span class="id">_</span> <span class="id">Hc0</span>) <span class="kwd">in</span> <span class="id">Hc1</span> ; <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">c0</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RiemannInt.html#c1">c1</a></span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rc</span> <span class="kwd">in</span> <span class="id">Hc1</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hc0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rc</span> <span class="kwd">in</span> <span class="id">Hc0</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hc1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">v0</span> <span class="id">v</span>) <span class="id">eqn</span>:<span class="id">Hv0</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">v</span> <span class="id">v1</span>) <span class="id">eqn</span>:<span class="id">Hv1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">Tv</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">v1</span> <span class="id">_</span> <span class="id">Hv0</span>) <span class="kwd">in</span> <span class="id">Hv1</span>; <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">v0</span> <span class="id">v1</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rv</span> <span class="kwd">in</span> <span class="id">Hv0</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hv1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Rv</span> <span class="kwd">in</span> <span class="id">Hv1</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hv0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">x1</span> <span class="id">y1</span>) <span class="id">eqn</span>:<span class="id">Hj0</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">y1</span> <span class="id">z1</span>) <span class="id">eqn</span>:<span class="id">Hj1</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> (<span class="id">IHy1</span> <span class="id">x1</span> <span class="id">z1</span> <span class="id">_</span> <span class="id">Hj0</span>) <span class="kwd">in</span> <span class="id">Hj1</span>; <span class="tactic">rewrite</span> <span class="id">Hj1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_reflexive">state_compare_reflexive</a></span> <span class="kwd">in</span> <span class="id">Hj0</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hj1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_reflexive">state_compare_reflexive</a></span> <span class="kwd">in</span> <span class="id">Hj1</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id">Hj0</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> (<span class="id">IHy2</span> <span class="id">x2</span> <span class="id">z2</span> <span class="id">_</span> <span class="id">H</span>) <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_compare_strict_order">state_compare_strict_order</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">CompareStrictOrder</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> <span class="id">C</span> <span class="id">about_C</span> <span class="id">V</span> <span class="id">about_V</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_reflexive">state_compare_reflexive</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_transitive">state_compare_transitive</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="state_type">state_type</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inhabited</span> := @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_inhabited">state_inhabited</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">_</span> <span class="id">_</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare_strictorder</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_strict_order">state_compare_strict_order</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="message">message</a></span> (<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>) : <span class="kwd">Type</span> := (<span class="id">C</span> * <span class="id">V</span> * @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="message_inhabited">message_inhabited</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">inhabitedC</span> := <span class="id">about_C</span>); <span class="tactic">destruct</span> <span class="id">inhabitedC</span> <span class="kwd">as</span> [<span class="id">inhabitedC</span> <span class="id">_</span> <span class="id">_</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">inhabitedV</span> := <span class="id">about_V</span>); <span class="tactic">destruct</span> <span class="id">inhabitedV</span> <span class="kwd">as</span> [<span class="id">inhabitedV</span> <span class="id">_</span> <span class="id">_</span> ].<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">inhabitedC</span>,<span class="id">inhabitedV</span>,<span class="id"><a href="CasperCBC.CBC.Definitions.html#state0">state0</a></span> <span class="id">C</span> <span class="id">V</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="estimate">estimate</a></span> {<span class="id">C</span> <span class="id">V</span>} (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> ) : <span class="id">C</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span> (<span class="id">c</span>, <span class="id">_</span> , <span class="id">_</span>) =&gt; <span class="id">c</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sender">sender</a></span> {<span class="id">C</span> <span class="id">V</span>} (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id">V</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span> (<span class="id">_</span>, <span class="id">v</span>, <span class="id">_</span>) =&gt; <span class="id">v</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification">justification</a></span> {<span class="id">C</span> <span class="id">V</span>} (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span> (<span class="id">_</span>, <span class="id">_</span>, <span class="id">sigma</span>) =&gt; <span class="id">sigma</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="get_messages">get_messages</a></span> {<span class="id">C</span> <span class="id">V</span>} (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sigma</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> =&gt; []<br/>
&nbsp;&nbsp;| <span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">to</span> <span class="id">sigma</span>' =&gt; (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) :: <span class="id">get_messages</span> <span class="id">sigma</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="observed">observed</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span>: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> <span class="id">compare_eq_dec</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="next">next</a></span> {<span class="id">C</span> <span class="id">V</span>} (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) =&gt; <span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">to</span> <span class="id">sigma</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="get_messages_next">get_messages_next</a></span> {<span class="id">C</span> <span class="id">V</span>} : <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) = <span class="id">msg</span> :: <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg</span> <span class="kwd">as</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>]. <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_is_next">add_is_next</a></span> {<span class="id">C</span> <span class="id">V</span>} : <span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) <span class="id">j</span> <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>)<span class="id">to</span> <span class="id">sigma</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_confusion_next">no_confusion_next</a></span> {<span class="id">C</span> <span class="id">V</span>} : <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma1</span> <span class="id">sigma2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id">sigma1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">msg1</span> = <span class="id">msg2</span> /\ <span class="id">sigma1</span> = <span class="id">sigma2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg1</span> <span class="kwd">as</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">j1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg2</span> <span class="kwd">as</span> [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">j2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_confusion_next_empty">no_confusion_next_empty</a></span> {<span class="id">C</span> <span class="id">V</span>} : <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span> &lt;&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intro</span>. <span class="tactic">destruct</span> <span class="id">msg</span> <span class="kwd">as</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>]. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="message_compare">message_compare</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison">comparison</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare">state_compare</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="message_compare_strict_order">message_compare_strict_order</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">CompareStrictOrder</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span> <span class="id">C</span> <span class="id">about_C</span> <span class="id">V</span> <span class="id">about_V</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg1</span> <span class="id">msg2</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_reflexive">state_compare_reflexive</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg1</span> <span class="id">msg2</span> <span class="id">msg3</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_transitive">state_compare_transitive</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="message_strictorder">message_strictorder</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">CompareStrictOrder</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span> <span class="id">C</span> <span class="id">about_C</span> <span class="id">V</span> <span class="id">about_V</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg1</span> <span class="id">msg2</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_reflexive">state_compare_reflexive</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg1</span> <span class="id">msg2</span> <span class="id">msg3</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_compare_transitive">state_compare_transitive</a></span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="message_type">message_type</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span>} `{<span class="id">about_C</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} {<span class="id">V</span>} `{<span class="id">about_V</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id">inhabited</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_inhabited">message_inhabited</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare">message_compare</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare_strictorder</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_compare_strict_order">message_compare_strict_order</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="message_lt">message_lt</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">compare_lt</span> <span class="id">compare</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="message_lt_strictorder">message_lt_strictorder</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#StrictOrder">StrictOrder</a></span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">about_M</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">compare_lt_irreflexive</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_lt_transitive</span>.<br/>
Defined.</div>
<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="in_state">in_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="syntactic_state_inclusion">syntactic_state_inclusion</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma1</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">sigma2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_empty_state">in_empty_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_state_dec">in_state_dec</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;{<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>} + {~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>. <span class="tactic">apply</span> <span class="id">compare_eq_dec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_state_dec_if_true">in_state_dec_if_true</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;{<span class="id">A</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">sigma</span> (<span class="id">T</span> <span class="id">E</span> : <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec">in_state_dec</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="kwd">then</span> <span class="id">T</span> <span class="kwd">else</span> <span class="id">E</span>) = <span class="id">T</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec">in_state_dec</a></span> <span class="id">msg</span> <span class="id">sigma</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">n</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_state_dec_if_false">in_state_dec_if_false</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;{<span class="id">A</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">sigma</span> (<span class="id">T</span> <span class="id">E</span> : <span class="id">A</span>),<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">if</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec">in_state_dec</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="kwd">then</span> <span class="id">T</span> <span class="kwd">else</span> <span class="id">E</span>) = <span class="id">E</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec">in_state_dec</a></span> <span class="id">msg</span> <span class="id">sigma</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">i</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="in_state_fn">in_state_fn</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec">in_state_dec</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#right">right</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_state_correct">in_state_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">sigma</span>; <span class="tactic">split</span>; <span class="tactic">intro</span>; <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec">in_state_dec</a></span> <span class="id">msg</span> <span class="id">sigma</span>) <span class="id">eqn</span>:<span class="id">Hin</span>;<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">rewrite</span> <span class="id">Hin</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Hin</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>; <span class="tactic">apply</span> <span class="id">n</span>; <span class="tactic">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_state_correct</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; ~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_correct">in_state_correct</a></span>).<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">mirror_reflect_curry</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_state_next_iff">in_state_next_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> <span class="id">msg1</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma1</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id">sigma1</span>) &lt;-&gt; <span class="id">msg1</span> = <span class="id">msg</span> \/ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">H</span>; (<span class="id">left</span>; <span class="tactic">assumption</span>) || (<span class="id">right</span>; <span class="tactic">assumption</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_singleton_state">in_singleton_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> <span class="id">msg</span>' : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) -&gt; <span class="id">msg</span> = <span class="id">msg</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_empty_state">in_empty_state</a></span> <span class="id">_</span> <span class="id">H</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_extx_in_x">not_extx_in_x</a></span> {<span class="id">C</span> <span class="id">V</span>} : <span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) <span class="id">j</span> <span class="id">j</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">j</span>' <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">j</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">j</span>'; <span class="tactic">intros</span>;  <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span>; <span class="tactic">simpl</span>; <span class="tactic">intro</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHj</span>'1; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHj</span>'2; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="locally_sorted">locally_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="LSorted_Empty">LSorted_Empty</a></span> : <span class="id">locally_sorted</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="LSorted_Singleton">LSorted_Singleton</a></span> : <span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">j</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">locally_sorted</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">locally_sorted</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="LSorted_Next">LSorted_Next</a></span> : <span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">j</span> <span class="id">msg</span>' <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">locally_sorted</span> <span class="id">j</span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">msg</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">locally_sorted</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">locally_sorted</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>))<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="locally_sorted_msg">locally_sorted_msg</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">HscM</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_message_justification">locally_sorted_message_justification</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) <span class="id">j</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">j</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#LSorted_Singleton">LSorted_Singleton</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_message_characterization">locally_sorted_message_characterization</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id">sigma</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span><br/>
&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">msg</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msg</span> /\ <span class="id">sigma</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)<br/>
&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">msg1</span> <span class="id">msg2</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sigma</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msg1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg1</span> <span class="id">msg2</span><br/>
&nbsp;&nbsp;).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">left</span>. <span class="id">exists</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">right</span>. <span class="id">exists</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>). <span class="id">exists</span> <span class="id">msg</span>'. <span class="id">exists</span> <span class="id">sigma0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | [<span class="id">H</span> | <span class="id">H</span>]]; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">LSmsg</span> <span class="id">EQ</span>]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg</span> <span class="kwd">as</span> [(<span class="id">c</span>,<span class="id">v</span>) <span class="id">j</span>]. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="kwd">in</span> <span class="id">LSmsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg1</span> [<span class="id">msg2</span> [<span class="id">sigma</span>' [<span class="id">EQ</span> [<span class="id">LS2</span>' [<span class="id">LSmsg1</span> <span class="id">LT</span>]]]]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg1</span> <span class="kwd">as</span> [(<span class="id">c1</span>,<span class="id">v1</span>) <span class="id">j1</span>]. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="kwd">in</span> <span class="id">LSmsg1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_next_next">locally_sorted_next_next</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg1</span> <span class="id">msg2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_characterization">locally_sorted_message_characterization</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | [[<span class="id">msg</span> [<span class="id">_</span> <span class="id">H</span>]] | [<span class="id">msg1</span>' [<span class="id">msg2</span>' [<span class="id">sigma</span>' [<span class="id">H</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">Hlt</span>]]]]]]]].<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> <span class="id">H</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> <span class="id">H</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_remove_second">locally_sorted_remove_second</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id">sigma</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_characterization">locally_sorted_message_characterization</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | [[<span class="id">msg</span> [<span class="id">_</span> <span class="id">H</span>]] | [<span class="id">msg1</span>' [<span class="id">msg2</span>' [<span class="id">sigma</span>' [<span class="id">Heq</span> [<span class="id">H</span> [<span class="id">Hj</span> <span class="id">Hlt</span>]]]]]]]].<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> [<span class="id">Heq</span>' <span class="id">Heq</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> [<span class="id">Heq</span>' <span class="id">Heq</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_characterization">locally_sorted_message_characterization</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> | [[<span class="id">msg</span> [<span class="id">_</span> <span class="id">H</span>]] | [<span class="id">msg2</span>'' [<span class="id">msg3</span> [<span class="id">sigma</span>'' [<span class="id">Heq</span> [<span class="id">H</span> [<span class="id">_</span> <span class="id">Hlt2</span>]]]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">Hj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">compare_lt_transitive</span>  <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hlt</span>) <span class="kwd">in</span> <span class="id">Hlt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg1</span>' <span class="kwd">as</span> [(<span class="id">c1</span>', <span class="id">v1</span>') <span class="id">j1</span>']. <span class="tactic">destruct</span> <span class="id">msg3</span> <span class="kwd">as</span> [(<span class="id">c3</span>, <span class="id">v3</span>) <span class="id">j3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="kwd">in</span> <span class="id">Hj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#LSorted_Next">LSorted_Next</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_head">locally_sorted_head</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msg</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>] <span class="id">sigma</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_tail">locally_sorted_tail</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof63')">Proof.</div>
<div class="proofscript" id="proof63">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_characterization">locally_sorted_message_characterization</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id">Hcempty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [[<span class="id">cmsg0</span> [<span class="id">LScmsg0</span> <span class="id">Hcnext</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">cmsg1</span> [<span class="id">cmsg2</span> [<span class="id">csigma</span>' [<span class="id">Hcnext</span> [<span class="id">LScnext</span> [<span class="id">LScmsg1</span> <span class="id">LTc</span>]]]]]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;]]; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">Hcnext</span>; <span class="tactic">destruct</span> <span class="id">Hcnext</span>; <span class="tactic">subst</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>; <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hcempty</span>).<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_all">locally_sorted_all</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof64')">Proof.</div>
<div class="proofscript" id="proof64">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> | <span class="id">Hin</span>] ; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHlocally_sorted2</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="locally_sorted_first">locally_sorted_first</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span>' <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg</span> <span class="id">msg</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof65')">Proof.</div>
<div class="proofscript" id="proof65">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">sigma</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">msg</span>. <span class="tactic">induction</span> <span class="id">sigma</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="kwd">in</span> *. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_next_next">locally_sorted_next_next</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_remove_second">locally_sorted_remove_second</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">IHsigma2</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_syntactic_state_inclusion_first_equal">sorted_syntactic_state_inclusion_first_equal</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof66')">Proof.</div>
<div class="proofscript" id="proof66">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span>' <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_first">locally_sorted_first</a></span> <span class="id">msg</span>) <span class="kwd">in</span> <span class="id">Hin</span> <span class="kwd">as</span> <span class="id">Hlt</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span>' (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Hin</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>'; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">compare_lt_irreflexive</span> <span class="id">_</span> <span class="id">Hlt</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_syntactic_state_inclusion">sorted_syntactic_state_inclusion</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' (<span class="id">msg</span> <span class="id">msg</span>' : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>') -&gt;<br/>
&nbsp;&nbsp;(<span class="id">msg</span> = <span class="id">msg</span>' /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> <span class="id">sigma</span>')<br/>
&nbsp;&nbsp;\/<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg</span>' <span class="id">msg</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) <span class="id">sigma</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>'))).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.  <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="id">left</span>. <span class="tactic">subst</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#sorted_syntactic_state_inclusion_first_equal">sorted_syntactic_state_inclusion_first_equal</a></span> <span class="kwd">with</span> <span class="id">msg</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_first">locally_sorted_first</a></span> <span class="id">msg</span>') <span class="kwd">in</span> <span class="id">H2</span> <span class="kwd">as</span> <span class="id">Hlt</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg1</span> <span class="id">Hin1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">Hin1</span> <span class="kwd">as</span> <span class="id">H1in</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">H1in</span>'.  <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1in</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">Hin1</span>.  <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hlt1</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg</span>' <span class="id">msg1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hin1</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_first">locally_sorted_first</a></span> <span class="id">msg</span>) <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_lt_transitive</span> <span class="kwd">with</span> <span class="id">msg</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1in</span>'; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id">compare_lt_irreflexive</span> <span class="id">_</span> <span class="id">Hlt1</span>).<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_syntactic_state_inclusion_eq_ind">sorted_syntactic_state_inclusion_eq_ind</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id">sigma1</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma2</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> <span class="id">sigma1</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">msg1</span> = <span class="id">msg2</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma2</span> <span class="id">sigma1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof68')">Proof.</div>
<div class="proofscript" id="proof68">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#sorted_syntactic_state_inclusion">sorted_syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#sorted_syntactic_state_inclusion">sorted_syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">destruct</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id">compare_lt_irreflexive</span> <span class="id">_</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id">compare_lt_irreflexive</span> <span class="id">_</span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id">compare_lt_transitive</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span>) <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">compare_lt_irreflexive</span> <span class="id">_</span> <span class="id">H2</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_syntactic_state_inclusion_equality_predicate">sorted_syntactic_state_inclusion_equality_predicate</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma2</span> <span class="id">sigma1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">sigma1</span> = <span class="id">sigma2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sigma1</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">sigma2</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">apply</span> <span class="id">incl_empty</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">incl_empty</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#sorted_syntactic_state_inclusion_eq_ind">sorted_syntactic_state_inclusion_eq_ind</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">Heq</span> [<span class="id">Hin12</span> <span class="id">Hin21</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_tail">locally_sorted_tail</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_tail">locally_sorted_tail</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHsigma1_2</span> <span class="kwd">in</span> <span class="id">Hin21</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">msg</span>: <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">sigma</span>: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span>, <span class="id">sigma</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id">msg</span>, <span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">to</span> <span class="id">sigma</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare</span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt; <span class="id">sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Lt">Lt</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Gt">Gt</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) (<span class="id">add_in_sorted_fn</span> <span class="id">msg</span> <span class="id">sigma</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="set_eq_add_in_sorted">set_eq_add_in_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">sigma</span>)) (<span class="id">msg</span> :: (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sigma</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">IHsigma1</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1</span>)) <span class="id">eqn</span>:<span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">StrictOrder_Reflexive</span> <span class="kwd">in</span> <span class="id">Hcmp</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>. <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">Hin</span>; <span class="tactic">try</span> (<span class="id">right</span>; <span class="id">left</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHsigma2</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hmsg</span> | [<span class="id">H1</span> | <span class="id">H2</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; (<span class="id">left</span>; <span class="tactic">assumption</span>) || (<span class="id">right</span>; <span class="tactic">apply</span> <span class="id">IHsigma2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_preserves_inclusion">add_preserves_inclusion</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> <span class="id">sigma</span>' : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;(<span class="id">msg</span>' : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> <span class="id">sigma</span>')<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span>' <span class="id">sigma</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id">msg</span>' :: <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>'); <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> <span class="id">msg</span>' : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span>' <span class="id">sigma</span>') &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id">msg</span> = <span class="id">msg</span>' \/ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> <span class="id">msg</span>' <span class="id">sigma</span>') <span class="kwd">as</span> [<span class="id">Hincl1</span> <span class="id">Hincl2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hincl1</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hincl2</span>. <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_next">add_in_sorted_next</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare</span> <span class="id">msg1</span> <span class="id">msg2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Lt">Lt</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> <span class="id">sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Gt">Gt</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg2</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg1</span> <span class="id">sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg1</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>] <span class="id">sigma</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_non_empty">add_in_sorted_non_empty</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">sigma</span> &lt;&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma</span>; <span class="tactic">inversion</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">compare</span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1</span>)); <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_preserves_message_membership">add_preserves_message_membership</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> <span class="id">j</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof75')">Proof.</div>
<div class="proofscript" id="proof75">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">msg</span>; <span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_inv1">add_in_sorted_inv1</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> <span class="id">msg</span>' : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">sigma</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> -&gt; <span class="id">msg</span> = <span class="id">msg</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof76')">Proof.</div>
<div class="proofscript" id="proof76">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>] <span class="id">msg</span>' <span class="id">sigma</span> <span class="id">AddA</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">AddA</span>. <span class="tactic">rewrite</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="kwd">in</span> <span class="id">AddA</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">AddA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">AddA</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">AddA</span>. <span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) (<span class="id">c0</span>, <span class="id">v0</span>, <span class="id">sigma1</span>)) <span class="id">eqn</span>:<span class="id">Hcmp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> <span class="id">AddA</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">AddA</span>; <span class="tactic">destruct</span> <span class="id">AddA</span>; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">StrictOrder_Reflexive</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="tactic">inversion</span> <span class="id">Hcmp</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_non_empty">add_in_sorted_non_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H0</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_sorted">add_in_sorted_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msg</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">sigma</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof77')">Proof.</div>
<div class="proofscript" id="proof77">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">sigma</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sigma</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">IHsigma1</span>; <span class="tactic">rename</span> <span class="id">sigma1</span> <span class="id">into</span> <span class="id">j</span>; <span class="tactic">rename</span> <span class="id">sigma2</span> <span class="id">into</span> <span class="id">sigma</span>; <span class="tactic">rename</span> <span class="id">IHsigma2</span> <span class="id">into</span> <span class="id">IHsigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">msg</span> <span class="kwd">as</span> [(<span class="id">mc</span>, <span class="id">mv</span>) <span class="id">mj</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Hmj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_tail">locally_sorted_tail</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> <span class="id">Hsigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_head">locally_sorted_head</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> <span class="id">Hcvj</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="kwd">in</span> <span class="id">Hcvj</span> <span class="kwd">as</span> <span class="id">Hj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">IHsigma</span> <span class="id">_</span> <span class="id">Hsigma</span>) <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">HLSadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> (<span class="id">mc</span>, <span class="id">mv</span>, <span class="id">mj</span>) (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>)) <span class="id">eqn</span>:<span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_characterization">locally_sorted_message_characterization</a></span> <span class="kwd">in</span> <span class="id">HLSadd</span> <span class="kwd">as</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hadd</span> <span class="kwd">as</span> [<span class="id">Hadd</span> | [<span class="id">Hadd</span> | <span class="id">Hadd</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_non_empty">add_in_sorted_non_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hadd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">Hadd</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">Hmsg</span>' <span class="id">Hadd</span>]]. <span class="tactic">rewrite</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_inv1">add_in_sorted_inv1</a></span> <span class="kwd">in</span> <span class="id">Hadd</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">Hadd</span> <span class="kwd">as</span> [<span class="id">msg1</span> [<span class="id">msg2</span> [<span class="id">sigma</span>' [<span class="id">Hadd</span> [<span class="id">HLS</span>' [<span class="id">H1</span> <span class="id">Hlt12</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hadd</span> <span class="kwd">in</span> *. <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>)) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">mc</span>, <span class="id">mv</span>, <span class="id">mj</span>) <span class="id">sigma</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span>. <span class="tactic">unfold</span> <span class="id">compare_lt</span>. <span class="tactic">unfold</span> <span class="id">Lib.Preamble.compare</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_first">locally_sorted_first</a></span> <span class="kwd">with</span> <span class="id">sigma</span>; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="kwd">in</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hadd</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_inv">Forall_inv</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="list_to_state">list_to_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">msgs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">msgs</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_to_state_locally_sorted">list_to_state_locally_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msgs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msgs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> <span class="id">msgs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof78')">Proof.</div>
<div class="proofscript" id="proof78">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">msgs</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHmsgs</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_inv">Forall_inv</a></span> <span class="kwd">with</span> <span class="id">msgs</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_to_state_iff">list_to_state_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msgs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> <span class="id">msgs</span>)) <span class="id">msgs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof79')">Proof.</div>
<div class="proofscript" id="proof79">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">msgs</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">set_eq_tran</span> <span class="kwd">with</span> (<span class="id">a</span> :: (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> <span class="id">msgs</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">set_eq_cons</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_to_state_sorted">list_to_state_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>) = <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof80')">Proof.</div>
<div class="proofscript" id="proof80">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHlocally_sorted2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>. <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="messages_union">messages_union</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">m1</span> <span class="id">m2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>))<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">m1</span> ++ <span class="id">m2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_union">state_union</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma2</span>))).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_ignore_repeat">add_in_sorted_ignore_repeat</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) <span class="id">j</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">msg</span> = (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> (<span class="id">add</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">to</span> <span class="id">s</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">add</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">to</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof81')">Proof.</div>
<div class="proofscript" id="proof81">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">compare</span> <span class="id">msg</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>)) <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>. <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_swap_base">add_in_sorted_swap_base</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">y</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">x</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">x</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">y</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof82')">Proof.</div>
<div class="proofscript" id="proof82">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">destruct</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">y</span>; <span class="tactic">destruct</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">case_pair</span> <span class="id">about_M</span> (<span class="id">c0</span>,<span class="id">v0</span>,<span class="id">s0</span>) (<span class="id">c</span>,<span class="id">v</span>,<span class="id">s</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H_eq1</span>, <span class="id">H_eq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_eq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_eq2</span>; <span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H_lt</span>, <span class="id">H_gt</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H_gt</span>, <span class="id">H_lt</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_swap_succ">add_in_sorted_swap_succ</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">y</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">x</span> <span class="id">s</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">x</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">y</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof83')">Proof.</div>
<div class="proofscript" id="proof83">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span>; <span class="tactic">induction</span> <span class="id">s</span> <span class="kwd">as</span> [|<span class="id">c</span> <span class="id">v</span> <span class="id">j</span> <span class="id">IHj</span> <span class="id">prev</span> <span class="id">IHs</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_swap_base">add_in_sorted_swap_base</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">x</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>)) <span class="id">eqn</span>:<span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">y</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>)) <span class="id">eqn</span>:<span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_y</span>. <span class="tactic">subst</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_y_copy</span> := <span class="id">H_y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_x</span> <span class="kwd">in</span> <span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">H_y</span>. <span class="tactic">rewrite</span> <span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_y_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_x</span>. <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_y</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span>; <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">y</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>)) <span class="id">eqn</span>:<span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_y</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_x</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">y</span> <span class="id">x</span>) <span class="id">eqn</span>:<span class="id">H_yx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_yx</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>. <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">H_yx</span>. <span class="tactic">rewrite</span> <span class="id">H_yx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">H_yx</span>. <span class="tactic">rewrite</span> <span class="id">H_yx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_y</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">y</span> <span class="id">x</span>) <span class="id">eqn</span>:<span class="id">H_yx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_yx</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span> <span class="kwd">in</span> <span class="id">H_y</span>; <span class="tactic">inversion</span> <span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">y</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Lt">Lt</a></span>). <span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span>. <span class="tactic">exact</span> <span class="id">H_yx</span>. <span class="tactic">exact</span> <span class="id">H_x</span>. <span class="tactic">rewrite</span> <span class="id">H_y</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_y</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">y</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>)) <span class="id">eqn</span>:<span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_y</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">x</span> <span class="id">y</span>) <span class="id">eqn</span>:<span class="id">H_xy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq</span> <span class="kwd">in</span> <span class="id">H_xy</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span> <span class="kwd">in</span> <span class="id">H_y</span>; <span class="tactic">inversion</span> <span class="id">H_y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">x</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Lt">Lt</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">StrictOrder_Transitive</span>. <span class="tactic">apply</span> <span class="id">H_xy</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_x</span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Finally,&nbsp;the&nbsp;induction&nbsp;hypothesis&nbsp;is&nbsp;used&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHs</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">next</span>" :=<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>; <span class="tactic">simpl</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="add_in_sorted">add_in_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;| <span class="id"><a name="add_in_Empty">add_in_Empty</a></span> : <span class="kwd">forall</span> <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">add_in_sorted</span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id"><a name="add_in_Next_eq">add_in_Next_eq</a></span> : <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">add_in_sorted</span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id">sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id"><a name="add_in_Next_lt">add_in_Next_lt</a></span> : <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">msg</span>' <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg</span> <span class="id">msg</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">add_in_sorted</span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>))<br/>
&nbsp;&nbsp;&nbsp;| <span class="id"><a name="add_in_Next_gt">add_in_Next_gt</a></span> : <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">msg</span>' <span class="id">sigma</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="id">msg</span>' <span class="id">msg</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">add_in_sorted</span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">add_in_sorted</span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span>' <span class="id">sigma</span>').<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_empty">add_in_empty</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">sigma</span> -&gt; <span class="id">sigma</span> = (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof84')">Proof.</div>
<div class="proofscript" id="proof84">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>] <span class="id">sigma</span> <span class="id">AddA</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">AddA</span> <span class="kwd">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ [(<span class="id">ca</span>, <span class="id">va</span>) <span class="id">ja</span>] <span class="id">A</span> <span class="id">AEmpty</span> <span class="id">C</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [(<span class="id">ca</span>, <span class="id">va</span>) <span class="id">ja</span>] <span class="id">sigmaA</span> <span class="id">A</span> <span class="id">ANext</span> <span class="id">C</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [(<span class="id">ca</span>, <span class="id">va</span>) <span class="id">ja</span>] [(<span class="id">ca</span>', <span class="id">va</span>') <span class="id">ja</span>'] <span class="id">sigmaA</span> <span class="id">LTA</span> <span class="id">smsg</span> <span class="id">smsg</span>' <span class="id">smsg1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [(<span class="id">ca</span>, <span class="id">va</span>) <span class="id">ja</span>] [(<span class="id">ca</span>', <span class="id">va</span>') <span class="id">ja</span>'] <span class="id">sigmaA</span> <span class="id">sigmaA</span>' <span class="id">LTA</span> <span class="id">AddA</span>' <span class="id">A</span> <span class="id">B</span> <span class="id">C</span>]<br/>
&nbsp;&nbsp;; <span class="tactic">clear</span> <span class="id">AddA</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_correct">add_in_sorted_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s1</span> <span class="id">s2</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">s1</span> <span class="id">s2</span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">s1</span> = <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof85')">Proof.</div>
<div class="proofscript" id="proof85">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">sigma1</span> <span class="id">sigma2</span>; <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">sigma2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sigma1</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_empty">add_in_empty</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">destruct</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">unfold</span> <span class="id">compare_lt</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="tactic">rewrite</span> <span class="id">H2</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next">no_confusion_next</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">destruct</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#message_lt">message_lt</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">unfold</span> <span class="id">compare_lt</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">rewrite</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHsigma1_2</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">rewrite</span> <span class="id">H3</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1_1</span>)) <span class="id">eqn</span>:<span class="id">Hcmp</span>; <span class="tactic">subst</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">StrictOrder_Reflexive</span> <span class="kwd">in</span> <span class="id">Hcmp</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_Next_eq">add_in_Next_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_Next_lt">add_in_Next_lt</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_Next_gt">add_in_Next_gt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">compare_asymmetric</span> <span class="kwd">in</span> <span class="id">Hcmp</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">IHsigma1_2</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">add_in_sorted_sorted</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msg</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof86')">Proof.</div>
<div class="proofscript" id="proof86">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_correct">add_in_sorted_correct</a></span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_confusion_add_in_sorted_empty">no_confusion_add_in_sorted_empty</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof87')">Proof.</div>
<div class="proofscript" id="proof87">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_correct">add_in_sorted_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">about_M</span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">rewrite</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#no_confusion_next_empty">no_confusion_next_empty</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_functional">add_in_sorted_functional</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma1</span> <span class="id">sigma2</span> <span class="id">sigma2</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma1</span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma1</span> <span class="id">sigma2</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">sigma2</span> = <span class="id">sigma2</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof88')">Proof.</div>
<div class="proofscript" id="proof88">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_correct">add_in_sorted_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_correct">add_in_sorted_correct</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_message_preservation">add_in_sorted_message_preservation</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof89')">Proof.</div>
<div class="proofscript" id="proof89">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages_next">get_messages_next</a></span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_no_junk">add_in_sorted_no_junk</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>', <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span>' <span class="id">sigma</span>' -&gt; <span class="id">msg</span>' = <span class="id">msg</span> \/ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span>' <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof90')">Proof.</div>
<div class="proofscript" id="proof90">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id">sigma</span>' <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span> <span class="kwd">as</span><br/>
&nbsp;&nbsp;[ [(<span class="id">hc</span>, <span class="id">hv</span>) <span class="id">hj</span>]<br/>
&nbsp;&nbsp;| [(<span class="id">hc</span>, <span class="id">hv</span>) <span class="id">hj</span>] <span class="id">Hsigma</span><br/>
&nbsp;&nbsp;| [(<span class="id">hc</span>, <span class="id">hv</span>) <span class="id">hj</span>] [(<span class="id">hc</span>', <span class="id">hv</span>') <span class="id">hj</span>'] <span class="id">Hsigma</span> <span class="id">HLT</span><br/>
&nbsp;&nbsp;| [(<span class="id">hc</span>, <span class="id">hv</span>) <span class="id">hj</span>] [(<span class="id">hc</span>', <span class="id">hv</span>') <span class="id">hj</span>'] <span class="id">Hsigma</span> <span class="id">Hsigma</span>' <span class="id">HGT</span> <span class="id">HAdd</span> <span class="id">H_H</span><br/>
&nbsp;&nbsp;]; <span class="tactic">intros</span> [(<span class="id">c</span>', <span class="id">v</span>') <span class="id">j</span>'] <span class="id">HIn</span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span> <span class="kwd">in</span> <span class="id">HIn</span><br/>
&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">HIn</span> <span class="kwd">as</span> [<span class="id">Hin1</span> | <span class="id">Hin2</span>]<br/>
&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="id">right</span>; <span class="tactic">assumption</span>)<br/>
&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">inversion</span> <span class="id">Hin1</span>; <span class="tactic">subst</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span>. <span class="tactic">inversion</span> <span class="id">Hin1</span>; <span class="tactic">clear</span> <span class="id">Hin1</span>; <span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H_H</span> <span class="kwd">in</span> <span class="id">Hin2</span>. <span class="tactic">destruct</span> <span class="id">Hin2</span> <span class="kwd">as</span> [<span class="id">HInEq</span> | <span class="id">HIn</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_sorted">add_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted">add_in_sorted</a></span> <span class="id">msg</span> <span class="id">sigma</span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof91')">Proof.</div>
<div class="proofscript" id="proof91">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sigma</span>; <span class="tactic">intros</span>; <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id">exfalso</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_empty_state">in_empty_state</a></span> <span class="id">_</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_next_iff">in_state_next_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_first">locally_sorted_first</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1</span>)) <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Hlt</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_tail">locally_sorted_tail</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHsigma2</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_ignore">add_in_sorted_ignore</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof92')">Proof.</div>
<div class="proofscript" id="proof92">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_correct">add_in_sorted_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_sorted">add_sorted</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_in_sorted_fn_in">add_in_sorted_fn_in</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">m</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">m</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">m</span> <span class="id">s</span>) = <span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">m</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof93')">Proof.</div>
<div class="proofscript" id="proof93">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">compare_eq_refl</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="sort_state">sort_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="kwd">Next</span> <span class="id">C</span> <span class="id">V</span> <span class="id">j</span> <span class="id">s</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">C</span>, <span class="id">V</span>, <span class="id">sort_state</span> <span class="id">j</span>) (<span class="id">sort_state</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sort_state_locally_sorted">sort_state_locally_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sort_state">sort_state</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof94')">Proof.</div>
<div class="proofscript" id="proof94">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">try</span> <span class="id">constructor</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sort_state_idempotent">sort_state_idempotent</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#sort_state">sort_state</a></span> <span class="id">s</span> = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof95')">Proof.</div>
<div class="proofscript" id="proof95">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hs</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHHs</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHHs1</span>. <span class="tactic">rewrite</span> <span class="id">IHHs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_next">add_in_sorted_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_comm_swap">state_union_comm_swap</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">y</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">x</span> <span class="id">s</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">x</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">y</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof96')">Proof.</div>
<div class="proofscript" id="proof96">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_swap_base">add_in_sorted_swap_base</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_swap_succ">add_in_sorted_swap_succ</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_comm_helper_helper">state_union_comm_helper_helper</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> <span class="id">l1</span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> <span class="id">l1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof97')">Proof.</div>
<div class="proofscript" id="proof97">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHPermutation</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_comm_swap">state_union_comm_swap</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">IHPermutation1</span>, <span class="id">IHPermutation2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_messages">state_union_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span>)) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma2</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof98')">Proof.</div>
<div class="proofscript" id="proof98">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_iff">list_to_state_iff</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_incl_right">state_union_incl_right</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma2</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof99')">Proof.</div>
<div class="proofscript" id="proof99">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_messages">state_union_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_incl_left">state_union_incl_left</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof100')">Proof.</div>
<div class="proofscript" id="proof100">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_messages">state_union_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_iff">state_union_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma1</span> <span class="id">sigma2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span>) &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma1</span> \/ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof101')">Proof.</div>
<div class="proofscript" id="proof101">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span>; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_messages">state_union_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_messages">state_union_messages</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_incl_iterated">state_union_incl_iterated</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigmas</span> (<span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">sigma</span> <span class="id">sigmas</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">sigmas</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof102')">Proof.</div>
<div class="proofscript" id="proof102">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sigmas</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_incl_left">state_union_incl_left</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHsigmas</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">sigmas</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_incl_right">state_union_incl_right</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_sorted">state_union_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof103')">Proof.</div>
<div class="proofscript" id="proof103">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_all">locally_sorted_all</a></span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> <span class="id">Hall1</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hall1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_all">locally_sorted_all</a></span> <span class="kwd">in</span> <span class="id">H0</span> <span class="kwd">as</span> <span class="id">Hall2</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hall2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_locally_sorted">list_to_state_locally_sorted</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hall1</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hall2</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_add_in_sorted">state_union_add_in_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> (<span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msg2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg2</span> <span class="id">sigma2</span>) = <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg2</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof104')">Proof.</div>
<div class="proofscript" id="proof104">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#sorted_syntactic_state_inclusion_equality_predicate">sorted_syntactic_state_inclusion_equality_predicate</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_sorted">state_union_sorted</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_sorted">state_union_sorted</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_iff">state_union_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_iff">state_union_iff</a></span>. <span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>.  <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_iff">state_union_iff</a></span>. <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_iff">state_union_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>. <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_iff">state_union_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="compare_strict_order_v">compare_strict_order_v</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} (<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>))<br/>
&nbsp;&nbsp;: <span class="id">CompareStrictOrder</span> (@<span class="id">triple_strictly_comparable_proj2_compare</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">HscM</span>)<br/>
&nbsp;&nbsp;:= @<span class="id">compare_strictorder</span> <span class="id">_</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">HscM</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="compare_eq_dec_v">compare_eq_dec_v</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} (<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>))<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : <span class="id">V</span>, {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id">compare_eq_dec</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_strict_order_v">compare_strict_order_v</a></span> <span class="id">HscM</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_messages">equivocating_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare_eq_dec</span> <span class="id">msg1</span> <span class="id">msg2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="kwd">match</span> <span class="id">msg1</span>, <span class="id">msg2</span> <span class="kwd">with</span> (<span class="id">c1</span>, <span class="id">v1</span>, <span class="id">j1</span>), (<span class="id">c2</span>, <span class="id">v2</span>, <span class="id">j2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v1</span> <span class="id">v2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span> <span class="id">msg1</span> <span class="id">j2</span>) &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span> <span class="id">msg2</span> <span class="id">j1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#right">right</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_messages_prop">equivocating_messages_prop</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">msg1</span> &lt;&gt; <span class="id">msg2</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg2</span> /\ ~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg2</span>) /\ ~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg2</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg1</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_sender">equivocating_messages_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof105')">Proof.</div>
<div class="proofscript" id="proof105">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">j1</span>] [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">j2</span>] <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>, <span class="id">v1</span>, <span class="id">j1</span>) (<span class="id">c2</span>, <span class="id">v2</span>, <span class="id">j2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_correct">equivocating_messages_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg1</span> <span class="id">msg2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof106')">Proof.</div>
<div class="proofscript" id="proof106">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">c1</span> <span class="id">v1</span>] <span class="id">j1</span>] [[<span class="id">c2</span> <span class="id">v2</span>] <span class="id">j2</span>]; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;inequality&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;sender&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_sender">equivocating_messages_sender</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;msg1&nbsp;is&nbsp;not&nbsp;in&nbsp;msg2's&nbsp;justification&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_correct">in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_absurd</span>. <span class="tactic">rewrite</span> <span class="id">H_absurd</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>) (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;msg2&nbsp;is&nbsp;not&nbsp;in&nbsp;msg1's&nbsp;justification&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_correct">in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_absurd</span>. <span class="tactic">rewrite</span> <span class="id">H_absurd</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>) (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">andb_false_r</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H_neq</span> [<span class="id">H_sender</span> [<span class="id">H_in1</span> <span class="id">H_in2</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_state_correct</span>' <span class="kwd">in</span> <span class="id">H_in1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_state_correct</span>' <span class="kwd">in</span> <span class="id">H_in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>) (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_in1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_in1</span>. <span class="tactic">rewrite</span> <span class="id">H_in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. <span class="id">contradiction</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_comm">equivocating_messages_comm</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg2</span> <span class="id">msg1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof107')">Proof.</div>
<div class="proofscript" id="proof107">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">sigma1</span>] [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">sigma2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>, <span class="id">v1</span>, <span class="id">sigma1</span>) (<span class="id">c2</span>, <span class="id">v2</span>, <span class="id">sigma2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">eq_dec_if_false</span> <span class="id">compare_eq_dec</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_comm">andb_comm</a></span>. <span class="tactic">reflexivity</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hnot</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hnot</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hnot</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hnot</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hnot</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hnot</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg1</span> <span class="id">msg2</span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg2</span> <span class="id">msg1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof108')">Proof.</div>
<div class="proofscript" id="proof108">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_comm">equivocating_messages_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="non_equivocating_messages_extend">non_equivocating_messages_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">sigma1</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma1</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof109')">Proof.</div>
<div class="proofscript" id="proof109">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c0</span>, <span class="id">v0</span>) <span class="id">sigma</span>']; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c0</span>, <span class="id">v0</span>, <span class="id">sigma</span>') (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma1</span>)).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;these&nbsp;two&nbsp;messages&nbsp;are&nbsp;equal,&nbsp;they&nbsp;cannot&nbsp;be&nbsp;equivocating&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;these&nbsp;messages&nbsp;are&nbsp;not&nbsp;equal,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;When&nbsp;their&nbsp;senders&nbsp;are&nbsp;equal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span> <span class="id">v0</span> <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_correct">in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="non_equivocating_messages_sender">non_equivocating_messages_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg1</span> &lt;&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof110')">Proof.</div>
<div class="proofscript" id="proof110">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">j1</span>] [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">j2</span>] <span class="id">Hneq</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hneq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Heq</span>. <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>. <span class="tactic">apply</span> <span class="id">Hneq</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_state">equivocating_in_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_state_prop">equivocating_in_state_prop</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>', <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span>' <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg</span> <span class="id">msg</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_correct">equivocating_in_state_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof111')">Proof.</div>
<div class="proofscript" id="proof111">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>. <span class="tactic">assumption</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_correct">equivocating_messages_correct</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'; <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_correct">equivocating_messages_correct</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivocating_in_state_correct</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; ~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof112')">Proof.</div>
<div class="proofscript" id="proof112">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mirror_reflect_curry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_incl">equivocating_in_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof113')">Proof.</div>
<div class="proofscript" id="proof113">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hin</span> <span class="id">Heq</span>]]. <span class="id">exists</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_not_seen">equivocating_in_state_not_seen</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>)) -&gt;<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof114')">Proof.</div>
<div class="proofscript" id="proof114">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>] <span class="id">sigma</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (@<span class="id">set_map_exists</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>)) <span class="kwd">in</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">equivocating_in_state_correct</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">existsb_forall</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">cx</span>, <span class="id">vx</span>) <span class="id">jx</span>] <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#non_equivocating_messages_sender">non_equivocating_messages_sender</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Heq</span>. <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">cx</span>, <span class="id">vx</span>, <span class="id">jx</span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) : <span class="tactic">set</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">msg</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_senders_prop">equivocating_senders_prop</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">lv</span> : <span class="tactic">set</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">lv</span> &lt;-&gt; <span class="id">exists</span> <span class="id">msg</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span> = <span class="id">v</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_correct">equivocating_senders_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_prop">equivocating_senders_prop</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof115')">Proof.</div>
<div class="proofscript" id="proof115">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Left&nbsp;direction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> <span class="id">H_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> [<span class="id">H_sender</span> <span class="id">H_equiv</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_incl">equivocating_senders_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof116')">Proof.</div>
<div class="proofscript" id="proof116">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_incl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>')).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_incl</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">v</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>. <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span> <span class="kwd">with</span> <span class="id">sigma</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_extend">equivocating_senders_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma</span>) <span class="id">to</span> <span class="id">sigma</span>) = <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof117')">Proof.</div>
<div class="proofscript" id="proof117">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Why&nbsp;doesn't&nbsp;the&nbsp;suff&nbsp;tactic&nbsp;work&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_suff</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> (<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma</span>)<span class="id">to</span> <span class="id">sigma</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma</span>)<span class="id">to</span> <span class="id">sigma</span>))) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>))); <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">H_suff</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hequiv</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma</span>) (<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">sigma</span>) <span class="id">to</span> <span class="id">sigma</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">existsb_forall</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_comm">equivocating_messages_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#non_equivocating_messages_extend">non_equivocating_messages_extend</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_eq_fn</span>. <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span>. <span class="tactic">split</span>; <span class="tactic">intros</span><br/>
&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span><br/>
&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">Hin</span> <span class="id">Hmsg</span>]]; <span class="id">exists</span> <span class="id">msg</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#non_equivocating_messages_extend">non_equivocating_messages_extend</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">c</span> <span class="id">v</span>) <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hmsg</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_unseen">equivocating_senders_unseen</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) <span class="id">j</span>,<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">sigma</span>)) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof118')">Proof.</div>
<div class="proofscript" id="proof118">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">v</span>' <span class="id">Hin</span><br/>
&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id">set_map_exists</span>; <span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [[(<span class="id">cx</span>, <span class="id">vx</span>) <span class="id">jx</span>] [<span class="id">Hin</span> <span class="id">Heq</span>]]<br/>
&nbsp;&nbsp;; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;; <span class="id">exists</span> (<span class="id">cx</span>, <span class="id">v</span>', <span class="id">jx</span>)<br/>
&nbsp;&nbsp;; <span class="tactic">simpl</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">HEquiv</span>]<br/>
&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> <span class="kwd">in</span> <span class="id">HEquiv</span><br/>
&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">HEquiv</span><br/>
&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">HEquiv</span> <span class="kwd">as</span> [[(<span class="id">cy</span>, <span class="id">vy</span>) <span class="id">jy</span>] [<span class="id">Hiny</span> <span class="id">HEquiv</span>]]<br/>
&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">Hiny</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnequiv</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) (<span class="id">cy</span>, <span class="id">vy</span>, <span class="id">jy</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">Hnequiv</span>  <span class="kwd">in</span> <span class="id">HEquiv</span>; <span class="tactic">inversion</span> <span class="id">HEquiv</span>); <span class="tactic">clear</span> <span class="id">HEquiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hiny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#non_equivocating_messages_sender">non_equivocating_messages_sender</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span>. <span class="id">exists</span> (<span class="id">cy</span>, <span class="id">vy</span>, <span class="id">jy</span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> (<span class="id">cy</span>, <span class="id">vy</span>, <span class="id">jy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hiny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exfalso</span>. <span class="tactic">inversion</span> <span class="id">H1</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span>. <span class="id">exists</span> (<span class="id">cx</span>, <span class="id">v</span>', <span class="id">jx</span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_sender">equivocating_messages_sender</a></span> <span class="kwd">in</span> <span class="id">HEquiv</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">HEquiv</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;-  <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">cy</span>, <span class="id">vy</span>, <span class="id">jy</span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fault_weight_state_incl">fault_weight_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span> &lt;= <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span>')%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof119')">Proof.</div>
<div class="proofscript" id="proof119">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> @<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>); <span class="tactic">intro</span> <span class="id">Scv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq_dec</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_incl">equivocating_senders_incl</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="incl_messages">incl_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="not_heavy">not_heavy</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_heavy_single">not_heavy_single</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> <span class="id">msg</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof120')">Proof.</div>
<div class="proofscript" id="proof120">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_le">Rge_le</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_heavy_subset">not_heavy_subset</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> <span class="id">s</span>' : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">s</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof121')">Proof.</div>
<div class="proofscript" id="proof121">
&nbsp;&nbsp;<span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span>'); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state_incl">fault_weight_state_incl</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>} `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="protocol_state">protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;| <span class="id"><a name="protocol_state_empty">protocol_state_empty</a></span> : <span class="id">protocol_state</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a name="protocol_state_next">protocol_state_next</a></span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">j</span>, <span class="id">protocol_state</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">protocol_state</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#incl_messages">incl_messages</a></span> <span class="id">j</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">protocol_state</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nil_empty_state">nil_empty_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s</span> = [] -&gt; <span class="id">s</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof122')">Proof.</div>
<div class="proofscript" id="proof122">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">H_nil</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_nil</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Facts about protocol states as traces *</div>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_sorted">protocol_state_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">state</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">state</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">state</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof123')">Proof.</div>
<div class="proofscript" id="proof123">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">s</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_not_heavy">protocol_state_not_heavy</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof124')">Proof.</div>
<div class="proofscript" id="proof124">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_le">Rge_le</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_valid_estimate">protocol_state_valid_estimate</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#estimate">estimate</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof125')">Proof.</div>
<div class="proofscript" id="proof125">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">H_ps</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H_ps</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_eq</span> | <span class="id">H_in</span>].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">IHH_ps1</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_singleton">protocol_state_singleton</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">c</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof126')">Proof.</div>
<div class="proofscript" id="proof126">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Heq</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> = (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_next">protocol_state_next</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_empty">protocol_state_empty</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy_single">not_heavy_single</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_start_from_empty">protocol_state_start_from_empty</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">s</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> \/ <span class="id">exists</span> <span class="id">msg</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof127')">Proof.</div>
<div class="proofscript" id="proof127">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>). <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">incl_empty</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#nil_empty_state">nil_empty_state</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IHprotocol_state2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">destruct</span> <span class="id">IHprotocol_state1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> <span class="id">H_empty</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> <span class="id">H_empty</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="copy_protocol_state">copy_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span> <span class="id">s</span> <span class="id">c</span>-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">s</span>) <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof128')">Proof.</div>
<div class="proofscript" id="proof128">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span> <span class="id">Hps</span> <span class="id">c</span> <span class="id">Hc</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> (<span class="id">add</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">sigma</span>) <span class="id">to</span> <span class="id">sigma</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy">not_heavy</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_extend">equivocating_senders_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">Hps</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="union_protocol_states">union_protocol_states</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof129')">Proof.</div>
<div class="proofscript" id="proof129">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">about_s1</span> <span class="id">about_s2</span> <span class="id">Hps1</span> <span class="id">Hps2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_sorted">list_to_state_sorted</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_sorted">protocol_state_sorted</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">replace</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>)) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s</span>)) <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="tactic">rewrite</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_add_in_sorted">state_union_add_in_sorted</a></span> <span class="id">s1</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_sorted">protocol_state_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_sorted">protocol_state_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="id">c</span> <span class="id">v</span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_sorted">protocol_state_sorted</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_next">protocol_state_next</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHps2_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_sorted">protocol_state_sorted</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_iff">state_union_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="message_subset_correct">message_subset_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#incl_messages">incl_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg</span>) <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof130')">Proof.</div>
<div class="proofscript" id="proof130">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">H_ps</span> <span class="id">msg</span> <span class="id">H_in_msg</span> <span class="id">m</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H_ps</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_in_msg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="id">m</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_useful</span>. <span class="tactic">clear</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in_msg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in_msg</span> <span class="kwd">as</span> [<span class="id">H_eq</span> | <span class="id">H_in_msg</span>].<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H</span> <span class="id">m</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">H_left</span> <span class="id">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_right</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">right</span>; <span class="tactic">apply</span> <span class="id">IHH_ps1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Lemmas about justifications of messages contained within protocol states, i.e. "past" protocol states *</div>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_justification">protocol_state_justification</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof131')">Proof.</div>
<div class="proofscript" id="proof131">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">H_ps</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H_ps</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">left</span> | <span class="id">right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id">IHH_ps1</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_all_justifications">protocol_state_all_justifications</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof132')">Proof.</div>
<div class="proofscript" id="proof132">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">H_ps</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H_ps</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_justif</span> <span class="id">H_justif_in</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_justification">protocol_state_justification</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>)); <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="no_self_justification">no_self_justification</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">j</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof133')">Proof.</div>
<div class="proofscript" id="proof133">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">H_prot</span> <span class="id">c</span> <span class="id">v</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H_prot</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_eq</span> | <span class="id">H_in</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">IHH_prot2</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H5</span> <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> (<span class="id">c0</span>,<span class="id">v0</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H_useful</span>. <span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">H_left</span> <span class="id">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_right</span> (<span class="id">c0</span>,<span class="id">v0</span>,<span class="id">j</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> (<span class="id">c0</span>,<span class="id">v0</span>,<span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_extx_in_x">not_extx_in_x</a></span> <span class="id">c</span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c0</span>,<span class="id">v0</span>,<span class="id">j</span>) <span class="id">s</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#set_eq_add_in_sorted">set_eq_add_in_sorted</a></span> (<span class="id">c0</span>,<span class="id">v0</span>,<span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">msg</span>. <span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="messages_equivocating_senders_eq">messages_equivocating_senders_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof134')">Proof.</div>
<div class="proofscript" id="proof134">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> [<span class="id">H_eq1</span> <span class="id">H_eq2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_equiv1</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">H_eq1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_equiv2</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span> <span class="id">s2</span> <span class="id">s1</span> <span class="id">H_eq2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_eq1</span> <span class="id">msg</span>. <span class="id">spec</span> <span class="id">H_eq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg_in</span> <span class="kwd">as</span> [<span class="id">H_goal</span> <span class="id">_</span>]; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg_in</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_equiv1</span> <span class="id">msg</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_eq2</span> <span class="id">msg</span>. <span class="id">spec</span> <span class="id">H_eq2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg_in</span> <span class="kwd">as</span> [<span class="id">H_goal</span> <span class="id">_</span>]; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg_in</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_equiv2</span> <span class="id">msg</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_empty">equivocating_senders_empty</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">C</span> <span class="id">V</span>) = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof135')">Proof.</div>
<div class="proofscript" id="proof135">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivocating_senders_extend</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">to</span> <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof136')">Proof.</div>
<div class="proofscript" id="proof136">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in</span>; <span class="tactic">apply</span> <span class="id">set_map_exists</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Arbitrary&nbsp;v0&nbsp;is&nbsp;an&nbsp;equivocating&nbsp;sender&nbsp;in&nbsp;the&nbsp;new&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Arbitrary&nbsp;v0&nbsp;has&nbsp;sent&nbsp;an&nbsp;equivocating_in_state&nbsp;message&nbsp;in&nbsp;the&nbsp;new&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> <span class="id">H_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_in</span> <span class="id">H_equiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span>' <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;message&nbsp;has&nbsp;an&nbsp;equivocation&nbsp;partner&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Both&nbsp;of&nbsp;these&nbsp;messages&nbsp;are&nbsp;in&nbsp;the&nbsp;new&nbsp;state&nbsp;-&nbsp;case&nbsp;analysis&nbsp;on&nbsp;each&nbsp;of&nbsp;them&nbsp;with&nbsp;the&nbsp;hd&nbsp;element&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_hd</span> | <span class="id">H_tl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;first&nbsp;equivocating&nbsp;message&nbsp;is&nbsp;the&nbsp;hd&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>' <span class="kwd">as</span> [<span class="id">H_absurd</span> | <span class="id">H_in</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;second&nbsp;equivocating&nbsp;message&nbsp;is&nbsp;also&nbsp;the&nbsp;hd,&nbsp;we&nbsp;have&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H_equiv</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;second&nbsp;equivocarting&nbsp;message&nbsp;is&nbsp;in&nbsp;the&nbsp;tl,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H_in0</span> [<span class="id">H_sender0</span> <span class="id">H_equiv0</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;first&nbsp;equivocating&nbsp;message&nbsp;is&nbsp;in&nbsp;the&nbsp;tl,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>' <span class="kwd">as</span> [<span class="id">H_hd</span>' | <span class="id">H_tl</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;second&nbsp;equivocating&nbsp;message&nbsp;is&nbsp;the&nbsp;hd,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H_in0</span> [<span class="id">H_sender0</span> <span class="id">H_equiv0</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">H_sender</span> <span class="id">_</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_sender</span>. <span class="tactic">symmetry</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;second&nbsp;equivocating&nbsp;message&nbsp;is&nbsp;in&nbsp;the&nbsp;tl,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Arbitrary&nbsp;v0&nbsp;is&nbsp;an&nbsp;equivocating&nbsp;sender&nbsp;in&nbsp;the&nbsp;old&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H_in0</span> <span class="id">H_sender0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span> <span class="kwd">as</span> [<span class="id">H_in0</span> <span class="id">H_equiv0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span> <span class="kwd">with</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_msg_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof137')">Proof.</div>
<div class="proofscript" id="proof137">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">H_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> @<span class="id"><a href="CasperCBC.CBC.Common.html#set_eq_nodup_sum_weight_eq">set_eq_nodup_sum_weight_eq</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>) <span class="kwd">as</span> <span class="id">Sc</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">compare_eq_dec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="messages_fault_weight_eq">messages_fault_weight_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof138')">Proof.</div>
<div class="proofscript" id="proof138">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">H_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_equivocating_senders_eq">messages_equivocating_senders_eq</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_next_equivocating_senders_eq">add_next_equivocating_senders_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>) <span class="id">j</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof139')">Proof.</div>
<div class="proofscript" id="proof139">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_obv</span> : <span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id">j</span>) <span class="id">s</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_in</span>. <span class="tactic">subst</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_equivocating_senders_eq">messages_equivocating_senders_eq</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_already_equivocating_sender">add_already_equivocating_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof140')">Proof.</div>
<div class="proofscript" id="proof140">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">v</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_v_in</span> <span class="id">H_msg</span>'<span class="id">_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_msg</span>'<span class="id">_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_v_in</span> <span class="id">H_msg</span>'<span class="id">_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span> <span class="kwd">as</span> [<span class="id">H_v_in</span> <span class="id">H_equiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> [<span class="id">H_msg</span>'<span class="id">_partner_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_msg</span>'<span class="id">_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_msg</span>'<span class="id">_partner_in</span>. <span class="tactic">destruct</span> <span class="id">H_msg</span>'<span class="id">_partner_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">destruct</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">s</span>)) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">v</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof141')">Proof.</div>
<div class="proofscript" id="proof141">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">msg</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-  <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> [<span class="id">H_sender</span> <span class="id">H_equiv</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_eq</span> | <span class="id">H_noteq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg_partner</span> [<span class="id">H_msg_partner</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">split</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_msg_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg_partner</span>. <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> [<span class="id">H_msg</span>'<span class="id">_partner</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_msg</span>'<span class="id">_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg</span>'<span class="id">_partner</span> <span class="kwd">as</span> [<span class="id">H_eq</span>' | <span class="id">H_noteq</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">destruct</span> <span class="id">H_equiv</span>. <span class="tactic">split</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">split</span>. <span class="id">easy</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>. <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span>. <span class="tactic">split</span>. <span class="tactic">subst</span>; <span class="tactic">symmetry</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[<span class="id">H_sender</span> <span class="id">H_equiv</span>] | <span class="id">H_noteq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg_partner</span> [<span class="id">H_msg_partner</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">destruct</span> <span class="id">H_equiv</span>. <span class="tactic">symmetry</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>. <span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">set_map_exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_noteq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_noteq</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. 2 : <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> <span class="id">about_msg</span>'<span class="id">_partner</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_equivocating_sender">add_equivocating_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">msg</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span>' <span class="id">s</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg</span> <span class="id">msg</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof142')">Proof.</div>
<div class="proofscript" id="proof142">
&nbsp;&nbsp;<span class="comment">(*&nbsp;Because&nbsp;we're&nbsp;using&nbsp;set_add,&nbsp;we&nbsp;don't&nbsp;need&nbsp;to&nbsp;care&nbsp;about&nbsp;whether&nbsp;(sender&nbsp;msg)&nbsp;is&nbsp;already&nbsp;in&nbsp;(equivocating_senders&nbsp;s)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">msg</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span>)) <span class="kwd">as</span> [<span class="id">H_msg_in</span> | <span class="id">H_msg_out</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;msg&nbsp;is&nbsp;already&nbsp;in&nbsp;s,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Adding&nbsp;it&nbsp;does&nbsp;nothing&nbsp;to&nbsp;the&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">s_sorted</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_sorted">protocol_state_sorted</a></span> <span class="id">s</span> <span class="id">about_s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_ignore</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_ignore">add_in_sorted_ignore</a></span> <span class="id">msg</span> <span class="id">s</span> <span class="id">s_sorted</span> <span class="id">H_msg_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">H_ignore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_ignore</span> <span class="id">s_sorted</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Adding&nbsp;the&nbsp;sender&nbsp;should&nbsp;do&nbsp;nothing&nbsp;to&nbsp;(equivocating_senders&nbsp;s)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;following&nbsp;is&nbsp;winding&nbsp;and&nbsp;painful&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="kwd">in</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (@<span class="id">set_map_exists</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>)) <span class="kwd">in</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_mem</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H0_in</span> <span class="id">H0_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H0_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_senders</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H_senders</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0_in</span> <span class="kwd">as</span> [<span class="id">H0_in</span> <span class="id">H0_equiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">msg</span> = <span class="id">msg0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">spec</span> <span class="id">H_senders</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_senders</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H0_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0_equiv</span> <span class="kwd">as</span> [<span class="id">msg0_partner</span> [<span class="id">H0_equivl</span> <span class="id">H0_equivr</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0_partner</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0_equivr</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">H_goal</span> <span class="id">_</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg0</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">exact</span> <span class="id">H0_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;following&nbsp;will&nbsp;also&nbsp;be&nbsp;winding&nbsp;and&nbsp;painful&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v0</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;msg&nbsp;is&nbsp;not&nbsp;already&nbsp;in&nbsp;s,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;all&nbsp;we&nbsp;know&nbsp;(sender&nbsp;msg)&nbsp;could&nbsp;already&nbsp;be&nbsp;in&nbsp;(equivocating_senders&nbsp;s)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;(sender&nbsp;msg)&nbsp;is&nbsp;already&nbsp;in&nbsp;there,&nbsp;then&nbsp;adding&nbsp;it&nbsp;again&nbsp;does&nbsp;nothing&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_ignore</span> : <span class="id">set_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">v</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>. <span class="id">right</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span> <span class="kwd">in</span> <span class="id">H_ignore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">set_eq_tran</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">exact</span> <span class="id">H_ignore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_already_equivocating_sender">add_already_equivocating_sender</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;(sender&nbsp;msg)&nbsp;is&nbsp;not&nbsp;already&nbsp;in&nbsp;there&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v0</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg</span> <span class="kwd">as</span> [[<span class="id">c</span> <span class="id">v</span>] <span class="id">j</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v0</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H_in0</span> <span class="id">H_sender0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span>. <span class="id">exists</span> <span class="id">msg0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. 2 : <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">msg0_partner</span> [<span class="id">H_in0</span> <span class="id">H_equiv0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>; <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="valid_protocol_state">valid_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) (<span class="id">csigma</span> <span class="id">cempty</span> : <span class="id">C</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">v</span> <span class="id">sigma</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">csigma</span>, <span class="id">v</span>, <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">sigma</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vs</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_protocol_state">in_valid_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span> \/<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> /\ (<span class="id">msg</span> = (<span class="id">csigma</span>, <span class="id">v</span>, <span class="id">sigma</span>) \/ (<span class="id">msg</span> = (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>))).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof143')">Proof.</div>
<div class="proofscript" id="proof143">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Heq</span> | <span class="id">Hin</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">right</span>; <span class="id">exists</span> <span class="id">a</span>; <span class="tactic">split</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>); (<span class="id">left</span>; <span class="tactic">assumption</span>) || (<span class="id">right</span>; <span class="tactic">assumption</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHvs</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">assumption</span>). <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">Hin</span> <span class="id">H</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_protocol_state_rev_sigma">in_valid_protocol_state_rev_sigma</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">sigma</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof144')">Proof.</div>
<div class="proofscript" id="proof144">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_protocol_state_rev_csigma">in_valid_protocol_state_rev_csigma</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id">csigma</span>, <span class="id">v</span>, <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof145')">Proof.</div>
<div class="proofscript" id="proof145">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.  <span class="tactic">apply</span> <span class="id">IHvs</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_valid_protocol_state_rev_cempty">in_valid_protocol_state_rev_cempty</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">sigma</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof146')">Proof.</div>
<div class="proofscript" id="proof146">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.  <span class="tactic">apply</span> <span class="id">IHvs</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="valid_protocol_state_equivocating_senders">valid_protocol_state_equivocating_senders</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">cempty</span> : <span class="id">C</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">cempty</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>) <span class="id">vs</span>,<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">csigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">csigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>)) <span class="id">vs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof147')">Proof.</div>
<div class="proofscript" id="proof147">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="kwd">as</span> <span class="id">sigma</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">sigma2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">set_map_exists</span>  <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [[(<span class="id">cx</span>, <span class="id">vx</span>) <span class="id">jx</span>] [<span class="id">Hin</span> <span class="id">Hsend</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsend</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hsend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Hequiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hequiv</span> <span class="kwd">as</span> [[(<span class="id">cy</span>, <span class="id">vy</span>) <span class="id">jy</span>] [<span class="id">Hiny</span> <span class="id">Hequiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqsigma2</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state">in_valid_protocol_state</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> | [<span class="id">vv</span> [<span class="id">Hin</span> [<span class="id">Heq</span> | <span class="id">Heq</span>]]]]; <span class="tactic">try</span> (<span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqsigma</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqsigma2</span> <span class="kwd">in</span> <span class="id">Hiny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state">in_valid_protocol_state</a></span> <span class="kwd">in</span> <span class="id">Hiny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hiny</span> <span class="kwd">as</span> [<span class="id">Hiny</span> | [<span class="id">vv</span> [<span class="id">Hiny</span> [<span class="id">Heq</span> | <span class="id">Heq</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Heqsigma</span> <span class="kwd">in</span> <span class="id">Hiny</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">Hiny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hin</span> <span class="kwd">in</span> <span class="id">Hequiv</span>. <span class="tactic">rewrite</span> <span class="id">Hiny</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">Hequiv</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Hin</span> <span class="kwd">in</span> <span class="id">Hequiv</span>. <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">Hequiv</span>; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin</span>. <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H2</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Hin</span> <span class="kwd">in</span> <span class="id">Hequiv</span>. <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">Hequiv</span>; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin</span>. <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H2</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">set_map_exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">cempty</span>, <span class="id">x</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>). <span class="tactic">simpl</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Heqsigma2</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state_rev_cempty">in_valid_protocol_state_rev_cempty</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> (<span class="id">csigma</span>, <span class="id">x</span>, <span class="id">sigma</span>). <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">Heqsigma2</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state_rev_csigma">in_valid_protocol_state_rev_csigma</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqsigma</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H2</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_empty_state">in_empty_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="valid_protocol_state_ps">valid_protocol_state_ps</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">cempty</span> : <span class="id">C</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id">cempty</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> : <span class="id">V</span>,<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">csigma</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">csigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</div>
<div class="proofscript" id="proof148">
&nbsp;&nbsp;<span class="id">pose</span> (@<span class="id">strictly_comparable_eq_dec</span> <span class="id">_</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>)) <span class="kwd">as</span> <span class="id">HEqDec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_singleton">protocol_state_singleton</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">a</span>) + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>)%<span class="id">R</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_0_l">Rplus_0_l</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>)) <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_compat_r">Rplus_le_compat_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_le">Rge_le</a></span>. <span class="id">left</span>. <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">a</span>). <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H2</span>. <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m</span> <span class="id">H_in</span>. <span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id">a</span> :: <span class="id">vs</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="kwd">as</span> <span class="id">sigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">cempty</span> <span class="id">vs</span>) <span class="kwd">as</span> <span class="id">sigma2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">set_eq_proj1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_unseen">equivocating_senders_unseen</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [[(<span class="id">cx</span>, <span class="id">vx</span>) <span class="id">jx</span>] [<span class="id">Hin</span> <span class="id">Heq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqsigma2</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state">in_valid_protocol_state</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">Heqsigma</span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H2</span>. <span class="tactic">inversion</span> <span class="id">H4</span>. <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">vv</span> [<span class="id">Hin</span> <span class="id">Heq</span>]]. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Hnin</span> <span class="id">Hnodup</span>]. <span class="tactic">apply</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Heq</span>]; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">set_eq_proj1</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state_equivocating_senders">valid_protocol_state_equivocating_senders</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H2</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_singleton">protocol_state_singleton</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hcontra</span>]; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state_rev_sigma">in_valid_protocol_state_rev_sigma</a></span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">red</span>; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id">a</span> :: <span class="id">vs</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">cempty</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">csigma</span> <span class="id">cempty</span> (<span class="id">a</span> :: <span class="id">vs</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span>  <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_proj1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state_equivocating_senders">valid_protocol_state_equivocating_senders</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
