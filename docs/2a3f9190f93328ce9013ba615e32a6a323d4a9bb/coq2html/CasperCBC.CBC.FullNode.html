
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.CBC.FullNode</title>
<meta name="description" content="Documentation of Coq module CasperCBC.CBC.FullNode" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.CBC.FullNode</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Reals.html">Reals</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relations.html">Relations</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html">RelationClasses</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Setoids.Setoid.html">Setoid</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.EqdepFacts.html">EqdepFacts</a></span> .<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lib.Preamble</span> <span class="id">Lib.ListExtras</span> <span class="id">Lib.ListSetExtras</span> <span class="id">Lib.RealsExtras</span> <span class="id">VLSM.Equivocation</span> <span class="id">VLSM.Decisions</span> <span class="id">Lib.Measurable</span> <span class="id"><a href="CasperCBC.CBC.Protocol.html">CBC.Protocol</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html">CBC.Common</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html">CBC.Definitions</a></span>.<br/>
<br/>
<div class="doc">Building blocks for instancing CBC_protocol with full node version *</div>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_state">sorted_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>) `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">Type</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>| <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s</span> }.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_state_proj1">sorted_state_proj1</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s</span>.<br/>
<span class="kwd">Coercion</span> <span class="id">sorted_state_proj1</span> : <span class="id">sorted_state</span> &gt;-&gt; <span class="id">state</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="make_sorted_state">make_sorted_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sort_state">sort_state</a></span> <span class="id">s</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sort_state_locally_sorted">sort_state_locally_sorted</a></span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="make_already_sorted_state">make_already_sorted_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#make_sorted_state">make_sorted_state</a></span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">Hs</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof144')">Proof.</div>
<div class="proofscript" id="proof144">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#make_sorted_state">make_sorted_state</a></span>. <span class="tactic">apply</span> <span class="id">exist_eq</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sort_state_idempotent">sort_state_idempotent</a></span> <span class="id">s</span> <span class="id">Hs</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_message">sorted_message</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>) `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">Type</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;(<span class="id">C</span> * <span class="id">V</span> * <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_message_proj1">sorted_message_proj1</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sm</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_message">sorted_message</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sm</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">c</span>, <span class="id">v</span>, <span class="id">sj</span>) =&gt; (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">sj</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Coercion</span> <span class="id">sorted_message_proj1</span> : <span class="id">sorted_message</span> &gt;-&gt; <span class="id">message</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="make_sorted_message">make_sorted_message</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_message">sorted_message</a></span> <span class="id">C</span> <span class="id">V</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof145')">Proof.</div>
<div class="proofscript" id="proof145">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [((<span class="id">c</span>,<span class="id">v</span>), <span class="id">j</span>) <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_message_justification">locally_sorted_message_justification</a></span> <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">j</span> <span class="id">Hs</span>).<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="get_sorted_messages">get_sorted_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:  <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_message">sorted_message</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">sigma</span>, <span class="id">Hsigma</span>) := <span class="id">s</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgs</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#make_sorted_message">make_sorted_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">list_annotate</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_msg">locally_sorted_msg</a></span> <span class="id">msgs</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_all">locally_sorted_all</a></span> <span class="id">sigma</span> <span class="id">Hsigma</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="add_message_sorted">add_message_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sm</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_message">sorted_message</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;(<span class="id">ss</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:  <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof146')">Proof.</div>
<div class="proofscript" id="proof146">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sm</span> <span class="kwd">as</span> [(<span class="id">c</span>,<span class="id">v</span>) [<span class="id">j</span> <span class="id">Hj</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ss</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id">j</span>) <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_sorted">add_in_sorted_sorted</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state0_neutral">state0_neutral</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof147')">Proof.</div>
<div class="proofscript" id="proof147">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_sorted">list_to_state_sorted</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_state0">sorted_state0</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>) `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> (<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span> <span class="id">s</span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#LSorted_Empty">LSorted_Empty</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_state_inhabited">sorted_state_inhabited</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</div>
<div class="proofscript" id="proof148">
 <span class="tactic">exact</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state0">sorted_state0</a></span> <span class="id">C</span> <span class="id">V</span>). Qed.</div>
<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="state_strictly_comparable">state_strictly_comparable</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">triple_strictly_comparable_proj3</span> <span class="id">about_M</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_state_compare">sorted_state_compare</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison">comparison</a></span><br/>
&nbsp;&nbsp;:= <span class="id">sigify_compare</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_state_compare_reflexive">sorted_state_compare_reflexive</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id">CompareReflexive</span> (@<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_compare">sorted_state_compare</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">about_M</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof149')">Proof.</div>
<div class="proofscript" id="proof149">
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s1</span> <span class="kwd">as</span> [<span class="id">s1</span> <span class="id">about_s1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s2</span> <span class="kwd">as</span> [<span class="id">s2</span> <span class="id">about_s2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">assert</span> (<span class="id">about_s</span> : <span class="id">CompareStrictOrder</span> <span class="id">triple_strictly_comparable_proj3_compare</span>) <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id">triple_strictly_comparable_proj3_strictorder</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">about_s</span>. <span class="id">spec</span> <span class="id">StrictOrder_Reflexive</span> <span class="id">s1</span> <span class="id">s2</span>. <span class="tactic">rewrite</span> <span class="id">StrictOrder_Reflexive</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">exist_eq</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_state_compare_transitive">sorted_state_compare_transitive</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id">CompareTransitive</span> (@<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_compare">sorted_state_compare</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">about_M</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">c</span> <span class="id">H12</span> <span class="id">H23</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s1</span> <span class="kwd">as</span> [<span class="id">s1</span> <span class="id">about_s1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s2</span> <span class="kwd">as</span> [<span class="id">s2</span> <span class="id">about_s2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s3</span> <span class="kwd">as</span> [<span class="id">s3</span> <span class="id">about_s3</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (@<span class="id">StrictOrder_Transitive</span> <span class="id">_</span> <span class="id">_</span> <span class="id">triple_strictly_comparable_proj3_strictorder</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">c</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="sorted_state_strictorder">sorted_state_strictorder</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id">CompareStrictOrder</span> (@<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_compare">sorted_state_compare</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">about_M</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id">StrictOrder_Reflexive</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_compare_reflexive">sorted_state_compare_reflexive</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">StrictOrder_Transitive</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_compare_transitive">sorted_state_compare_transitive</a></span>; }.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="sorted_state_type">sorted_state_type</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id">inhabited</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_inhabited">sorted_state_inhabited</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare</span> := <span class="id">sigify_compare</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted">locally_sorted</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare_strictorder</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_strictorder">sorted_state_strictorder</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_state_union_comm">sorted_state_union_comm</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s2</span> <span class="id">s1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s1</span> <span class="kwd">as</span> [<span class="id">s1</span> <span class="id">about_s1</span>];<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s2</span> <span class="kwd">as</span> [<span class="id">s2</span> <span class="id">about_s2</span>];<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_sorted">list_to_state_sorted</a></span> <span class="id">s1</span> <span class="id">about_s1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span>' := <span class="id"><a href="CasperCBC.CBC.Definitions.html#locally_sorted_all">locally_sorted_all</a></span> <span class="id">s1</span> <span class="id">about_s1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_duh</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation">Permutation</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html#Permutation_app_comm">Permutation_app_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_comm_helper_helper">state_union_comm_helper_helper</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="sorted_state_union">sorted_state_union</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">sigma1</span> <span class="id">sigma2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state">list_to_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma2</span>))) <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof152')">Next Obligation.</div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union_sorted">state_union_sorted</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma1</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma2</span>; <span class="tactic">assumption</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_state_sorted_union_comm">sorted_state_sorted_union_comm</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union">sorted_state_union</a></span> <span class="id">s1</span> <span class="id">s2</span> = <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union">sorted_state_union</a></span> <span class="id">s2</span> <span class="id">s1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof153')">Proof.</div>
<div class="proofscript" id="proof153">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union_comm">sorted_state_union_comm</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union">sorted_state_union</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">exist_eq</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="reachable">reachable</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_proj1">sorted_state_proj1</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_proj1">sorted_state_proj1</a></span> <span class="id">s2</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reachable_refl">reachable_refl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>, <span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">s</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof154')">Proof.</div>
<div class="proofscript" id="proof154">
 <span class="tactic">intros</span>; <span class="id">easy</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reachable_trans">reachable_trans</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> <span class="id">sigma3</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">sigma2</span> <span class="id">sigma3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">sigma1</span> <span class="id">sigma3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof155')">Proof.</div>
<div class="proofscript" id="proof155">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>). <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">sigma2</span>); <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reach_union">reach_union</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">s1</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union">sorted_state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof156')">Proof.</div>
<div class="proofscript" id="proof156">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_incl</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_iff">list_to_state_iff</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_incl</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">useful</span>].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">useful</span> <span class="id">x</span>. <span class="id">spec</span> <span class="id">useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reachable_morphism">reachable_morphism</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">s2</span> = <span class="id">s3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">s1</span> <span class="id">s3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof157')">Proof.</div>
<div class="proofscript" id="proof157">
 <span class="tactic">intros</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>. Qed.</div>
<br/>
<div class="doc">Proof obligations from CBC_protocol *</div>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocation_weight_compat">equivocation_weight_compat</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">Hm</span> : <span class="id">Measurable</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>), (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> &lt;= <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s2</span> <span class="id">s1</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof158')">Proof.</div>
<div class="proofscript" id="proof158">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state_incl">fault_weight_state_incl</a></span> <span class="id">s1</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>)).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span>' := <span class="id"><a href="CasperCBC.CBC.Definitions.html#list_to_state_iff">list_to_state_iff</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">s2</span>))).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span>' <span class="kwd">as</span> [<span class="id">_</span> <span class="id">useful</span>]. <span class="tactic">intros</span> <span class="id">x</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">useful</span> <span class="id">x</span>. <span class="id">spec</span> <span class="id">useful</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#messages_union">messages_union</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s2</span> <span class="id">s1</span>) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>) <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union_comm">sorted_state_union_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_sorted_state0">about_sorted_state0</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state0">sorted_state0</a></span> <span class="id">C</span> <span class="id">V</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof159')">Proof.</div>
<div class="proofscript" id="proof159">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state0">sorted_state0</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_empty">protocol_state_empty</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">union_protocol_states</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union">sorted_state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_union">sorted_state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof160')">Proof.</div>
<div class="proofscript" id="proof160">
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">s1</span> <span class="id">about_s1</span>] [<span class="id">s2</span> <span class="id">about_s2</span>] <span class="id">H_prot1</span> <span class="id">H_prot2</span> <span class="id">H_weight</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#union_protocol_states">union_protocol_states</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reach_morphism">reach_morphism</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id">s2</span> = <span class="id">s3</span> -&gt; <span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span> <span class="id">s1</span> <span class="id">s3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof161')">Proof.</div>
<div class="proofscript" id="proof161">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">H_12</span> <span class="id">H_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">easy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sorted_estimator">sorted_estimator</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">c</span> : <span class="id">C</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">estimator</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s</span>) <span class="id">c</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sorted_estimator_total">sorted_estimator_total</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>, <span class="id">exists</span> <span class="id">c</span> : <span class="id">C</span>, <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_estimator">sorted_estimator</a></span> <span class="id">s</span> <span class="id">c</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof162')">Proof.</div>
<div class="proofscript" id="proof162">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">He</span>. <span class="tactic">destruct</span> <span class="id">s</span>. <span class="tactic">destruct</span> (<span class="id">estimator_total</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x0</span>. <span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="sorted_estimator_instance">sorted_estimator_instance</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="id">Estimator</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id">estimator</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_estimator">sorted_estimator</a></span><br/>
&nbsp;&nbsp;; <span class="id">estimator_total</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_estimator_total">sorted_estimator_total</a></span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="FullNode_syntactic">FullNode_syntactic</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>} : <span class="id"><a href="CasperCBC.CBC.Protocol.html#CBC_protocol_eq">CBC_protocol_eq</a></span> :=<br/>
&nbsp;&nbsp;{ <span class="id"><a href="CasperCBC.CBC.Protocol.html#consensus_values">consensus_values</a></span> := <span class="id">C</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_consensus_values">about_consensus_values</a></span> := <span class="id">triple_strictly_comparable_proj1</span> <span class="id">about_M</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#validators">validators</a></span> := <span class="id">V</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_validators">about_validators</a></span> :=  <span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#weight">weight</a></span> := <span class="id">Measurable.weight</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#t">t</a></span> := <span class="id">threshold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#suff_val">suff_val</a></span> := <span class="id">reachable_threshold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state">state</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state">sorted_state</a></span> <span class="id">C</span> <span class="id">V</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_state">about_state</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_type">sorted_state_type</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state0">state0</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state0">sorted_state0</a></span> <span class="id">C</span> <span class="id">V</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state_eq">state_eq</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state_union_comm">state_union_comm</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_state_sorted_union_comm">sorted_state_sorted_union_comm</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach">reach</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable">reachable</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_refl">reach_refl</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable_refl">reachable_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_trans">reach_trans</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#reachable_trans">reachable_trans</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_union">reach_union</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#reach_union">reach_union</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_morphism">reach_morphism</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#reach_morphism">reach_morphism</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#E">E</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_estimator">sorted_estimator</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#estimator_total">estimator_total</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#sorted_estimator_total">sorted_estimator_total</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#prot_state">prot_state</a></span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_state0">about_state0</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_sorted_state0">about_sorted_state0</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#equivocation_weight">equivocation_weight</a></span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#equivocation_weight_compat">equivocation_weight_compat</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocation_weight_compat">equivocation_weight_compat</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_prot_state">about_prot_state</a></span> := <span class="id">union_protocol_states</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate">pstate</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>) `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">Type</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> | <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span>}.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate_proj1">pstate_proj1</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">p</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">p</span>.<br/>
<span class="kwd">Coercion</span> <span class="id">pstate_proj1</span> : <span class="id">pstate</span> &gt;-&gt; <span class="id">state</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate_rel">pstate_rel</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_proj1">pstate_proj1</a></span> <span class="id">p1</span>) (<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_proj1">pstate_proj1</a></span> <span class="id">p2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="non_trivial_pstate">non_trivial_pstate</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">s1</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">s1</span> <span class="id">s</span> -&gt; <span class="id">P</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">s2</span> <span class="id">s</span> -&gt; (<span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="exists_pivotal_validator_ps">exists_pivotal_validator_ps</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;`{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id"><a href="CasperCBC.CBC.Common.html#exists_pivotal_validator">exists_pivotal_validator</a></span> <span class="id">V</span> (@<span class="id">strictly_comparable_eq_dec</span> <span class="id">_</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>)) <span class="id">Hm</span> <span class="id">Hrt</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="non_triviality_decisions_on_properties_of_protocol_states">non_triviality_decisions_on_properties_of_protocol_states</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;`{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">p</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span> -&gt; <span class="kwd">Prop</span>) , <span class="id"><a href="CasperCBC.CBC.FullNode.html#non_trivial_pstate">non_trivial_pstate</a></span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof163')">Proof.</div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;<span class="id">pose</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>) <span class="kwd">as</span> <span class="id">HscV</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> (@<span class="id">strictly_comparable_eq_dec</span> <span class="id">_</span> <span class="id">HscV</span>) <span class="kwd">as</span> <span class="id">HeqV</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Decisions.estimator_total</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="kwd">as</span> [<span class="id">c</span> <span class="id">Hc</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#exists_pivotal_validator_ps">exists_pivotal_validator_ps</a></span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">vs</span> [<span class="id">Hnodup</span> [<span class="id">Hnin</span> [<span class="id">Hlt</span> <span class="id">Hgt</span>]]]]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span> <span class="kwd">as</span> [ | <span class="id">v</span>' <span class="id">vs</span>].<br/>
&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">bleh</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)) <span class="tactic">by</span> <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_singleton">protocol_state_singleton</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">bleh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#distinct_choice_total">distinct_choice_total</a></span> <span class="id">v</span>) <span class="kwd">as</span> [<span class="id">v</span>' <span class="id">Hv</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="kwd">as</span> <span class="id">sigma0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hps0</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">sigma0</span>) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_singleton">protocol_state_singleton</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Decisions.estimator_total</span> <span class="id">sigma0</span>) <span class="kwd">as</span> [<span class="id">c0</span> <span class="id">Hc0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">bleh</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>) <span class="id">sigma0</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>) <span class="id">sigma0</span>) <span class="id">bleh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span>' <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">bleh</span> <span class="kwd">as</span> <span class="id">Hft</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnft</span>' : (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span>' &gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_le_trans">Rlt_le_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id">to</span> (<span class="id">add</span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>) <span class="id">to</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ( <span class="id">Hequiv</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)<span class="id">to</span> (<span class="id">add</span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>)<span class="id">to</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hv</span>'. <span class="tactic">inversion</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_empty_state">in_empty_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span>. <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> ( <span class="id">Hequiv0</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state">equivocating_in_state</a></span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">add</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)<span class="id">to</span> (<span class="id">add</span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>)<span class="id">to</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_empty_state">in_empty_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hv</span>'. <span class="tactic">inversion</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span>. <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hequiv0</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rminus">Rminus</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_gt_compat_r">Rplus_gt_compat_r</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>))) <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_0_l">Rplus_0_l</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">rewrite</span> <span class="id">Rplus_opp_l</span> <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_lt">Rgt_lt</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state_incl">fault_weight_state_incl</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> | [<span class="id">Hin</span> | <span class="id">Hcontra</span>]]; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hcontra</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="kwd">in</span> <span class="id">H</span>'. <span class="tactic">apply</span> <span class="id">H</span>'. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rgt">Rgt</a></span> <span class="kwd">in</span> <span class="id">Hnft</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_irrefl">Rlt_irrefl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_le_trans">Rlt_le_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span>'). <span class="tactic">assumption</span>. <span class="tactic">destruct</span> <span class="id">sigma</span>' <span class="kwd">as</span> [<span class="id">sigma</span>' <span class="id">about_sigma</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">about_sigma</span>'. <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="kwd">as</span> <span class="id">sigma0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hps0</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">sigma0</span>) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_singleton">protocol_state_singleton</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Decisions.estimator_total</span> <span class="id">sigma0</span>) <span class="kwd">as</span> [<span class="id">c0</span> <span class="id">Hc0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id">c0</span>,<span class="id">v</span>,<span class="id">sigma0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">bleh</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>) <span class="id">sigma0</span>)) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>) <span class="id">sigma0</span>) <span class="id">bleh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span>' <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>'; <span class="tactic">apply</span> <span class="id">H</span>'. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="kwd">as</span> <span class="id">sigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqsigma</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> <span class="id">Heqsigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Decisions.estimator_total</span> <span class="id">sigma</span>) <span class="kwd">as</span> [<span class="id">csigma</span> <span class="id">Hcsigma</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state">valid_protocol_state</a></span> <span class="id">sigma</span> <span class="id">csigma</span> <span class="id">c</span> (<span class="id">v</span>' :: <span class="id">vs</span>)) <span class="kwd">as</span> <span class="id">sigma2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hequiv2</span> : <span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma2</span>) (<span class="id">v</span>' :: <span class="id">vs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Heqsigma2</span>. <span class="tactic">rewrite</span> <span class="id">Heqsigma</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state_equivocating_senders">valid_protocol_state_equivocating_senders</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">bleh</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">sigma2</span>) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#valid_protocol_state_ps">valid_protocol_state_ps</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">sigma2</span> <span class="id">bleh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span>' <span class="id">Hfutures</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">predicate_not</span>. <span class="tactic">intro</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">Hfutures</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma</span>' <span class="kwd">as</span> [<span class="id">sigma</span>' <span class="id">about_sigma</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hps</span>' := <span class="id">about_sigma</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">Hps</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_heavy_subset">not_heavy_subset</a></span> (<span class="id">add</span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>) <span class="id">to</span> <span class="id">sigma2</span>)) <span class="kwd">in</span> <span class="id">Hps</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_irrefl">Rlt_irrefl</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_le_trans">Rlt_le_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id">add</span> (<span class="id">c0</span>, <span class="id">v</span>, <span class="id">sigma0</span>)<span class="id">to</span> <span class="id">sigma2</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rminus">Rminus</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_gt_compat_r">Rplus_gt_compat_r</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>))) <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">rewrite</span> <span class="id">Rplus_opp_l</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_lt">Rgt_lt</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_gt_trans">Rge_gt_trans</a></span> <span class="kwd">with</span> (<span class="id">sum_weights</span> (<span class="id">v</span>' :: <span class="id">vs</span>) + (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>)))%<span class="id">R</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hsum</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>) + <span class="id">sum_weights</span> (<span class="id">v</span>' :: <span class="id">vs</span>))%<span class="id">R</span> = <span class="id">sum_weights</span> (<span class="id">v</span> :: <span class="id">v</span>' :: <span class="id">vs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">Hsum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_ge">Rle_ge</a></span>. <span class="tactic">apply</span> <span class="id">sum_weights_incl</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>; <span class="tactic">try</span> (<span class="id">constructor</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">vv</span> <span class="id">Hvin</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">c</span>, <span class="id">vv</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">destruct</span> <span class="id">Hvin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hvin</span>]; <span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> || <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state_rev_sigma">in_valid_protocol_state_rev_sigma</a></span>. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state_rev_cempty">in_valid_protocol_state_rev_cempty</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id">c0</span>, <span class="id">vv</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id">c</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span> ; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>; <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intro</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">Hnin</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id">csigma</span>, <span class="id">vv</span>, (<span class="id"><a href="CasperCBC.CBC.Definitions.html#next">next</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>) <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span>)). <span class="tactic">split</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="id">right</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_valid_protocol_state_rev_csigma">in_valid_protocol_state_rev_csigma</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>; <span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>; <span class="tactic">split</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intro</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_singleton_state">in_singleton_state</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">Hnin</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hmin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">now</span> <span class="tactic">apply</span> <span class="id">Hfutures</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="no_local_confluence_prot_state">no_local_confluence_prot_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;`{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">a</span> <span class="id">a1</span> <span class="id">a2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">a</span> <span class="id">a1</span> /\ <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">a</span> <span class="id">a2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">exists</span> (<span class="id">a</span>' : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">a1</span> <span class="id">a</span>' /\ <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">a2</span> <span class="id">a</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof164')">Proof.</div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#non_triviality_decisions_on_properties_of_protocol_states">non_triviality_decisions_on_properties_of_protocol_states</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">P</span> [[<span class="id">ps1</span> <span class="id">about_ps1</span>] [<span class="id">ps2</span> <span class="id">about_ps2</span>]]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_empty">protocol_state_empty</a></span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ps1</span>, <span class="id">ps2</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> (<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="id">easy</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Habsurd</span>. <span class="tactic">destruct</span> <span class="id">Habsurd</span> <span class="kwd">as</span> [<span class="id">s</span> [<span class="id">Hs1</span> <span class="id">Hs2</span>]].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">about_ps1</span> <span class="id">s</span> <span class="id">Hs1</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">about_ps2</span> <span class="id">s</span> <span class="id">Hs2</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_inhabited">pstate_inhabited</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">p1</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof165')">Proof.</div>
<div class="proofscript" id="proof165">
 <span class="id">now</span> <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#Empty">Empty</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_empty">protocol_state_empty</a></span>). Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate_compare">pstate_compare</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">ps1</span> <span class="id">ps2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison">comparison</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">compare</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">ps1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">ps2</span>).<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_eq_dec">pstate_eq_dec</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">p1</span> <span class="id">p2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), {<span class="id">p1</span> = <span class="id">p2</span>} + {<span class="id">p1</span> &lt;&gt; <span class="id">p2</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof166')">Proof.</div>
<div class="proofscript" id="proof166">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">p1</span> <span class="id">p2</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sigify_eq_dec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_rel_refl">pstate_rel_refl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> (@<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof167')">Proof.</div>
<div class="proofscript" id="proof167">
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intro</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [<span class="id">p</span> <span class="id">about_p</span>].<br/>
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">simpl</span>. <span class="id">easy</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_rel_trans">pstate_rel_trans</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> (@<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof168')">Proof.</div>
<div class="proofscript" id="proof168">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span> <span class="id">H_12</span> <span class="id">H_23</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p1</span> <span class="kwd">as</span> [<span class="id">p1</span> <span class="id">about_p1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p2</span> <span class="kwd">as</span> [<span class="id">p2</span> <span class="id">about_p2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p3</span> <span class="kwd">as</span> [<span class="id">p3</span> <span class="id">about_p3</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#get_messages">get_messages</a></span> <span class="id">p2</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="level0">level0</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Protocol.html#PartialOrder">PartialOrder</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id"><a href="CasperCBC.CBC.Protocol.html#A_eq_dec">A_eq_dec</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_eq_dec">pstate_eq_dec</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_inhabited">A_inhabited</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_inhabited">pstate_inhabited</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_rel">A_rel</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel">pstate_rel</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_rel_refl">A_rel_refl</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel_refl">pstate_rel_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_rel_trans">A_rel_trans</a></span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate_rel_trans">pstate_rel_trans</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="level1">level1</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;`{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Protocol.html#PartialOrderNonLCish">PartialOrderNonLCish</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id"><a href="CasperCBC.CBC.Protocol.html#no_local_confluence_ish">no_local_confluence_ish</a></span> := (@<span class="id"><a href="CasperCBC.CBC.FullNode.html#no_local_confluence_prot_state">no_local_confluence_prot_state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)}.<br/>
<br/>
<div class="doc">Strong non-triviality *</div>
<span class="kwd">Definition</span> <span class="id"><a name="in_future">in_future</a></span> {<span class="id">C</span> <span class="id">V</span>} (<span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="next_future">next_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> <span class="id">msg</span> <span class="id">s1</span> = <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="in_past">in_past</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">s2</span> <span class="id">s1</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="in_past_trace">in_past_trace</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s1</span> /\ <span class="id"><a href="CasperCBC.CBC.Definitions.html#justification">justification</a></span> <span class="id">msg</span> = <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="no_common_future">no_common_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.FullNode.html#in_future">in_future</a></span> <span class="id">s1</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.FullNode.html#in_future">in_future</a></span> <span class="id">s2</span> <span class="id">s</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="yes_common_future">yes_common_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>), <span class="id"><a href="CasperCBC.CBC.FullNode.html#in_future">in_future</a></span> <span class="id">s1</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.FullNode.html#in_future">in_future</a></span> <span class="id">s2</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="strong_nontriviality">strong_nontriviality</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s1</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_future">next_future</a></span> <span class="id">s1</span> <span class="id">s2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s3</span> : <span class="id"><a href="CasperCBC.CBC.FullNode.html#pstate">pstate</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#yes_common_future">yes_common_future</a></span> <span class="id">s1</span> <span class="id">s3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#no_common_future">no_common_future</a></span> <span class="id">s2</span> <span class="id">s3</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages">about_equivocating_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof169')">Proof.</div>
<div class="proofscript" id="proof169">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_fn">in_state_fn</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_dec_if_false">in_state_dec_if_false</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">H_neq</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_extx_in_x">not_extx_in_x</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>) <span class="id">v</span> <span class="id">j</span> <span class="id">j</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_extx_in_x">not_extx_in_x</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)) <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>) <span class="id">j</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#not_extx_in_x">not_extx_in_x</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>) <span class="id">v</span>' <span class="id">j</span> <span class="id">j</span>); <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H2</span> <span class="tactic">at</span> 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="next_equivocation_state">next_equivocation_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;(<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_incl">next_equivocation_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof170')">Proof.</div>
<div class="proofscript" id="proof170">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>; <span class="id">right</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_keeps_messages">next_equivocation_state_keeps_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>) (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof171')">Proof.</div>
<div class="proofscript" id="proof171">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_keeps_equivocators">next_equivocation_state_keeps_equivocators</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> <span class="id">v</span>' <span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof172')">Proof.</div>
<div class="proofscript" id="proof172">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_incl</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_incl">equivocating_senders_incl</a></span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_incl</span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">H_incl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_keeps_equivocating_messages">next_equivocation_state_keeps_equivocating_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>) (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof173')">Proof.</div>
<div class="proofscript" id="proof173">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_incl</span> := @<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span> <span class="id">C</span> <span class="id">V</span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_incl</span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">H_incl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages_in_state_l">about_equivocating_messages_in_state_l</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof174')">Proof.</div>
<div class="proofscript" id="proof174">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages_in_state_r">about_equivocating_messages_in_state_r</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof175')">Proof.</div>
<div class="proofscript" id="proof175">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages_add_equivocator">about_equivocating_messages_add_equivocator</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof176')">Proof.</div>
<div class="proofscript" id="proof176">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages_in_state_l">about_equivocating_messages_in_state_l</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">He</span> : <span class="id">Estimator</span> (@<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>, <span class="id">v</span>, <span class="id">s</span>) <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof177')">Proof.</div>
<div class="proofscript" id="proof177">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_extend">equivocating_senders_extend</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>) <span class="id">v</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_is_next">add_is_next</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_rewrite</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_next_equivocating_senders_eq">add_next_equivocating_senders_eq</a></span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>) <span class="id">v</span> <span class="id">s</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">set_eq_tran</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_weight_one">add_weight_one</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">j</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof178')">Proof.</div>
<div class="proofscript" id="proof178">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_weight_two">add_weight_two</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof179')">Proof.</div>
<div class="proofscript" id="proof179">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_weight_three">add_weight_three</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Protocol.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof180')">Proof.</div>
<div class="proofscript" id="proof180">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">about_j</span> <span class="id">H_notin</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_equivocating_sender">add_equivocating_sender</a></span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;{ <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_one">add_weight_one</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>) <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span> .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_next">protocol_state_next</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_one">add_weight_one</a></span> <span class="id">_</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">about_j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages">about_equivocating_messages</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">HscV</span>  := @<span class="id">triple_strictly_comparable_proj2</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">about_M</span>).<br/>
&nbsp;&nbsp;<span class="id">pose</span> (@<span class="id">strictly_comparable_eq_dec</span> <span class="id">_</span> <span class="id">HscV</span>) <span class="kwd">as</span> <span class="id">HeqV</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_inter</span> := <span class="id"><a href="CasperCBC.CBC.Common.html#senders_fault_weight_eq">senders_fault_weight_eq</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)))) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#sender">sender</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>))))).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_inter</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">clear</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_rewrite</span> := <span class="id">sum_weights_in</span> <span class="id">v</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#compare_eq_dec_v">compare_eq_dec_v</a></span> <span class="id">about_M</span>) <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>))))).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span>. <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_rewrite</span>. <span class="tactic">clear</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_eq_compat_r">Rplus_eq_compat_r</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_nodup_sum_weight_eq</span><br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_nodup">set_remove_nodup</a></span><br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span><br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_iff">set_remove_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span>; <span class="tactic">apply</span> <span class="id">set_map_nodup</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Hneq</span>]; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_iff">set_remove_iff</a></span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span>; <span class="tactic">apply</span> <span class="id">set_map_nodup</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> (<span class="id">right</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_absurd</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_notin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="add_weight_under">add_weight_under</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">Hm</span> : <span class="id">Measurable</span> <span class="id">V</span>} `{<span class="id">Hrt</span> : <span class="id">ReachableThreshold</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">v</span> : <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">j</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Protocol.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof181')">Proof.</div>
<div class="proofscript" id="proof181">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">about_j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_notin</span> <span class="id">about_v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_three">add_weight_three</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_two">add_weight_two</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_one">add_weight_one</a></span>; <span class="id">easy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="next_equivocation_protocol_state">next_equivocation_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">j</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_under">add_weight_under</a></span> <span class="id">j</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof182')">Proof.</div>
<div class="proofscript" id="proof182">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">about_j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_notin</span> <span class="id">H_neq</span> <span class="id">H_weight</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages">about_equivocating_messages</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">H2_noteq</span> [<span class="id">H2_sender</span> [<span class="id">H2_left</span> <span class="id">H2_right</span>]]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">correct_estimate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Facilitate&nbsp;membership&nbsp;peeling&nbsp;with&nbsp;helper&nbsp;lemma&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_preserves_message_membership">add_preserves_message_membership</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id">j</span>) <span class="id">j</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') <span class="tactic">by</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_adds_weight">next_equivocation_adds_weight</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_under">add_weight_under</a></span> <span class="id">s</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">v</span> <span class="id">v</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">v</span> <span class="id">v</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Protocol.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof183')">Proof.</div>
<div class="proofscript" id="proof183">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">v</span> <span class="id">H_not_heavy</span> <span class="id">H_notin</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_protocol_state">next_equivocation_protocol_state</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span>; <span class="id">easy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="next_equivocation_rec">next_equivocation_rec</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>} `{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">HscV</span> := <span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">vs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">hd</span> :: <span class="id">tl</span> =&gt; <span class="id">next_equivocation_rec</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">hd</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">hd</span>)) <span class="id">tl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">next_equivocation_rec</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">vs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id">hd</span> :: <span class="id">tl</span> =&gt; <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>) <span class="id">hd</span> <span class="id">v0</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_keeps_messages">next_equivocations_keeps_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>} `{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> <span class="id">msg</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof184')">Proof.</div>
<div class="proofscript" id="proof184">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state_keeps_messages">next_equivocation_state_keeps_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_keeps_equivocating_senders">next_equivocations_keeps_equivocating_senders</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>} `{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof185')">Proof.</div>
<div class="proofscript" id="proof185">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span>; <span class="id">right</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_equivocating_sender_cons">next_equivocation_equivocating_sender_cons</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">hd</span> : <span class="id">V</span>) (<span class="id">v0</span> <span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">hd</span> <span class="id">v0</span>)) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> = <span class="id">hd</span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof186')">Proof.</div>
<div class="proofscript" id="proof186">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">hd</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages_add_equivocator">about_equivocating_messages_add_equivocator</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> [<span class="id">H_sender</span> <span class="id">H_equiv</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state">next_equivocation_state</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_state_keeps_equivocating_messages">next_equivocation_state_keeps_equivocating_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_equivocating_senders_iff">next_equivocations_equivocating_senders_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> <span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; <span class="id">v</span> &lt;&gt; <span class="id">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>)) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof187')">Proof.</div>
<div class="proofscript" id="proof187">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span>; <span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>]; <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">spec</span> <span class="id">IHvs</span> <span class="id">v0</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_neq</span>. <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[ ? ? ] | ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[ ? ? ] | ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[ ? ? ] | ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;H0&nbsp;must&nbsp;be&nbsp;false.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg_absurd</span> [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_contra</span> := <span class="id"><a href="CasperCBC.CBC.Definitions.html#non_equivocating_messages_extend">non_equivocating_messages_extend</a></span> <span class="id">msg_absurd</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>) (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)) <span class="id">v0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_contra</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_correct">equivocating_messages_correct</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_comm">equivocating_messages_comm</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_equiv</span> <span class="kwd">in</span> <span class="id">H_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHvs</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_cons">in_cons</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Discharging&nbsp;induction&nbsp;hypothesis&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span> <span class="id">v0</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;analysis&nbsp;on&nbsp;where&nbsp;v&nbsp;is&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H_in</span> | <span class="id">H_equiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;When&nbsp;we&nbsp;are&nbsp;looking&nbsp;at&nbsp;the&nbsp;hd&nbsp;element,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_neq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> <span class="id">v</span> <span class="id">tl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">simpl</span>. <span class="tactic">split</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>), <span class="id">v0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>), <span class="id">v0</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">simpl</span>. <span class="tactic">clear</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_neq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_cons">in_cons</a></span> <span class="id">hd</span> <span class="id">v</span> <span class="id">tl</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span>; <span class="id">right</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span>; <span class="id">right</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHvs</span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_add_weights">next_equivocations_add_weights</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id">sum_weights</span> <span class="id">vs</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) /\ <span class="id">v</span> &lt;&gt; <span class="id">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id">sum_weights</span> <span class="id">vs</span>)%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof188')">Proof.</div>
<div class="proofscript" id="proof188">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">vs</span> <span class="id">v0</span> <span class="id">H_nodup</span> <span class="id">H_underweight</span> <span class="id">H_disjoint</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Base&nbsp;case&nbsp;:&nbsp;no&nbsp;validators&nbsp;to&nbsp;add&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Induction&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;first&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H_nodup</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;second&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_reg_pos_r">Rplus_le_reg_pos_r</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id">sum_weights</span> <span class="id">tl</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">hd</span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Measurable.weight</span> <span class="id">hd</span>). <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id">sum_weights</span> <span class="id">tl</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">hd</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;third&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">v</span>. <span class="id">spec</span> <span class="id">H_disjoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHvs</span> <span class="kwd">as</span> [<span class="id">H_prot</span> <span class="id">H_weight</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">hd</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> <span class="id">hd</span> <span class="id">tl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_notin_tl</span> : ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">hd</span> <span class="id">tl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_disjoint</span> <span class="kwd">as</span> [<span class="id">H_disjoint</span> <span class="id">H_neq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_rewrite</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocations_equivocating_senders_iff">next_equivocations_equivocating_senders_iff</a></span> <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span> <span class="id">hd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocation_protocol_state">next_equivocation_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_rewrite</span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Need&nbsp;a&nbsp;helper&nbsp;lemma&nbsp;about&nbsp;weight&nbsp;adding&nbsp;here&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_under">add_weight_under</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_weight</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id">sum_weights</span> <span class="id">tl</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">hd</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">hd</span>)) (<span class="id">sum_weights</span> <span class="id">tl</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_weight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="tactic">rewrite</span> <span class="id">H_rewrite</span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="potentially_pivotal_state">potentially_pivotal_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">about_M</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span>)} `{<span class="id">Hrt</span> : <span class="id">ReachableThreshold</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id">V</span>) (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) /\<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sum_weights</span> ((<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) ++ <span class="id">vs</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sum_weights</span> ((<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) ++ <span class="id">vs</span>) &gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="all_pivotal_validator">all_pivotal_validator</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : @<span class="id"><a href="CasperCBC.CBC.Definitions.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.FullNode.html#potentially_pivotal_state">potentially_pivotal_state</a></span> <span class="id">v</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof189')">Proof.</div>
<div class="proofscript" id="proof189">
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>) <span class="kwd">as</span> <span class="id">HscV</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> (@<span class="id">strictly_comparable_eq_dec</span> <span class="id">_</span> <span class="id">HscV</span>) <span class="kwd">as</span> <span class="id">HeqV</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">HscV</span>) <span class="kwd">as</span> <span class="id">compare_v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Protocol.html#suff_val">suff_val</a></span> <span class="kwd">as</span> [<span class="id">vs</span> [<span class="id">Hvs</span> <span class="id">Hweight</span>]].<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) <span class="kwd">as</span> <span class="id">eqv_s</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff">set_diff</a></span> <span class="id">compare_eq_dec</span> <span class="id">vs</span> <span class="id">eqv_s</span>) <span class="kwd">as</span> <span class="id">vss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">sum_weights</span> (<span class="id">vss</span> ++ <span class="id">eqv_s</span>) &gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_gt_trans">Rge_gt_trans</a></span> <span class="kwd">with</span> (<span class="id">sum_weights</span> <span class="id">vs</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_ge">Rle_ge</a></span>. <span class="tactic">apply</span> <span class="id">sum_weights_incl</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heqvss</span>. <span class="tactic">apply</span> <span class="id">diff_app_nodup</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heqvss</span>. <span class="tactic">intros</span> <span class="id">a</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff_iff">set_diff_iff</a></span>. <span class="tactic">apply</span> <span class="id">or_and_distr_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id">compare_eq_dec</span> <span class="id">a</span> <span class="id">eqv_s</span>); (<span class="id">left</span>; <span class="tactic">assumption</span>) || (<span class="id">right</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#pivotal_validator_extension">pivotal_validator_extension</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">vs</span>' [<span class="id">Hnodup_vs</span>' [<span class="id">Hincl_vs</span>' [<span class="id">Hgt</span> [<span class="id">v</span> [<span class="id">Hin_v</span> <span class="id">Hlt</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">Hincl_vs</span>' <span class="kwd">in</span> <span class="id">Hin_v</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff_elim2">set_diff_elim2</a></span> <span class="kwd">in</span> <span class="id">Hin_v</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">decide_eq</span> <span class="id">v</span> <span class="id">vs</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">decide_eq</span> <span class="id">v</span> <span class="id">vs</span>')) <span class="kwd">as</span> <span class="id">Hnodup_remove</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_nodup">set_remove_nodup</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_remove_elim</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_1">set_remove_1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">Hincl_vs</span>' <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff_elim2">set_diff_elim2</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">sum_weights_app</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> <span class="kwd">in</span> <span class="id">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_gt">Rlt_gt</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_lt_reg_r">Rplus_lt_reg_r</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Protocol.html#weight">weight</a></span> <span class="id">v</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rminus">Rminus</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id">Rplus_opp_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_lt">Rgt_lt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_gt_trans">Rge_gt_trans</a></span> <span class="kwd">with</span> (<span class="id">sum_weights</span> (<span class="id">vs</span>' ++ <span class="id">eqv_s</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rge">Rge</a></span>. <span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sum_weights_app</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id">sum_weights</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>))) .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id">sum_weights_app</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_eq_compat_r">Rplus_eq_compat_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">sum_weights_in</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">diff_app_nodup</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="strong_nontriviality_full">strong_nontriviality_full</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span>} `{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.CBC.FullNode.html#strong_nontriviality">strong_nontriviality</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof190')">Proof.</div>
<div class="proofscript" id="proof190">
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">triple_strictly_comparable_proj2</span> <span class="id">about_M</span>) <span class="kwd">as</span> <span class="id">HscV</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> (@<span class="id">strictly_comparable_eq_dec</span> <span class="id">_</span> <span class="id">HscV</span>) <span class="kwd">as</span> <span class="id">HeqV</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (@<span class="id">compare</span> <span class="id">_</span> <span class="id">HscV</span>) <span class="kwd">as</span> <span class="id">compare_v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">s1</span> <span class="id">about_s1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#all_pivotal_validator">all_pivotal_validator</a></span> <span class="id">s1</span> <span class="id">about_s1</span>) <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">H_v</span> [<span class="id">vs</span> [<span class="id">H_nodup</span> [<span class="id">H_v_notin</span> [<span class="id">H_disjoint</span> [<span class="id">H_under</span> <span class="id">H_over</span>]]]]]]].<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id">s1</span>) <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span> <span class="id">s1</span> <span class="id">about_s1</span>  (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span> <span class="id">s1</span>) <span class="id">v</span>)) <span class="kwd">as</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Book-keeping&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s1_s2_senders</span> : <span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>))) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s1_s2_weight</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> = <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>)) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#add_weight_one">add_weight_one</a></span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Proving&nbsp;next-step&nbsp;relation&nbsp;is&nbsp;trivial.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id">s1</span>); <span class="tactic">subst</span>; <span class="id">easy</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;s3&nbsp;is&nbsp;the&nbsp;state&nbsp;with&nbsp;equivocations&nbsp;from&nbsp;all&nbsp;the&nbsp;senders&nbsp;in&nbsp;vs&nbsp;recursively&nbsp;added&nbsp;to&nbsp;s1,&nbsp;in&nbsp;addition&nbsp;to&nbsp;(c,v,s1)'s&nbsp;equivocating&nbsp;partner&nbsp;message.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;we&nbsp;add&nbsp;the&nbsp;equivocating&nbsp;partner&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>), <span class="id">v</span>, (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>)) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>)) <span class="kwd">as</span> <span class="id">s1</span>'.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Book-keeping&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_eq_senders</span> : <span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>') (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Heqs1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>) <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">set_eq_tran</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>. <span class="tactic">exact</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s_inter_weight</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span>' = <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;are&nbsp;ready&nbsp;to&nbsp;construct&nbsp;s3&nbsp;from&nbsp;s1'&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;And&nbsp;if&nbsp;we&nbsp;have&nbsp;set&nbsp;up&nbsp;everything&nbsp;correctly,&nbsp;the&nbsp;premises&nbsp;at&nbsp;this&nbsp;point&nbsp;in&nbsp;the&nbsp;proof&nbsp;are&nbsp;sufficient.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s1</span>' <span class="id">vs</span> <span class="id">v</span>) <span class="kwd">as</span> <span class="id">s3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">about_s3</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s3</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Heqs3</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocations_add_weights">next_equivocations_add_weights</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_s_inter_weight</span>. <span class="tactic">rewrite</span> <span class="id">sum_weights_app</span> <span class="kwd">in</span> <span class="id">H_under</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">v0</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_eq_senders</span> <span class="kwd">as</span> [<span class="id">H_left</span> <span class="id">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_right</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="id">spec</span> <span class="id">H_left</span> <span class="id">v0</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. <span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="tactic">subst</span>. <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s3</span> <span class="id">about_s3</span>).<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;s1&nbsp;and&nbsp;s3&nbsp;share&nbsp;a&nbsp;common&nbsp;future&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state">protocol_state</a></span> <span class="id">s3</span> <span class="id">about_s3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">simpl</span>. <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m0</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Need&nbsp;to&nbsp;prove&nbsp;that&nbsp;next_equivocation_rec'&nbsp;doesn't&nbsp;drop&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocations_keeps_messages">next_equivocations_keeps_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>; <span class="id">right</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;s2&nbsp;and&nbsp;s3&nbsp;don't&nbsp;share&nbsp;a&nbsp;common&nbsp;future&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Arbitrary&nbsp;state&nbsp;in&nbsp;both&nbsp;s2&nbsp;and&nbsp;s3&nbsp;leads&nbsp;to&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intros</span> [<span class="id">s</span> <span class="id">about_s</span>] <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H_in2</span> <span class="id">H_in3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_in2_copy</span> := <span class="id">H_in2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_in3_copy</span> := <span class="id">H_in3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#in_future">in_future</a></span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#syntactic_state_inclusion">syntactic_state_inclusion</a></span> <span class="kwd">in</span> <span class="id">H_in2</span>, <span class="id">H_in3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;show&nbsp;that&nbsp;two&nbsp;equivocating&nbsp;messages&nbsp;are&nbsp;in&nbsp;s&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in2</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id">s1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Second&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in3</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;this&nbsp;message&nbsp;is&nbsp;in&nbsp;s3&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_obv</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state">in_state</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>) <span class="id">s1</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#in_state_add_in_sorted_iff">in_state_add_in_sorted_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocations_keeps_messages">next_equivocations_keeps_messages</a></span> <span class="id">s1</span>' <span class="id">vs</span> <span class="id">v</span>) <span class="kwd">in</span> <span class="id">H_obv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;prove&nbsp;that&nbsp;these&nbsp;two&nbsp;messages&nbsp;are&nbsp;equivocating&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_equiv</span> : <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_messages_prop">equivocating_messages_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id">s1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender_correct">get_distinct_sender_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;say&nbsp;that&nbsp;v&nbsp;will&nbsp;be&nbsp;an&nbsp;equivocating&nbsp;sender&nbsp;inside&nbsp;s&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_v_in</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id">v</span>, <span class="id">s1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.Definitions.html#add_in_sorted_fn">add_in_sorted_fn</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id">s1</span>) <span class="id">s1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_in2</span> <span class="id">H_in3</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;say&nbsp;that&nbsp;v's&nbsp;weight&nbsp;will&nbsp;be&nbsp;inside&nbsp;s's&nbsp;fault&nbsp;weight&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;part&nbsp;is&nbsp;a&nbsp;little&nbsp;tricky&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_equivocators_s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id">v</span> :: (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>) ++ <span class="id">vs</span>)) (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span> <span class="kwd">as</span> [<span class="id">H_hd</span> | <span class="id">H_tl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H_tl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_tl</span> <span class="kwd">as</span> [<span class="id">H_left</span> | <span class="id">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_incl">equivocating_senders_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_in2_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">H_in_v0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v0</span> (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s1</span>' <span class="id">vs</span> <span class="id">v</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.FullNode.html#next_equivocations_equivocating_senders_iff">next_equivocations_equivocating_senders_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">_</span> <span class="id">H_absurd</span>. <span class="tactic">subst</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqs3</span> <span class="kwd">in</span> <span class="id">H_in_v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders_incl">equivocating_senders_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_in3_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s_overweight</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>) + <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>) + <span class="id">sum_weights</span> <span class="id">vs</span> &lt;= <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span>)%<span class="id">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">replace</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>) + <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>) + <span class="id">sum_weights</span> <span class="id">vs</span>))%<span class="id">R</span> <span class="kwd">with</span> (<span class="id">sum_weights</span> ([<span class="id">v</span>] ++ (<span class="id"><a href="CasperCBC.CBC.Definitions.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>)) ++ <span class="id">vs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sum_weights_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proving&nbsp;mutual&nbsp;NoDup&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nodup_append</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>. <span class="tactic">intros</span>; <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nodup_append</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">a</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">H</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">a</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">Habsurd</span>. <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Habsurd</span>. <span class="tactic">destruct</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">inversion</span> <span class="id">H0</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">inversion</span> <span class="id">H0</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id">sum_weights_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">ring</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_finale</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H_s_overweight</span> <span class="id">about_s</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">H_finale</span> <span class="id">H_over</span> <span class="id">H_s1_s2_weight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">sum_weights_app</span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Definitions.html#fault_weight_state">fault_weight_state</a></span> <span class="kwd">in</span> <span class="id">H_s1_s2_weight</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_s1_s2_weight</span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_gt_compat_l">Rplus_gt_compat_l</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>))) <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>) + (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">Measurable.weight</span> <span class="id">v</span>)))%<span class="id">R</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">threshold</span>)%<span class="id">R</span> <span class="kwd">in</span> <span class="id">H_over</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_not_le">Rgt_not_le</a></span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
