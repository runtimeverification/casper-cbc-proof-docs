
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.VLSM.Common</title>
<meta name="description" content="Documentation of Coq module CasperCBC.VLSM.Common" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.VLSM.Common</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Nat.html">Nat</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Lia.html">Lia</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Streams</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html">RelationClasses</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html">Morphisms</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lib.Preamble</span> <span class="id">Lib.ListExtras</span> <span class="id">Lib.StreamExtras</span>.<br/>
<br/>
<h1> VLSM Basics
This module provides basic VLSM infrastructure.
</h1>
<br/>
<h2> VLSM definition
*** The type of a VLSM
The type of a VLSM is a triple consisting of the underlying types of
messages, states, and labels.
In Coq it is defined as a Class taking &lt;&lt;message&gt;&gt; as parameter and having
<span class="bracket"><span class="id">state</span></span> and <span class="bracket"><span class="id">label</span></span> as fields.  &lt;&lt;message&gt;&gt; is a parameter to allow it to be
easily shared by multiple VLSMs during composition.
</h2>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="VLSM_type">VLSM_type</a></span> (<span class="id">message</span> : <span class="kwd">Type</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id"><a name="state">state</a></span> : <span class="kwd">Type</span><br/>
&nbsp;&nbsp;; <span class="id"><a name="label">label</a></span> : <span class="kwd">Type</span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
<h3> The signature of a VLSM
Although the VLSM definition does not single out the notion of a VLSM
signature, we find it convenient to extract it as the <span class="bracket"><span class="id">VLSM_sign</span></span> class.
The <span class="bracket"><span class="id">VLSM_sign</span></span> class is parameterized by a <span class="bracket"><span class="id">VLSM_type</span></span> and defines properties
for initial states (<span class="bracket"><span class="id">initial_state_prop</span></span>) and initial messages
(<span class="bracket"><span class="id">initial_message_prop</span></span>), from which we can immediately define the dependent
types <span class="bracket"><span class="id">initial_state</span></span> (as <span class="bracket"><span class="id">state</span></span>s having the <span class="bracket"><span class="id">initial_state_prop</span></span>erty) and
<span class="bracket"><span class="id">intial_message</span></span> (as &lt;&lt;message&gt;&gt;s having the <span class="bracket"><span class="id">initial_message_prop</span></span>erty).
Additionally, <span class="bracket"><span class="id">VLSM_sign</span></span> requires the identification of an <span class="bracket"><span class="id">initial_state</span></span> <span class="bracket"><span class="id">s0</span></span>,
a &lt;&lt;message&gt;&gt; <span class="bracket"><span class="id">m0</span></span>, and a <span class="bracket"><span class="id">label</span></span> <span class="bracket"><span class="id">l0</span></span> to ensure the non-emptiness of the
corresponding sets.
</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_sign">VLSM_sign</a></span> {<span class="id">message</span> : <span class="kwd">Type</span>} (<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="initial_state_prop">initial_state_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">initial_state</span> := { <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> | <span class="id">initial_state_prop</span> <span class="id">s</span> }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="initial_message_prop">initial_message_prop</a></span> : <span class="id">message</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">initial_message</span> := { <span class="id">m</span> : <span class="id">message</span> | <span class="id">initial_message_prop</span> <span class="id">m</span> }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="s0">s0</a></span> : <span class="id">initial_state</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="m0">m0</a></span> : <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="l0">l0</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="option_initial_message_prop">option_initial_message_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>} {<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>} {<span class="id">sign</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">om</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM_sign_pre_loaded_with_messages">VLSM_sign_pre_loaded_with_messages</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>} {<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>} (<span class="id">sign</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">initial</span> : <span class="id">message</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">sign</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> := <span class="kwd">fun</span> <span class="id">m</span> =&gt; @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">sign</span>  <span class="id">m</span> \/ <span class="id">initial</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">sign</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">sign</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">sign</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="decidable_initial_messages_prop">decidable_initial_messages_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>} {<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>} (<span class="id">sign</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">forall</span> <span class="id">m</span>, <span class="id">Decision</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">m</span>).<br/>
<br/>
<h3> VLSM class definition
Given a <span class="bracket"><span class="id">VLSM_sign</span></span>nature, a <span class="bracket"><span class="id">VLSM</span></span> is defined by providing a <span class="bracket"><span class="id">transition</span></span>
function and a <span class="bracket"><span class="id">valid</span></span>ity condition.
</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_class">VLSM_class</a></span> {<span class="id">message</span> : <span class="kwd">Type</span>} {<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>} (<span class="id">lsm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="transition">transition</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="valid">valid</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM_class_pre_loaded_with_messages">VLSM_class_pre_loaded_with_messages</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>} {<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>} {<span class="id">lsm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>} (<span class="id">vlsm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">lsm</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">initial</span> : <span class="id">message</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign_pre_loaded_with_messages">VLSM_sign_pre_loaded_with_messages</a></span> <span class="id">lsm</span> <span class="id">initial</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">vlsm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">vlsm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM">VLSM</a></span> (<span class="id">message</span> : <span class="kwd">Type</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> (<span class="kwd">fun</span> <span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> (<span class="kwd">fun</span> <span class="id">S</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">T</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">S</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mk_vlsm">mk_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">S</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">T</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">M</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">T</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">S</span> <span class="id">M</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_vlsm">pre_loaded_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">initial</span> : <span class="id">message</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">M</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">X</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">M</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class_pre_loaded_with_messages">VLSM_class_pre_loaded_with_messages</a></span> <span class="id">M</span> <span class="id">initial</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">M</span>'.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Traces">Traces</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<h2> Traces
We introduce the concept of a trace to formalize an execution of the protocol.
It is abstracted as a pair &lt;&lt;(start, steps)&gt;&gt; where &lt;&lt;start&gt;&gt; is a state
and &lt;&lt;steps&gt;&gt; is a tuple of objects which fully describe the transitions
underwent during execution. Notably, &lt;&lt;steps&gt;&gt; might be infinite.
In Coq, we can define these objects (which we name <span class="bracket"><span class="id">transition_item</span></span>s) as consisting of:
<ul>
<li>
 the <span class="bracket"><span class="id">label</span></span> <span class="bracket"><span class="id">l</span></span>
</li>
<li>
 the (optional) <span class="bracket"><span class="id">input</span></span> &lt;&lt;message&gt;&gt;
</li>
<li>
 the <span class="bracket"><span class="id">destination</span></span> <span class="bracket"><span class="id">state</span></span> of the transition
</li>
<li>
 the (optional) <span class="bracket"><span class="id">output</span></span> &lt;&lt;message&gt;&gt; generated by the transition
</h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="transition_item">transition_item</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{   <span class="id"><a name="l">l</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a name="input">input</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a name="destination">destination</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a name="output">output</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="field_selector">field_selector</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">field</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">m</span> <span class="id">item</span> =&gt; <span class="id">field</span> <span class="id">item</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="item_sends_or_receives">item_sends_or_receives</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">m</span> <span class="id">item</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span> \/ <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">item</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_has_message">trace_has_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">message_selector</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="id">message_selector</span> <span class="id">msg</span>) <span class="id">tr</span>.<br/>
<br/>
<div class="doc">Defines a message received but not sent by within the trace. </li>
</ul>
</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_received_not_sent_before_or_after">trace_received_not_sent_before_or_after</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_has_message">trace_has_message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#field_selector">field_selector</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span>) <span class="id">m</span> <span class="id">tr</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_has_message">trace_has_message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#field_selector">field_selector</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span>) <span class="id">m</span> <span class="id">tr</span>.<br/>
<br/>
<div class="doc">States that a property holds for all messages received but not sent by a trace. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_received_not_sent_before_or_after_invariant">trace_received_not_sent_before_or_after_invariant</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">forall</span> <span class="id">m</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_received_not_sent_before_or_after">trace_received_not_sent_before_or_after</a></span> <span class="id">tr</span> <span class="id">m</span> -&gt; <span class="id">P</span> <span class="id">m</span>.<br/>
<br/>
<div class="doc">'proto_run's are used for an alternative definition of 'protocol_prop' which
  takes into account transitions. See 'vlsm_run_prop'.
  </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="proto_run">proto_run</a></span> : <span class="kwd">Type</span> := <span class="id"><a name="mk_proto_run">mk_proto_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="start">start</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="transitions">transitions</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="final">final</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="Trace">Trace</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Finite">Finite</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="id">Trace</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Infinite">Infinite</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="id">Trace</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_first">trace_first</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">_</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">_</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_trace_last">finite_trace_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">si</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_trace_nth">finite_trace_nth</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">si</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_last">trace_last</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_nth">trace_nth</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">s</span> <span class="id">ls</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">st</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">st</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces">Traces</a></span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> {<span class="id">message</span>} {<span class="id">T</span>} , {<span class="id">message</span>} <span class="id">T</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#field_selector">field_selector</a></span> {<span class="id">_</span>} {<span class="id">T</span>} <span class="id">_</span> <span class="id">msg</span> <span class="id">item</span> / .<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#item_sends_or_receives">item_sends_or_receives</a></span> {<span class="id">_</span>} {<span class="id">_</span>} <span class="id">msg</span> <span class="id">item</span> /.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="TraceLemmas">TraceLemmas</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">message</span> : <span class="kwd">Type</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="last_error_destination_last">last_error_destination_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlast</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> (<span class="id">last_error</span> <span class="id">tr</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">default</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">default</span> <span class="id">tr</span>  = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="kwd">in</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">last_error</span> <span class="id">tr</span>) <span class="id">eqn</span> : <span class="id">eq</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">last_error</span> <span class="kwd">in</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_map</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_last_cons">finite_trace_last_cons</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">x</span> <span class="id">tl</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">x</span>::<span class="id">tl</span>) = <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">x</span>) <span class="id">tl</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>, <span class="id">unroll_last</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_last_nil">finite_trace_last_nil</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> [] = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</div>
<div class="proofscript" id="proof14">
 <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_last_app">finite_trace_last_app</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">t1</span> <span class="id">t2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">t1</span> ++ <span class="id">t2</span>) = <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">t1</span>) <span class="id">t2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id">last_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_last_is_last">finite_trace_last_is_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">x</span> <span class="id">tl</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">tl</span>++[<span class="id">x</span>]) = <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_is_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_nth_first">finite_trace_nth_first</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">si</span> <span class="id">tr</span> 0 = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">si</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_nth_last">finite_trace_nth_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">si</span> <span class="id">tr</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tr</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">si</span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span>;[<span class="tactic">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> [<span class="id">nth_error</span> <span class="id">length</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nth_error_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_nth_app1">finite_trace_nth_app1</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">t1</span> <span class="id">t2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) <span class="id">n</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">si</span> (<span class="id">t1</span>++<span class="id">t2</span>) <span class="id">n</span> = <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">si</span> <span class="id">t1</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_nth_app2">finite_trace_nth_app2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">t1</span> <span class="id">t2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) <span class="id">n</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">t1</span> &lt;= <span class="id">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">si</span> (<span class="id">t1</span>++<span class="id">t2</span>) <span class="id">n</span> = <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">si</span> <span class="id">t1</span>) <span class="id">t2</span> (<span class="id">n</span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">t1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Compare_dec.html#le_lt_eq_dec">Compare_dec.le_lt_eq_dec</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H</span> |&lt;-].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span>;<span class="tactic">simpl</span> <span class="id">length</span>;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>;[|<span class="id">solve</span>[<span class="tactic">auto</span> <span class="kwd">with</span> <span class="id">arith</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>;[<span class="id">exfalso</span>;<span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> -<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">t1</span>) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">n</span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">t1</span>)) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_app1">finite_trace_nth_app1</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_last">finite_trace_nth_last</a></span> <span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.PeanoNat.html#Nat.sub_diag">PeanoNat.Nat.sub_diag</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_first">finite_trace_nth_first</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_nth_length">finite_trace_nth_length</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) <span class="id">n</span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">si</span> <span class="id">tr</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nth_error_length</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Peano.html#le_S_n">le_S_n</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_last_prefix">finite_trace_last_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) <span class="id">n</span> <span class="id">nth</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">s</span> <span class="id">tr</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">nth</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">list_prefix</span> <span class="id">tr</span> <span class="id">n</span>) = <span class="id">nth</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>); <span class="tactic">intro</span> <span class="id">l</span>; <span class="tactic">clear</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">intros</span> [=&lt;-]. <span class="tactic">destruct</span> <span class="id">l</span>;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">intro</span> <span class="id">H</span>. <span class="tactic">symmetry</span>. <span class="id">revert</span> <span class="id">H</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">list_prefix_nth_last</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_trace_last_suffix">finite_trace_last_suffix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) <span class="id">n</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">list_suffix</span> <span class="id">tr</span> <span class="id">n</span>) = <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">list_suffix_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="unlock_finite_trace_last">unlock_finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="id">Opaque</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#TraceLemmas">TraceLemmas</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="vlsm_projections">vlsm_projections</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vlsm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="type">type</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections.vlsm">vlsm</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="sign">sign</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections.vlsm">vlsm</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="machine">machine</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections.vlsm">vlsm</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vstate">vstate</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vlabel">vlabel</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_state_prop">vinitial_state_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_state">vinitial_state</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_message_prop">vinitial_message_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="voption_initial_message_prop">voption_initial_message_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#option_initial_message_prop">option_initial_message_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_message">vinitial_message</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message">initial_message</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vs0">vs0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vm0">vm0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vl0">vl0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vdecidable_initial_messages_prop">vdecidable_initial_messages_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#decidable_initial_messages_prop">decidable_initial_messages_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vtransition">vtransition</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vvalid">vvalid</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vtransition_item">vtransition_item</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vTrace">vTrace</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vproto_run">vproto_run</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections">vlsm_projections</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="mk_vlsm_machine">mk_vlsm_machine</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) = <span class="id">X</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">X</span> <span class="kwd">as</span> (<span class="id">T</span>, (<span class="id">S</span>, <span class="id">M</span>)). <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM">VLSM</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TypeX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SignX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MachineX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">TypeX</span>.<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">SignX</span>.<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">MachineX</span>.<br/>
<br/>
<h3> Protocol states and messages
We further characterize certain objects as being _protocol_, which means they can
be witnessed or experienced during executions of the protocol. For example,
a message is a <span class="bracket"><span class="id">protocol_message</span></span> if there exists an execution of the protocol
in which it is produced.
We choose here to define protocol states and messages together as the
<span class="bracket"><span class="id">protocol_prop</span></span> property, inductively defined over the
<span class="bracket"><span class="id">state</span> * <span class="id">option</span> <span class="id">message</span></span> product type,
as this definition avoids the need of using a mutually recursive definition.
The inductive definition has three cases:
<ul>
<li>
 if &lt;&lt;s&gt;&gt; is a <span class="bracket"><span class="id">state</span></span> with the <span class="bracket"><span class="id">initial_state_prop</span></span>erty, then &lt;&lt;(s, None)&gt;&gt; has the <span class="bracket"><span class="id">protocol_prop</span></span>erty;
</li>
<li>
 if &lt;&lt;m&gt;&gt; is a &lt;&lt;message&gt;&gt; with the <span class="bracket"><span class="id">initial_message_prop</span></span>erty, then &lt;&lt;(&gt;&gt;<span class="bracket"><span class="id">s0</span>, <span class="id">Some</span></span>&lt;&lt; m)&gt;&gt; has the <span class="bracket"><span class="id">protocol_prop</span></span>erty;
</li>
<li>
 for all <span class="bracket"><span class="id">state</span></span>s &lt;&lt;s&gt;&gt;, <span class="bracket"><span class="id">option</span></span>al &lt;&lt;message&gt;&gt; &lt;&lt;om&gt;&gt;,
  and <span class="bracket"><span class="id">label</span></span> &lt;&lt;l&gt;&gt;:
</li>
</ul>
  if there is an (optional) &lt;&lt;message&gt;&gt; &lt;&lt;_om&gt;&gt; such that &lt;&lt;(s, _om)&gt;&gt; has the <span class="bracket"><span class="id">protocol_prop</span></span>erty;
  and if there is a <span class="bracket"><span class="id">state</span></span> &lt;&lt;_s&gt;&gt; such that &lt;&lt;(_s, om)&gt;&gt; has the <span class="bracket"><span class="id">protocol_prop</span></span>erty;
  and if &lt;&lt;l&gt;&gt; <span class="bracket"><span class="id">valid</span></span> &lt;&lt;(s, om)&gt;&gt;,
  then <span class="bracket"><span class="id">transition</span></span> &lt;&lt;l (s, om)&gt;&gt; has the <span class="bracket"><span class="id">protocol_prop</span></span>erty.
</h3>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="protocol_prop">protocol_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="protocol_initial">protocol_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hom</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#option_initial_message_prop">option_initial_message_prop</a></span> <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">protocol_prop</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="protocol_generated">protocol_generated</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">_om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id">protocol_prop</span> (<span class="id">s</span>, <span class="id">_om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">_s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpm</span> : <span class="id">protocol_prop</span> (<span class="id">_s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">protocol_prop</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_initial_state">protocol_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">s</span>:<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>] (<span class="id">Hs</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>,<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id">s</span> <span class="id">Hs</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_state_prop">protocol_state_prop</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_message_prop">protocol_message_prop</a></span> (<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>)).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_state">protocol_state</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_message">protocol_message</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="initial_is_protocol">initial_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinitial</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="initial_message_is_protocol">initial_message_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinitial</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">m</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="option_protocol_message_prop">option_protocol_message_prop</a></span> (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="option_protocol_message_None">option_protocol_message_None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="option_protocol_message_Some">option_protocol_message_Some</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hpm</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hpm</span>]. <span class="id">exists</span> <span class="id">s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="option_initial_message_is_protocol">option_initial_message_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinitial</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#option_initial_message_prop">option_initial_message_prop</a></span> <span class="id">om</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_Some">option_protocol_message_Some</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_None">option_protocol_message_None</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Protocol validity and protocol transitions
To achieve this, it is useful to further define _protocol_ validity and
_protocol_ transitions:
</h3>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_valid">protocol_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>, <span class="id">om</span>) := <span class="id">som</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id">om</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">om</span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_transition">protocol_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\  <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> <span class="id">som</span> = <span class="id">som</span>'.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_transition_preserving">protocol_transition_preserving</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om1</span> <span class="id">om2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprotocol</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s1</span>, <span class="id">om1</span>) (<span class="id">s2</span>, <span class="id">om2</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">R</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_valid">protocol_transition_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> <span class="id">som</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Hpv</span> <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_valid_transition">protocol_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> <span class="id">som</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> <span class="id">som</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_valid_transition_iff">protocol_valid_transition_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id">exists</span> (<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> <span class="id">som</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid_transition">protocol_valid_transition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">som</span>' <span class="id">Hpt</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_valid">protocol_transition_valid</a></span> <span class="kwd">with</span> <span class="id">som</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_generated_valid">protocol_generated_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">_om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">_s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">_om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">_s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_origin">protocol_transition_origin</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>',<span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hp</span>] <span class="id">_</span>] <span class="id">_</span>]. <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_destination">protocol_transition_destination</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</div>
<div class="proofscript" id="proof36">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hs</span>] [[<span class="id">_s</span> <span class="id">Hom</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_in">protocol_transition_in</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">_</span> [[<span class="id">_s</span> <span class="id">Hom</span>] <span class="id">_</span>]] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_transition_out">protocol_prop_transition_out</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>', <span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_out">protocol_transition_out</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id">om</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop_transition_out">protocol_prop_transition_out</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_is_valid">protocol_transition_is_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">_</span> [<span class="id">_</span> <span class="id">Hv</span>]] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_transition">protocol_transition_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:  <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) = (<span class="id">s</span>', <span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Ht</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_valid_out">protocol_prop_valid_out</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid_transition">protocol_valid_transition</a></span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [[<span class="id">s</span>' <span class="id">om</span>'] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_transition">protocol_transition_transition</a></span>  <span class="id">Ht</span>); <span class="tactic">intro</span> <span class="id">Hteq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hteq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop_transition_out">protocol_prop_transition_out</a></span> <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">For VLSMs initialized with many initial messages such as
    the <span class="bracket"><span class="id">composite_vlsm_constrained_projection</span></span> or the <span class="bracket"><span class="id">pre_loaded_with_all_messages_vlsm</span></span>,
    the question of whether a <span class="bracket"><span class="id">VLSM</span></span> <span class="bracket"><span class="id">can_emit</span></span> a message &lt;&lt;m&gt;&gt; becomes more
    useful than that whether &lt;&lt;m&gt;&gt; is a <span class="bracket"><span class="id">protocol_message</span></span>.
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_generated_prop">protocol_generated_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>).<br/>
<br/>
<div class="doc">Of course, if a VLSM <span class="bracket"><span class="id">can_emit</span></span> &lt;&lt;(s,m)&gt;&gt;, then &lt;&lt;(s,m)&gt;&gt; is protocol.
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_generated_prop_protocol">protocol_generated_prop_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_prop">protocol_generated_prop</a></span> <span class="id">s</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>) .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [(<span class="id">s0</span>, <span class="id">om0</span>) [<span class="id">l</span> [[[<span class="id">_om0</span> <span class="id">Hs0</span>] [[<span class="id">_s0</span> <span class="id">Hom0</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om0</span> <span class="id">_s0</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="can_emit">can_emit</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_iff">can_emit_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span> &lt;-&gt; <span class="id">exists</span> <span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_prop">protocol_generated_prop</a></span> <span class="id">s</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">som</span> [<span class="id">l</span> [<span class="id">s</span> <span class="id">Ht</span>]]]. <span class="id">exists</span> <span class="id">s</span>, <span class="id">som</span>, <span class="id">l</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">s</span> [<span class="id">som</span> [<span class="id">l</span> <span class="id">Ht</span>]]]. <span class="id">exists</span> <span class="id">som</span>, <span class="id">l</span>, <span class="id">s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">If a VLSM <span class="bracket"><span class="id">can_emit</span></span> a message &lt;&lt;m&gt;&gt;, then &lt;&lt;m&gt;&gt; is protocol.
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_protocol">can_emit_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span> .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit_iff">can_emit_iff</a></span> <span class="kwd">in</span> <span class="id">Hm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_prop_protocol">protocol_generated_prop_protocol</a></span> <span class="kwd">in</span> <span class="id">Hm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">A characterization of protocol messages in terms of <span class="bracket"><span class="id">can_emit</span></span>
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_protocol_iff">can_emit_protocol_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">m</span> \/ <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">s</span> <span class="id">Hm</span>]; <span class="tactic">inversion</span> <span class="id">Hm</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s1</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">l1</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">Him</span> | <span class="id">Hem</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit_protocol">can_emit_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Protocol state and protocol message characterization
The definition and results below show that the mutually-recursive definitions
for <span class="bracket"><span class="id">protocol_state</span></span>s and <span class="bracket"><span class="id">protocol_message</span></span>s can be derived from the
prior definitions.
The results below offers equivalent characterizations for <span class="bracket"><span class="id">protocol_state</span></span>s
and <span class="bracket"><span class="id">protocol_message</span></span>s, similar to their recursive definition.
</h3>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_prop_iff">protocol_state_prop_iff</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; (<span class="id">exists</span> <span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span>, <span class="id">s</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id">exists</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>', <span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Hps</span>'. <span class="tactic">destruct</span> <span class="id">Hps</span>' <span class="kwd">as</span> [<span class="id">om</span>' <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hs</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hs0</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="id">exists</span> <span class="id">l1</span>. <span class="id">exists</span> (<span class="id">s</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">om</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [[[<span class="id">s</span> <span class="id">His</span>] <span class="id">Heq</span>] | [<span class="id">l</span> [[<span class="id">s</span> <span class="id">om</span>] [<span class="id">om</span>' [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>; [<span class="tactic">assumption</span> | <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">om</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">A specialized induction principle for <span class="bracket"><span class="id">protocol_state_prop</span></span>.
        Compared to opening the existential and using <span class="bracket"><span class="id">protocol_prop_ind</span></span>,
        this avoids the redundancy of the <span class="bracket"><span class="id">protocol_initial_state</span></span> case
        needing a proof for any <span class="bracket"><span class="id">initial_state</span></span> and then <span class="bracket"><span class="id">protocol_initial_message</span></span>
        asking for a proof specifically for <span class="bracket"><span class="id">s0</span></span>, and also avoids the
        little trouble of needing &lt;&lt;set&gt;&gt; or &lt;&lt;dependent induction&gt;&gt; to
        handle the pair in the index in <span class="bracket"><span class="id">protocol_prop</span> (<span class="id">s</span>,<span class="id">om</span>)</span>.
     </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_prop_ind">protocol_state_prop_ind</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IHinit</span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>), <span class="id">P</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IHgen</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">l</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>')) (<span class="id">Hs</span> : <span class="id">P</span> <span class="id">s</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>), <span class="id">P</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">om</span> <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">s</span>, <span class="id">om</span>) <span class="kwd">as</span> <span class="id">som</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">om</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hs</span>; <span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">Heqsom</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHinit</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHgen</span> <span class="id">s1</span> <span class="id">l1</span> <span class="id">om</span> <span class="id">om0</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHHs1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHgen</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_message_prop_iff">protocol_message_prop_iff</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; (<span class="id">exists</span> <span class="id">im</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message">initial_message</a></span>, <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">im</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id">exists</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">s</span>' <span class="id">Hpm</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpm</span>'; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">m</span>' <span class="id">Hom</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">exists</span> <span class="id">l1</span>. <span class="id">exists</span> (<span class="id">s</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [[[<span class="id">s</span> <span class="id">His</span>] <span class="id">Heq</span>] | [<span class="id">l</span> [[<span class="id">s</span> <span class="id">om</span>] [<span class="id">s</span>' [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<h2> Trace Properties
Note that it is unnecessary to specify the source state of the transition,
as it is implied by the preceding <span class="bracket"><span class="id">transition_item</span></span> (or by the &lt;&lt;start&gt;&gt; state,
if such an item doesn't exist).
</h2>
<br/>
<br/>
<h3> Finite <span class="bracket"><span class="id">protocol_trace</span></span>s
A <span class="bracket"><span class="id">finite_protocol_trace_from</span></span> a <span class="bracket"><span class="id">state</span></span> &lt;&lt;start&gt;&gt; is a pair &lt;&lt;(start, steps)&gt;&gt; where &lt;&lt;steps&gt;&gt;
is a list of <span class="bracket"><span class="id">transition_item</span></span>s, and is inductively defined by:
<ul>
<li>
 &lt;&lt;(s, <span class="bracket"></span>)&gt;&gt; is a <span class="bracket"><span class="id">finite_protocol_trace_from</span></span> &lt;&lt;s&gt;&gt;
</li>
<li>
 if there is a <span class="bracket"><span class="id">protocol_transition</span></span> &lt;&lt;l (s', iom) (s, oom)&gt;&gt;
</li>
</ul>
  and if &lt;&lt;(s,steps)&gt;&gt; is a <span class="bracket"><span class="id">protocol_trace_from</span></span> &lt;&lt;s&gt;&gt;
  then &lt;&lt;(s', ({| l := l; input := iom; destination := s; output := oom |} :: steps)&gt;&gt;
  is a <span class="bracket"><span class="id">protocol_transition_from</span></span> &lt;&lt;s'&gt;&gt;.
Note that the definition is given such that it extends an existing trace by
adding a transition to its front.
The reason for this choice is to have this definition be similar to the one
for infinite traces, which can only be extended at the front.
</h3>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="finite_protocol_trace_from">finite_protocol_trace_from</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="finite_ptrace_empty">finite_ptrace_empty</a></span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span> -&gt; <span class="id">finite_protocol_trace_from</span> <span class="id">s</span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="finite_ptrace_extend">finite_ptrace_extend</a></span> : <span class="kwd">forall</span>  (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_protocol_trace_from</span> <span class="id">s</span> <span class="id">tl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">iom</span>) (<span class="id">s</span>, <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_protocol_trace_from</span>  <span class="id">s</span>' ({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |} :: <span class="id">tl</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_ptrace_singleton">finite_ptrace_singleton</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>} {<span class="id">s</span> <span class="id">s</span>': <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>} {<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">iom</span>) (<span class="id">s</span>', <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span>  <span class="id">s</span> ({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>'; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |} :: [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">l</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">iom</span> <span class="id">oom</span> <span class="id">Hptrans</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span> <span class="id">s</span>' []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span> <span class="id">s</span>' (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="id">Hptrans</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hptrans</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_protocol_trace">finite_protocol_trace</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Opaque</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_first_valid_transition">finite_ptrace_first_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">te</span> :: <span class="id">tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te</span>) (<span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [[<span class="id">Hs</span> <span class="id">_</span>] <span class="id">_</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_tail">finite_ptrace_tail</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">te</span> :: <span class="id">tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>) <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_last_pstate">finite_ptrace_last_pstate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">with</span> []. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_tail">finite_ptrace_tail</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHtr</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">a</span> :: <span class="id">tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">a</span>) <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;[<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">unroll_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_to">protocol_transition_to</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr1</span> <span class="id">tr2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">tr1</span> ++ [<span class="id">te</span>] ++ <span class="id">tr2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lst1</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te</span>) (<span class="id">lst1</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">s</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHtr1</span> (<span class="id">tr1</span> ++ [<span class="id">te</span>] ++ <span class="id">tr2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">is</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHtr1</span>. <span class="id">specialize</span> (<span class="id">IHtr1</span> <span class="id">s</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_consecutive_valid_transition">finite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr1</span> <span class="id">tr2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te1</span> <span class="id">te2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>] ++ <span class="id">tr2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te1</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te2</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> ([<span class="id">te1</span>; <span class="id">te2</span>] ++ <span class="id">tr2</span>) <span class="kwd">with</span> ([<span class="id">te1</span>] ++ [<span class="id">te2</span>] ++ <span class="id">tr2</span>) <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_to">protocol_transition_to</a></span> <span class="id">s</span> <span class="id">tr</span> (<span class="id">tr1</span> ++ [<span class="id">te1</span>]) <span class="id">tr2</span> <span class="id">te2</span> <span class="id">Htr</span> <span class="id">Heq</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_is_last">finite_trace_last_is_last</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_output_is_protocol">protocol_trace_output_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Houtput</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#field_selector">field_selector</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">m</span>) <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">is</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Houtput</span>;<span class="tactic">intros</span>;<span class="tactic">inversion</span> <span class="id">Htr</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_out">protocol_transition_out</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">IHHoutput</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_input_is_protocol">protocol_trace_input_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinput</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#field_selector">field_selector</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">m</span>) <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">is</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hinput</span>;<span class="tactic">intros</span>;<span class="tactic">inversion</span> <span class="id">Htr</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_in">protocol_transition_in</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">IHHinput</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="first_transition_valid">first_transition_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> [<span class="id">te</span>] &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te</span>) (<span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te</span>).<br/>
<br/>
<div class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">te</span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="kwd">in</span> <span class="id">Ht</span> <span class="kwd">as</span> <span class="id">Hdestination0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; [|<span class="tactic">assumption</span>]. <span class="id">constructor</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="extend_right_finite_trace_from">extend_right_finite_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ts</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht12</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s1</span> <span class="id">ts</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l3</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s2</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s1</span> <span class="id">ts</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">iom3</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s3</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">oom3</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv23</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l3</span> (<span class="id">s2</span>, <span class="id">iom3</span>) (<span class="id">s3</span>, <span class="id">oom3</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s1</span> (<span class="id">ts</span> ++ [{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom3</span> |}]).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Ht12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_singleton">finite_ptrace_singleton</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHHt12</span>. <span class="tactic">apply</span> <span class="id">IHHt12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s2</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span> <span class="kwd">in</span> <span class="id">Hv23</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">ls</span> <span class="id">ls</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) (<span class="id">s</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span>' <span class="id">ls</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">ls</span> ++ <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ls</span>;<span class="tactic">intro</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_nil">finite_trace_last_nil</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span> (<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHls</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> [<span class="id">Hal</span> <span class="id">Hl</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hal</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;[<span class="tactic">apply</span> <span class="id">IHls</span>;<span class="tactic">split</span>|];<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHls</span> <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> [<span class="id">Hl</span> <span class="id">Hl</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[<span class="id">constructor</span>|];<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_rev_ind">finite_protocol_trace_from_rev_ind</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hempty</span>: <span class="kwd">forall</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span> -&gt; <span class="id">P</span> <span class="id">s</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hextend</span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sf</span> <span class="id">iom</span> <span class="id">oom</span> <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hx</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span>,<span class="id">iom</span>) (<span class="id">sf</span>,<span class="id">oom</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span>:= {|<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span>:=<span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span>:=<span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span>:=<span class="id">sf</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span>:=<span class="id">oom</span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span> (<span class="id">tr</span>++[<span class="id">x</span>])):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>; <span class="tactic">intro</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">apply</span> <span class="id">Hempty</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">apply</span> (<span class="id">Hextend</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Htr</span> (<span class="id">IHtr</span> <span class="id">Htr</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hx</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_rev_ind">finite_protocol_trace_rev_ind</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hempty</span>: <span class="kwd">forall</span> <span class="id">si</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">si</span> -&gt; <span class="id">P</span> <span class="id">si</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hextend</span> : <span class="kwd">forall</span> <span class="id">si</span> <span class="id">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">si</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">si</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sf</span> <span class="id">iom</span> <span class="id">oom</span> <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hx</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">si</span> <span class="id">tr</span>,<span class="id">iom</span>) (<span class="id">sf</span>,<span class="id">oom</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">x</span>:= {|<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span>:=<span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span>:=<span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span>:=<span class="id">sf</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span>:=<span class="id">oom</span>|} <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">si</span> (<span class="id">tr</span>++[<span class="id">x</span>])):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">si</span> <span class="id">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">si</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">si</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">si</span> <span class="id">tr</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Htr</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_rev_ind">finite_protocol_trace_from_rev_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hempty</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hextend</span>;[<span class="tactic">split</span>|..];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Several other lemmas in this vein are necessary for proving results regarding
traces.
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_prefix">finite_protocol_trace_from_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">list_prefix</span> <span class="id">ls</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof63')">Proof.</div>
<div class="proofscript" id="proof63">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">list_prefix_suffix</span> <span class="id">ls</span> <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hdecompose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hdecompose</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Hpr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nth</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">s</span> <span class="id">ls</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">nth</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">nth</span> (<span class="id">list_suffix</span> <span class="id">ls</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof64')">Proof.</div>
<div class="proofscript" id="proof64">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">list_prefix_suffix</span> <span class="id">ls</span> <span class="id">n</span>) <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> (<span class="id">list_prefix</span> <span class="id">ls</span> <span class="id">n</span>)) <span class="kwd">with</span> <span class="id">nth</span> <span class="kwd">in</span> <span class="id">Htr</span>;[<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_first">finite_trace_nth_first</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">injection</span> <span class="id">Hnth</span> <span class="kwd">as</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ls</span>;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">list_prefix_nth_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_segment">finite_protocol_trace_from_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1th</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="id">s</span> <span class="id">ls</span> <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n1th</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">n1th</span> (<span class="id">list_segment</span> <span class="id">ls</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof65')">Proof.</div>
<div class="proofscript" id="proof65">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span> <span class="kwd">with</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_prefix">finite_protocol_trace_from_prefix</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n1</span>;[<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span> <span class="kwd">in</span> <span class="id">Hnth</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_nth</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_from_protocol_trace">can_emit_from_protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprotocol</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">si</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_has_message">trace_has_message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#field_selector">field_selector</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span>) <span class="id">m</span> <span class="id">tr</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof66')">Proof.</div>
<div class="proofscript" id="proof66">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">Hm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hin</span> <span class="id">Houtput</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_split">in_split</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">l1</span> [<span class="id">l2</span> <span class="id">Hconcat</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hprotocol</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_to">protocol_transition_to</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> <span class="id">Hconcat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Houtput</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">eexists</span>;<span class="tactic">exact</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
<br/>
<div class="doc">The final state of a finite portion of a protocol trace.
    This is defined over <span class="bracket"><span class="id">finite_protocol_trace_from</span></span> because
    an initial state is necessary in case &lt;&lt;tr&gt;&gt; is empty,
    and this allows the definition to have only one non-implicit
    parameter.
 </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="finite_ptrace_from_to_empty">finite_ptrace_from_to_empty</a></span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span> -&gt; <span class="id">finite_protocol_trace_from_to</span> <span class="id">s</span> <span class="id">s</span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="finite_ptrace_from_to_extend">finite_ptrace_from_to_extend</a></span> : <span class="kwd">forall</span>  (<span class="id">s</span> <span class="id">f</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_protocol_trace_from_to</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">iom</span>) (<span class="id">s</span>, <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_protocol_trace_from_to</span> <span class="id">s</span>' <span class="id">f</span> ({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |} :: <span class="id">tl</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_from_to_singleton">finite_ptrace_from_to_singleton</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">iom</span>) (<span class="id">s</span>', <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">s</span>' [{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>'; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |}].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof68')">Proof.</div>
<div class="proofscript" id="proof68">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span> = <span class="id">f</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_nil">finite_trace_last_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_add_last">finite_protocol_trace_from_add_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span> = <span class="id">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hfrom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hfrom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_nil">finite_trace_last_nil</a></span>. <span class="tactic">intros</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span>. <span class="tactic">simpl</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_first_pstate">finite_protocol_trace_from_to_first_pstate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_last_pstate">finite_protocol_trace_from_to_last_pstate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">f</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_last_pstate">finite_ptrace_last_pstate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_app">finite_protocol_trace_from_to_app</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> <span class="id">s</span> <span class="id">f</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">ls</span> <span class="id">ls</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">m</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">m</span> <span class="id">f</span> <span class="id">ls</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> (<span class="id">ls</span> ++ <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hl</span> <span class="id">Hl</span>';<span class="tactic">induction</span> <span class="id">Hl</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_app_split">finite_protocol_trace_from_to_app_split</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">f</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">ls</span> <span class="id">ls</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> (<span class="id">ls</span> ++ <span class="id">ls</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">m</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">ls</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">m</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">m</span> <span class="id">f</span> <span class="id">ls</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">s</span>;<span class="tactic">induction</span> <span class="id">ls</span>;<span class="tactic">intros</span> <span class="id">s</span>;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_nil">finite_trace_last_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>. <span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_first_pstate">finite_protocol_trace_from_to_first_pstate</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> 1; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHls</span> <span class="kwd">in</span> <span class="id">H4</span> <span class="kwd">as</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_from_to_extend">finite_ptrace_from_to_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span> : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">si</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_init_add_last">finite_protocol_trace_init_add_last</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">si</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">si</span> <span class="id">tr</span> = <span class="id">sf</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof75')">Proof.</div>
<div class="proofscript" id="proof75">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">Hinit</span>] <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_add_last">finite_protocol_trace_from_add_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_init_to_forget_last">finite_protocol_trace_init_to_forget_last</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">si</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof76')">Proof.</div>
<div class="proofscript" id="proof76">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hinit</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_init_to_last">finite_protocol_trace_init_to_last</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">si</span> <span class="id">tr</span> = <span class="id">sf</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof77')">Proof.</div>
<div class="proofscript" id="proof77">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="extend_right_finite_trace_from_to">extend_right_finite_trace_from_to</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ts</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht12</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">ts</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l3</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">iom3</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s3</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">oom3</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv23</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l3</span> (<span class="id">s2</span>, <span class="id">iom3</span>) (<span class="id">s3</span>, <span class="id">oom3</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s1</span> <span class="id">s3</span> (<span class="id">ts</span> ++ [{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom3</span> |}]).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof78')">Proof.</div>
<div class="proofscript" id="proof78">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Ht12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_from_to_singleton">finite_ptrace_from_to_singleton</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_from_to_extend">finite_ptrace_from_to_extend</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_rev_ind">finite_protocol_trace_from_to_rev_ind</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hempty</span>: <span class="kwd">forall</span> <span class="id">si</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">si</span> -&gt; <span class="id">P</span> <span class="id">si</span> <span class="id">si</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hextend</span> : <span class="kwd">forall</span> <span class="id">si</span> <span class="id">s</span> <span class="id">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">si</span> <span class="id">s</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sf</span> <span class="id">iom</span> <span class="id">oom</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">iom</span>) (<span class="id">sf</span>,<span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">si</span> <span class="id">sf</span> (<span class="id">tr</span>++[{|<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span>:=<span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span>:=<span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span>:=<span class="id">sf</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span>:=<span class="id">oom</span>|}])):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof79')">Proof.</div>
<div class="proofscript" id="proof79">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">si</span> <span class="id">sf</span> <span class="id">tr</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">sf</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sf</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Htr</span>;<span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">Hempty</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_app_split">finite_protocol_trace_from_to_app_split</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hstep</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hstep</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H3</span>;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHtr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Infinite <span class="bracket"><span class="id">protcol_trace</span></span>s </h3>
<br/>
<div class="doc">We now define <span class="bracket"><span class="id">infinite_protocol_trace</span></span>s. The definitions
resemble their finite counterparts, adapted to the technical
necessities of defining infinite objects. Notably, &lt;&lt;steps&gt;&gt; is
stored as a stream, as opposed to a list.
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">CoInductive</span> <span class="id"><a name="infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="infinite_ptrace_extend">infinite_ptrace_extend</a></span> : <span class="kwd">forall</span>  (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">infinite_protocol_trace_from</span> <span class="id">s</span> <span class="id">tl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">iom</span>) (<span class="id">s</span>, <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">infinite_protocol_trace_from</span>  <span class="id">s</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |}  <span class="id">tl</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="infinite_ptrace">infinite_ptrace</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">st</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">st</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_ptrace_consecutive_valid_transition">infinite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> <span class="id">tr2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr1</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te1</span> <span class="id">te2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">stream_app</span> (<span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>]) <span class="id">tr2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te1</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te2</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof80')">Proof.</div>
<div class="proofscript" id="proof80">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">is</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">is</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHtr1</span> (<span class="id">stream_app</span> (<span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>]) <span class="id">tr2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">is</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHtr1</span> <span class="id">s</span> <span class="id">H2</span>). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_app_iff">infinite_protocol_trace_from_app_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span>' <span class="id">ls</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">stream_app</span> <span class="id">ls</span> <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof81')">Proof.</div>
<div class="proofscript" id="proof81">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>'. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ls</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">_</span> <span class="id">H</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">constructor</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_origin">protocol_transition_origin</a></span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">Htr</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_ptrace_extend">infinite_ptrace_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHls</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>' <span class="kwd">in</span> <span class="id">Htr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span> <span class="kwd">in</span> <span class="id">Htr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">apply</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="id">specialize</span> (<span class="id">IHls</span> <span class="id">s1</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHls</span>. <span class="id">specialize</span> (<span class="id">IHls</span> <span class="id">ls</span>'). <span class="tactic">apply</span> <span class="id">IHls</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id">s</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_cons">finite_trace_last_cons</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_prefix">infinite_protocol_trace_from_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">stream_prefix</span> <span class="id">ls</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof82')">Proof.</div>
<div class="proofscript" id="proof82">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">stream_prefix_suffix</span> <span class="id">ls</span> <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hdecompose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hdecompose</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_app_iff">infinite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Hpr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_prefix_rev">infinite_protocol_trace_from_prefix_rev</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpref</span>: <span class="kwd">forall</span> <span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">stream_prefix</span> <span class="id">ls</span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof83')">Proof.</div>
<div class="proofscript" id="proof83">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">Hpref</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">a</span>, <span class="id">ls</span>) <span class="id">s</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hpref0</span> := <span class="id">Hpref</span> 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpref0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hpref</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpref</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_segment">infinite_protocol_trace_from_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1th</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id">n1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">n1th</span> (<span class="id">stream_segment</span> <span class="id">ls</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof84')">Proof.</div>
<div class="proofscript" id="proof84">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span> <span class="kwd">with</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_prefix">infinite_protocol_trace_from_prefix</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">n1th</span>. <span class="tactic">clear</span> <span class="id">n1th</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth">finite_trace_nth</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">stream_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">stream_prefix_nth</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<h3> Protocol traces
Finally, we define <span class="bracket"><span class="id">Trace</span></span> as a sum-type of its finite/infinite variants.
It inherits some previously introduced definitions, culminating with the
<span class="bracket"><span class="id">protocol_trace</span></span>.
</h3>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ptrace_from_prop">ptrace_from_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">sm</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">sm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">s</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">sm</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_ptrace">infinite_ptrace</a></span> <span class="id">s</span> <span class="id">sm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_trace">protocol_trace</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_from">protocol_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_from_prop">ptrace_from_prop</a></span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof85')">Proof.</div>
<div class="proofscript" id="proof85">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_initial">protocol_trace_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof86')">Proof.</div>
<div class="proofscript" id="proof86">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_from_iff">protocol_trace_from_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_from_prop">ptrace_from_prop</a></span> <span class="id">tr</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof87')">Proof.</div>
<div class="proofscript" id="proof87">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Htr</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_from">protocol_trace_from</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_initial">protocol_trace_initial</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="vlsm_run_prop">vlsm_run_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="empty_run_initial_state">empty_run_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">His</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">vlsm_run_prop</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">is</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := []; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id">is</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="empty_run_initial_message">empty_run_initial_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">im</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Him</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">im</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">vlsm_run_prop</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := []; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">im</span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="extend_run">extend_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">state_run</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id">vlsm_run_prop</span> <span class="id">state_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">state_run</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">state_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ts</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">state_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">msg_run</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id">vlsm_run_prop</span> <span class="id">msg_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">msg_run</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">vlsm_run_prop</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">is</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := <span class="id">ts</span> ++ [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|   <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">om</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">som</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">som</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := <span class="id">som</span>' |}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_run_initial_state">vlsm_run_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">run</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hrun</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">run</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof88')">Proof.</div>
<div class="proofscript" id="proof88">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hrun</span>; [<span class="tactic">assumption</span>| ..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">is</span> <span class="kwd">in</span> *. <span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">The output message of a vlsm_run with no transitions must be initial</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_run_no_transitions_output">vlsm_run_no_transitions_output</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">run</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hrun</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hno_transitions</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">run</span> = [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Houtput</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">run</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof89')">Proof.</div>
<div class="proofscript" id="proof89">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">run</span>. <span class="tactic">destruct</span> <span class="id">final0</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hrun</span>; <span class="tactic">subst</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ts</span>; <span class="tactic">discriminate</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vlsm_run">vlsm_run</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">r</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">r</span> }.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_run_last_state">vlsm_run_last_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof90')">Proof.</div>
<div class="proofscript" id="proof90">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">r</span>; <span class="tactic">clear</span> <span class="id">r</span>; <span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hr</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_is_last">finite_trace_last_is_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_run_last_final">vlsm_run_last_final</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hne_tr</span> : <span class="id">tr</span> &lt;&gt; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lst</span> := <span class="id">last_error</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">lst</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">lst</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof91')">Proof.</div>
<div class="proofscript" id="proof91">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">r</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">r</span>; <span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">inversion</span> <span class="id">Hr</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">Hr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">tr</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">lst</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">last_error_is_last</span> . <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="run_is_protocol">run_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof92')">Proof.</div>
<div class="proofscript" id="proof92">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">replace</span> <span class="id">is</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">is</span> <span class="id">His</span>)) <span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">assumption</span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">om</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">om</span>. <span class="tactic">unfold</span> <span class="id">s</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">state_run</span>) <span class="kwd">as</span> [<span class="id">s</span> <span class="id">_om</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">msg_run</span>) <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">om</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id">l1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id">IHHr1</span> <span class="id">_s</span> <span class="id">om</span> <span class="id">IHHr2</span> <span class="id">Hv</span>). <span class="tactic">intro</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_is_run">protocol_is_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id">som</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> <span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>, (<span class="id">som</span>' = <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof93')">Proof.</div>
<div class="proofscript" id="proof93">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">om</span> <span class="kwd">as</span> [<span class="id">m</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#empty_run_initial_message">empty_run_initial_message</a></span> <span class="id">_</span> <span class="id">Hom</span> <span class="id">_</span> <span class="id">Hs</span>)); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#empty_run_initial_state">empty_run_initial_state</a></span> <span class="id">_</span> <span class="id">Hs</span>)); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IHHp1</span> <span class="kwd">as</span> [[<span class="id">state_run</span> <span class="id">Hsr</span>] <span class="id">Heqs</span>]. <span class="tactic">destruct</span> <span class="id">IHHp2</span> <span class="kwd">as</span> [[<span class="id">msg_run</span> <span class="id">Hmr</span>] <span class="id">Heqm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#extend_run">extend_run</a></span> <span class="id">state_run</span> <span class="id">Hsr</span>). <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">Hvr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvr</span> <span class="id">msg_run</span> <span class="id">Hmr</span> <span class="id">l1</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqs</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqs</span> <span class="kwd">in</span> <span class="id">Hvr</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Heqm</span> <span class="kwd">in</span> <span class="id">Hvr</span>. <span class="id">specialize</span> (<span class="id">Hvr</span> <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hvr</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="run_is_trace">run_is_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof94')">Proof.</div>
<div class="proofscript" id="proof94">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">r</span>; <span class="tactic">clear</span> <span class="id">r</span>; <span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hr</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IHHr1</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_state">vlsm_run_last_state</a></span>; <span class="tactic">intros</span> <span class="id">Hls</span>. <span class="id">specialize</span> (<span class="id">Hls</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">state_run</span> <span class="id">Hr1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hls</span>. <span class="tactic">unfold</span> <span class="id">ts</span>. <span class="tactic">unfold</span> <span class="id">is</span>. <span class="tactic">rewrite</span> <span class="id">Hls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">state_run</span>)). <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_protocol">run_is_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">state_run</span> <span class="id">Hr1</span>)); <span class="tactic">intro</span> <span class="id">Hp</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">msg_run</span>)). <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_protocol">run_is_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">msg_run</span> <span class="id">Hr2</span>)); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hp</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_is_run">trace_is_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> <span class="id">r</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span> = <span class="id">is</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span> = <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof95')">Proof.</div>
<div class="proofscript" id="proof95">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Htr</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_rev_ind">finite_protocol_trace_rev_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">si</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := []; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id">si</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) |}; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#empty_run_initial_state">empty_run_initial_state</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [[<span class="id">_</span> [<span class="id">Hmsg</span> <span class="id">Hvalid</span>]] <span class="id">Htrans</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHHtr</span> <span class="kwd">as</span> [<span class="id">r0</span> [<span class="id">Hr0</span> [<span class="id">Hstart</span> <span class="id">Htr_r0</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id">sf</span>,<span class="id">oom</span>)|};<span class="tactic">simpl</span>;<span class="tactic">repeat</span> <span class="tactic">split</span>;[|<span class="tactic">reflexivity</span>..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#extend_run">extend_run</a></span> <span class="id">r0</span> <span class="id">Hr0</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r0</span>)) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">si</span> <span class="id">tr</span>) <span class="kwd">in</span> <span class="id">Hextend</span> <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">rewrite</span> &lt;- <span class="id">Hstart</span>, &lt;- <span class="id">Htr_r0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_state">vlsm_run_last_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">r0</span> <span class="id">Hr0</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hstart</span>, <span class="id">Htr_r0</span> <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hstart</span> <span class="id">Htr_r0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmsg</span> <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">Hmsg</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_run">protocol_is_run</a></span> <span class="kwd">in</span> <span class="id">Hmsg</span> <span class="kwd">as</span> [[<span class="id">r_msg</span> <span class="id">Hr_msg</span>] <span class="id">Hmsg</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="tactic">f_equal</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span>) <span class="kwd">in</span> <span class="id">Hmsg</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hextend</span> <span class="id">r_msg</span> <span class="id">Hr_msg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hmsg</span> <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">_s</span> <span class="id">r_msg</span> <span class="id">Hr_msg</span> <span class="id">Hmsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hextend</span> <span class="id">l1</span> <span class="id">Hvalid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htrans</span> <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_is_protocol_prop">trace_is_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">tr</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof96')">Proof.</div>
<div class="proofscript" id="proof96">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_is_run">trace_is_run</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">Htr</span>); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hrun</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrun</span> <span class="kwd">as</span> [<span class="id">run</span> [<span class="id">Hrun</span> [<span class="id">Hstart</span> <span class="id">Htrans</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_protocol">run_is_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">run</span> <span class="id">Hrun</span>)); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_final">vlsm_run_last_final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">run</span> <span class="id">Hrun</span>)); <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Hlast</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htrans</span> <span class="kwd">in</span> <span class="id">Hlast</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_list_last</span> <span class="id">tr</span> <span class="id">tr</span>' <span class="id">lst</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">Hlast</span>'. <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">run</span>) <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hinit</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">spec</span> <span class="id">Hlast</span>'; [<span class="tactic">destruct</span> <span class="id">tr</span>'; <span class="tactic">intro</span> <span class="id">contra</span>; <span class="tactic">inversion</span> <span class="id">contra</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id">last_error_is_last</span> <span class="kwd">in</span> <span class="id">Hlast</span>'. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hlast</span>' <span class="kwd">as</span> [<span class="id">Hdestination</span> <span class="id">Houtput</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_is_last">finite_trace_last_is_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>! <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span>! <span class="id">last_is_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">run</span>) <span class="kwd">as</span> (<span class="id">s</span>, <span class="id">om</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_is_protocol_state">trace_is_protocol_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof97')">Proof.</div>
<div class="proofscript" id="proof97">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id">_</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_is_protocol_prop">trace_is_protocol_prop</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<div class="doc">Having defined <span class="bracket"><span class="id">protocol_trace</span></span>s, we now connect them to protocol states
and messages, in the following sense: for each state-message pair (&lt;&lt;s&gt;&gt;, &lt;&lt;m&gt;&gt;)
that has the <span class="bracket"><span class="id">protocol_prop</span></span>erty, there exists a <span class="bracket"><span class="id">protocol_trace</span></span> which ends
in &lt;&lt;s&gt;&gt; by outputting &lt;&lt;m&gt;&gt; </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_is_trace">protocol_is_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id">exists</span> (<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">is</span> <span class="id">s</span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> (<span class="id">last_error</span> <span class="id">tr</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof98')">Proof.</div>
<div class="proofscript" id="proof98">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_run">protocol_is_run</a></span> (<span class="id">s</span>,<span class="id">om</span>) <span class="id">Hp</span>); <span class="tactic">intros</span> [<span class="id">vr</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_trace">run_is_trace</a></span> <span class="id">vr</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hvr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>) <span class="id">eqn</span>:<span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hvr</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htrace</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">His</span>]. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">ts</span>; <span class="tactic">inversion</span> <span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span>). <span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>). <span class="tactic">rewrite</span> <span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_final">vlsm_run_last_final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">r</span> <span class="id">Hvr</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">rewrite</span> &lt;- <span class="id">Heq</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">Hs</span> <span class="id">Hom</span>];[<span class="tactic">discriminate</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_add_last">finite_protocol_trace_init_add_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#last_error_destination_last">last_error_destination_last</a></span>];<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Giving a trace for <span class="bracket"><span class="id">protocol_state_prop</span></span> can be stated more
        simply than <span class="bracket"><span class="id">protocol_is_trace</span></span>, because we don't need a
        disjunction because we are not making claims about <span class="bracket"><span class="id">output</span></span>
        messages.
     </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_has_trace">protocol_state_has_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">is</span> <span class="id">s</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Proof</span> <span class="kwd">using</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hp</span> <span class="kwd">as</span> [<span class="id">_om</span> <span class="id">Hp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_trace">protocol_is_trace</a></span> <span class="kwd">in</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hp</span> <span class="kwd">as</span> [<span class="id">Hinit</span>|<span class="id">Htrace</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">s</span>, [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Htrace</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">tr</span> [<span class="id">Htr</span> <span class="id">_</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">is</span>, <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Any trace with the 'finite_protocol_trace_from' property can be completed
    (to the left) to start in an initial state</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_complete_left">finite_protocol_trace_from_complete_left</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">trs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">is</span> (<span class="id">trs</span> ++ <span class="id">tr</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">is</span> <span class="id">trs</span> = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof99')">Proof.</div>
<div class="proofscript" id="proof99">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Htr</span> <span class="kwd">as</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_has_trace">protocol_state_has_trace</a></span> <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">trs</span> [<span class="id">Htrs</span> <span class="id">His</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">is</span>, <span class="id">trs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span> <span class="kwd">in</span> <span class="id">Htrs</span> <span class="kwd">as</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hlast</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span> <span class="kwd">in</span> <span class="id">Htrs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span> || <span class="tactic">assumption</span> ||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Any trace with the 'finite_protocol_trace_from_to' property can be completed
    (to the left) to start in an initial state</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_complete_left">finite_protocol_trace_from_to_complete_left</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">f</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">trs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">is</span> <span class="id">f</span> (<span class="id">trs</span> ++ <span class="id">tr</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">is</span> <span class="id">trs</span> = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof100')">Proof.</div>
<div class="proofscript" id="proof100">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>) <span class="kwd">as</span> <span class="id">Hs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Htr</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_has_trace">protocol_state_has_trace</a></span> <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">trs</span> [<span class="id">Htrs</span> <span class="id">His</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">is</span>, <span class="id">trs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_app">finite_protocol_trace_from_to_app</a></span> <span class="kwd">with</span> <span class="id">s</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span> <span class="kwd">in</span> <span class="id">Htrs</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Another benefit of defining traces is that we can succintly
describe indirect transitions between arbitrary pairs of states.
We say that state &lt;&lt;second&gt;&gt; is in state &lt;&lt;first&gt;&gt;'s futures if
there exists a finite (possibly empty) protocol trace that begins
with &lt;&lt;first&gt;&gt; and ends in &lt;&lt;second&gt;&gt;.
This relation is often used in stating safety and liveness properties.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="in_futures">in_futures</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">first</span> <span class="id">second</span> <span class="id">tr</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_preserving">in_futures_preserving</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpre</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#PreOrder">PreOrder</a></span> <span class="id">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_preserving">protocol_transition_preserving</a></span> <span class="id">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hin</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">R</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof101')">Proof.</div>
<div class="proofscript" id="proof101">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Ht</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">transitivity</span> <span class="id">s</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Instance</span> <span class="id"><a name="eq_equiv">eq_equiv</a></span> : @<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Equivalence">Equivalence</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span> := <span class="id">_</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_strict_preserving">in_futures_strict_preserving</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpre</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#StrictOrder">StrictOrder</a></span> <span class="id">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_preserving">protocol_transition_preserving</a></span> <span class="id">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hin</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hneq</span> : <span class="id">s1</span> &lt;&gt; <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">R</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof102')">Proof.</div>
<div class="proofscript" id="proof102">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.Morphisms.html#StrictOrder_PreOrder">StrictOrder_PreOrder</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#eq_equiv">eq_equiv</a></span>) <span class="kwd">in</span> <span class="id">Hpre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_preserving">in_futures_preserving</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#relation_disjunction">relation_disjunction</a></span> <span class="id">R</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq">eq</a></span>) <span class="id">Hpre</span>) <span class="kwd">as</span> <span class="id">Hpreserve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hpreserve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span>; <span class="tactic">intros</span>. <span class="id">left</span>. <span class="tactic">apply</span> (<span class="id">Ht</span> <span class="id">s3</span> <span class="id">s4</span> <span class="id">l1</span> <span class="id">om1</span> <span class="id">om2</span> <span class="id">Hprotocol</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">spec</span> <span class="id">Hpreserve</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hpreserve</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">Hneq</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">Heq</span>. <span class="tactic">subst</span>. <span class="tactic">intros</span> <span class="id">y1</span> <span class="id">y2</span> <span class="id">Heq</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_protocol_fst">in_futures_protocol_fst</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfuture</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">first</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof103')">Proof.</div>
<div class="proofscript" id="proof103">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfuture</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_refl">in_futures_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">first</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">first</span>.<br/>
<br/>
<div class="toggleproof" onclick="toggleDisplay('proof104')">Proof.</div>
<div class="proofscript" id="proof104">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_trans">in_futures_trans</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> <span class="id">third</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H12</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H23</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">second</span> <span class="id">third</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">third</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof105')">Proof.</div>
<div class="proofscript" id="proof105">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H12</span> <span class="kwd">as</span> [<span class="id">tr12</span> <span class="id">Htr12</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H23</span> <span class="kwd">as</span> [<span class="id">tr23</span> <span class="id">Htr23</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">tr12</span> ++ <span class="id">tr23</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_app">finite_protocol_trace_from_to_app</a></span> <span class="kwd">with</span> <span class="id">second</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_witness">in_futures_witness</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfutures</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>) (<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n1</span> &lt;= <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">second</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof106')">Proof.</div>
<div class="proofscript" id="proof106">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_protocol_fst">in_futures_protocol_fst</a></span> <span class="id">first</span> <span class="id">second</span> <span class="id">Hfutures</span>); <span class="tactic">intro</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_has_trace">protocol_state_has_trace</a></span> <span class="kwd">in</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hps</span> <span class="kwd">as</span> [<span class="id">prefix_start</span> [<span class="id">prefix_tr</span> [<span class="id">Hprefix_tr</span> <span class="id">Hinit</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfutures</span> <span class="kwd">as</span> [<span class="id">suffix_tr</span> <span class="id">Hsuffix_tr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_app">finite_protocol_trace_from_to_app</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hprefix_tr</span> <span class="id">Hsuffix_tr</span>) <span class="kwd">as</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span> <span class="kwd">in</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">prefix_start</span> (<span class="id">prefix_tr</span> ++ <span class="id">suffix_tr</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">split</span>;<span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">prefix_tr</span>), (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">prefix_tr</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">suffix_tr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[<span class="id">lia</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span> <span class="kwd">in</span> <span class="id">Hprefix_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span> <span class="kwd">in</span> <span class="id">Hsuffix_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_app1">finite_trace_nth_app1</a></span>;[|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_last">finite_trace_nth_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_app2">finite_trace_nth_app2</a></span>;[|<span class="id">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Minus.html#minus_plus">Minus.minus_plus</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_last">finite_trace_nth_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_segment">trace_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">l</span> =&gt; <span class="id">list_segment</span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">l</span> =&gt; <span class="id">stream_segment</span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ptrace_segment">ptrace_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfirst</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> <span class="id">tr</span> <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">first</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_segment">trace_segment</a></span> <span class="id">tr</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof107')">Proof.</div>
<div class="proofscript" id="proof107">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">tr</span> | <span class="id">s</span> <span class="id">tr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_segment">finite_protocol_trace_from_segment</a></span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hfirst</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hfirst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_segment">infinite_protocol_trace_from_segment</a></span> <span class="id">s</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">Hle</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="Trace_messages">Trace_messages</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Finite_messages">Finite_messages</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) -&gt; <span class="id">Trace_messages</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Infinite_messages">Infinite_messages</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) -&gt; <span class="id">Trace_messages</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_output_messages_trace">protocol_output_messages_trace</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace_messages">Trace_messages</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">_</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite_messages">Finite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">st</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite_messages">Infinite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">st</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_input_messages_trace">protocol_input_messages_trace</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace_messages">Trace_messages</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">_</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite_messages">Finite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">st</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite_messages">Infinite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">st</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_prefix">trace_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id">exists</span> <span class="id">suffix</span>, <span class="id">ls</span> = <span class="id">prefix</span> ++ (<span class="id">last</span> :: <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">st</span> =&gt; <span class="id">exists</span> <span class="id">suffix</span>, <span class="id">st</span> = <span class="id">stream_app</span> <span class="id">prefix</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last</span> <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_prefix_fn">trace_prefix_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> (<span class="id">list_prefix</span> <span class="id">ls</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">st</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> (<span class="id">stream_prefix</span> <span class="id">st</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_prefix_protocol">trace_prefix_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprefix</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">prefix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>)) (<span class="id">prefix</span> ++ [<span class="id">last</span>])).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof108')">Proof.</div>
<div class="proofscript" id="proof108">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span> (<span class="kwd">fun</span> <span class="id">prefix</span> =&gt; <span class="kwd">forall</span> (<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="id">tr</span> <span class="id">last</span> <span class="id">prefix</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> <span class="id">tr</span>) (<span class="id">prefix</span> ++ [<span class="id">last</span>]))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">last</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">Hprefix</span>; <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [ | ]; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="kwd">in</span> <span class="id">Hprefix</span>;   <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hprefix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hprefix</span> <span class="kwd">as</span> [<span class="id">suffix</span> <span class="id">Heq</span>]; <span class="tactic">subst</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Htr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_singleton">finite_ptrace_singleton</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">last_p</span> <span class="id">p</span> <span class="id">Hind</span> <span class="id">last</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">Hprefix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hind</span> <span class="id">last_p</span> <span class="id">tr</span> <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [ | ]; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="kwd">in</span> <span class="id">Hprefix</span>;   <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hprefix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hprefix</span> <span class="kwd">as</span> [<span class="id">suffix</span> <span class="id">Heq</span>]; <span class="tactic">subst</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">simpl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hind</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hex</span> : <span class="id">exists</span> <span class="id">suffix0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p</span> ++ [<span class="id">last_p</span>]) ++ <span class="id">last</span> :: <span class="id">suffix</span> = <span class="id">p</span> ++ <span class="id">last_p</span> :: <span class="id">suffix0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="tactic">by</span> (<span class="id">exists</span> (<span class="id">last</span> :: <span class="id">suffix</span>); <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span> (<span class="id">Hind</span> <span class="id">Hex</span>); <span class="tactic">clear</span> <span class="id">Hex</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hind</span> <span class="kwd">as</span> [<span class="id">Hptr</span> <span class="id">_</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">last</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">app_cons</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |} <span class="id">suffix</span>) <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="id">p</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">in</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_consecutive_valid_transition">finite_ptrace_consecutive_valid_transition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Htr</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_is_last">finite_trace_last_is_last</a></span>. <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hex</span> : <span class="id">exists</span> <span class="id">suffix0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stream_app</span> (<span class="id">p</span> ++ [<span class="id">last_p</span>])  (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last</span> <span class="id">suffix</span>) = <span class="id">stream_app</span> <span class="id">p</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last_p</span> <span class="id">suffix0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="tactic">by</span> (<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last</span> <span class="id">suffix</span>); <span class="tactic">rewrite</span> &lt;- <span class="id">stream_app_assoc</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span> (<span class="id">Hind</span> <span class="id">Hex</span>); <span class="tactic">clear</span> <span class="id">Hex</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hind</span> <span class="kwd">as</span> [<span class="id">Hptr</span> <span class="id">_</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">last</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">stream_app_cons</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">stream_app_assoc</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="id">p</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">in</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_ptrace_consecutive_valid_transition">infinite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">stream_app</span> (<span class="id">p</span> ++ [<span class="id">last_p</span>; {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |}]) <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suffix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last_p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Htr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_is_last">finite_trace_last_is_last</a></span>. <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="build_trace_prefix_protocol">build_trace_prefix_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprefix</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">prefix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>)) (<span class="id">prefix</span> ++ [<span class="id">last</span>]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_protocol">trace_prefix_protocol</a></span> <span class="id">tr</span> <span class="id">last</span> <span class="id">prefix</span> <span class="id">Hprefix</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_prefix_fn_protocol">trace_prefix_fn_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_fn">trace_prefix_fn</a></span> <span class="id">tr</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof109')">Proof.</div>
<div class="proofscript" id="proof109">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_protocol">trace_prefix_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">tr</span> <span class="id">Htr</span>)); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_fn">trace_prefix_fn</a></span> <span class="id">tr</span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">pref_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pref_tr</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">l</span> | <span class="id">s</span> <span class="id">l</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [| <span class="id">item</span> <span class="id">l</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">l</span>' | <span class="id">s</span>' <span class="id">l</span>']<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; (<span class="tactic">split</span>;[|<span class="tactic">assumption</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">constructor</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;  <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">Hnnil</span> : <span class="id">item</span> ::<span class="id">l</span> &lt;&gt; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">intro</span> <span class="id">Hnil</span>; <span class="tactic">inversion</span> <span class="id">Hnil</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#exists_last">exists_last</a></span> <span class="id">Hnnil</span>); <span class="tactic">intros</span> [<span class="id">prefix</span> [<span class="id">last</span> <span class="id">Heq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">Hnnil</span> <span class="id">Heq</span> <span class="id">l</span> <span class="id">item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">s</span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">tr</span> <span class="id">Htr</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span>; <span class="tactic">subst</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_protocol">trace_prefix_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">l</span>' | <span class="id">s</span>' <span class="id">l</span>']<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">clear</span> <span class="id">Heqpref_tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">list_prefix_suffix</span> <span class="id">l</span>' <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hl</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hl</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">list_suffix</span> <span class="id">l</span>' <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">stream_prefix_suffix</span> <span class="id">l</span>' <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hl</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hl</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">stream_suffix</span> <span class="id">l</span>' <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">stream_app_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">l</span>' | <span class="id">s</span>' <span class="id">l</span>']; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_nth">protocol_trace_nth</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> <span class="id">tr</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof110')">Proof.</div>
<div class="proofscript" id="proof110">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">l</span> | <span class="id">s0</span> <span class="id">l</span>]; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span> <span class="id">s0</span> <span class="id">l</span> <span class="id">Htr</span> <span class="id">n</span> <span class="id">s</span> <span class="id">Hnth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hsuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Hsuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hle</span> : <span class="id">n</span> &lt;= <span class="id">n</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_segment">infinite_protocol_trace_from_segment</a></span> <span class="id">s0</span> <span class="id">l</span> <span class="id">Htr</span> <span class="id">n</span> <span class="id">n</span> <span class="id">Hle</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Hseg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Hseg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_protocol_snd">in_futures_protocol_snd</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfutures</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">second</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof111')">Proof.</div>
<div class="proofscript" id="proof111">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_witness">in_futures_witness</a></span> <span class="id">first</span> <span class="id">second</span> <span class="id">Hfutures</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span> [<span class="id">tr</span> [<span class="id">n1</span> [<span class="id">n2</span> [<span class="id">Hle</span> [<span class="id">Hn1</span> <span class="id">Hn2</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hn2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_nth">protocol_trace_nth</a></span> <span class="kwd">with</span> <span class="id">tr</span> <span class="id">n2</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_witness_reverse">in_futures_witness_reverse</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs1</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof112')">Proof.</div>
<div class="proofscript" id="proof112">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hle</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Hs1</span> <span class="kwd">in</span> <span class="id">Hs2</span>. <span class="tactic">inversion</span> <span class="id">Hs2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_nth">protocol_trace_nth</a></span> <span class="kwd">with</span> <span class="id">tr</span> <span class="id">n2</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_segment">trace_segment</a></span> <span class="id">tr</span> <span class="id">n1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_add_last">finite_protocol_trace_from_add_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_segment">ptrace_segment</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ { <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">tr</span> | <span class="id">s</span> <span class="id">tr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs1</span>, <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">list_segment</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_suffix">finite_trace_last_suffix</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_prefix">finite_trace_last_prefix</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_length</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_nth_length">finite_trace_nth_length</a></span> <span class="kwd">in</span> <span class="id">Hs2</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">stream_segment</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#unlock_finite_trace_last">unlock_finite_trace_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_map</span>, <span class="id">stream_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id">stream_prefix_nth_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="kwd">in</span> <span class="id">Hs2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hs2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">stream_prefix_length</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span>)); <span class="tactic">intro</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="terminating_trace_prop">terminating_trace_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">ls</span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">A <span class="bracket"><span class="id">protocol_trace</span></span> is _complete_, if it is either _terminating_ or infinite.
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="complete_trace_prop">complete_trace_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#terminating_trace_prop">terminating_trace_prop</a></span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composition_constraint">composition_constraint</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_vdecidable">VLSM_vdecidable</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="valid_decidable">valid_decidable</a></span> : <span class="kwd">forall</span> <span class="id">l</span> <span class="id">som</span>, {<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> <span class="id">som</span>} + {~<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> <span class="id">som</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span>.<br/>
<br/>
<div class="doc">Make all arguments of <span class="bracket"><span class="id">protocol_state_prop_ind</span></span> explicit
    so it will work with the &lt;&lt;induction using&gt;&gt; tactic.
    (closing the section added &lt;&lt;{message}&gt;&gt; as an implicit argument)
 </div>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop_ind">protocol_state_prop_ind</a></span> : <span class="tactic">clear</span> <span class="id">implicits</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_ind">finite_protocol_trace_from_to_ind</a></span> : <span class="tactic">clear</span> <span class="id">implicits</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_rev_ind">finite_protocol_trace_rev_ind</a></span> : <span class="tactic">clear</span> <span class="id">implicits</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_rev_ind">finite_protocol_trace_from_rev_ind</a></span> : <span class="tactic">clear</span> <span class="id">implicits</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span> [<span class="id">message</span>] (<span class="id">X</span>) [<span class="id">s1</span>] [<span class="id">ts</span>] (<span class="id">Ht12</span>) [<span class="id">l3</span>] [<span class="id">iom3</span>] [<span class="id">s3</span>] [<span class="id">oom3</span>] (<span class="id">Hv23</span>).<br/>
<span class="id">Arguments</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from_to">extend_right_finite_trace_from_to</a></span> [<span class="id">message</span>] (<span class="id">X</span>) [<span class="id">s1</span>] [<span class="id">s2</span>] [<span class="id">ts</span>] (<span class="id">Ht12</span>) [<span class="id">l3</span>] [<span class="id">iom3</span>] [<span class="id">s3</span>] [<span class="id">oom3</span>] (<span class="id">Hv23</span>).<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="TraceWithLast">TraceWithLast</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">base_prop</span> : <span class="kwd">forall</span> {<span class="id">message</span>} (<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">_</span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id">_</span> <span class="id">X</span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">trace_prop</span> : <span class="kwd">forall</span> {<span class="id">message</span>} (<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;&nbsp;{<span class="id"><a name="ptrace_add_last">ptrace_add_last</a></span>: <span class="kwd">forall</span> [<span class="id">msg</span>] [<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">msg</span>] [<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">base_prop</span> <span class="id">X</span> <span class="id">s</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span> = <span class="id">f</span> -&gt; <span class="id">trace_prop</span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="ptrace_get_last">ptrace_get_last</a></span>: <span class="kwd">forall</span> [<span class="id">msg</span>] [<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">msg</span>] [<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trace_prop</span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span> = <span class="id">f</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="ptrace_last_pstate">ptrace_last_pstate</a></span>: <span class="kwd">forall</span> [<span class="id">msg</span>] [<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">msg</span>] [<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trace_prop</span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">X</span> <span class="id">f</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="ptrace_forget_last">ptrace_forget_last</a></span>: <span class="kwd">forall</span> [<span class="id">msg</span>] [<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">msg</span>] [<span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trace_prop</span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span> -&gt; <span class="id">base_prop</span> <span class="id">X</span> <span class="id">s</span> <span class="id">tr</span><br/>
&nbsp;&nbsp;}.<br/>
<span class="kwd">Hint</span> <span class="id">Mode</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithLast">TraceWithLast</a></span> - ! : <span class="id">typeclass_instances</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Mode</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithLast">TraceWithLast</a></span> ! - : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ptrace_add_default_last">ptrace_add_default_last</a></span><br/>
&nbsp;&nbsp;`{<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithLast">TraceWithLast</a></span> <span class="id">base_prop</span> <span class="id">trace_prop</span>}<br/>
&nbsp;&nbsp;[<span class="id">msg</span>] [<span class="id">X</span>:<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">msg</span>] [<span class="id">s</span> <span class="id">tr</span>] (<span class="id">Htr</span>: <span class="id">base_prop</span> <span class="id">msg</span> <span class="id">X</span> <span class="id">s</span> <span class="id">tr</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trace_prop</span> <span class="id">msg</span> <span class="id">X</span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">s</span> <span class="id">tr</span>) <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof113')">Proof.</div>
<div class="proofscript" id="proof113">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_add_last">ptrace_add_last</a></span>. <span class="tactic">assumption</span>. <span class="tactic">reflexivity</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="trace_with_last_ptrace_from">trace_with_last_ptrace_from</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithLast">TraceWithLast</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span>) (@<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span>)<br/>
&nbsp;&nbsp;:= {<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_add_last">ptrace_add_last</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_add_last">finite_protocol_trace_from_add_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_get_last">ptrace_get_last</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_last_pstate">ptrace_last_pstate</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last_pstate">finite_protocol_trace_from_to_last_pstate</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="trace_with_last_ptrace_init">trace_with_last_ptrace_init</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithLast">TraceWithLast</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span>) (@<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span>)<br/>
&nbsp;&nbsp;:= {<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_add_last">ptrace_add_last</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_add_last">finite_protocol_trace_init_add_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_get_last">ptrace_get_last</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to_last">finite_protocol_trace_init_to_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_last_pstate">ptrace_last_pstate</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_last_pstate">ptrace_last_pstate</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">H</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to_forget_last">finite_protocol_trace_init_to_forget_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="TraceWithStart">TraceWithStart</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span>} {<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : @<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">message</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">trace_prop</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id">X</span>)) -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;{<span class="id"><a name="ptrace_first_pstate">ptrace_first_pstate</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> [<span class="id">tr</span>], <span class="id">trace_prop</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">X</span> <span class="id">start</span><br/>
&nbsp;}.<br/>
<span class="kwd">Hint</span> <span class="id">Mode</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithStart">TraceWithStart</a></span> - - - ! : <span class="id">typeclass_instances</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="trace_with_start_ptrace_from">trace_with_start_ptrace_from</a></span> <span class="id">message</span> (<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>) <span class="id">s</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithStart">TraceWithStart</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">X</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;:= {<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="id">X</span> <span class="id">s</span>}.<br/>
<span class="kwd">Instance</span> <span class="id"><a name="trace_with_start_ptrace">trace_with_start_ptrace</a></span> <span class="id">message</span> (<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>) <span class="id">s</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithStart">TraceWithStart</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">X</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;:= {<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> <span class="id">tr</span> <span class="id">H</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">H</span>)}.<br/>
<span class="kwd">Instance</span> <span class="id"><a name="trace_with_start_ptrace_from_to">trace_with_start_ptrace_from_to</a></span> <span class="id">message</span> (<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>) <span class="id">s</span> <span class="id">f</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithStart">TraceWithStart</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;:= {<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> <span class="id">tr</span> <span class="id">H</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> <span class="id">H</span>)}.<br/>
<span class="kwd">Instance</span> <span class="id"><a name="trace_with_start_ptrace_init_to">trace_with_start_ptrace_init_to</a></span> <span class="id">message</span> (<span class="id">X</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>) <span class="id">s</span> <span class="id">f</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#TraceWithStart">TraceWithStart</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span>)<br/>
&nbsp;&nbsp;:= {<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> <span class="id">tr</span> <span class="id">H</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_first_pstate">ptrace_first_pstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> <span class="id">H</span>)}.<br/>
<br/>
<h3> VLSM Inclusion and Equality
We can also define VLSM _inclusion_  and _equality_ in terms of traces.
When both VLSMs have the same state and label types they also share the
same <span class="bracket"><span class="id">Trace</span></span> type, and sets of traces can be compared without conversion.
<ul>
<li>
 VLSM X is _included_ in VLSM Y if every <span class="bracket"><span class="id">protocol_trace</span></span> available to X
is also available to Y.
</li>
<li>
 VLSM X and VLSM Y are _equal_ if their <span class="bracket"><span class="id">protocol_trace</span></span>s are exactly the same.
</h3>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_equality">VLSM_equality</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM_eq_part">VLSM_eq_part</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> <span class="id">t</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">Y</span> <span class="id">t</span> .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Notation</span> <span class="id"><a name="VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> := (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_part">VLSM_eq_part</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">Y</span>)).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM_incl_part">VLSM_incl_part</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> <span class="id">t</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">Y</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Local</span> <span class="kwd">Notation</span> <span class="id"><a name="VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span> := (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">Y</span>)).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_trans">VLSM_incl_trans</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span> <span class="id">SigZ</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>) (<span class="id">MZ</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigZ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>) (<span class="id">Z</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MZ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">Y</span> <span class="id">Z</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof114')">Proof.</div>
<div class="proofscript" id="proof114">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_in_futures">VLSM_incl_in_futures</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">X</span> <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">Y</span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof115')">Proof.</div>
<div class="proofscript" id="proof115">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hfuture</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_witness">in_futures_witness</a></span> <span class="kwd">in</span> <span class="id">Hfuture</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfuture</span> <span class="kwd">as</span> [[<span class="id">tr</span> <span class="id">Htr</span>] [<span class="id">n1</span> [<span class="id">n2</span> [<span class="id">Hle</span> [<span class="id">Hs1</span> <span class="id">Hs2</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_witness_reverse">in_futures_witness_reverse</a></span> <span class="id">Y</span> <span class="id">s1</span> <span class="id">s2</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">tr</span> <span class="id">Htr</span>) <span class="id">n1</span> <span class="id">n2</span> <span class="id">Hle</span> <span class="id">Hs1</span> <span class="id">Hs2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_incl_l">VLSM_eq_incl_l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof116')">Proof.</div>
<div class="proofscript" id="proof116">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">Hxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_incl_r">VLSM_eq_incl_r</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">Y</span> <span class="id">X</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof117')">Proof.</div>
<div class="proofscript" id="proof117">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">Hyt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_incl_iff">VLSM_eq_incl_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">Y</span> <span class="id">X</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof118')">Proof.</div>
<div class="proofscript" id="proof118">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_l">VLSM_eq_incl_l</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_r">VLSM_eq_incl_r</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">Hxy</span> <span class="id">Hyx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hyx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">VLSM inclusion specialized to finite trace. </li>
</ul>
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_finite_protocol_trace">VLSM_incl_finite_protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">Y</span> <span class="id">s</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof119')">Proof.</div>
<div class="proofscript" id="proof119">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hptr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">tr</span>)) <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">Y</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">tr</span>)). { <span class="tactic">intro</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hptr</span>. <span class="tactic">apply</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_finite_protocol_trace_init_to">VLSM_incl_finite_protocol_trace_init_to</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">f</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_init_to">finite_protocol_trace_init_to</a></span> <span class="id">Y</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof120')">Proof.</div>
<div class="proofscript" id="proof120">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_add_last">ptrace_add_last</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_get_last">ptrace_get_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span>;<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_protocol_trace">VLSM_incl_finite_protocol_trace</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_protocol_state">VLSM_incl_protocol_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">X</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">Y</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof121')">Proof.</div>
<div class="proofscript" id="proof121">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_has_trace">protocol_state_has_trace</a></span> <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">tr</span> <span class="id">Htr</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_get_last">ptrace_get_last</a></span> <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_protocol_trace">VLSM_incl_finite_protocol_trace</a></span> <span class="id">_</span> <span class="id">MY</span>) <span class="kwd">in</span> <span class="id">Htr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_is_protocol_state">trace_is_protocol_state</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_initial_state">VLSM_incl_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id">X</span> <span class="id">is</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id">Y</span> <span class="id">is</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof122')">Proof.</div>
<div class="proofscript" id="proof122">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">His</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">Y</span> <span class="id">is</span> []). { <span class="tactic">intro</span> <span class="id">Hpis</span>. <span class="tactic">apply</span> <span class="id">Hpis</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hpis</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">X</span> <span class="id">is</span> []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>; [|<span class="tactic">assumption</span>]. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hpis</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_protocol_trace">VLSM_incl_finite_protocol_trace</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_finite_protocol_trace_from">VLSM_incl_finite_protocol_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">Y</span> <span class="id">s</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof123')">Proof.</div>
<div class="proofscript" id="proof123">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_complete_left">finite_protocol_trace_from_complete_left</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">pre</span> [<span class="id">Htr</span> <span class="id">Hlst</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_protocol_trace">VLSM_incl_finite_protocol_trace</a></span> <span class="id">_</span> <span class="id">MY</span>) <span class="kwd">in</span> <span class="id">Htr</span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="id">Y</span>) <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="kwd">in</span> <span class="id">Htr</span>. <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_finite_protocol_trace_from_to">VLSM_incl_finite_protocol_trace_from_to</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">f</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to">finite_protocol_trace_from_to</a></span> <span class="id">Y</span> <span class="id">s</span> <span class="id">f</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof124')">Proof.</div>
<div class="proofscript" id="proof124">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_last">finite_protocol_trace_from_to_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span> <span class="kwd">as</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_forget_last">finite_protocol_trace_from_to_forget_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_protocol_trace_from">VLSM_incl_finite_protocol_trace_from</a></span> <span class="id">_</span> <span class="id">MY</span>) <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_add_last">finite_protocol_trace_from_add_last</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_protocol_transition">VLSM_incl_protocol_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> <span class="id">MX</span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span> <span class="id">s</span> <span class="id">im</span> <span class="id">s</span>' <span class="id">om</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">im</span>) (<span class="id">s</span>',<span class="id">om</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">Y</span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">im</span>) (<span class="id">s</span>',<span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof125')">Proof.</div>
<div class="proofscript" id="proof125">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span> <span class="id">s</span> <span class="id">im</span> <span class="id">s</span>' <span class="id">om</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">X</span> <span class="id">s</span>) <span class="kwd">as</span> <span class="id">Hs</span> <span class="tactic">by</span> <span class="tactic">apply</span> <span class="id">Hstep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_has_trace">protocol_state_has_trace</a></span> <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">tr</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">is</span> (<span class="id">tr</span> ++ [{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">im</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>'; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">om</span> |}]))) <span class="kwd">as</span> <span class="id">Htr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from_to">extend_right_finite_trace_from_to</a></span> <span class="id">X</span> <span class="id">Htr</span> <span class="id">Hstep</span>) <span class="kwd">as</span> <span class="id">Htr</span>''.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_forget_last">ptrace_forget_last</a></span> <span class="kwd">in</span> <span class="id">Htr</span>'';<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">Htr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span>' <span class="kwd">as</span> [<span class="id">Htrace</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="id">Y</span> <span class="id">is</span> <span class="id">tr</span>) <span class="kwd">in</span> <span class="id">Htrace</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Htrace</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_get_last">ptrace_get_last</a></span> <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htrace</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality">VLSM_equality</a></span>.<br/>
<br/>
<span class="kwd">Notation</span> <span class="id"><a name="VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> := (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_part">VLSM_eq_part</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">Y</span>)).<br/>
<span class="kwd">Notation</span> <span class="id"><a name="VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span> := (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_part">VLSM_incl_part</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">Y</span>)).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_sym">VLSM_eq_sym</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>}<br/>
&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">Y</span> <span class="id">X</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof126')">Proof.</div>
<div class="proofscript" id="proof126">
&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_trans">VLSM_eq_trans</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span> <span class="id">SigZ</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>}<br/>
&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>) (<span class="id">MZ</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigZ</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>) (<span class="id">Z</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MZ</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Y</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">Y</span> <span class="id">Z</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">X</span> <span class="id">Z</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof127')">Proof.</div>
<div class="proofscript" id="proof127">
&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_incl">protocol_prop_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">message</span> : <span class="kwd">Type</span>] [<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>] [<span class="id">SigX</span> <span class="id">SigY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>):<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">m</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message_prop">vinitial_message_prop</a></span> <span class="id">X</span> <span class="id">m</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message_prop">vinitial_message_prop</a></span> <span class="id">Y</span> <span class="id">m</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">som</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id">X</span> <span class="id">som</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id">Y</span> <span class="id">som</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof128')">Proof.</div>
<div class="proofscript" id="proof128">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hincl</span> <span class="id">Hinits</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;protocol_initial&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">cut</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id">Y</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>;[<span class="tactic">apply</span> <span class="id">Hinits</span>|];<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> [])).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;protocol_generated&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l1</span> (<span class="id">s</span>,<span class="id">om</span>)) <span class="kwd">as</span> <span class="id">som</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">X</span> <span class="id">l1</span> (<span class="id">s</span>,<span class="id">om</span>) <span class="id">som</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">split</span>. <span class="id">eexists</span>;<span class="id">eassumption</span>. <span class="tactic">split</span>. <span class="id">eexists</span>;<span class="id">eassumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">som</span>' <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">om</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_protocol_transition">VLSM_incl_protocol_transition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hincl</span>) <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> <span class="id">H1</span>) <span class="kwd">as</span> [<span class="id">Hvalid</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Heq</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span>;[<span class="id">eassumption</span>..|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hvalid</span>.<br/>
Qed.</div>
<br/>
<div class="doc">It is natural to look for sufficient conditions for VLSM inclusion (or equality),
which are easy to verify in a practical setting. One such result is the following.
For VLSM &lt;&lt;X&gt;&gt; to be included in VLSM &lt;&lt;Y&gt;&gt;, the following set of conditions is sufficient:
<ul>
<li>
 &lt;&lt;X&gt;&gt;'s <span class="bracket"><span class="id">initial_state</span></span>s are included in &lt;&lt;Y&gt;&gt;'s <span class="bracket"><span class="id">initial</span> <span class="id">state</span></span>s
</li>
<li>
 Every message &lt;&lt;m&gt;&gt; (including the empty one) which can be input to a
<span class="bracket"><span class="id">protocol_valid</span></span> transition in &lt;&lt;X&gt;&gt;, is a <span class="bracket"><span class="id">protocol_message</span></span> in &lt;&lt;Y&gt;&gt;
</li>
<li>
 &lt;&lt;X&gt;&gt;'s <span class="bracket"><span class="id">protocol_valid</span></span> is included in &lt;&lt;Y&gt;&gt;'s <span class="bracket"><span class="id">valid</span></span>.
</li>
<li>
 For all <span class="bracket"><span class="id">protocol_valid</span></span> inputs (in &lt;&lt;X&gt;&gt;), &lt;&lt;Y&gt;&gt;'s <span class="bracket"><span class="id">transition</span></span> acts
like &lt;&lt;X&gt;&gt;'s <span class="bracket"><span class="id">transition</span></span>.
</li>
</ul>
</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="basic_VLSM_incl">basic_VLSM_incl</a></span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;{<span class="id">SX</span> <span class="id">SY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">T</span>}<br/>
&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SX</span>)<br/>
&nbsp;&nbsp;(<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SY</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>)<br/>
&nbsp;&nbsp;(<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_finite_traces_characterization">VLSM_incl_finite_traces_characterization</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">s</span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof129')">Proof.</div>
<div class="proofscript" id="proof129">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">Hincl</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">tr</span>)). <span class="tactic">apply</span> <span class="id">Hincl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">is</span> <span class="id">tr</span> | <span class="id">is</span> <span class="id">tr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">Htr</span>. <span class="tactic">apply</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">HtrX</span> <span class="id">HisX</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">His_tr</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">is</span> []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>; [|<span class="tactic">assumption</span>]. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">His_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">His_tr</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">HisY</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_prefix_rev">infinite_protocol_trace_from_prefix_rev</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_prefix">infinite_protocol_trace_from_prefix</a></span> <span class="kwd">with</span> (<span class="id">n0</span> := <span class="id">n</span>) <span class="kwd">in</span> <span class="id">HtrX</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Hincl</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">HtrX</span> <span class="id">HisX</span>)).<br/>
Qed.</div>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;(<span class="id">Hinitial_state</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">s</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id">Hinitial_protocol_message</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message_prop">vinitial_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">m</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">m</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id">Hvalid</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id">Htransition</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) = <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_props">protocol_props</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">som</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">som</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">som</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ ((<span class="id">exists</span> <span class="id">l</span> <span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>,<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">som</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">som</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof130')">Proof.</div>
<div class="proofscript" id="proof130">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">som</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_state">Hinitial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> [<span class="id">l</span> [<span class="id">_s</span> <span class="id">Hv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>;[|<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_None">option_protocol_message_None</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_protocol_message">Hinitial_protocol_message</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rename</span> <span class="id">IHprotocol_prop1</span> <span class="id">into</span> <span class="id">IHs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rename</span> <span class="id">IHprotocol_prop2</span> <span class="id">into</span> <span class="id">IHm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHm</span>. <span class="tactic">destruct</span> <span class="id">IHm</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">IHm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHs</span>. <span class="tactic">destruct</span> <span class="id">IHs</span> <span class="kwd">as</span> [<span class="id">IHs</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l1</span> (<span class="id">s</span>,<span class="id">om</span>)) <span class="kwd">as</span> <span class="id">Hpvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">eexists</span>;<span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="id">eexists</span>;<span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHm</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> <span class="id">_</span> <span class="id">l1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#ex_intro">ex_intro</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">Hv</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Hv</span> <span class="id">_om</span> <span class="id">H</span> <span class="id">_s</span> <span class="id">H0</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Htransition">Htransition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hpvalid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l1</span>) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Htransition">Htransition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">l1</span> (<span class="id">s</span>,<span class="id">om</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHs</span> <span class="kwd">as</span> [<span class="id">_om</span> <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHm</span> <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">Hm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>) <span class="kwd">with</span> (<span class="id">_om</span>:=<span class="id">_om</span>) (<span class="id">_s</span>:=<span class="id">_s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hvalid">Hvalid</a></span>;<span class="tactic">apply</span> <span class="id">Hpvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[|<span class="tactic">intros</span> <span class="id">_</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">eexists</span>;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>;<span class="tactic">exact</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="Hprotocol_message">Hprotocol_message</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof131')">Proof.</div>
<div class="proofscript" id="proof131">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span> <span class="id">s</span> [<span class="id">m</span>|] <span class="id">H</span>;[|<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_None">option_protocol_message_None</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">_</span> [[<span class="id">_s</span> <span class="id">H</span>] <span class="id">Hv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_props">protocol_props</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>, <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="basic_VLSM_incl_protocol_state">basic_VLSM_incl_protocol_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> (<span class="id">s</span>,<span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof132')">Proof.</div>
<div class="proofscript" id="proof132">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_props">protocol_props</a></span> <span class="kwd">in</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="basic_VLSM_incl_protocol_transition">basic_VLSM_incl_protocol_transition</a></span><br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">is</span> <span class="id">os</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">is</span>, <span class="id">iom</span>) (<span class="id">os</span>, <span class="id">oom</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">l</span> (<span class="id">is</span>, <span class="id">iom</span>) (<span class="id">os</span>, <span class="id">oom</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof133')">Proof.</div>
<div class="proofscript" id="proof133">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">Hps</span> <span class="id">Hpm</span> <span class="id">Hv</span>); <span class="tactic">intros</span> <span class="id">Hpv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl_protocol_state">basic_VLSM_incl_protocol_state</a></span> <span class="kwd">with</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Hprotocol_message">Hprotocol_message</a></span> <span class="kwd">in</span> <span class="id">Hpv</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hvalid">Hvalid</a></span> <span class="id">l</span> <span class="id">is</span> <span class="id">iom</span> <span class="id">Hpv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Htransition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Htransition">Htransition</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="basic_VLSM_incl_finite_protocol_trace">basic_VLSM_incl_finite_protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpxt</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span> <span class="id">ls</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof134')">Proof.</div>
<div class="proofscript" id="proof134">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hpxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">m</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl_protocol_state">basic_VLSM_incl_protocol_state</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl_protocol_transition">basic_VLSM_incl_protocol_transition</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="basic_VLSM_incl">basic_VLSM_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof135')">Proof.</div>
<div class="proofscript" id="proof135">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_traces_characterization">VLSM_incl_finite_traces_characterization</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">ls</span> [<span class="id">Hxt</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl_finite_protocol_trace">basic_VLSM_incl_finite_protocol_trace</a></span> <span class="kwd">in</span> <span class="id">Hxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_state">Hinitial_state</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span>.<br/>
<br/>
<h3> Pre-loaded VLSMs
Given a VLSM &lt;&lt;X&gt;&gt;, we introduce the _pre-loaded_ version of it,
which is identical to &lt;&lt;X&gt;&gt;, except that it is endowed with the
whole message universe as its initial messages. The high degree
of freedom allowed to the _pre-loaded_ version lets it experience
everything experienced by &lt;&lt;X&gt;&gt; but also other types of behaviour,
including _Byzantine_ behaviour, which makes it a useful concept in
Byzantine fault tolerance analysis.
</h3>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_with_all_messages_vlsm_sig">pre_loaded_with_all_messages_vlsm_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> := <span class="kwd">fun</span> <span class="id">message</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vm0">vm0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vl0">vl0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_sig">pre_loaded_with_all_messages_vlsm_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="byzantine_message_prop">byzantine_message_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="byzantine_message">byzantine_message</a></span> : <span class="kwd">Type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#byzantine_message_prop">byzantine_message_prop</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_message_protocol_prop">pre_loaded_with_all_messages_message_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span>), <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof136')">Proof.</div>
<div class="proofscript" id="proof136">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>;[<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_protocol_prop">pre_loaded_with_all_messages_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof137')">Proof.</div>
<div class="proofscript" id="proof137">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om0</span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>) <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_protocol_state_prop">pre_loaded_with_all_messages_protocol_state_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof138')">Proof.</div>
<div class="proofscript" id="proof138">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hps</span> <span class="kwd">as</span> [<span class="id">om</span> <span class="id">Hprs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_protocol_prop">pre_loaded_with_all_messages_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="any_message_is_protocol_in_preloaded">any_message_is_protocol_in_preloaded</a></span> (<span class="id">om</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof139')">Proof.</div>
<div class="proofscript" id="proof139">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_message_protocol_prop">pre_loaded_with_all_messages_message_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="preloaded_protocol_state_prop">preloaded_protocol_state_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="preloaded_protocol_initial_state">preloaded_protocol_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>:<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> (<span class="id">VLSM_sign</span>:=<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_sig">pre_loaded_with_all_messages_vlsm_sig</a></span>) <span class="id">s</span>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">preloaded_protocol_state_prop</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="preloaded_protocol_generated">preloaded_protocol_generated</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id">preloaded_protocol_state_prop</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> (<span class="id">VLSM_class</span>:=<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">preloaded_protocol_state_prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> (<span class="id">VLSM_class</span>:=<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_protocol_state_prop_iff">preloaded_protocol_state_prop_iff</a></span> <span class="id">s</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_state_prop">preloaded_protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof140')">Proof.</div>
<div class="proofscript" id="proof140">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">om</span> <span class="id">Hproto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> <span class="id">s</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id">s</span>,<span class="id">om</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">som</span>:=(<span class="id">s</span>,<span class="id">om</span>)) <span class="kwd">in</span> <span class="id">Hproto</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">clearbody</span> <span class="id">som</span>;<span class="tactic">clear</span> <span class="id">s</span> <span class="id">om</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hproto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_initial_state">preloaded_protocol_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_generated">preloaded_protocol_generated</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>;[<span class="tactic">assumption</span>|<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">pose</span> (<span class="id">som</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>:<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>, <span class="id">om</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l1</span> (<span class="id">s</span>,<span class="id">om</span>)) <span class="kwd">with</span> <span class="id">som</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">som</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHpreloaded_protocol_state_prop</span> <span class="kwd">as</span> [<span class="id">_om</span> <span class="id">IHs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#any_message_is_protocol_in_preloaded">any_message_is_protocol_in_preloaded</a></span> <span class="id">om</span>) <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">Hom</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span>;<span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_weaken_protocol_prop">preloaded_weaken_protocol_prop</a></span> <span class="id">som</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">som</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">som</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof141')">Proof.</div>
<div class="proofscript" id="proof141">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">refine</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">s</span> <span class="id">Hs</span> <span class="id">om</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">_</span> <span class="id">IHprotocol_prop1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span> <span class="id">_</span> <span class="id">IHprotocol_prop2</span> <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_weaken_protocol_transition">preloaded_weaken_protocol_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> <span class="id">s</span> <span class="id">om</span> <span class="id">s</span>' <span class="id">om</span>':<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">om</span>) (<span class="id">s</span>',<span class="id">om</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">om</span>) (<span class="id">s</span>',<span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof142')">Proof.</div>
<div class="proofscript" id="proof142">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [[[<span class="id">_om</span> <span class="id">Hproto_s</span>] [<span class="id">_</span> <span class="id">Hpvalid</span>]] <span class="id">Htrans</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[<span class="tactic">clear</span> <span class="id">Htrans</span>|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_om</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_weaken_protocol_prop">preloaded_weaken_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">_om</span> <span class="id">Hproto_s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#any_message_is_protocol_in_preloaded">any_message_is_protocol_in_preloaded</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_incl_pre_loaded_with_all_messages_vlsm">vlsm_incl_pre_loaded_with_all_messages_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof143')">Proof.</div>
<div class="proofscript" id="proof143">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span>) <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_vlsm_incl">pre_loaded_vlsm_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">Q</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PimpliesQ</span> : <span class="kwd">forall</span> <span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>, <span class="id">P</span> <span class="id">m</span> -&gt; <span class="id">Q</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">P</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof144')">Proof.</div>
<div class="proofscript" id="proof144">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="kwd">as</span> (<span class="id">T</span>, (<span class="id">S</span>, <span class="id">M</span>)). <span class="tactic">intro</span> <span class="id">Hpincl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; [<span class="tactic">assumption</span>| ..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Hinit</span>|<span class="id">HP</span>];[<span class="id">left</span>|<span class="id">right</span>];<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_vlsm_is_pre_loaded_with_True">pre_loaded_with_all_messages_vlsm_is_pre_loaded_with_True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> (<span class="kwd">fun</span> <span class="id">m</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof145')">Proof.</div>
<div class="proofscript" id="proof145">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_iff">VLSM_eq_incl_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class_pre_loaded_with_messages">VLSM_class_pre_loaded_with_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">_</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>))); <span class="tactic">intros</span>; [<span class="tactic">assumption</span>| | <span class="tactic">apply</span> <span class="id">H</span> |<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>;<span class="id">right</span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class_pre_loaded_with_messages">VLSM_class_pre_loaded_with_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">_</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>)) <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_machine">pre_loaded_with_all_messages_vlsm_machine</a></span> ); <span class="tactic">intros</span>; [<span class="tactic">assumption</span>| | <span class="tactic">apply</span> <span class="id">H</span> |<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_vlsm_incl_pre_loaded_with_all_messages">pre_loaded_vlsm_incl_pre_loaded_with_all_messages</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">P</span>) <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof146')">Proof.</div>
<div class="proofscript" id="proof146">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_trans">VLSM_incl_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm_incl">pre_loaded_vlsm_incl</a></span> <span class="id">P</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>)). <span class="tactic">intros</span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_iff">VLSM_eq_incl_iff</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm_is_pre_loaded_with_True">pre_loaded_with_all_messages_vlsm_is_pre_loaded_with_True</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_is_pre_loaded_with_False">vlsm_is_pre_loaded_with_False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> (<span class="kwd">fun</span> <span class="id">m</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof147')">Proof.</div>
<div class="proofscript" id="proof147">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="kwd">as</span> (<span class="id">T</span>, (<span class="id">S</span>, <span class="id">M</span>)). <span class="tactic">intro</span> <span class="id">Hpp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_iff">VLSM_eq_incl_iff</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span>; <span class="tactic">intros</span>; [<span class="tactic">assumption</span>| | <span class="tactic">apply</span> <span class="id">H</span> |<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>;<span class="id">left</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span>; <span class="tactic">intros</span>; [<span class="tactic">assumption</span>| | <span class="tactic">apply</span> <span class="id">H</span> |<span class="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [|[]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_is_pre_loaded_with_False_protocol_prop">vlsm_is_pre_loaded_with_False_protocol_prop</a></span><br/>
&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="id">som</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span>  (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> (<span class="kwd">fun</span> <span class="id">m</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>)) <span class="id">som</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</div>
<div class="proofscript" id="proof148">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_is_pre_loaded_with_False">vlsm_is_pre_loaded_with_False</a></span> <span class="kwd">as</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm.X">X</a></span> <span class="kwd">as</span> (<span class="id">T</span>, (<span class="id">S</span>, <span class="id">M</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop_incl">protocol_prop_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;[|<span class="id">cbn</span>;<span class="tactic">tauto</span>]);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">Ht</span>;<span class="tactic">apply</span> <span class="id">Heq</span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="non_empty_protocol_trace_from_protocol_generated_prop">non_empty_protocol_trace_from_protocol_generated_prop</a></span><br/>
&nbsp;&nbsp;`(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">m</span> : <span class="id">message</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_prop">protocol_generated_prop</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">m</span><br/>
&nbsp;&nbsp;&lt;-&gt; <span class="id">exists</span> (<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) (<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">X</span> <span class="id">is</span> <span class="id">tr</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last_error</span> <span class="id">tr</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">item</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span> = <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">item</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof149')">Proof.</div>
<div class="proofscript" id="proof149">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [(<span class="id">s</span>', <span class="id">om</span>') [<span class="id">l</span> <span class="id">Hsm</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span> <span class="id">Hsm</span>) <span class="kwd">as</span> [[<span class="id">Hp</span> <span class="id">_</span>] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_singleton">finite_ptrace_singleton</a></span> <span class="id">_</span> <span class="id">Hsm</span>) <span class="kwd">as</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_complete_left">finite_protocol_trace_from_complete_left</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span>  <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">trs</span> [<span class="id">Htrs</span> <span class="id">_</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">is</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">Htrs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">context</span> [<span class="id">_</span> ++ [?<span class="id">item</span>]] =&gt; <span class="id">remember</span> <span class="id">item</span> <span class="kwd">as</span> <span class="id">lstitem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">trs</span> ++ [<span class="id">lstitem</span>]). <span class="id">exists</span> <span class="id">lstitem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">apply</span> <span class="id">last_error_is_last</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">lstitem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">is</span> [<span class="id">tr</span> [<span class="id">item</span> [<span class="id">Htr</span> [<span class="id">Hitem</span> [<span class="id">Hs</span> <span class="id">Hm</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_list_last</span> <span class="id">tr</span> <span class="id">tr</span>' <span class="id">item</span>' <span class="id">Heq</span>; [<span class="tactic">inversion</span> <span class="id">Hitem</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_error_is_last</span> <span class="kwd">in</span> <span class="id">Hitem</span>. <span class="tactic">inversion</span> <span class="id">Hitem</span>. <span class="tactic">clear</span> <span class="id">Hitem</span>. <span class="tactic">subst</span> <span class="id">item</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">clear</span> <span class="id">Htr</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hm</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id">_</span>, <span class="id">l1</span>. <span class="tactic">apply</span> <span class="id">H3</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_protocol_generated">VLSM_incl_protocol_generated</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>}<br/>
&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">m</span> : <span class="id">message</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_prop">protocol_generated_prop</a></span> <span class="id">X</span> <span class="id">s</span> <span class="id">m</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_prop">protocol_generated_prop</a></span> <span class="id">Y</span> <span class="id">s</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hsm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#non_empty_protocol_trace_from_protocol_generated_prop">non_empty_protocol_trace_from_protocol_generated_prop</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#non_empty_protocol_trace_from_protocol_generated_prop">non_empty_protocol_trace_from_protocol_generated_prop</a></span> <span class="kwd">in</span> <span class="id">Hsm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hsm</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">tr</span> [<span class="id">item</span> [<span class="id">Htr</span> <span class="id">Hsm</span>]]]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">is</span>, <span class="id">tr</span>, <span class="id">item</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">assumption</span>]. <span class="tactic">clear</span> <span class="id">Hsm</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_protocol_trace">VLSM_incl_finite_protocol_trace</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_can_emit">VLSM_incl_can_emit</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>}<br/>
&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">X</span> <span class="id">Y</span>)<br/>
&nbsp;&nbsp;(<span class="id">m</span> : <span class="id">message</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">X</span> <span class="id">m</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">Y</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit_iff">can_emit_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">s</span> <span class="id">Hsm</span>]. <span class="id">exists</span> <span class="id">s</span>. <span class="id">revert</span> <span class="id">Hsm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_protocol_generated">VLSM_incl_protocol_generated</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_can_emit">pre_loaded_with_all_messages_can_emit</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;(<span class="id">m</span> : <span class="id">message</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">X</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>) <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof152')">Proof.</div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_can_emit">VLSM_incl_can_emit</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>))).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_incl_pre_loaded_with_all_messages_vlsm">vlsm_incl_pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm_machine">mk_vlsm_machine</a></span>;<span class="tactic">assumption</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
