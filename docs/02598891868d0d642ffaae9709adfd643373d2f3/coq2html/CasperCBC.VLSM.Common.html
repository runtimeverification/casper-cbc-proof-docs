
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.VLSM.Common</title>
<meta name="description" content="Documentation of Coq module CasperCBC.VLSM.Common" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.VLSM.Common</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Nat.html">Nat</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Lia.html">Lia</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Streams</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.ProofIrrelevance.html">ProofIrrelevance</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lib.Preamble</span> <span class="id">Lib.ListExtras</span> <span class="id">Lib.StreamExtras</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_type">VLSM_type</a></span> (<span class="id">message</span> : <span class="kwd">Type</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="state">state</a></span> : <span class="kwd">Type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="label">label</a></span> : <span class="kwd">Type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_sign">VLSM_sign</a></span> {<span class="id">message</span> : <span class="kwd">Type</span>} (<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="initial_state_prop">initial_state_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">initial_state</span> := { <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> | <span class="id">initial_state_prop</span> <span class="id">s</span> }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="initial_message_prop">initial_message_prop</a></span> : <span class="id">message</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">initial_message</span> := { <span class="id">m</span> : <span class="id">message</span> | <span class="id">initial_message_prop</span> <span class="id">m</span> }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="s0">s0</a></span> : <span class="id">initial_state</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="m0">m0</a></span> : <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="l0">l0</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_class">VLSM_class</a></span> {<span class="id">message</span> : <span class="kwd">Type</span>} {<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>} (<span class="id">lsm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">vtype</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="transition">transition</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="valid">valid</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM">VLSM</a></span> (<span class="id">message</span> : <span class="kwd">Type</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> (<span class="kwd">fun</span> <span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> (<span class="kwd">fun</span> <span class="id">S</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">T</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">S</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="mk_vlsm">mk_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">S</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">T</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">M</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">T</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">S</span> <span class="id">M</span>).<br/>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="Traces">Traces</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="transition_item">transition_item</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{   <span class="id"><a name="l">l</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a name="input">input</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a name="destination">destination</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a name="output">output</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="Trace">Trace</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Finite">Finite</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="id">Trace</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Infinite">Infinite</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="id">Trace</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_first">trace_first</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">_</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">_</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_last">trace_last</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#Traces">Traces</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="vlsm_projections">vlsm_projections</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vlsm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="type">type</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections.vlsm">vlsm</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="sign">sign</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections.vlsm">vlsm</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="machine">machine</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections.vlsm">vlsm</a></span>).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vstate">vstate</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vlabel">vlabel</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_state_prop">vinitial_state_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_state">vinitial_state</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_message_prop">vinitial_message_prop</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vinitial_message">vinitial_message</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message">initial_message</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vs0">vs0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vm0">vm0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vl0">vl0</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vtransition">vtransition</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vvalid">vvalid</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vtransition_item">vtransition_item</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vTrace">vTrace</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_projections">vlsm_projections</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="mk_vlsm_machine">mk_vlsm_machine</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>) = <span class="id">X</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">X</span> <span class="kwd">as</span> (<span class="id">T</span>, (<span class="id">S</span>, <span class="id">M</span>)). <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM">VLSM</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TypeX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SignX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#sign">sign</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MachineX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">TypeX</span>.<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">SignX</span>.<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">MachineX</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="protocol_prop">protocol_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="protocol_initial_state">protocol_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">protocol_prop</span> (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="protocol_initial_message">protocol_initial_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">im</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message">initial_message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">im</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">protocol_prop</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="protocol_generated">protocol_generated</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">_om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id">protocol_prop</span> (<span class="id">s</span>, <span class="id">_om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">_s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpm</span> : <span class="id">protocol_prop</span> (<span class="id">_s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">protocol_prop</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)).<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_state_prop">protocol_state_prop</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_message_prop">protocol_message_prop</a></span> (<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>)).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_state">protocol_state</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span> }.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_message">protocol_message</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span> }.<br/>
&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="initial_is_protocol">initial_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinitial</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">Hinitial</span>) <span class="kwd">as</span> <span class="id">is</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="option_protocol_message_prop">option_protocol_message_prop</a></span> (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="option_protocol_message_None">option_protocol_message_None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>). <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="option_protocol_message_Some">option_protocol_message_Some</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hpm</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hpm</span>]. <span class="id">exists</span> <span class="id">s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_valid">protocol_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>, <span class="id">om</span>) := <span class="id">som</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id">om</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">om</span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_transition">protocol_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\  <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> <span class="id">som</span> = <span class="id">som</span>'.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_valid">protocol_transition_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> <span class="id">som</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">Hpv</span> <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_valid_transition">protocol_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> <span class="id">som</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> <span class="id">som</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_valid_transition_iff">protocol_valid_transition_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> <span class="id">som</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id">exists</span> (<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> <span class="id">som</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid_transition">protocol_valid_transition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">som</span>' <span class="id">Hpt</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_valid">protocol_transition_valid</a></span> <span class="kwd">with</span> <span class="id">som</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_generated_valid">protocol_generated_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">_om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">_s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">_om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">_s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_origin">protocol_transition_origin</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>',<span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hp</span>] <span class="id">_</span>] <span class="id">_</span>]. <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_destination">protocol_transition_destination</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hs</span>] [[<span class="id">_s</span> <span class="id">Hom</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_in">protocol_transition_in</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>)) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">_</span> [[<span class="id">_s</span> <span class="id">Hom</span>] <span class="id">_</span>]] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_transition_in">protocol_prop_transition_in</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> <span class="id">_s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">_s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span> <span class="kwd">as</span> [<span class="id">m</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_in">protocol_transition_in</a></span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="id">exists</span> <span class="id">x</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>). <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_transition_out">protocol_prop_transition_out</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>', <span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_is_valid">protocol_transition_is_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">_</span> [<span class="id">_</span> <span class="id">Hv</span>]] <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_transition">protocol_transition_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:  <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) = (<span class="id">s</span>', <span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Ht</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_valid_out">protocol_prop_valid_out</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid_transition">protocol_valid_transition</a></span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [[<span class="id">s</span>' <span class="id">om</span>'] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_transition">protocol_transition_transition</a></span>  <span class="id">Ht</span>); <span class="tactic">intro</span> <span class="id">Hteq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hteq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop_transition_out">protocol_prop_transition_out</a></span> <span class="id">Ht</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">For VLSMs initialized with many initial messages such as
    the <span class="bracket"><span class="id">composite_vlsm_constrained_projection</span></span> or the <span class="bracket"><span class="id">pre_loaded_vlsm</span></span>,
    the question of whether a <span class="bracket"><span class="id">VLSM</span></span> <span class="bracket"><span class="id">can_emit</span></span> a message &lt;&lt;m&gt;&gt; becomes more
    useful than that whether &lt;&lt;m&gt;&gt; is a <span class="bracket"><span class="id">protocol_message</span></span>.
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="can_emit">can_emit</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>).<br/>
<br/>
<div class="doc">Of course, if a VLSM <span class="bracket"><span class="id">can_emit</span></span> a message &lt;&lt;m&gt;&gt;, then &lt;&lt;m&gt;&gt; is
    a protocol message.
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_protocol">can_emit_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span> .<br/>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [(<span class="id">s0</span>, <span class="id">om0</span>) [<span class="id">l</span> [<span class="id">s</span> [[[<span class="id">_om0</span> <span class="id">Hs0</span>] [[<span class="id">_s0</span> <span class="id">Hom0</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om0</span> <span class="id">_s0</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">A characterization of protocol messages in terms of <span class="bracket"><span class="id">can_emit</span></span>
    </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_protocol_iff">can_emit_protocol_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">m</span> \/ <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">s</span> <span class="id">Hm</span>]; <span class="tactic">inversion</span> <span class="id">Hm</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">im</span> <span class="kwd">as</span> [<span class="id">m</span> <span class="id">Him</span>]. <span class="tactic">simpl</span>. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s1</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">l1</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">Him</span> | <span class="id">Hem</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> <span class="id">m</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">m</span> <span class="id">Him</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_message">protocol_initial_message</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit_protocol">can_emit_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_prop_iff">protocol_state_prop_iff</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; (<span class="id">exists</span> <span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span>, <span class="id">s</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id">exists</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>', <span class="id">om</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Hps</span>'. <span class="tactic">destruct</span> <span class="id">Hps</span>' <span class="kwd">as</span> [<span class="id">om</span>' <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hs</span>; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="id">left</span>; <span class="id">exists</span> <span class="id">is</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="id">left</span>; <span class="id">exists</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">exists</span> <span class="id">l1</span>. <span class="id">exists</span> (<span class="id">s</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">om</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [[[<span class="id">s</span> <span class="id">His</span>] <span class="id">Heq</span>] | [<span class="id">l</span> [[<span class="id">s</span> <span class="id">om</span>] [<span class="id">om</span>' [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">om</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_prop_ind">protocol_state_prop_ind</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IHinit</span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>), <span class="id">P</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IHgen</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">l</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>')) (<span class="id">Hs</span> : <span class="id">P</span> <span class="id">s</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>), <span class="id">P</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">om</span> <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">s</span>, <span class="id">om</span>) <span class="kwd">as</span> <span class="id">som</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">om</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hs</span>; <span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">Heqsom</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHinit</span>. <span class="tactic">unfold</span> <span class="id">s</span>. <span class="tactic">destruct</span> <span class="id">is</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHinit</span>. <span class="tactic">unfold</span> <span class="id">s</span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHgen</span> <span class="id">s1</span> <span class="id">l1</span> <span class="id">om</span> <span class="id">om0</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHHs1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHgen</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_message_prop_iff">protocol_message_prop_iff</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">m</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; (<span class="id">exists</span> <span class="id">im</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message">initial_message</a></span>, <span class="id">m</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">im</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id">exists</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> <span class="id">som</span> (<span class="id">s</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">s</span>' <span class="id">Hpm</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpm</span>'; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="id">left</span>; <span class="id">exists</span> <span class="id">im</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">exists</span> <span class="id">l1</span>. <span class="id">exists</span> (<span class="id">s</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [[[<span class="id">s</span> <span class="id">His</span>] <span class="id">Heq</span>] | [<span class="id">l</span> [[<span class="id">s</span> <span class="id">om</span>] [<span class="id">s</span>' [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]]]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>). <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_message">protocol_initial_message</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">s</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<h1> Trace Properties
Note that it is unnecessary to specify the source state of the transition,
as it is implied by the preceding <span class="bracket"><span class="id">transition_item</span></span> (or by the &lt;&lt;start&gt;&gt; state,
if such an item doesn't exist).
</h1>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="finite_protocol_trace_from">finite_protocol_trace_from</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="finite_ptrace_empty">finite_ptrace_empty</a></span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span> -&gt; <span class="id">finite_protocol_trace_from</span> <span class="id">s</span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="finite_ptrace_extend">finite_ptrace_extend</a></span> : <span class="kwd">forall</span>  (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_protocol_trace_from</span> <span class="id">s</span> <span class="id">tl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">iom</span>) (<span class="id">s</span>, <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">finite_protocol_trace_from</span>  <span class="id">s</span>' ({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |} :: <span class="id">tl</span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_protocol_trace">finite_protocol_trace</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_first_valid_transition">finite_ptrace_first_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">te</span> :: <span class="id">tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te</span>) (<span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [[<span class="id">Hs</span> <span class="id">_</span>] <span class="id">_</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_tail">finite_ptrace_tail</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">te</span> :: <span class="id">tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>) <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</div>
<div class="proofscript" id="proof36">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_last_pstate">finite_ptrace_last_pstate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">with</span> []. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_tail">finite_ptrace_tail</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHtr</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> (<span class="id">a</span> :: <span class="id">tr</span>)) <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">unroll_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_ptrace_consecutive_valid_transition">finite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> <span class="id">tr2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr1</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te1</span> <span class="id">te2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>] ++ <span class="id">tr2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te1</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te2</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">s</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHtr1</span> (<span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>] ++ <span class="id">tr2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">is</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHtr1</span>. <span class="id">specialize</span> (<span class="id">IHtr1</span> <span class="id">s</span> <span class="id">H2</span>). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="first_transition_valid">first_transition_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> [<span class="id">te</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te</span>) (<span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te</span>).<br/>
<br/>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="extend_right_finite_trace_from">extend_right_finite_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">ts</span> <span class="id">s3</span> <span class="id">iom3</span> <span class="id">oom3</span> <span class="id">l3</span> (<span class="id">s2</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">List.last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ts</span>) <span class="id">s1</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s1</span> <span class="id">ts</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l3</span> (<span class="id">s2</span>, <span class="id">iom3</span>) (<span class="id">s3</span>, <span class="id">oom3</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s1</span> (<span class="id">ts</span> ++ [{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom3</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom3</span> |}]).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">ts</span> <span class="id">s3</span> <span class="id">iom3</span> <span class="id">oom3</span> <span class="id">l3</span> <span class="id">s2</span> <span class="id">Ht12</span> <span class="id">Hv23</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Ht12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="id">Hv23</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHHt12</span>. <span class="tactic">apply</span> <span class="id">IHHt12</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s2</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tl</span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> ({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |} :: <span class="id">tl</span>)) <span class="id">s</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">remove_hd_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">ls</span> <span class="id">ls</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) (<span class="id">s</span>' := (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span>' <span class="id">ls</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">ls</span> ++ <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>'. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ls</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">_</span> <span class="id">H</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">constructor</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_origin">protocol_transition_origin</a></span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">Htr</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHls</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>' <span class="kwd">in</span> <span class="id">Htr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">last_identity</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">destination0</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |} :: <span class="id">ls</span>)) <span class="id">s</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>. <span class="tactic">rewrite</span> <span class="id">unroll_last</span>. <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_identity</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">apply</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="id">specialize</span> (<span class="id">IHls</span> <span class="id">s1</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHls</span>. <span class="id">specialize</span> (<span class="id">IHls</span> <span class="id">ls</span>'). <span class="tactic">apply</span> <span class="id">IHls</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">last_identity</span> : <span class="id">s</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">s1</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>. <span class="tactic">rewrite</span> <span class="id">unroll_last</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_identity</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Several other lemmas in this vein are necessary for proving results regarding
traces.
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_prefix">finite_protocol_trace_from_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">list_prefix</span> <span class="id">ls</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">list_prefix_suffix</span> <span class="id">ls</span> <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hdecompose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hdecompose</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Hpr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nth</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">s</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">nth</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">nth</span> (<span class="id">list_suffix</span> <span class="id">ls</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">list_prefix_suffix</span> <span class="id">ls</span> <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hdecompose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hdecompose</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Heq</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> (<span class="id">list_prefix</span> <span class="id">ls</span> <span class="id">n</span>)) <span class="id">s</span> = <span class="id">nth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">list_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">inversion</span> <span class="id">Hnth</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="kwd">as</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">list_prefix_nth_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_segment">finite_protocol_trace_from_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1th</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">s</span> :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">n1th</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">n1th</span> (<span class="id">list_segment</span> <span class="id">ls</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span> <span class="kwd">with</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_prefix">finite_protocol_trace_from_prefix</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_prefix_nth</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_to">protocol_transition_to</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">middle</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> <span class="id">prefix</span> <span class="id">suffix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsplit</span> : <span class="id">tr</span> = <span class="id">prefix</span> ++ [<span class="id">middle</span>] ++ <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">si</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prev_state</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix</span>) <span class="id">si</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">middle</span>) (<span class="id">prev_state</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">middle</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">middle</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">middle</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">prefix</span> <span class="id">eqn</span> : <span class="id">eq_prefix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#first_transition_valid">first_transition_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_prefix">finite_protocol_trace_from_prefix</a></span> <span class="id">si</span> <span class="id">tr</span> <span class="id">Htr</span> 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hsplit</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">list_prefix</span> <span class="id">suffix</span> 0 = []). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">list_prefix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">suffix</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hnot_empty</span>: <span class="id">t</span> :: <span class="id">l1</span> &lt;&gt; []). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">discriminate</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#exists_last">exists_last</a></span> <span class="id">Hnot_empty</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">X0</span> <span class="kwd">as</span> [<span class="id">l2</span> [<span class="id">lst</span> <span class="id">Hlst</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlst</span> <span class="kwd">in</span> <span class="id">Hsplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hsplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_consecutive_valid_transition">finite_ptrace_consecutive_valid_transition</a></span> <span class="id">si</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">tr</span> <span class="id">suffix</span> <span class="id">l2</span> <span class="id">lst</span> <span class="id">middle</span> <span class="id">Htr</span> <span class="id">Hsplit</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">lst</span> = <span class="id">prev_state</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_from_protocol_trace">can_emit_from_protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprotocol</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">si</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="kwd">fun</span> <span class="id">elem</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">elem</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>) <span class="id">tr</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<div class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">Hm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hin</span> <span class="id">Houtput</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_split">in_split</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">l1</span> [<span class="id">l2</span> <span class="id">Hconcat</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hprotocol</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_to">protocol_transition_to</a></span> <span class="id">si</span> <span class="id">x</span> <span class="id">tr</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">Hconcat</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">l1</span>) <span class="id">si</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Houtput</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<div class="doc">We now define <span class="bracket"><span class="id">infinite_protocol_trace</span></span>s. The definitions
resemble their finite counterparts, adapted to the technical
necessities of defining infinite objects. Notably, &lt;&lt;steps&gt;&gt; is
stored as a stream, as opposed to a list.
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">CoInductive</span> <span class="id"><a name="infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="infinite_ptrace_extend">infinite_ptrace_extend</a></span> : <span class="kwd">forall</span>  (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">infinite_protocol_trace_from</span> <span class="id">s</span> <span class="id">tl</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">iom</span>) (<span class="id">s</span>, <span class="id">oom</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">infinite_protocol_trace_from</span>  <span class="id">s</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |}  <span class="id">tl</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="infinite_ptrace">infinite_ptrace</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">st</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">st</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_ptrace_consecutive_valid_transition">infinite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> <span class="id">tr2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr1</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">te1</span> <span class="id">te2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">stream_app</span> (<span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>]) <span class="id">tr2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te1</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">te2</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">te2</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">te2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">is</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">is</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H2</span>; <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHtr1</span> (<span class="id">stream_app</span> (<span class="id">tr1</span> ++ [<span class="id">te1</span>; <span class="id">te2</span>]) <span class="id">tr2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">tr</span> <span class="id">Heq</span> <span class="id">is</span> <span class="id">Htr</span>; <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHtr1</span> <span class="id">s</span> <span class="id">H2</span>). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_app_iff">infinite_protocol_trace_from_app_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>' := (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span>' <span class="id">ls</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">stream_app</span> <span class="id">ls</span> <span class="id">ls</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>'. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ls</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">_</span> <span class="id">H</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">constructor</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_origin">protocol_transition_origin</a></span> <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">Htr</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_ptrace_extend">infinite_ptrace_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHls</span>. <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>' <span class="kwd">in</span> <span class="id">Htr</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">last_identity</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">destination0</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |} :: <span class="id">ls</span>)) <span class="id">s</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>. <span class="tactic">rewrite</span> <span class="id">unroll_last</span>. <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_identity</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">Htr</span>. <span class="tactic">apply</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="id">specialize</span> (<span class="id">IHls</span> <span class="id">s1</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHls</span>. <span class="id">specialize</span> (<span class="id">IHls</span> <span class="id">ls</span>'). <span class="tactic">apply</span> <span class="id">IHls</span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">last_identity</span> : <span class="id">s</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">s1</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>. <span class="tactic">rewrite</span> <span class="id">unroll_last</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_identity</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_prefix">infinite_protocol_trace_from_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">stream_prefix</span> <span class="id">ls</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">stream_prefix_suffix</span> <span class="id">ls</span> <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hdecompose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hdecompose</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_app_iff">infinite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Hpr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_prefix_rev">infinite_protocol_trace_from_prefix_rev</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpref</span>: <span class="kwd">forall</span> <span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> (<span class="id">stream_prefix</span> <span class="id">ls</span> <span class="id">n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">Hpref</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> (<span class="id">a</span>, <span class="id">ls</span>) <span class="id">s</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hpref0</span> := <span class="id">Hpref</span> 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpref0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hpref</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpref</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="infinite_protocol_trace_from_segment">infinite_protocol_trace_from_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1th</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id">n1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">n1th</span> (<span class="id">stream_segment</span> <span class="id">ls</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span> <span class="kwd">with</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_prefix">infinite_protocol_trace_from_prefix</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">n1th</span>. <span class="tactic">clear</span> <span class="id">n1th</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">stream_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">stream_prefix_nth</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ptrace_from_prop">ptrace_from_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">sm</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id">s</span> <span class="id">sm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">s</span> <span class="id">ls</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">sm</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_ptrace">infinite_ptrace</a></span> <span class="id">s</span> <span class="id">sm</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_trace">protocol_trace</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_from">protocol_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_from_prop">ptrace_from_prop</a></span> <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_initial">protocol_trace_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">simpl</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_from_iff">protocol_trace_from_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_from_prop">ptrace_from_prop</a></span> <span class="id">tr</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Htr</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_from">protocol_trace_from</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_initial">protocol_trace_initial</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="proto_run">proto_run</a></span> : <span class="kwd">Type</span> := <span class="id"><a name="mk_proto_run">mk_proto_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="start">start</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="transitions">transitions</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a name="final">final</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="vlsm_run_prop">vlsm_run_prop</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="empty_run_initial_state">empty_run_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">vlsm_run_prop</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">is</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := []; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="empty_run_initial_message">empty_run_initial_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">im</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message">initial_message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">im</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">vlsm_run_prop</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := []; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id">s</span>, <span class="id">om</span>) |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="extend_run">extend_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">state_run</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id">vlsm_run_prop</span> <span class="id">state_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">state_run</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">state_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ts</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">state_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">msg_run</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id">vlsm_run_prop</span> <span class="id">msg_run</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">msg_run</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">vlsm_run_prop</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">is</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := <span class="id">ts</span> ++ [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|   <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">om</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">som</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">som</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := <span class="id">som</span>' |}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vlsm_run">vlsm_run</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">r</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span> | <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">r</span> }.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_run_last_state">vlsm_run_last_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span>)) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">r</span>; <span class="tactic">clear</span> <span class="id">r</span>; <span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hr</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">last_is_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_run_last_final">vlsm_run_last_final</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hne_tr</span> : <span class="id">tr</span> &lt;&gt; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lst</span> := <span class="id">last_error</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">lst</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">lst</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">r</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">r</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">r</span>; <span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">inversion</span> <span class="id">Hr</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">Hr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">tr</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">lst</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">last_error_is_last</span> . <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="run_is_protocol">run_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hr</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">om</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">om</span>. <span class="tactic">unfold</span> <span class="id">s</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">state_run</span>) <span class="kwd">as</span> [<span class="id">s</span> <span class="id">_om</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">msg_run</span>) <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">om</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id">l1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id">IHHr1</span> <span class="id">_s</span> <span class="id">om</span> <span class="id">IHHr2</span> <span class="id">Hv</span>). <span class="tactic">intro</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_is_run">protocol_is_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id">som</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> <span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>, (<span class="id">som</span>' = <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#empty_run_initial_state">empty_run_initial_state</a></span> <span class="id">is</span>)); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#empty_run_initial_message">empty_run_initial_message</a></span> <span class="id">im</span>)); <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IHHp1</span> <span class="kwd">as</span> [[<span class="id">state_run</span> <span class="id">Hsr</span>] <span class="id">Heqs</span>]. <span class="tactic">destruct</span> <span class="id">IHHp2</span> <span class="kwd">as</span> [[<span class="id">msg_run</span> <span class="id">Hmr</span>] <span class="id">Heqm</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#extend_run">extend_run</a></span> <span class="id">state_run</span> <span class="id">Hsr</span>). <span class="tactic">simpl</span>. <span class="tactic">intros</span> <span class="id">Hvr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvr</span> <span class="id">msg_run</span> <span class="id">Hmr</span> <span class="id">l1</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqs</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqs</span> <span class="kwd">in</span> <span class="id">Hvr</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Heqm</span> <span class="kwd">in</span> <span class="id">Hvr</span>. <span class="id">specialize</span> (<span class="id">Hvr</span> <span class="id">Hv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hvr</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="run_is_trace">run_is_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">vr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run">vlsm_run</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">vr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span>)) (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">r</span>; <span class="tactic">clear</span> <span class="id">r</span>; <span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hr</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span> <span class="id">is</span>); <span class="tactic">intro</span> <span class="id">Hpis</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hpis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">is</span> <span class="kwd">as</span> [<span class="id">is</span> <span class="id">His</span>]; <span class="tactic">simpl</span>. <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>); <span class="tactic">intro</span> <span class="id">Hps0</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hps0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">Hs0</span>]; <span class="tactic">simpl</span>. <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">IHHr1</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_state">vlsm_run_last_state</a></span>; <span class="tactic">intros</span> <span class="id">Hls</span>. <span class="id">specialize</span> (<span class="id">Hls</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">state_run</span> <span class="id">Hr1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hls</span>. <span class="tactic">unfold</span> <span class="id">ts</span>. <span class="tactic">unfold</span> <span class="id">is</span>. <span class="tactic">rewrite</span> <span class="id">Hls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">state_run</span>)). <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_protocol">run_is_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">state_run</span> <span class="id">Hr1</span>)); <span class="tactic">intro</span> <span class="id">Hp</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">msg_run</span>)). <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_protocol">run_is_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">msg_run</span> <span class="id">Hr2</span>)); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hp</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_is_run">trace_is_run</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>) <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> <span class="id">r</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">r</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span> = <span class="id">is</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span> = <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span> (<span class="kwd">fun</span> <span class="id">tr</span> =&gt; (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>) <span class="id">tr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">r</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#proto_run">proto_run</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_prop">vlsm_run_prop</a></span> <span class="id">r</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span> = <span class="id">is</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span> = <span class="id">tr</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">is</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := []; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) |}; <span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#empty_run_initial_state">empty_run_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">lst</span> <span class="id">prefix</span> <span class="id">IHprefix</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hprefix</span> <span class="id">Hlst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHprefix</span> <span class="id">Hprefix</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHprefix</span> <span class="kwd">as</span> [<span class="id">r0</span> [<span class="id">Hr0</span> [<span class="id">Hstart</span> <span class="id">Htr_r0</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> := <span class="id">is</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> := <span class="id">prefix</span> ++ [<span class="id">lst</span>]; <span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> := (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">lst</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">lst</span>) |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#extend_run">extend_run</a></span> <span class="id">r0</span> <span class="id">Hr0</span>); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_valid_transition">finite_ptrace_first_valid_transition</a></span> <span class="kwd">in</span> <span class="id">Hlst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">lst</span> <span class="kwd">as</span> [<span class="id">lst_l</span> <span class="id">lst_in</span> <span class="id">lst_dest</span> <span class="id">lst_out</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_state">vlsm_run_last_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">r0</span> <span class="id">Hr0</span>)); <span class="tactic">intro</span> <span class="id">Hlast_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast_state</span>. <span class="tactic">rewrite</span> <span class="id">Htr_r0</span> <span class="kwd">in</span> <span class="id">Hlast_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hstart</span> <span class="kwd">in</span> <span class="id">Hlast_state</span>. <span class="tactic">rewrite</span> <span class="id">Hlast_state</span> <span class="kwd">in</span> <span class="id">Hlst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop_transition_in">protocol_prop_transition_in</a></span> <span class="id">Hlst</span>); <span class="tactic">intro</span> <span class="id">Hmsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmsg</span> <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">Hmsg</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_run">protocol_is_run</a></span> <span class="kwd">in</span> <span class="id">Hmsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hmsg</span> <span class="kwd">as</span> [[<span class="id">r_msg</span> <span class="id">Hr_msg</span>] <span class="id">Hmsg</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hextend</span> <span class="id">r_msg</span> <span class="id">Hr_msg</span> <span class="id">lst_l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_is_valid">protocol_transition_is_valid</a></span> <span class="id">Hlst</span>); <span class="tactic">intro</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hmsg</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hmsg</span> <span class="kwd">in</span> <span class="id">Hextend</span>. <span class="tactic">simpl</span>  <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hextend</span> <span class="id">Hvalid</span>). <span class="tactic">rewrite</span> <span class="id">Hstart</span> <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_transition">protocol_transition_transition</a></span> <span class="id">Hlst</span>); <span class="tactic">intro</span> <span class="id">Htransition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htransition</span> <span class="kwd">in</span> <span class="id">Hextend</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htr_r0</span> <span class="kwd">in</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hextend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_is_protocol">trace_is_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state">initial_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>) <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">is</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_is_run">trace_is_run</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">Htr</span>); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hrun</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrun</span> <span class="kwd">as</span> [<span class="id">run</span> [<span class="id">Hrun</span> [<span class="id">Hstart</span> <span class="id">Htrans</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_protocol">run_is_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">run</span> <span class="id">Hrun</span>)); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_state">vlsm_run_last_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">run</span> <span class="id">Hrun</span>)); <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Hlast</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htrans</span> <span class="kwd">in</span> <span class="id">Hlast</span>'. <span class="tactic">rewrite</span> <span class="id">Hstart</span> <span class="kwd">in</span> <span class="id">Hlast</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#final">final</a></span> <span class="id">run</span>) <span class="kwd">as</span> (<span class="id">s</span>', <span class="id">om</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<div class="doc">Having defined <span class="bracket"><span class="id">protocol_trace</span></span>s, we now connect them to protocol states
and messages, in the following sense: for each state-message pair (&lt;&lt;s&gt;&gt;, &lt;&lt;m&gt;&gt;)
that has the <span class="bracket"><span class="id">protocol_prop</span></span>erty, there exists a <span class="bracket"><span class="id">protocol_trace</span></span> which ends
in &lt;&lt;s&gt;&gt; by outputting &lt;&lt;m&gt;&gt; </div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_is_trace">protocol_is_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/ <span class="id">exists</span> (<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id">is</span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> (<span class="id">last_error</span> <span class="id">tr</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> (<span class="id">last_error</span> <span class="id">tr</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_run">protocol_is_run</a></span> (<span class="id">s</span>,<span class="id">om</span>) <span class="id">Hp</span>); <span class="tactic">intros</span> [<span class="id">vr</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_trace">run_is_trace</a></span> <span class="id">vr</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vr</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">Hvr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>) <span class="id">eqn</span>:<span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hvr</span>; <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htrace</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">is</span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">His</span>]. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">His</span>]. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">ts</span>; <span class="tactic">inversion</span> <span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">right</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#start">start</a></span> <span class="id">r</span>)). <span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#transitions">transitions</a></span> <span class="id">r</span>). <span class="tactic">rewrite</span> <span class="id">Htrace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_final">vlsm_run_last_final</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">r</span> <span class="id">Hvr</span>)); <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Htrace</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hlf</span>; <span class="tactic">apply</span> <span class="id">Hlf</span>. <span class="tactic">intros</span> <span class="id">HC</span>; <span class="tactic">inversion</span> <span class="id">HC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_nth">trace_nth</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id">s</span>::<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">ls</span>) <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">st</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">st</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Another benefit of defining traces is that we can succintly
describe indirect transitions between arbitrary pairs of states.
We say that state &lt;&lt;second&gt;&gt; is in state &lt;&lt;first&gt;&gt;'s futures if
there exists a finite (possibly empty) protocol trace that begins
with &lt;&lt;first&gt;&gt; and ends in &lt;&lt;second&gt;&gt;.
This relation is often used in stating safety and liveness properties.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="in_futures">in_futures</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">first</span> <span class="id">tr</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">first</span> = <span class="id">second</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_protocol_fst">in_futures_protocol_fst</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfuture</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">first</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof63')">Proof.</div>
<div class="proofscript" id="proof63">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfuture</span> <span class="kwd">as</span> [<span class="id">tr</span> [<span class="id">Htr</span> <span class="id">Hlast</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_refl">in_futures_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">first</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">first</span>.<br/>
<br/>
<div class="toggleproof" onclick="toggleDisplay('proof64')">Proof.</div>
<div class="proofscript" id="proof64">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_trans">in_futures_trans</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> <span class="id">third</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H12</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">H23</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">second</span> <span class="id">third</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">third</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof65')">Proof.</div>
<div class="proofscript" id="proof65">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H12</span> <span class="kwd">as</span> [<span class="id">tr12</span> [<span class="id">Htr12</span> <span class="id">Hsnd</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H23</span> <span class="kwd">as</span> [<span class="id">tr23</span> [<span class="id">Htr23</span> <span class="id">Hthird</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">second</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="id">first</span> <span class="id">tr12</span> <span class="id">tr23</span>); <span class="tactic">simpl</span>; <span class="tactic">intros</span> [<span class="id">Happ</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Happ</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Htr12</span> <span class="id">Htr23</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">tr12</span> ++ <span class="id">tr23</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">last_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_witness">in_futures_witness</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfutures</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>) (<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">n1</span> &lt;= <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">second</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof66')">Proof.</div>
<div class="proofscript" id="proof66">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_protocol_fst">in_futures_protocol_fst</a></span> <span class="id">first</span> <span class="id">second</span> <span class="id">Hfutures</span>); <span class="tactic">intro</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hps</span> <span class="kwd">as</span> [<span class="id">_mfirst</span> <span class="id">Hfirst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="kwd">in</span> <span class="id">Hfutures</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hfutures</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfutures</span> <span class="kwd">as</span> [<span class="id">suffix_tr</span> [<span class="id">Hsuffix_tr</span> <span class="id">Hsnd</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_run">protocol_is_run</a></span> <span class="kwd">in</span> <span class="id">Hfirst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfirst</span> <span class="kwd">as</span> [<span class="id">prefix_run</span> <span class="id">Hprefix_run</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_run_last_state">vlsm_run_last_state</a></span> <span class="id">prefix_run</span>); <span class="tactic">intro</span> <span class="id">Hprefix_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#run_is_trace">run_is_trace</a></span> <span class="id">prefix_run</span>); <span class="tactic">intro</span> <span class="id">Hprefix_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">prefix_run</span> <span class="kwd">as</span> [<span class="id">prefix_run</span> <span class="id">Hpref_run</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">prefix_run</span> <span class="kwd">as</span> [<span class="id">prefix_start</span> <span class="id">prefix_tr</span> <span class="id">prefix_final</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">prefix_start</span>) <span class="id">prefix_tr</span> <span class="id">suffix_tr</span>); <span class="tactic">intro</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hprefix_last</span> <span class="kwd">in</span> <span class="id">Happ</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Hprefix_run</span> <span class="kwd">in</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Happ</span> <span class="kwd">as</span> [<span class="id">Happ</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hprefix_tr</span> <span class="kwd">as</span> [<span class="id">Hprefix_tr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Happ</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#conj">conj</a></span> <span class="id">Hprefix_tr</span> <span class="id">Hsuffix_tr</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hfinite_tr</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">prefix_start</span>) (<span class="id">prefix_tr</span> ++ <span class="id">suffix_tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="id">constructor</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">prefix_start</span>) (<span class="id">prefix_tr</span> ++ <span class="id">suffix_tr</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">prefix_start</span>) (<span class="id">prefix_tr</span> ++ <span class="id">suffix_tr</span>)) <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">prefix_tr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">prefix_tr</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">suffix_tr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">prefix_tr</span>) <span class="kwd">as</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heqm</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length_zero_iff_nil">length_zero_iff_nil</a></span> <span class="kwd">in</span> <span class="id">Heqm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> (<span class="tactic">f_equal</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">suffix_tr</span>) <span class="kwd">as</span> <span class="id">delta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">delta</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heqdelta</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length_zero_iff_nil">length_zero_iff_nil</a></span> <span class="kwd">in</span> <span class="id">Heqdelta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">nth_error_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnth_pref</span> : <span class="kwd">forall</span> <span class="id">suf</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix_tr</span> ++ <span class="id">suf</span>) <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app1">nth_error_app1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">nth_error_last</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix_tr</span>) <span class="id">m</span>); <span class="tactic">intro</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hlen</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix_tr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hnth</span> <span class="id">Hlen</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">prefix_start</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hnth</span>. <span class="tactic">f_equal</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hprefix_last</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Heqm</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">Hnth_pref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">suffix_tr</span>) <span class="kwd">as</span> <span class="id">delta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">delta</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heqdelta</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length_zero_iff_nil">length_zero_iff_nil</a></span> <span class="kwd">in</span> <span class="id">Heqdelta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Plus.html#plus_0_r">Plus.plus_0_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hnth_pref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_app2">nth_error_app2</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">m</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">delta</span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span>) <span class="kwd">with</span>  <span class="id">delta</span> <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">nth_error_last</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">suffix_tr</span>) <span class="id">delta</span>); <span class="tactic">intro</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hnth</span> <span class="id">Heqdelta</span> <span class="id">first</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_length">map_length</a></span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Heqm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_segment">trace_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">l</span> =&gt; <span class="id">list_segment</span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">l</span> =&gt; <span class="id">stream_segment</span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="ptrace_segment">ptrace_segment</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfirst</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> <span class="id">tr</span> <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">first</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_segment">trace_segment</a></span> <span class="id">tr</span> <span class="id">n1</span> <span class="id">n2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">tr</span> | <span class="id">s</span> <span class="id">tr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_segment">finite_protocol_trace_from_segment</a></span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hfirst</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hfirst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_segment">infinite_protocol_trace_from_segment</a></span> <span class="id">s</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">Hle</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Inductive</span> <span class="id"><a name="Trace_messages">Trace_messages</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Finite_messages">Finite_messages</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) -&gt; <span class="id">Trace_messages</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a name="Infinite_messages">Infinite_messages</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span>) -&gt; <span class="id">Trace_messages</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_output_messages_trace">protocol_output_messages_trace</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace_messages">Trace_messages</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">_</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite_messages">Finite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">st</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite_messages">Infinite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">st</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="protocol_input_messages_trace">protocol_input_messages_trace</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>) : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace_messages">Trace_messages</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">_</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite_messages">Finite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">st</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite_messages">Infinite_messages</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">st</span>) <span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_prefix">trace_prefix</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id">exists</span> <span class="id">suffix</span>, <span class="id">ls</span> = <span class="id">prefix</span> ++ (<span class="id">last</span> :: <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">st</span> =&gt; <span class="id">exists</span> <span class="id">suffix</span>, <span class="id">st</span> = <span class="id">stream_app</span> <span class="id">prefix</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last</span> <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_prefix_fn">trace_prefix_fn</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> (<span class="id">list_prefix</span> <span class="id">ls</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">st</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> (<span class="id">stream_prefix</span> <span class="id">st</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_prefix_protocol">trace_prefix_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprefix</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">prefix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>)) (<span class="id">prefix</span> ++ [<span class="id">last</span>])).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof68')">Proof.</div>
<div class="proofscript" id="proof68">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">tr</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span> (<span class="kwd">fun</span> <span class="id">prefix</span> =&gt; <span class="kwd">forall</span> (<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>) (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="id">tr</span> <span class="id">last</span> <span class="id">prefix</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> <span class="id">tr</span>) (<span class="id">prefix</span> ++ [<span class="id">last</span>]))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">last</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">Hprefix</span>; <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [ | ]; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="kwd">in</span> <span class="id">Hprefix</span>;   <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hprefix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hprefix</span> <span class="kwd">as</span> [<span class="id">suffix</span> <span class="id">Heq</span>]; <span class="tactic">subst</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span>; <span class="tactic">simpl</span>; <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Htr</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Htr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s1</span> [] (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="id">H3</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">iom</span> <span class="id">oom</span> <span class="id">l1</span>); <span class="tactic">intro</span> <span class="id">Hext</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id">Hext</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">last_p</span> <span class="id">p</span> <span class="id">Hind</span> <span class="id">last</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">Hprefix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hind</span> <span class="id">last_p</span> <span class="id">tr</span> <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [ | ]; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="kwd">in</span> <span class="id">Hprefix</span>;   <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hprefix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hprefix</span> <span class="kwd">as</span> [<span class="id">suffix</span> <span class="id">Heq</span>]; <span class="tactic">subst</span>; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]; <span class="tactic">simpl</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hind</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hex</span> : <span class="id">exists</span> <span class="id">suffix0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p</span> ++ [<span class="id">last_p</span>]) ++ <span class="id">last</span> :: <span class="id">suffix</span> = <span class="id">p</span> ++ <span class="id">last_p</span> :: <span class="id">suffix0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="tactic">by</span> (<span class="id">exists</span> (<span class="id">last</span> :: <span class="id">suffix</span>); <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span> (<span class="id">Hind</span> <span class="id">Hex</span>); <span class="tactic">clear</span> <span class="id">Hex</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hind</span> <span class="kwd">as</span> [<span class="id">Hptr</span> <span class="id">_</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">last</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id">app_cons</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |} <span class="id">suffix</span>) <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="id">p</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">in</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_consecutive_valid_transition">finite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p</span> ++ [<span class="id">last_p</span>; {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |}] ++ <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suffix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last_p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Htr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">last_is_last</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hex</span> : <span class="id">exists</span> <span class="id">suffix0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">stream_app</span> (<span class="id">p</span> ++ [<span class="id">last_p</span>])  (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last</span> <span class="id">suffix</span>) = <span class="id">stream_app</span> <span class="id">p</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last_p</span> <span class="id">suffix0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="tactic">by</span> (<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Cons">Cons</a></span> <span class="id">last</span> <span class="id">suffix</span>); <span class="tactic">rewrite</span> &lt;- <span class="id">stream_app_assoc</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">specialize</span> (<span class="id">Hind</span> <span class="id">Hex</span>); <span class="tactic">clear</span> <span class="id">Hex</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hind</span> <span class="kwd">as</span> [<span class="id">Hptr</span> <span class="id">_</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">last</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#extend_right_finite_trace_from">extend_right_finite_trace_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">stream_app_cons</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">stream_app_assoc</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="id">p</span> <span class="id">_</span> <span class="id">_</span>) <span class="kwd">in</span> <span class="id">Htr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_ptrace_consecutive_valid_transition">infinite_ptrace_consecutive_valid_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">stream_app</span> (<span class="id">p</span> ++ [<span class="id">last_p</span>; {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |}]) <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suffix</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last_p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l1</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">destination0</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">output0</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Htr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">last_is_last</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="build_trace_prefix_protocol">build_trace_prefix_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprefix</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">prefix</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>)) (<span class="id">prefix</span> ++ [<span class="id">last</span>]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_protocol">trace_prefix_protocol</a></span> <span class="id">tr</span> <span class="id">last</span> <span class="id">prefix</span> <span class="id">Hprefix</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_prefix_fn_protocol">trace_prefix_fn_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_fn">trace_prefix_fn</a></span> <span class="id">tr</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_protocol">trace_prefix_protocol</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">tr</span> <span class="id">Htr</span>)); <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_fn">trace_prefix_fn</a></span> <span class="id">tr</span> <span class="id">n</span>) <span class="kwd">as</span> <span class="id">pref_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">pref_tr</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">l</span> | <span class="id">s</span> <span class="id">l</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [| <span class="id">item</span> <span class="id">l</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">l</span>' | <span class="id">s</span>' <span class="id">l</span>']<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">constructor</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">replace</span> <span class="id">s</span>' <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">s</span>' <span class="id">Hinit</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">Hnnil</span> : <span class="id">item</span> ::<span class="id">l</span> &lt;&gt; [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">intro</span> <span class="id">Hnil</span>; <span class="tactic">inversion</span> <span class="id">Hnil</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#exists_last">exists_last</a></span> <span class="id">Hnnil</span>); <span class="tactic">intros</span> [<span class="id">prefix</span> [<span class="id">last</span> <span class="id">Heq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> *; <span class="tactic">clear</span> <span class="id">Hnnil</span> <span class="id">Heq</span> <span class="id">l</span> <span class="id">item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">s</span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">tr</span> <span class="id">Htr</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">destruct</span> <span class="id">tr</span>; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span>; <span class="tactic">subst</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix_protocol">trace_prefix_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">l</span>' | <span class="id">s</span>' <span class="id">l</span>']<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">clear</span> <span class="id">Heqpref_tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">list_prefix_suffix</span> <span class="id">l</span>' <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hl</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hl</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">list_suffix</span> <span class="id">l</span>' <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">stream_prefix_suffix</span> <span class="id">l</span>' <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hl</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hl</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">stream_suffix</span> <span class="id">l</span>' <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">stream_app_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span>' <span class="id">l</span>' | <span class="id">s</span>' <span class="id">l</span>']; <span class="tactic">inversion</span> <span class="id">Heqpref_tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_trace_nth">protocol_trace_nth</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> <span class="id">tr</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s0</span> <span class="id">l</span> | <span class="id">s0</span> <span class="id">l</span>]; <span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_suffix">finite_protocol_trace_from_suffix</a></span> <span class="id">s0</span> <span class="id">l</span> <span class="id">Htr</span> <span class="id">n</span> <span class="id">s</span> <span class="id">Hnth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hsuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Hsuf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hle</span> : <span class="id">n</span> &lt;= <span class="id">n</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from_segment">infinite_protocol_trace_from_segment</a></span> <span class="id">s0</span> <span class="id">l</span> <span class="id">Htr</span> <span class="id">n</span> <span class="id">n</span> <span class="id">Hle</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">Hseg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_first_pstate">finite_ptrace_first_pstate</a></span> <span class="kwd">in</span> <span class="id">Hseg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_protocol_snd">in_futures_protocol_snd</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfutures</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">second</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures_witness">in_futures_witness</a></span> <span class="id">first</span> <span class="id">second</span> <span class="id">Hfutures</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span> [<span class="id">tr</span> [<span class="id">n1</span> [<span class="id">n2</span> [<span class="id">Hle</span> [<span class="id">Hn1</span> <span class="id">Hn2</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hn2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_nth">protocol_trace_nth</a></span> <span class="kwd">with</span> <span class="id">tr</span> <span class="id">n2</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="in_futures_witness_reverse">in_futures_witness_reverse</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> <span class="id">second</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs1</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">first</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#trace_nth">trace_nth</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">second</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> <span class="id">first</span> <span class="id">second</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hle</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Hs1</span> <span class="kwd">in</span> <span class="id">Hs2</span>. <span class="tactic">inversion</span> <span class="id">Hs2</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> []. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_nth">protocol_trace_nth</a></span> <span class="kwd">with</span> <span class="id">tr</span> <span class="id">n2</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-  <span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_segment">trace_segment</a></span> <span class="id">tr</span> <span class="id">n1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#ptrace_segment">ptrace_segment</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ { <span class="tactic">destruct</span> <span class="id">tr</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">tr</span> | <span class="id">s</span> <span class="id">tr</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">list_segment</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_map</span>. <span class="tactic">rewrite</span> <span class="id">list_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">list_prefix_nth_last</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">nth_error_length</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">list_prefix_length</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span>) <span class="id">Hs2</span>); <span class="tactic">intro</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">stream_segment</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_map</span>. <span class="tactic">rewrite</span> <span class="id">stream_prefix_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">list_suffix_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">rewrite</span> <span class="id">stream_prefix_nth_last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="kwd">in</span> <span class="id">Hs2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hs2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hs2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">stream_prefix_length</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">m</span>)); <span class="tactic">intro</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="terminating_trace_prop">terminating_trace_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">ls</span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">ls</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">A <span class="bracket"><span class="id">protocol_trace</span></span> is _complete_, if it is either _terminating_ or infinite.
</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="complete_trace_prop">complete_trace_prop</a></span> (<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">tr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#terminating_trace_prop">terminating_trace_prop</a></span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composition_constraint">composition_constraint</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM.message">message</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Class</span> <span class="id"><a name="VLSM_vdecidable">VLSM_vdecidable</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="valid_decidable">valid_decidable</a></span> : <span class="kwd">forall</span> <span class="id">l</span> <span class="id">som</span>, {<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> <span class="id">som</span>} + {~<span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="id">l</span> <span class="id">som</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_equality">VLSM_equality</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">vtype</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM_eq">VLSM_eq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> <span class="id">t</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">Y</span> <span class="id">t</span> .<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="VLSM_incl">VLSM_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>) (<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">X</span> <span class="id">t</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id">Y</span> <span class="id">t</span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_incl_l">VLSM_eq_incl_l</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">MX</span> <span class="id">MY</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">MX</span> <span class="id">MY</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">Hxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_incl_r">VLSM_eq_incl_r</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">MX</span> <span class="id">MY</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">MY</span> <span class="id">MX</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">Hyt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_eq_incl_iff">VLSM_eq_incl_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">SigX</span> <span class="id">SigY</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality.vtype">vtype</a></span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigX</span>) (<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SigY</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq">VLSM_eq</a></span> <span class="id">MX</span> <span class="id">MY</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">MX</span> <span class="id">MY</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id">MY</span> <span class="id">MX</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof75')">Proof.</div>
<div class="proofscript" id="proof75">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_l">VLSM_eq_incl_l</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_eq_incl_r">VLSM_eq_incl_r</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">Hxy</span> <span class="id">Hyx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Hyx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_equality">VLSM_equality</a></span>.<br/>
<br/>
<div class="doc">It is natural to look for sufficient conditions for VLSM inclusion (or equality),
which are easy to verify in a practical setting. One such result is the following.
For VLSM &lt;&lt;X&gt;&gt; to be included in VLSM &lt;&lt;Y&gt;&gt;, the following set of conditions is sufficient:
<ul>
<li>
 &lt;&lt;X&gt;&gt;'s <span class="bracket"><span class="id">initial_state</span></span>s are included in &lt;&lt;Y&gt;&gt;'s <span class="bracket"><span class="id">initial</span> <span class="id">state</span></span>s
</li>
<li>
 Every message &lt;&lt;m&gt;&gt; (including the empty one) which can be input to a
<span class="bracket"><span class="id">protocol_valid</span></span> transition in &lt;&lt;X&gt;&gt;, is a <span class="bracket"><span class="id">protocol_message</span></span> in &lt;&lt;Y&gt;&gt;
</li>
<li>
 &lt;&lt;X&gt;&gt;'s <span class="bracket"><span class="id">protocol_valid</span></span> is included in &lt;&lt;Y&gt;&gt;'s <span class="bracket"><span class="id">valid</span></span>.
</li>
<li>
 For all <span class="bracket"><span class="id">protocol_valid</span></span> inputs (in &lt;&lt;X&gt;&gt;), &lt;&lt;Y&gt;&gt;'s <span class="bracket"><span class="id">transition</span></span> acts
like &lt;&lt;X&gt;&gt;'s <span class="bracket"><span class="id">transition</span></span>.
</li>
</ul>
</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="basic_VLSM_incl">basic_VLSM_incl</a></span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;{<span class="id">SX</span> <span class="id">SY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id">T</span>}<br/>
&nbsp;&nbsp;(<span class="id">MX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SX</span>)<br/>
&nbsp;&nbsp;(<span class="id">MY</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id">SY</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MX</span>)<br/>
&nbsp;&nbsp;(<span class="id">Y</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id">MY</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hinitial_state</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id">X</span> <span class="id">s</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id">Y</span> <span class="id">s</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id">Hprotocol_message</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id">Y</span> <span class="id">om</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id">Hvalid</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id">Y</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id">Htransition</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) = <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id">Y</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_protocol_state">VLSM_incl_protocol_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> (<span class="id">s</span>,<span class="id">om</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof76')">Proof.</div>
<div class="proofscript" id="proof76">
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">s</span>, <span class="id">om</span>) <span class="kwd">as</span> <span class="id">som</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">om</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>; <span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">Heqsom</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heqsom</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">is</span> <span class="kwd">as</span> [<span class="id">is</span> <span class="id">His</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_state">Hinitial_state</a></span> <span class="kwd">in</span> <span class="id">His</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">is</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">is</span> <span class="id">His</span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>).<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="kwd">as</span> [<span class="id">is</span> <span class="id">His</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_state">Hinitial_state</a></span> <span class="kwd">in</span> <span class="id">His</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">is</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">is</span> <span class="id">His</span>)); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>).<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">om0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">Hps1</span> <span class="id">Hps2</span> <span class="id">Hv</span>); <span class="tactic">intros</span> <span class="id">Hpv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Htransition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Htransition">Htransition</a></span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHHps1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>). <span class="tactic">destruct</span> <span class="id">IHHps1</span> <span class="kwd">as</span> [<span class="id">_omf</span> <span class="id">Hfps</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>) <span class="id">s1</span> <span class="id">om0</span>) <span class="kwd">with</span> (  <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">l1</span> (<span class="id">s</span>, <span class="id">om</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hprotocol_message">Hprotocol_message</a></span> <span class="id">l1</span> <span class="id">s</span> <span class="id">om</span> <span class="id">Hpv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hprotocol_message">Hprotocol_message</a></span> <span class="kwd">as</span> [<span class="id">_sX</span> <span class="id">HpmX</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>) <span class="kwd">with</span> <span class="id">_omf</span> <span class="id">_sX</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hvalid">Hvalid</a></span> <span class="id">l1</span> <span class="id">s</span> <span class="id">om</span> <span class="id">Hpv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_protocol_transition">VLSM_incl_protocol_transition</a></span><br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">is</span> <span class="id">os</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.message">message</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">l</span> (<span class="id">is</span>, <span class="id">iom</span>) (<span class="id">os</span>, <span class="id">oom</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">l</span> (<span class="id">is</span>, <span class="id">iom</span>) (<span class="id">os</span>, <span class="id">oom</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof77')">Proof.</div>
<div class="proofscript" id="proof77">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">Hps</span> <span class="id">Hpm</span> <span class="id">Hv</span>); <span class="tactic">intros</span> <span class="id">Hpv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_protocol_state">VLSM_incl_protocol_state</a></span> <span class="kwd">with</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hprotocol_message">Hprotocol_message</a></span> <span class="kwd">in</span> <span class="id">Hpv</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hvalid">Hvalid</a></span> <span class="id">l</span> <span class="id">is</span> <span class="id">iom</span> <span class="id">Hpv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Htransition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Htransition">Htransition</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_finite_ptrace">VLSM_incl_finite_ptrace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpxt</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span> <span class="id">ls</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof78')">Proof.</div>
<div class="proofscript" id="proof78">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hpxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">m</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_protocol_state">VLSM_incl_protocol_state</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_protocol_transition">VLSM_incl_protocol_transition</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="VLSM_incl_infinite_ptrace">VLSM_incl_infinite_ptrace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpxt</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.X">X</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Y">Y</a></span> <span class="id">s</span> <span class="id">ls</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof79')">Proof.</div>
<div class="proofscript" id="proof79">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [[<span class="id">l</span> <span class="id">input</span> <span class="id">destination</span> <span class="id">output</span>] <span class="id">ls</span>] <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hx</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">destination</span> <span class="id">ls</span> <span class="id">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_protocol_transition">VLSM_incl_protocol_transition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="basic_VLSM_incl">basic_VLSM_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.MX">MX</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.MY">MY</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof80')">Proof.</div>
<div class="proofscript" id="proof80">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">s</span> <span class="id">ls</span>| <span class="id">s</span> <span class="id">ss</span>]; <span class="tactic">simpl</span>; <span class="tactic">intros</span> [<span class="id">Hxt</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_ptrace">VLSM_incl_finite_ptrace</a></span> <span class="kwd">in</span> <span class="id">Hxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_state">Hinitial_state</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_infinite_ptrace">VLSM_incl_infinite_ptrace</a></span> <span class="kwd">in</span> <span class="id">Hxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl.Hinitial_state">Hinitial_state</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span>.<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="pre_loaded_vlsm">pre_loaded_vlsm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_vlsm_sig">pre_loaded_vlsm_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> := <span class="kwd">fun</span> <span class="id">message</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vm0">vm0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vl0">vl0</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_vlsm_machine">pre_loaded_vlsm_machine</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm_sig">pre_loaded_vlsm_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="pre_loaded_vlsm">pre_loaded_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm_machine">pre_loaded_vlsm_machine</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="byzantine_message_prop">byzantine_message_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="byzantine_message">byzantine_message</a></span> : <span class="kwd">Type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#byzantine_message_prop">byzantine_message_prop</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_protocol_prop">pre_loaded_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof81')">Proof.</div>
<div class="proofscript" id="proof81">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_state">protocol_initial_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id">is</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">im</span> <span class="kwd">as</span> [<span class="id">m</span> <span class="id">Him</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">om0</span>. <span class="tactic">clear</span> <span class="id">Him</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Him</span> : @<span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm_sig">pre_loaded_vlsm_sig</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial_message">protocol_initial_message</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">m</span> <span class="id">Him</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span>) <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_can_emit">pre_loaded_can_emit</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof82')">Proof.</div>
<div class="proofscript" id="proof82">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [(<span class="id">s0</span>, <span class="id">om0</span>) [<span class="id">l</span> [<span class="id">s</span> [[[<span class="id">_om0</span> <span class="id">Hs0</span>] [[<span class="id">_s0</span> <span class="id">Hom0</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_protocol_prop">pre_loaded_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_protocol_prop">pre_loaded_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hom0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s0</span>, <span class="id">om0</span>). <span class="id">exists</span> <span class="id">l</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_om0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_s0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="vlsm_incl_pre_loaded_vlsm">vlsm_incl_pre_loaded_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span>) <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm_machine">pre_loaded_vlsm_machine</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof83')">Proof.</div>
<div class="proofscript" id="proof83">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span>) <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm_machine">pre_loaded_vlsm_machine</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span>; <span class="tactic">try</span> (<span class="tactic">assumption</span> || <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">_</span> [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_protocol_prop">pre_loaded_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm.X">X</a></span> <span class="kwd">as</span> (<span class="id">T</span>,(<span class="id">S</span>,<span class="id">M</span>)). <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span>.<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
