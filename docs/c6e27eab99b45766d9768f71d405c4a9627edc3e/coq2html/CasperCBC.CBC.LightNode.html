
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.CBC.LightNode</title>
<meta name="description" content="Documentation of Coq module CasperCBC.CBC.LightNode" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.CBC.LightNode</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Reals.html">Reals</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Relations.Relations.html">Relations</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html">RelationClasses</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Setoids.Setoid.html">Setoid</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Permutation.html">Permutation</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.EqdepFacts.html">EqdepFacts</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.ChoiceFacts.html">ChoiceFacts</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical.html">Classical</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Sorting.html">Sorting</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lib.Preamble</span> <span class="id">Lib.ListExtras</span> <span class="id">Lib.ListSetExtras</span> <span class="id">Lib.SortedLists</span> <span class="id"><a href="CasperCBC.CBC.Protocol.html">CBC.Protocol</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html">CBC.Common</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_type">justification_type</a></span> (<span class="id">hash</span> : <span class="kwd">Type</span>) : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">hash</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_type_inhabited">justification_type_inhabited</a></span> {<span class="id">hash</span>} : <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span> := [].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_compare">justification_compare</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison">comparison</a></span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">list_compare</span> <span class="id">compare</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="about_justification_type">about_justification_type</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id">inhabited</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type_inhabited">justification_type_inhabited</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare</span> := <span class="id">list_compare</span> <span class="id">compare</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare_strictorder</span> := <span class="id">list_compare_strict_order</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_add">justification_add</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">add_in_sorted_list_fn</span> <span class="id">compare</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_add_iff">justification_add_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id">add_in_sorted_list_iff</span> <span class="id">hash</span> <span class="id">compare</span> <span class="id">compare_strictorder</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_add_head">justification_add_head</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id">add_in_sorted_list_head</span> <span class="id">hash</span> <span class="id">compare</span> <span class="id">compare_strictorder</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_add_tail">justification_add_tail</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id">add_in_sorted_list_tail</span> <span class="id">hash</span> <span class="id">compare</span> <span class="id">compare_strictorder</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_add_sorted">justification_add_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;@<span class="id">add_in_sorted_list_sorted</span> <span class="id">hash</span> <span class="id">compare</span> <span class="id">compare_strictorder</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_add_all">justification_add_all</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add">justification_add</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="justification_sorted">justification_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">j</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Sorted.html#LocallySorted">LocallySorted</a></span> (<span class="id">compare_lt</span> <span class="id">compare</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof200')">Proof.</div>
<div class="proofscript" id="proof200">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">j</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_sorted">justification_add_sorted</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="justification_set_eq">justification_set_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> <span class="id">hs</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> <span class="id">hs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof201')">Proof.</div>
<div class="proofscript" id="proof201">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">hs</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">set_eq_refl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; (<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add">justification_add</a></span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_iff">justification_add_iff</a></span>) || <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_iff">justification_add_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">subst</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;;  <span class="id">right</span>; <span class="tactic">apply</span> <span class="id">IHhs</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="justification_add_all_injective">justification_add_all_injective</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">hs1</span> <span class="id">hs2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> <span class="id">hs1</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> <span class="id">hs2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> <span class="id">hs1</span> <span class="id">hs2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof202')">Proof.</div>
<div class="proofscript" id="proof202">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id">set_equality_predicate</span> <span class="id">hash</span> (<span class="id">compare_lt</span> <span class="id">compare</span>) <span class="id">compare_lt_strict_order</span>) <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_sorted">justification_sorted</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_tran</span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> <span class="id">hs1</span>); <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_tran</span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> <span class="id">hs2</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification_in">justification_in</a></span><br/>
&nbsp;&nbsp;{<span class="id">hash</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">hash</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">hash</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> := <span class="id">inb</span> <span class="id">compare_eq_dec</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="message">message</a></span> (<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>) : <span class="kwd">Type</span> := <span class="id">C</span> * <span class="id">V</span> * <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span>.<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;`{<span class="id">HscC</span> : <span class="id">StrictlyComparable</span> <span class="id">C</span>} `{<span class="id">HscV</span> : <span class="id">StrictlyComparable</span> <span class="id">V</span>} `{<span class="id">HscH</span> : <span class="id">StrictlyComparable</span> <span class="id">hash</span>}.<br/>
<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="message_type">message_type</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">TripleStrictlyComparable</span> <span class="id">C</span> <span class="id">V</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span>).<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="estimate">estimate</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id">C</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span> (<span class="id">c</span>, <span class="id">_</span>, <span class="id">_</span>) =&gt; <span class="id">c</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sender">sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span> (<span class="id">_</span>, <span class="id">v</span>, <span class="id">_</span>) =&gt; <span class="id">v</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="justification">justification</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">msg</span> <span class="kwd">with</span> (<span class="id">_</span>, <span class="id">_</span>, <span class="id">j</span>) =&gt; <span class="id">j</span> <span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="MessageHash">MessageHash</a></span> <span class="id">message</span> <span class="id">hash</span> :=<br/>
&nbsp;&nbsp;{ <span class="id"><a name="hash_message">hash_message</a></span> : <span class="id">message</span> -&gt; <span class="id">hash</span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="InjectiveMessageHash">InjectiveMessageHash</a></span> <span class="id">message</span> <span class="id">hash</span> `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> <span class="id">message</span> <span class="id">hash</span>} :=<br/>
&nbsp;&nbsp;{ <span class="id"><a name="hash_message_injective">hash_message_injective</a></span> : <span class="id">Injective</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> := <span class="tactic">set</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_inhabited">state_inhabited</a></span> {<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> := [].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_compare">state_compare</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison">comparison</a></span>) := <span class="id">list_compare</span> <span class="id">compare</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="about_state">about_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id">inhabited</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_inhabited">state_inhabited</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare</span> := <span class="id">list_compare</span> <span class="id">compare</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">compare_strictorder</span> := <span class="id">list_compare_strict_order</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state0">state0</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> := [].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_add">state_add</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id">compare_eq_dec</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_remove">state_remove</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">HscM</span> : <span class="id">StrictlyComparable</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_in">state_in</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>-&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_mem">set_mem</a></span> <span class="id">compare_eq_dec</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_union">state_union</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>-&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>-&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union">set_union</a></span> <span class="id">compare_eq_dec</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_eq">state_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s1</span> <span class="id">s2</span> /\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s2</span> <span class="id">s1</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="state_union_comm">state_union_comm</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_eq">state_eq</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">s2</span> <span class="id">s1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof203')">Proof.</div>
<div class="proofscript" id="proof203">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_eq">state_eq</a></span>; <span class="tactic">split</span>;<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">H_in</span>;<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">set_union_comm</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="hash_state">hash_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_type">justification_type</a></span> <span class="id">hash</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hash_state_sorted">hash_state_sorted</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Sorting.Sorted.html#LocallySorted">LocallySorted</a></span> (<span class="id">compare_lt</span> <span class="id">compare</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof204')">Proof.</div>
<div class="proofscript" id="proof204">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_sorted">justification_sorted</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hash_state_injective">hash_state_injective</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma1</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma2</span><br/>
&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> <span class="id">sigma1</span> <span class="id">sigma2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof205')">Proof.</div>
<div class="proofscript" id="proof205">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all_injective">justification_add_all_injective</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H12</span> <span class="id">H21</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map">in_map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span>) <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id">H12</span> <span class="kwd">in</span> <span class="id">Hin</span> || <span class="tactic">apply</span> <span class="id">H21</span> <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">x</span>' [<span class="id">Heq</span> <span class="id">Hin</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message_injective">hash_message_injective</a></span> <span class="kwd">in</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (@<span class="id">set_equality_predicate</span> <span class="id">hash</span> (<span class="id">compare_lt</span> <span class="id">compare</span>) <span class="id">compare_lt_strict_order</span>); <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_sorted">hash_state_sorted</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_tran</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma2</span>); <span class="tactic">try</span> <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_tran</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma1</span>); <span class="tactic">try</span> <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">map_set_eq</span>. <span class="tactic">apply</span> <span class="id">set_eq_comm</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hash_state_in">hash_state_in</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">msg</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof206')">Proof.</div>
<div class="proofscript" id="proof206">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s</span> : <span class="id">set_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H_s</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">Heq</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message_injective">hash_message_injective</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H_s</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map">in_map</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hash_state_incl">hash_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma1</span> <span class="id">sigma2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">sigma1</span> <span class="id">sigma2</span> &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof207')">Proof.</div>
<div class="proofscript" id="proof207">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s1</span> : <span class="id">set_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma1</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s2</span> : <span class="id">set_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma2</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_add_all">justification_add_all</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">sigma2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">h</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_s2</span>. <span class="tactic">apply</span> <span class="id">H_s1</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_mh</span> <span class="id">Hin_m</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">Hin_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>. <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_messages">equivocating_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare_eq_dec</span> <span class="id">msg1</span> <span class="id">msg2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span>  =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="kwd">match</span> <span class="id">msg1</span>, <span class="id">msg2</span> <span class="kwd">with</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>), (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">compare_eq_dec</span> <span class="id">v1</span> <span class="id">v2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">_</span>  =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id">inb</span> <span class="id">compare_eq_dec</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">msg1</span>) <span class="id">j2</span>) &amp;&amp; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id">inb</span> <span class="id">compare_eq_dec</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">msg2</span>) <span class="id">j1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#right">right</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_messages_prop">equivocating_messages_prop</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">msg1</span> &lt;&gt; <span class="id">msg2</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg1</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg2</span> /\ ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">msg1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification">justification</a></span> <span class="id">msg2</span>) /\ ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">msg2</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#justification">justification</a></span> <span class="id">msg1</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_sender">equivocating_messages_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg1</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof208')">Proof.</div>
<div class="proofscript" id="proof208">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">j1</span>] [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">j2</span>] <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>, <span class="id">v1</span>, <span class="id">j1</span>) (<span class="id">c2</span>, <span class="id">v2</span>, <span class="id">j2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_correct">equivocating_messages_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg1</span> <span class="id">msg2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof209')">Proof.</div>
<div class="proofscript" id="proof209">
&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">c1</span> <span class="id">v1</span>] <span class="id">j1</span>] [[<span class="id">c2</span> <span class="id">v2</span>] <span class="id">j2</span>]; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;inequality&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;sender&nbsp;obligation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_sender">equivocating_messages_sender</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;msg1&nbsp;is&nbsp;not&nbsp;in&nbsp;msg2's&nbsp;justification&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">in_function</span> <span class="id">compare_eq_dec</span>) <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_absurd</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>) (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Proving&nbsp;msg2&nbsp;is&nbsp;not&nbsp;in&nbsp;msg1's&nbsp;justification&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="tactic">apply</span> (<span class="id">in_function</span> <span class="id">compare_eq_dec</span>) <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_absurd</span>. <span class="tactic">rewrite</span> <span class="id">H_absurd</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>) (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_false_r">andb_false_r</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H_neq</span> [<span class="id">H_sender</span> [<span class="id">H_in1</span> <span class="id">H_in2</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>,<span class="id">v1</span>,<span class="id">j1</span>) (<span class="id">c2</span>,<span class="id">v2</span>,<span class="id">j2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v1</span> <span class="id">v2</span>); <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">rewrite</span> <span class="id">mirror_reflect_curry</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H_in1</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id">H_in2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;;  <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">apply</span> (<span class="id">in_function</span> <span class="id">compare_eq_dec</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivocating_messages_correct</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; ~ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg1</span> <span class="id">msg2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof210')">Proof.</div>
<div class="proofscript" id="proof210">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mirror_reflect_curry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_comm">equivocating_messages_comm</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg2</span> <span class="id">msg1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof211')">Proof.</div>
<div class="proofscript" id="proof211">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">sigma1</span>] [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">sigma2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c1</span>, <span class="id">v1</span>, <span class="id">sigma1</span>) (<span class="id">c2</span>, <span class="id">v2</span>, <span class="id">sigma2</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">eq_dec_if_false</span> <span class="id">compare_eq_dec</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v1</span> <span class="id">v2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_comm">andb_comm</a></span>. <span class="tactic">reflexivity</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hnot</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hnot</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hnot</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hnot</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hnot</span>; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hnot</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg1</span> <span class="id">msg2</span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg2</span> <span class="id">msg1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof212')">Proof.</div>
<div class="proofscript" id="proof212">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_comm">equivocating_messages_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="non_equivocating_messages_sender">non_equivocating_messages_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg1</span> <span class="id">msg2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg1</span> &lt;&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg1</span> <span class="id">msg2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof213')">Proof.</div>
<div class="proofscript" id="proof213">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c1</span>, <span class="id">v1</span>) <span class="id">j1</span>] [(<span class="id">c2</span>, <span class="id">v2</span>) <span class="id">j2</span>] <span class="id">Hneq</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hneq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Heq</span>. <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>. <span class="tactic">apply</span> <span class="id">Hneq</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_state">equivocating_in_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg</span>) <span class="id">sigma</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_state_prop">equivocating_in_state_prop</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span>' <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg</span> <span class="id">msg</span>'.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_correct">equivocating_in_state_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof214')">Proof.</div>
<div class="proofscript" id="proof214">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state">equivocating_in_state</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'; <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">equivocating_in_state_correct</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; ~ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof215')">Proof.</div>
<div class="proofscript" id="proof215">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">mirror_reflect_curry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_incl">equivocating_in_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof216')">Proof.</div>
<div class="proofscript" id="proof216">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hin</span> <span class="id">Heq</span>]]. <span class="id">exists</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_not_seen">equivocating_in_state_not_seen</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> <span class="id">sigma</span>,<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> <span class="id">compare_eq_dec</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">sigma</span>) -&gt;<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof217')">Proof.</div>
<div class="proofscript" id="proof217">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>] <span class="id">sigma</span> <span class="id">Hnin</span>. <span class="tactic">rewrite</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">Hnin</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">equivocating_in_state_correct</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">existsb_forall</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">cx</span>, <span class="id">vx</span>) <span class="id">jx</span>] <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#non_equivocating_messages_sender">non_equivocating_messages_sender</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Heq</span>. <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">Hnin</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">cx</span>, <span class="id">vx</span>, <span class="id">jx</span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="tactic">set</span> <span class="id">V</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> <span class="id">compare_eq_dec</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">msg</span> =&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>) <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_senders_prop">equivocating_senders_prop</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">lv</span> : <span class="tactic">set</span> <span class="id">V</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">lv</span> &lt;-&gt; <span class="id">exists</span> <span class="id">msg</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span> = <span class="id">v</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_correct">equivocating_senders_correct</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_prop">equivocating_senders_prop</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof218')">Proof.</div>
<div class="proofscript" id="proof218">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">v</span>; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Left&nbsp;direction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> <span class="id">H_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> [<span class="id">H_sender</span> <span class="id">H_equiv</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_incl">equivocating_senders_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof219')">Proof.</div>
<div class="proofscript" id="proof219">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_incl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>=&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state">equivocating_in_state</a></span> <span class="id">msg</span> <span class="id">sigma</span>) <span class="id">sigma</span>').<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_incl</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">filter_incl_fn</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="reach">reach</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reach_refl">reach_refl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof220')">Proof.</div>
<div class="proofscript" id="proof220">
 <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reach_trans">reach_trans</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s2</span> <span class="id">s3</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s1</span> <span class="id">s3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof221')">Proof.</div>
<div class="proofscript" id="proof221">
 <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reach_union">reach_union</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s1</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof222')">Proof.</div>
<div class="proofscript" id="proof222">
 <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">x</span> <span class="id">H_in</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_iff">set_union_iff</a></span>; <span class="id">left</span>; <span class="tactic">assumption</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="reach_morphism">reach_morphism</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s1</span> <span class="id">s2</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_eq">state_eq</a></span> <span class="id">s2</span> <span class="id">s3</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span> <span class="id">s1</span> <span class="id">s3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof223')">Proof.</div>
<div class="proofscript" id="proof223">
 <span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">s3</span> <span class="id">H_reach</span> <span class="id">H_eq</span> <span class="id">x</span> <span class="id">H_in</span>. <span class="id">spec</span> <span class="id">H_reach</span> <span class="id">x</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_eq</span> <span class="kwd">as</span> [<span class="id">H_eq</span> <span class="id">_</span>]. <span class="id">spec</span> <span class="id">H_eq</span> <span class="id">x</span> <span class="id">H_reach</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fault_weight_state_incl">fault_weight_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span> &lt;= <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span>')%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof224')">Proof.</div>
<div class="proofscript" id="proof224">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_incl">equivocating_senders_incl</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="not_heavy">not_heavy</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_heavy_subset">not_heavy_subset</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof225')">Proof.</div>
<div class="proofscript" id="proof225">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span>'); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state_incl">fault_weight_state_incl</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_heavy_set_eq">not_heavy_set_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> <span class="id">sigma</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id">set_eq</span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof226')">Proof.</div>
<div class="proofscript" id="proof226">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span> <span class="id">H0</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;`{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;`{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;`{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;`{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="protocol_state">protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;| <span class="id"><a name="protocol_state_nil">protocol_state_nil</a></span> : <span class="id">protocol_state</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state0">state0</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="protocol_state_cons">protocol_state_cons</a></span> : <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">protocol_state</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">protocol_state</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">protocol_state</span> <span class="id">s</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_nodup">protocol_state_nodup</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof227')">Proof.</div>
<div class="proofscript" id="proof227">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_extx_in_x">not_extx_in_x</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">HPS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> (<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s</span>' <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>)) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof228')">Proof.</div>
<div class="proofscript" id="proof228">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span> <span class="id">v</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">PS</span> <span class="id">PS</span>'. <span class="tactic">induction</span> <span class="id">PS</span>'; <span class="tactic">intros</span> <span class="id">Hincl</span> <span class="id">Hin</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#state0">state0</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">inversion</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">set_remove_in_iff</span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) (<span class="id">c0</span>, <span class="id">v0</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s0</span> <span class="id">H1</span> <span class="id">H0</span>) <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_injective">hash_state_injective</a></span> <span class="kwd">in</span> <span class="id">H6</span>. <span class="tactic">apply</span> <span class="id">IHPS</span>'1; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span>. <span class="tactic">apply</span> <span class="id">Hincl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_injective">hash_state_injective</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H3</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHPS</span>'2; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> <span class="id">s0</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">h</span> <span class="id">Hin_h</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_1">set_remove_1</a></span> <span class="kwd">in</span> <span class="id">Hin_h</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_self">not_in_self</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">HPS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof229')">Proof.</div>
<div class="proofscript" id="proof229">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">v</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_extx_in_x">not_extx_in_x</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>) <span class="id">v</span> <span class="id">s</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">about_s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map">in_map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>)) <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_eq</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_eq</span> <span class="kwd">as</span> [<span class="id">H_eq</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>)) <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_in_self_relaxed">not_in_self_relaxed</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">HPS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">c</span> : <span class="id">C</span>) (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof230')">Proof.</div>
<div class="proofscript" id="proof230">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">c</span> <span class="id">v</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_extx_in_x">not_extx_in_x</a></span> <span class="id">c</span> <span class="id">v</span> <span class="id">s</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">about_s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map">in_map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">s</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>)) <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_eq</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#justification_set_eq">justification_set_eq</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_eq</span> <span class="kwd">as</span> [<span class="id">H_eq</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message">hash_message</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>)) <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="set_eq_protocol_state">set_eq_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">HPS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">sigma</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> <span class="id">sigma</span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">sigma</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">sigma</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof231')">Proof.</div>
<div class="proofscript" id="proof231">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>'; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#state0">state0</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">incl_empty</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id">set_eq_remove</span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)) <span class="kwd">in</span> <span class="id">H3</span> <span class="kwd">as</span> <span class="id">Hset_eq</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHH</span>'2 <span class="kwd">in</span> <span class="id">Hset_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="id">j</span> <span class="id">H</span>'1 <span class="id">c</span> <span class="id">H</span> <span class="id">v</span> <span class="id">sigma</span>'); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H3</span>. <span class="id">now</span> <span class="tactic">apply</span> (<span class="id">H3</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_set_eq">not_heavy_set_eq</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H3</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_nodup">set_remove_nodup</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="non_equivocating_messages_extend">non_equivocating_messages_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">sigma1</span> <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> <span class="id">sigma1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="id">msg</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma1</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof232')">Proof.</div>
<div class="proofscript" id="proof232">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c0</span>, <span class="id">v0</span>) <span class="id">sigma</span>']; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c0</span>, <span class="id">v0</span>, <span class="id">sigma</span>') (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma1</span>)).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;these&nbsp;two&nbsp;messages&nbsp;are&nbsp;equal,&nbsp;they&nbsp;cannot&nbsp;be&nbsp;equivocating&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;these&nbsp;messages&nbsp;are&nbsp;not&nbsp;equal,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;When&nbsp;their&nbsp;senders&nbsp;are&nbsp;equal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v0</span> <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_correct</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_in_state_extend">equivocating_in_state_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;:  <span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof233')">Proof.</div>
<div class="proofscript" id="proof233">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span> <span class="id">v</span> <span class="id">s</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_absurd</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#non_equivocating_messages_extend">non_equivocating_messages_extend</a></span> <span class="id">msg</span> <span class="id">s</span> <span class="id">c</span> <span class="id">v</span> <span class="id">H_in</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">equivocating_messages_correct</span>' <span class="kwd">in</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_extend">equivocating_senders_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">c</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> ((<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma</span>) :: <span class="id">sigma</span>) = <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof234')">Proof.</div>
<div class="proofscript" id="proof234">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Why&nbsp;doesn't&nbsp;the&nbsp;suff&nbsp;tactic&nbsp;work&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_irrefl</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma</span>) (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">equivocating_messages_correct</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_absurd</span> <span class="kwd">as</span> [<span class="id">H_eq</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_irrefl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id">equivocating_in_state_correct</span>' (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">sigma</span>) <span class="id">sigma</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span>' := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_extend">equivocating_in_state_extend</a></span> <span class="id">c</span> <span class="id">v</span> <span class="id">sigma</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_useful</span> <span class="kwd">in</span> <span class="id">H_useful</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_useful</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_eq_fn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_prop">orb_prop</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_goal</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#non_equivocating_messages_extend">non_equivocating_messages_extend</a></span> <span class="id">a</span> <span class="id">sigma</span> <span class="id">c</span> <span class="id">v</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">H1</span> <span class="id">a</span>). <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_true_intro">orb_true_intro</a></span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_not_heavy">protocol_state_not_heavy</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof235')">Proof.</div>
<div class="proofscript" id="proof235">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_le">Rge_le</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>; <span class="id">easy</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="copy_protocol_state">copy_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) :: <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof236')">Proof.</div>
<div class="proofscript" id="proof236">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Hps</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>) <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">set_remove_first</span>; <span class="id">easy</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nodup">protocol_state_nodup</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) :: <span class="id">s</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_extend">equivocating_senders_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">Hps</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_prot_state">about_prot_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">s1</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof237')">Proof.</div>
<div class="proofscript" id="proof237">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sig1</span> <span class="id">sig2</span> <span class="id">Hps1</span> <span class="id">Hps2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps2</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">IHHps2_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">sig1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHHps2_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">sig1</span> <span class="id">s</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">msg</span>; <span class="tactic">intro</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_intro">set_union_intro</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="kwd">in</span> <span class="id">Hin</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_elim">set_union_elim</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_1">set_remove_1</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">IHHps2_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nodup">protocol_state_nodup</a></span> <span class="kwd">in</span> <span class="id">Hps1</span> <span class="kwd">as</span> <span class="id">Hnodups1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">HnodupUs1s</span>' := <span class="id">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_nodup">set_union_nodup</a></span> <span class="id">compare_eq_dec</span> <span class="id">Hnodups1</span>) <span class="kwd">in</span> <span class="id">HnodupUs1s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">sig1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#set_eq_protocol_state">set_eq_protocol_state</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">sig1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_remove_union_in</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="id">j</span> <span class="id">Hps2_1</span> <span class="id">c</span> <span class="id">H</span> <span class="id">v</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_iff">set_union_iff</a></span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_nodup">set_remove_nodup</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)) <span class="kwd">in</span> <span class="id">HnodupUs1s</span>' <span class="kwd">as</span> <span class="id">Hnoduprem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#set_eq_protocol_state">set_eq_protocol_state</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">sig1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_remove_union_not_in</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocation_weight_compat">equivocation_weight_compat</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> &lt;= <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span> <span class="id">s2</span> <span class="id">s1</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof238')">Proof.</div>
<div class="proofscript" id="proof238">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state_incl">fault_weight_state_incl</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_iff">set_union_iff</a></span>. <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="LightNode_seteq">LightNode_seteq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Protocol.html#CBC_protocol_eq">CBC_protocol_eq</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{ <span class="id"><a href="CasperCBC.CBC.Protocol.html#consensus_values">consensus_values</a></span> := <span class="id">C</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_consensus_values">about_consensus_values</a></span> := <span class="id">HscC</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#validators">validators</a></span> := <span class="id">V</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_validators">about_validators</a></span> := <span class="id">HscV</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#weight">weight</a></span> := <span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#t">t</a></span> := <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#suff_val">suff_val</a></span> := <span class="id"><a href="CasperCBC.CBC.Common.html#reachable_threshold">reachable_threshold</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state">state</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state0">state0</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#state0">state0</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state_eq">state_eq</a></span> := <span class="id">set_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_state">about_state</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_state">about_state</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state_union">state_union</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union">state_union</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#state_union_comm">state_union_comm</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#state_union_comm">state_union_comm</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach">reach</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach">reach</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_refl">reach_refl</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach_refl">reach_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_trans">reach_trans</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach_trans">reach_trans</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_union">reach_union</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach_union">reach_union</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#reach_morphism">reach_morphism</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#reach_morphism">reach_morphism</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#E">E</a></span> := <span class="id"><a href="CasperCBC.CBC.Common.html#estimator">estimator</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#estimator_total">estimator_total</a></span> := <span class="id"><a href="CasperCBC.CBC.Common.html#estimator_total">estimator_total</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#prot_state">prot_state</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_state0">about_state0</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nil">protocol_state_nil</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#equivocation_weight">equivocation_weight</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#equivocation_weight_compat">equivocation_weight_compat</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocation_weight_compat">equivocation_weight_compat</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#about_prot_state">about_prot_state</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_prot_state">about_prot_state</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate_light">pstate_light</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>)  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">Type</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> | <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span>}.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate_light_proj1">pstate_light_proj1</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">p</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">p</span>.<br/>
<span class="kwd">Coercion</span> <span class="id">pstate_light_proj1</span> : <span class="id">pstate_light</span> &gt;-&gt; <span class="id">state</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pstate_light_rel">pstate_light_rel</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p1</span> <span class="id">p2</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_proj1">pstate_light_proj1</a></span> <span class="id">p1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_proj1">pstate_light_proj1</a></span> <span class="id">p2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="non_trivial_pstate_light">non_trivial_pstate_light</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="kwd">Prop</span>) :=<br/>
&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">s1</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">s1</span> <span class="id">s</span> -&gt; <span class="id">P</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">s2</span> <span class="id">s</span> -&gt; (<span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>)).<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_heavy_singleton">not_heavy_singleton</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> [<span class="id">msg</span>].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof239')">Proof.</div>
<div class="proofscript" id="proof239">
&nbsp;&nbsp;<span class="tactic">intros</span> [(<span class="id">c</span>, <span class="id">v</span>) <span class="id">j</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_le">Rge_le</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>. <span class="id">easy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_singleton">protocol_state_singleton</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">v</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> [(<span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof240')">Proof.</div>
<div class="proofscript" id="proof240">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">j</span> <span class="id">c</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">try</span> <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_nil">in_nil</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_singleton">not_heavy_singleton</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_incl">protocol_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s</span>' <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof241')">Proof.</div>
<div class="proofscript" id="proof241">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">about_s</span>; <span class="tactic">intros</span> <span class="id">s</span>' <span class="id">H_nodup</span> <span class="id">H_incl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nil">protocol_state_nil</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">spec</span> <span class="id">H_incl</span> <span class="id">m</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> <span class="id">m</span> <span class="id">s</span>'). <span class="tactic">inversion</span> <span class="id">H_incl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">spec</span> <span class="id">IHabout_s2</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">j</span> <span class="id">c</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHabout_s2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_nodup">set_remove_nodup</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">msg</span> = (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_contra</span> := <span class="id">set_remove_elim</span> <span class="id">compare_eq_dec</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">s</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_contra</span> <span class="id">H_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">spec</span> <span class="id">H_incl</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_iff">set_remove_iff</a></span> <span class="id">compare_eq_dec</span> <span class="id">msg</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">s</span>' <span class="id">H_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_useful</span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_iff">set_remove_iff</a></span>; <span class="tactic">try</span> <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">spec</span> <span class="id">IHabout_s2</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHabout_s2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">msg</span> &lt;&gt; (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">H_absurd</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_incl</span> (<span class="id">c</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_iff">set_remove_iff</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. 2 : <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> (<span class="id">H_incl</span> <span class="id">msg</span> <span class="id">H_in</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="binary_justification_nodup">binary_justification_nodup</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">c1</span> <span class="id">c2</span> : <span class="id">C</span>) (<span class="id">j1</span> <span class="id">j2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;~ <span class="id">set_eq</span> <span class="id">j1</span> <span class="id">j2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof242')">Proof.</div>
<div class="proofscript" id="proof242">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Hnin</span> <span class="id">Hnodup</span>]. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_injective">hash_state_injective</a></span> <span class="kwd">in</span> <span class="id">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">Hnin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hinx</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Heq</span> | <span class="id">Heq</span>]]; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHvs</span> <span class="kwd">in</span> <span class="id">Hnodup</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span>; <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hnin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hinx</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Heq</span> | <span class="id">Heq</span>]]; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="binary_justification_protocol_state">binary_justification_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">vs</span> <span class="id">c1</span> <span class="id">j1</span> <span class="id">c2</span> (<span class="id">j2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">set_eq</span> <span class="id">j1</span> <span class="id">j2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c1</span> <span class="id">j1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c2</span> <span class="id">j2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof243')">Proof.</div>
<div class="proofscript" id="proof243">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">Hanin</span> <span class="id">Hnodup</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">j1</span> <span class="id">c1</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">j2</span> <span class="id">c2</span> <span class="id">a</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHvs</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) (<span class="id">a</span> :: <span class="id">vs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">Hinv</span> <span class="id">Hinx</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#binary_justification_nodup">binary_justification_nodup</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hanin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Hinx</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Heq</span> | <span class="id">Heq</span>]]; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) (<span class="id">a</span> :: <span class="id">vs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="id">exists</span> <span class="id">a</span>. <span class="tactic">split</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>). <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">Hinv</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_injective">hash_state_injective</a></span> <span class="kwd">in</span> <span class="id">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">Hanin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">Hinv</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Heq</span> | <span class="id">Heq</span>]]; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">Hanin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">H4</span>. <span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">Hinv</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Heq</span> | <span class="id">Heq</span>]]; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#binary_justification_nodup">binary_justification_nodup</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="fault_weight_max">fault_weight_max</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">sigma</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">sigma</span> &lt;= <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> <span class="id">compare_eq_dec</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">sigma</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof244')">Proof.</div>
<div class="proofscript" id="proof244">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_incl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> <span class="id">Hin</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="exist_equivocating_messages">exist_equivocating_messages</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>)  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">vs</span>,<br/>
&nbsp;&nbsp;<span class="id">vs</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">j1</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id">exists</span> <span class="id">j2</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j1</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j2</span> /\ ~ <span class="id">set_eq</span> <span class="id">j1</span> <span class="id">j2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">c1</span>, <span class="id">exists</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c1</span> <span class="id">j1</span> /\ <span class="id"><a href="CasperCBC.CBC.Common.html#valid_estimate">valid_estimate</a></span> <span class="id">c2</span> <span class="id">j2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> (<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>) (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof245')">Proof.</div>
<div class="proofscript" id="proof245">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#estimator_total">estimator_total</a></span> []) <span class="kwd">as</span> [<span class="id">c</span> <span class="id">Hc</span>].<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">vs</span>; <span class="tactic">try</span> (<span class="id">exfalso</span>; <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">reflexivity</span>); <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#estimator_total">estimator_total</a></span> [(<span class="id">c</span>, <span class="id">v</span>, [])]) <span class="kwd">as</span> [<span class="id">c</span>' <span class="id">Hc</span>'].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#estimator_total">estimator_total</a></span> [(<span class="id">c</span>', <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> [(<span class="id">c</span>, <span class="id">v</span>, [])])]) <span class="kwd">as</span> [<span class="id">c</span>'' <span class="id">Hc</span>''].<br/>
&nbsp;&nbsp;<span class="id">exists</span> []. <span class="id">exists</span> [(<span class="id">c</span>', <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> [(<span class="id">c</span>, <span class="id">v</span>, [])])]. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_singleton">protocol_state_singleton</a></span> <span class="id">c</span>' <span class="id">v</span> [(<span class="id">c</span>, <span class="id">v</span>, [])]) <span class="kwd">in</span> <span class="id">Hc</span>'; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_singleton">protocol_state_singleton</a></span> <span class="id">c</span> <span class="id">v</span> []) <span class="kwd">in</span> <span class="id">Hc</span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">incl_empty</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">c</span>. <span class="id">exists</span> <span class="id">c</span>''. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#andb_true_iff">andb_true_iff</a></span>. <span class="tactic">split</span>; <span class="tactic">apply</span>  <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#negb_true_iff">negb_true_iff</a></span>; <span class="tactic">apply</span> <span class="id">in_correct</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hh</span>. <span class="tactic">destruct</span> <span class="id">Hh</span> <span class="kwd">as</span> [<span class="id">Hh</span> | <span class="id">Hf</span>]; <span class="tactic">try</span> <span class="id">contradiction</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_message_injective">hash_message_injective</a></span> <span class="kwd">in</span> <span class="id">Hh</span>. <span class="tactic">discriminate</span> <span class="id">Hh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>. <span class="tactic">intro</span> <span class="id">Hf</span>. <span class="id">contradiction</span> <span class="id">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intro</span>. <span class="tactic">discriminate</span> <span class="id">H0</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="non_triviality_decisions_on_properties_of_protocol_states">non_triviality_decisions_on_properties_of_protocol_states</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>)  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">p</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> -&gt; <span class="kwd">Prop</span>), <span class="id"><a href="CasperCBC.CBC.LightNode.html#non_trivial_pstate_light">non_trivial_pstate_light</a></span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof246')">Proof.</div>
<div class="proofscript" id="proof246">
&nbsp;&nbsp;<span class="comment">(*&nbsp;Get&nbsp;a&nbsp;pivotal&nbsp;validator&nbsp;and&nbsp;its&nbsp;complement&nbsp;set&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Common.html#exists_pivotal_validator">exists_pivotal_validator</a></span> <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">vs</span> [<span class="id">Hnodup</span> [<span class="id">Hvnin</span> [<span class="id">Hlte</span> <span class="id">Hgt</span>]]]]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Get&nbsp;a&nbsp;pair&nbsp;of&nbsp;messages&nbsp;in&nbsp;which&nbsp;that&nbsp;validator&nbsp;is&nbsp;equivocating&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#exist_equivocating_messages">exist_equivocating_messages</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> (<span class="id">v</span> :: <span class="id">vs</span>)) <span class="kwd">as</span> [<span class="id">j1</span> [<span class="id">j2</span> [<span class="id">Hj1ps</span> [<span class="id">Hj2ps</span> [<span class="id">Hneq12</span> [<span class="id">c1</span> [<span class="id">c2</span> [<span class="id">Hval1</span> [<span class="id">Hval2</span> <span class="id">Heqv</span>]]]]]]]]].<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;property&nbsp;is&nbsp;that&nbsp;of&nbsp;containing&nbsp;one&nbsp;equivocating&nbsp;partner&nbsp;message&nbsp;from&nbsp;this&nbsp;pivotal&nbsp;validator&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="kwd">fun</span> (<span class="id">p</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">c1</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">p</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;The&nbsp;first&nbsp;state&nbsp;which&nbsp;does&nbsp;satisfy&nbsp;this&nbsp;property&nbsp;is&nbsp;the&nbsp;state&nbsp;containing&nbsp;just&nbsp;that&nbsp;one&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> [(<span class="id">c1</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>)] (<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_singleton">protocol_state_singleton</a></span> <span class="id">c1</span> <span class="id">v</span> <span class="id">j1</span> <span class="id">Hj1ps</span> <span class="id">Hval1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>. <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;The&nbsp;second&nbsp;state&nbsp;which&nbsp;does&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;property&nbsp;is&nbsp;the&nbsp;state&nbsp;containing&nbsp;the&nbsp;message's&nbsp;equivocation&nbsp;partner,&nbsp;as&nbsp;well&nbsp;as&nbsp;messages&nbsp;from&nbsp;all&nbsp;the&nbsp;other&nbsp;validators&nbsp;in&nbsp;the&nbsp;complement&nbsp;set&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_prot</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> ((<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">j2</span> <span class="id">c2</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;the&nbsp;message&nbsp;partner&nbsp;is&nbsp;in&nbsp;the&nbsp;new&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;the&nbsp;new&nbsp;state&nbsp;without&nbsp;the&nbsp;message&nbsp;partner&nbsp;is&nbsp;a&nbsp;protocol&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;state&nbsp;is&nbsp;a&nbsp;protocol&nbsp;state&nbsp;if&nbsp;it's&nbsp;not&nbsp;too&nbsp;heavy&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#binary_justification_protocol_state">binary_justification_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_map">set_map</a></span> <span class="id">compare_eq_dec</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v0</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v0</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v0</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>))); <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_max">fault_weight_max</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;x&nbsp;is&nbsp;some&nbsp;arbitrary&nbsp;validator&nbsp;in&nbsp;vs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;x&nbsp;has&nbsp;sent&nbsp;some&nbsp;message&nbsp;in&nbsp;the&nbsp;tl&nbsp;of&nbsp;the&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [[(<span class="id">mc</span>, <span class="id">mv</span>) <span class="id">mj</span>] [<span class="id">Hin</span> <span class="id">Hveq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hveq</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">mv</span> [<span class="id">Hinv</span> <span class="id">Hinm</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinm</span> <span class="kwd">as</span> [<span class="id">Hinm</span> | [<span class="id">Hinm</span> | <span class="id">Hinm</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Hinm</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;the&nbsp;new&nbsp;state&nbsp;is&nbsp;duplicate-free&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#binary_justification_nodup">binary_justification_nodup</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>. <span class="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">v</span>'' [<span class="id">Hinv</span> <span class="id">Hinm</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hvnin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinm</span> <span class="kwd">as</span> [<span class="id">Hinm</span> | [<span class="id">Hinm</span> | <span class="id">Hinm</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Hinm</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;the&nbsp;new&nbsp;state&nbsp;is&nbsp;not&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">v0</span> <span class="id">Hinv0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">Hinv0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinv0</span> <span class="kwd">as</span> [[(<span class="id">c0</span>, <span class="id">v0</span>') <span class="id">j0</span>] [<span class="id">Hin</span> <span class="id">Heq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Hequiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">Hin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">v0</span>' [<span class="id">Hinv0</span> [<span class="id">Hin</span> | [<span class="id">Hin</span> | <span class="id">Hin</span>]]]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin</span>; <span class="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heq</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">Hequiv</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hequiv</span> <span class="kwd">as</span> [[(<span class="id">mc</span>, <span class="id">mv</span>) <span class="id">mj</span>] [<span class="id">Hin</span> <span class="id">Hequiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages">equivocating_messages</a></span> <span class="kwd">in</span> <span class="id">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> (<span class="id">c0</span>, <span class="id">v0</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>) (<span class="id">mc</span>, <span class="id">mv</span>, <span class="id">mj</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">eq_dec_if_true</span> <span class="kwd">in</span> <span class="id">Hequiv</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_if_false</span> <span class="kwd">in</span> <span class="id">Hequiv</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">compare_eq_dec</span> <span class="id">v0</span> <span class="id">mv</span>); <span class="tactic">try</span> <span class="tactic">discriminate</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">v0</span>' [<span class="id">Hinv0</span> [<span class="id">Hin</span> | [<span class="id">Hin</span> | <span class="id">Hin</span>]]]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> ((<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)  :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>) <span class="id">H_prot</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">sigma</span> <span class="id">Hincl</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">sigma</span> <span class="kwd">as</span> [<span class="id">sigma</span> <span class="id">about_sigma</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hpssigma</span> := <span class="id">about_sigma</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">Hpssigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy_subset">not_heavy_subset</a></span> ((<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>) :: ((<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>) :: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>))) <span class="kwd">in</span> <span class="id">Hpssigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_heavy">not_heavy</a></span> <span class="kwd">in</span> <span class="id">Hpssigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="kwd">in</span> <span class="id">Hpssigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Heq</span> : ((<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) <span class="id">vs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id">V</span> =&gt; [(<span class="id">c1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>); (<span class="id">c2</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>)]) (<span class="id">v</span> :: <span class="id">vs</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">Hpssigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_gt_compat_r">Rplus_gt_compat_r</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>)) <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rminus">Rminus</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_opp_l">Rplus_opp_l</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_lt">Rgt_lt</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_lt_trans">Rle_lt_trans</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hpssigma</span>) <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_lt_trans">Rle_lt_trans</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id">v</span> :: <span class="id">vs</span>))) <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> <span class="kwd">in</span> <span class="id">Hgt</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_irrefl">Rlt_irrefl</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span> + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>)%<span class="id">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">Hin0</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span>. <span class="id">exists</span> (<span class="id">c1</span>, <span class="id">v0</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v0</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb_exists">existsb_exists</a></span>. <span class="id">exists</span> (<span class="id">c2</span>, <span class="id">v0</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">Heqv</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v0</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">right</span>; <span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">msg</span> <span class="id">Hinm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinm</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hinm</span>]; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="no_local_confluence_prot_state_light">no_local_confluence_prot_state_light</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">a</span> <span class="id">a1</span> <span class="id">a2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">a</span> <span class="id">a1</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">a</span> <span class="id">a2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">exists</span> (<span class="id">a</span>' : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">a1</span> <span class="id">a</span>' /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">a2</span> <span class="id">a</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof247')">Proof.</div>
<div class="proofscript" id="proof247">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#non_triviality_decisions_on_properties_of_protocol_states">non_triviality_decisions_on_properties_of_protocol_states</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">P</span> [[<span class="id">ps1</span> <span class="id">about_ps1</span>] [<span class="id">ps2</span> <span class="id">about_ps2</span>]]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state0">state0</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nil">protocol_state_nil</a></span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">ps1</span>, <span class="id">ps2</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> (<span class="tactic">red</span>; <span class="tactic">simpl</span>; <span class="id">easy</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Habsurd</span>. <span class="tactic">destruct</span> <span class="id">Habsurd</span> <span class="kwd">as</span> [<span class="id">s</span> [<span class="id">Hs1</span> <span class="id">Hs2</span>]].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">about_ps1</span> <span class="id">s</span> <span class="id">Hs1</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">about_ps2</span> <span class="id">s</span> <span class="id">Hs2</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_light_eq_dec">pstate_light_eq_dec</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">p1</span> <span class="id">p2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), {<span class="id">p1</span> = <span class="id">p2</span>} + {<span class="id">p1</span> &lt;&gt; <span class="id">p2</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof248')">Proof.</div>
<div class="proofscript" id="proof248">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">p1</span> <span class="id">p2</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">sigify_eq_dec</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_light_inhabited">pstate_light_inhabited</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">p1</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof249')">Proof.</div>
<div class="proofscript" id="proof249">
 <span class="id">now</span> <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state0">state0</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nil">protocol_state_nil</a></span>). Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_light_rel_refl">pstate_light_rel_refl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Reflexive">Reflexive</a></span> (@<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">PS</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof250')">Proof.</div>
<div class="proofscript" id="proof250">
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intro</span> <span class="id">p</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> [<span class="id">p</span> <span class="id">about_p</span>].<br/>
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">simpl</span>. <span class="id">easy</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pstate_light_rel_trans">pstate_light_rel_trans</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Classes.RelationClasses.html#Transitive">Transitive</a></span> (@<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">PS</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof251')">Proof.</div>
<div class="proofscript" id="proof251">
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">p1</span> <span class="id">p2</span> <span class="id">p3</span> <span class="id">H_12</span> <span class="id">H_23</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p1</span> <span class="kwd">as</span> [<span class="id">p1</span> <span class="id">about_p1</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p2</span> <span class="kwd">as</span> [<span class="id">p2</span> <span class="id">about_p2</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p3</span> <span class="kwd">as</span> [<span class="id">p3</span> <span class="id">about_p3</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.Protocol.html#pstate_rel">pstate_rel</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">eapply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> <span class="id">p2</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="level0_light">level0_light</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Protocol.html#PartialOrder">PartialOrder</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id"><a href="CasperCBC.CBC.Protocol.html#A_eq_dec">A_eq_dec</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_eq_dec">pstate_light_eq_dec</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_inhabited">A_inhabited</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_inhabited">pstate_light_inhabited</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_rel">A_rel</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel">pstate_light_rel</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_rel_refl">A_rel_refl</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel_refl">pstate_light_rel_refl</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.Protocol.html#A_rel_trans">A_rel_trans</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light_rel_trans">pstate_light_rel_trans</a></span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="level1_light">level1_light</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.CBC.Protocol.html#PartialOrderNonLCish">PartialOrderNonLCish</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id"><a href="CasperCBC.CBC.Protocol.html#no_local_confluence_ish">no_local_confluence_ish</a></span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#no_local_confluence_prot_state_light">no_local_confluence_prot_state_light</a></span>; }.<br/>
<br/>
<div class="doc">Strong non-triviality *</div>
<span class="kwd">Definition</span> <span class="id"><a name="in_future">in_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s1</span> <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="next_future">next_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id">set_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id">compare_eq_dec</span> <span class="id">msg</span> <span class="id">s1</span>) <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="in_past">in_past</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s2</span> <span class="id">s1</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="no_common_future">no_common_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id"><a href="CasperCBC.CBC.LightNode.html#in_future">in_future</a></span> <span class="id">s1</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#in_future">in_future</a></span> <span class="id">s2</span> <span class="id">s</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="yes_common_future">yes_common_future</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>), <span class="id"><a href="CasperCBC.CBC.LightNode.html#in_future">in_future</a></span> <span class="id">s1</span> <span class="id">s</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#in_future">in_future</a></span> <span class="id">s2</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="strong_nontriviality">strong_nontriviality</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;`{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s1</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_future">next_future</a></span> <span class="id">s1</span> <span class="id">s2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#pstate_light">pstate_light</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#yes_common_future">yes_common_future</a></span> <span class="id">s1</span> <span class="id">s3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#no_common_future">no_common_future</a></span> <span class="id">s2</span> <span class="id">s3</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages">about_equivocating_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof252')">Proof.</div>
<div class="proofscript" id="proof252">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">about_j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_injective">hash_state_injective</a></span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H2</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) <span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="tactic">intros</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">H_neq</span>. <span class="id">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span> <span class="kwd">in</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_extx_in_x">not_extx_in_x</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) <span class="id">v</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>) <span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>.  }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">about_j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_in">hash_state_in</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="next_equivocation_state">next_equivocation_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">j</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_incl">next_equivocation_state_incl</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof253')">Proof.</div>
<div class="proofscript" id="proof253">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 3 <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_keeps_messages">next_equivocation_state_keeps_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>) (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof254')">Proof.</div>
<div class="proofscript" id="proof254">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_keeps_equivocators">next_equivocation_state_keeps_equivocators</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' <span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof255')">Proof.</div>
<div class="proofscript" id="proof255">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_incl</span> := @<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_incl">equivocating_senders_incl</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_incl</span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">H_incl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_state_keeps_equivocating_messages">next_equivocation_state_keeps_equivocating_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>) (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof256')">Proof.</div>
<div class="proofscript" id="proof256">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_incl</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_incl">equivocating_in_state_incl</a></span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_incl</span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">H_incl</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages_in_state_l">about_equivocating_messages_in_state_l</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof257')">Proof.</div>
<div class="proofscript" id="proof257">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">about_j</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages_in_state_r">about_equivocating_messages_in_state_r</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof258')">Proof.</div>
<div class="proofscript" id="proof258">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">about_j</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="about_equivocating_messages_add_equivocator">about_equivocating_messages_add_equivocator</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof259')">Proof.</div>
<div class="proofscript" id="proof259">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">about_j</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages_in_state_l">about_equivocating_messages_in_state_l</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s</span>) :: <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof260')">Proof.</div>
<div class="proofscript" id="proof260">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_extend">equivocating_senders_extend</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s</span>) <span class="id">v</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">set_eq_tran</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof261')">Proof.</div>
<div class="proofscript" id="proof261">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">H_eq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#set_eq_nodup_sum_weight_eq">set_eq_nodup_sum_weight_eq</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_weight_one">add_weight_one</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>} `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">j</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof262')">Proof.</div>
<div class="proofscript" id="proof262">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_weight_two">add_weight_two</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Measurable">Measurable</a></span> <span class="id">V</span>} `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof263')">Proof.</div>
<div class="proofscript" id="proof263">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_already_equivocating_sender">add_already_equivocating_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">msg</span> :: <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof264')">Proof.</div>
<div class="proofscript" id="proof264">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">v</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_v_in</span> <span class="id">H_msg</span>'<span class="id">_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_msg</span>'<span class="id">_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> <span class="id">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_v_in</span> <span class="id">H_msg</span>'<span class="id">_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span> <span class="kwd">as</span> [<span class="id">H_v_in</span> <span class="id">H_equiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> [<span class="id">H_msg</span>'<span class="id">_partner_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_msg</span>'<span class="id">_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.  <span class="tactic">destruct</span> <span class="id">H_msg</span>'<span class="id">_partner_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">destruct</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">msg</span> :: <span class="id">s</span>)) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">v</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span> /\ <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_prop">equivocating_in_state_prop</a></span> <span class="id">msg</span> <span class="id">s</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof265')">Proof.</div>
<div class="proofscript" id="proof265">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">msg</span> <span class="id">v</span>. <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;-  <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> [<span class="id">H_sender</span> <span class="id">H_equiv</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_eq</span> | <span class="id">H_noteq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg_partner</span> [<span class="id">H_msg_partner</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">split</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg_partner</span>. <span class="tactic">subst</span>. <span class="tactic">inversion</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> [<span class="id">H_msg</span>'<span class="id">_partner</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_msg</span>'<span class="id">_partner</span> <span class="kwd">as</span> [<span class="id">H_eq</span>' | <span class="id">H_noteq</span>'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">destruct</span> <span class="id">H_equiv</span>. <span class="tactic">split</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>. <span class="tactic">split</span>. <span class="id">easy</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>. <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span>. <span class="tactic">split</span>. <span class="tactic">subst</span>; <span class="tactic">symmetry</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[<span class="id">H_sender</span> <span class="id">H_equiv</span>] | <span class="id">H_noteq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_equiv</span> <span class="kwd">as</span> [<span class="id">msg_partner</span> [<span class="id">H_msg_partner</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">destruct</span> <span class="id">H_equiv</span>. <span class="tactic">symmetry</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>. <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">set_map_exists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_noteq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_noteq</span> <span class="kwd">as</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg</span>'<span class="id">_partner</span> <span class="id">about_msg</span>'<span class="id">_partner</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'<span class="id">_partner</span>. <span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">right</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_equivocating_sender">add_equivocating_sender</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">msg</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span>' <span class="id">s</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> <span class="id">msg</span> <span class="id">msg</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">msg</span> :: <span class="id">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id">compare_eq_dec</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof266')">Proof.</div>
<div class="proofscript" id="proof266">
&nbsp;&nbsp;<span class="comment">(*&nbsp;Because&nbsp;we're&nbsp;using&nbsp;set_add,&nbsp;we&nbsp;don't&nbsp;need&nbsp;to&nbsp;care&nbsp;about&nbsp;whether&nbsp;(sender&nbsp;msg)&nbsp;is&nbsp;already&nbsp;in&nbsp;(equivocating_senders&nbsp;s)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">msg</span> [<span class="id">msg</span>' [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> <span class="id">s</span>)) <span class="kwd">as</span> [<span class="id">H_msg_in</span> | <span class="id">H_msg_out</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;msg&nbsp;is&nbsp;already&nbsp;in&nbsp;s,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Adding&nbsp;it&nbsp;does&nbsp;nothing&nbsp;to&nbsp;the&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_ignore</span> := <span class="id">set_add_ignore</span> <span class="id">s</span> <span class="id">msg</span> <span class="id">H_msg_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> &lt;- <span class="id">H_ignore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Adding&nbsp;the&nbsp;sender&nbsp;should&nbsp;do&nbsp;nothing&nbsp;to&nbsp;(equivocating_senders&nbsp;s)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;following&nbsp;is&nbsp;winding&nbsp;and&nbsp;painful&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="kwd">in</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_mem</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H0_in</span> <span class="id">H0_sender</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H0_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_senders</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H_senders</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0_in</span> <span class="kwd">as</span> [<span class="id">H0_in</span> <span class="id">H0_equiv</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">msg</span> = <span class="id">msg0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">H0_in</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H0_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_ignore</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H0_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0_equiv</span> <span class="kwd">as</span> [<span class="id">msg0_partner</span> [<span class="id">H0_equivl</span> <span class="id">H0_equivr</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0_equivl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0_equivr</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_senders</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_senders</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>. <span class="tactic">assumption</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H0_equivr</span>; <span class="tactic">symmetry</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop_swap">equivocating_messages_prop_swap</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;following&nbsp;will&nbsp;also&nbsp;be&nbsp;winding&nbsp;and&nbsp;painful&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v0</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>'. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">rewrite</span> <span class="id">H_ignore</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. <span class="tactic">rewrite</span> <span class="id">H_ignore</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_goal</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_incl">equivocating_senders_incl</a></span> <span class="id">s</span> (<span class="id">msg</span> :: <span class="id">s</span>)). <span class="id">spec</span> <span class="id">H_goal</span>. <span class="id">right</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id">H_goal</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;msg&nbsp;is&nbsp;not&nbsp;already&nbsp;in&nbsp;s,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;all&nbsp;we&nbsp;know&nbsp;(sender&nbsp;msg)&nbsp;could&nbsp;already&nbsp;be&nbsp;in&nbsp;(equivocating_senders&nbsp;s)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;(sender&nbsp;msg)&nbsp;is&nbsp;already&nbsp;in&nbsp;there,&nbsp;then&nbsp;adding&nbsp;it&nbsp;again&nbsp;does&nbsp;nothing&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_ignore</span> : <span class="id">set_eq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id">compare_eq_dec</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">v</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_v_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>. <span class="id">right</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span> <span class="kwd">in</span> <span class="id">H_ignore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">set_eq_tran</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">exact</span> <span class="id">H_ignore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_already_equivocating_sender">add_already_equivocating_sender</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;(sender&nbsp;msg)&nbsp;is&nbsp;not&nbsp;already&nbsp;in&nbsp;there&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v0</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">msg</span> <span class="kwd">as</span> [[<span class="id">c</span> <span class="id">v</span>] <span class="id">j</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Classical_Prop.html#classic">classic</a></span> (<span class="id">v0</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> <span class="id">msg</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> <span class="id">msg</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span> <span class="kwd">in</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">msg0</span> [<span class="id">H_in0</span> <span class="id">H_sender0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_exists</span>. <span class="id">exists</span> <span class="id">msg0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. 2 : <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span> <span class="kwd">in</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_in_state_correct">equivocating_in_state_correct</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">msg0_partner</span> [<span class="id">H_in0</span> <span class="id">H_equiv0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg0_partner</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="add_weight_three">add_weight_three</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof267')">Proof.</div>
<div class="proofscript" id="proof267">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">about_j</span> <span class="id">H_notin</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := @<span class="id"><a href="CasperCBC.CBC.LightNode.html#add_equivocating_sender">add_equivocating_sender</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) :: ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">set_remove_first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>. <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nodup">protocol_state_nodup</a></span> <span class="kwd">in</span> <span class="id">about_j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_one">add_weight_one</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>) <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span> .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages">about_equivocating_messages</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_inter</span> := <span class="id"><a href="CasperCBC.CBC.Common.html#senders_fault_weight_eq">senders_fault_weight_eq</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)))) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id">compare_eq_dec</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#sender">sender</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>))))).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_inter</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">clear</span> <span class="id">H_inter</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_rewrite</span> := <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_in">sum_weights_in</a></span> <span class="id">v</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add">set_add</a></span> <span class="id">compare_eq_dec</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) ::<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)))).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_nodup">set_add_nodup</a></span>. <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_rewrite</span>. <span class="tactic">clear</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_eq_compat_r">Rplus_eq_compat_r</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">add_remove_inverse</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := @<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span>' := <span class="id">H_useful</span>).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">j</span> <span class="id">v</span>'.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>' ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>) <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_tran</span> := <span class="id">set_eq_tran</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H_useful</span> <span class="id">H_useful</span>').<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_useful</span> <span class="id">H_useful</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_tran</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_eq</span>].<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_eq</span> <span class="id">v</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="add_weight_under">add_weight_under</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}  `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>} `{<span class="id">Hrt</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#ReachableThreshold">ReachableThreshold</a></span> <span class="id">V</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">v</span> : <span class="id">V</span>) :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> <span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">j</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof268')">Proof.</div>
<div class="proofscript" id="proof268">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">about_j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_notin</span> <span class="id">about_v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_three">add_weight_three</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_two">add_weight_two</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_one">add_weight_one</a></span>; <span class="id">easy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="next_equivocation_protocol_state">next_equivocation_protocol_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">j</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">j</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">j</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_under">add_weight_under</a></span> <span class="id">j</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof269')">Proof.</div>
<div class="proofscript" id="proof269">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">j</span> <span class="id">about_j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_notin</span> <span class="id">H_neq</span> <span class="id">H_weight</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages">about_equivocating_messages</a></span> <span class="id">j</span> <span class="id">about_j</span> <span class="id">v</span> <span class="id">v</span>' <span class="id">H_neq</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_useful</span> <span class="kwd">as</span> [<span class="id">H2_noteq</span> [<span class="id">H2_sender</span> [<span class="id">H2_left</span> <span class="id">H2_right</span>]]].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Peeling&nbsp;first&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> <span class="id">j</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>) <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">about_j</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">set_remove_first</span>. 2 : <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_cons">protocol_state_cons</a></span> <span class="kwd">with</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>) (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)) <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">set_remove_first</span>. 2 : <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nodup">protocol_state_nodup</a></span> <span class="kwd">in</span> <span class="id">about_j</span>.<br/>
&nbsp;&nbsp;2 : <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;2 : { <span class="tactic">intros</span> <span class="id">H_or</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_inv">in_inv</a></span> <span class="kwd">in</span> <span class="id">H_or</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_or</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state_injective">hash_state_injective</a></span> <span class="kwd">in</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H2</span>. <span class="id">spec</span> <span class="id">H0</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H0</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self_relaxed">not_in_self_relaxed</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">auto</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H0</span>. <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span> <span class="kwd">in</span> <span class="id">H0</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_two">add_weight_two</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_one">add_weight_one</a></span> <span class="kwd">with</span> <span class="id">j</span> <span class="id">v</span>'.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">about_j</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#not_in_self">not_in_self</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nodup">protocol_state_nodup</a></span> <span class="kwd">in</span> <span class="id">about_j</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>), <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">j</span>, <span class="id">v</span>', <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">j</span>) :: <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">j</span> <span class="id">v</span> <span class="id">v</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_adds_weight">next_equivocation_adds_weight</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_under">add_weight_under</a></span> <span class="id">s</span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span>' : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">v</span> <span class="id">v</span>') /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">v</span> <span class="id">v</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof270')">Proof.</div>
<div class="proofscript" id="proof270">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">v</span> <span class="id">H_not_heavy</span> <span class="id">H_notin</span> <span class="id">v</span>' <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_protocol_state">next_equivocation_protocol_state</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span>; <span class="id">easy</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">next_equivocation_rec</span>'<br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>) : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">vs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id">hd</span> :: <span class="id">tl</span> =&gt; <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>) <span class="id">hd</span> <span class="id">v0</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_keeps_messages">next_equivocations_keeps_messages</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">msg</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">msg</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof271')">Proof.</div>
<div class="proofscript" id="proof271">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span> <span class="id">msg</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state_keeps_messages">next_equivocation_state_keeps_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_keeps_equivocating_senders">next_equivocations_keeps_equivocating_senders</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmh</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#MessageHash">MessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof272')">Proof.</div>
<div class="proofscript" id="proof272">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span>; <span class="id">right</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocation_equivocating_sender_cons">next_equivocation_equivocating_sender_cons</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">hd</span> : <span class="id">V</span>) (<span class="id">v0</span> <span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> &lt;&gt; <span class="id">v0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="id">s</span> <span class="id">hd</span> <span class="id">v0</span>)) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">v</span> = <span class="id">hd</span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof273')">Proof.</div>
<div class="proofscript" id="proof273">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">hd</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages_add_equivocator">about_equivocating_messages_add_equivocator</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">msg</span> [<span class="id">H_in</span> [<span class="id">H_sender</span> <span class="id">H_equiv</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">msg</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span>; <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state_keeps_equivocating_messages">next_equivocation_state_keeps_equivocating_messages</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_equivocating_senders_right">next_equivocations_equivocating_senders_right</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hsc3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#StrictlyComparable3">StrictlyComparable3</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hmhi</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#InjectiveMessageHash">InjectiveMessageHash</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#message">message</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">hash</span>}  `{<span class="id">He</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#Estimator">Estimator</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) <span class="id">C</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> <span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; <span class="id">v</span> &lt;&gt; <span class="id">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> \/ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof274')">Proof.</div>
<div class="proofscript" id="proof274">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span>; <span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>]; <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_neq</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span> <span class="id">v0</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_neq</span>. <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[ ? ? ] | ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">simpl</span>. <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[ ? ? ] | ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_sender_add_in_sorted_iff">equivocating_sender_add_in_sorted_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [[ ? ? ] | ?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;H0&nbsp;must&nbsp;be&nbsp;false.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">msg_absurd</span> [<span class="id">H_in</span> <span class="id">H_equiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_contra</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#non_equivocating_messages_extend">non_equivocating_messages_extend</a></span> <span class="id">msg_absurd</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>) (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)) <span class="id">v0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_contra</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_correct">equivocating_messages_correct</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_comm">equivocating_messages_comm</a></span> <span class="kwd">in</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_equiv</span> <span class="kwd">in</span> <span class="id">H_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_cons">in_cons</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_equivocating_senders_left_weak">next_equivocations_equivocating_senders_left_weak</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> <span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; <span class="id">v</span> &lt;&gt; <span class="id">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof275')">Proof.</div>
<div class="proofscript" id="proof275">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">vs</span>; <span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>]; <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">v</span> <span class="id">H_prot</span> <span class="id">H_neq</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">H_prot_sub</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_incl">protocol_state_incl</a></span> <span class="kwd">with</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> (<span class="id">hd</span> :: <span class="id">tl</span>) <span class="id">v0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_nodup">protocol_state_nodup</a></span> <span class="kwd">in</span> <span class="id">H_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> <span class="kwd">in</span> <span class="id">H_prot</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 3 (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H_prot</span>; <span class="tactic">destruct</span> <span class="id">H_prot</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_prot</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">msg</span> <span class="id">H_in_msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">repeat</span> <span class="id">right</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span> <span class="id">v0</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span> <span class="id">H_prot_sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H_neq</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Case&nbsp;analysis&nbsp;on&nbsp;where&nbsp;v&nbsp;is&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">H_eq</span> | <span class="id">H_in</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;When&nbsp;we&nbsp;are&nbsp;looking&nbsp;at&nbsp;the&nbsp;hd&nbsp;element,&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages_add_equivocator">about_equivocating_messages_add_equivocator</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">apply</span> <span class="id">H_neq</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">spec</span> <span class="id">IHvs</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := @<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_incl">equivocating_senders_incl</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state">next_equivocation_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span>) <span class="id">hd</span> <span class="id">v0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_state_incl">next_equivocation_state_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_useful</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="next_equivocations_add_weights">next_equivocations_add_weights</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>) (<span class="id">v0</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) /\ <span class="id">v</span> &lt;&gt; <span class="id">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s</span> <span class="id">vs</span> <span class="id">v0</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>)%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof276')">Proof.</div>
<div class="proofscript" id="proof276">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span> <span class="id">vs</span> <span class="id">v0</span> <span class="id">H_nodup</span> <span class="id">H_underweight</span> <span class="id">H_disjoint</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">vs</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHvs</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Base&nbsp;case&nbsp;:&nbsp;no&nbsp;validators&nbsp;to&nbsp;add&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Induction&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;first&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H_nodup</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;second&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_le_reg_pos_r">Rplus_le_reg_pos_r</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span> + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">tl</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">hd</span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">hd</span>). <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">tl</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">hd</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Discharging&nbsp;third&nbsp;premise&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHvs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">v</span>. <span class="id">spec</span> <span class="id">H_disjoint</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHvs</span> <span class="kwd">as</span> [<span class="id">H_prot</span> <span class="id">H_weight</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">hd</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span> <span class="id">hd</span> <span class="id">tl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_notin_tl</span> : ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">hd</span> <span class="id">tl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons_iff">NoDup_cons_iff</a></span> <span class="kwd">in</span> <span class="id">H_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_disjoint</span> <span class="kwd">as</span> [<span class="id">H_disjoint</span> <span class="id">H_neq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_rewrite</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocations_equivocating_senders_right">next_equivocations_equivocating_senders_right</a></span> <span class="id">s</span> <span class="id">tl</span> <span class="id">v0</span> <span class="id">hd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocation_protocol_state">next_equivocation_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_rewrite</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Need&nbsp;a&nbsp;helper&nbsp;lemma&nbsp;about&nbsp;weight&nbsp;adding&nbsp;here&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_under">add_weight_under</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_weight</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">H_underweight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">tl</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">hd</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">hd</span>)) (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">tl</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">H_weight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocation_adds_fault_weight">equivocation_adds_fault_weight</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="id">spec</span> <span class="id">H_rewrite</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="potentially_pivotal_state">potentially_pivotal_state</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id">V</span>) (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>) :=<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) /\<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">vs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">v</span> : <span class="id">V</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> <span class="id">vs</span> -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> ((<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) ++ <span class="id">vs</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> ((<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) ++ <span class="id">vs</span>) &gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>))%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="all_pivotal_validator">all_pivotal_validator</a></span><br/>
&nbsp;&nbsp;{<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>} `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>}<br/>
&nbsp;&nbsp;: <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#state">state</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">v</span> : <span class="id">V</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#potentially_pivotal_state">potentially_pivotal_state</a></span> <span class="id">v</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof277')">Proof.</div>
<div class="proofscript" id="proof277">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.CBC.Protocol.html#suff_val">suff_val</a></span> <span class="kwd">as</span> [<span class="id">vs</span> [<span class="id">Hvs</span> <span class="id">Hweight</span>]].<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>) <span class="kwd">as</span> <span class="id">eqv_s</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff">set_diff</a></span> <span class="id">compare_eq_dec</span> <span class="id">vs</span> <span class="id">eqv_s</span>) <span class="kwd">as</span> <span class="id">vss</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id">vss</span> ++ <span class="id">eqv_s</span>) &gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_gt_trans">Rge_gt_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_ge">Rle_ge</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heqvss</span>. <span class="tactic">apply</span> <span class="id">diff_app_nodup</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span>. <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">Heqvss</span>. <span class="tactic">intros</span> <span class="id">a</span> <span class="id">Hin</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff_iff">set_diff_iff</a></span>. <span class="tactic">apply</span> <span class="id">or_and_distr_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id">compare_eq_dec</span> <span class="id">a</span> <span class="id">eqv_s</span>); (<span class="id">left</span>; <span class="tactic">assumption</span>) || (<span class="id">right</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#pivotal_validator_extension">pivotal_validator_extension</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">vs</span>' [<span class="id">Hnodup_vs</span>' [<span class="id">Hincl_vs</span>' [<span class="id">Hgt</span> [<span class="id">v</span> [<span class="id">Hin_v</span> <span class="id">Hlt</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">v</span>. <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">Hincl_vs</span>' <span class="kwd">in</span> <span class="id">Hin_v</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff_elim2">set_diff_elim2</a></span> <span class="kwd">in</span> <span class="id">Hin_v</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> <span class="id">v</span> <span class="id">vs</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove">set_remove</a></span> <span class="id">compare_eq_dec</span> <span class="id">v</span> <span class="id">vs</span>')) <span class="kwd">as</span> <span class="id">Hnodup_remove</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_nodup">set_remove_nodup</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">set_remove_elim</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_remove_1">set_remove_1</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">Hincl_vs</span>' <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_diff_elim2">set_diff_elim2</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_app">sum_weights_app</a></span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> <span class="kwd">in</span> <span class="id">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rlt_gt">Rlt_gt</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_lt_reg_r">Rplus_lt_reg_r</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rminus">Rminus</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_opp_l">Rplus_opp_l</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_0_r">Rplus_0_r</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_lt">Rgt_lt</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_gt_trans">Rge_gt_trans</a></span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id">vs</span>' ++ <span class="id">eqv_s</span>)); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#Rge">Rge</a></span>. <span class="id">right</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_app">sum_weights_app</a></span>. <span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_comm">Rplus_comm</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>))) .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_app">sum_weights_app</a></span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_eq_compat_r">Rplus_eq_compat_r</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_in">sum_weights_in</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">diff_app_nodup</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="strong_nontriviality_full">strong_nontriviality_full</a></span><br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">V</span> <span class="id">hash</span> : <span class="kwd">Type</span>) `{<span class="id">PS</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#ProtocolState">ProtocolState</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>} `{<span class="id">Hit</span> : <span class="id"><a href="CasperCBC.CBC.Common.html#InhabitedTwice">InhabitedTwice</a></span> <span class="id">V</span>}<br/>
&nbsp;: <span class="id"><a href="CasperCBC.CBC.LightNode.html#strong_nontriviality">strong_nontriviality</a></span> <span class="id">C</span> <span class="id">V</span> <span class="id">hash</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof278')">Proof.</div>
<div class="proofscript" id="proof278">
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">s1</span> <span class="id">about_s1</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#all_pivotal_validator">all_pivotal_validator</a></span> <span class="id">s1</span> <span class="id">about_s1</span>) <span class="kwd">as</span> [<span class="id">v</span> [<span class="id">H_v</span> [<span class="id">vs</span> [<span class="id">H_nodup</span> [<span class="id">H_v_notin</span> [<span class="id">H_disjoint</span> [<span class="id">H_under</span> <span class="id">H_over</span>]]]]]]].<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span> <span class="id">s1</span> <span class="id">about_s1</span>  <span class="id">v</span>)) <span class="kwd">as</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Book-keeping&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s1_s2_senders</span> : <span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>))) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s1_s2_weight</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span> = <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>)) <span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#add_weight_one">add_weight_one</a></span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">s2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Proving&nbsp;next-step&nbsp;relation&nbsp;is&nbsp;trivial.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>); <span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span> <span class="kwd">in</span> <span class="id">H_in</span>. <span class="tactic">destruct</span> <span class="id">H_in</span>. <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H_in</span>; <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_add_iff">set_add_iff</a></span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;s3&nbsp;is&nbsp;the&nbsp;state&nbsp;with&nbsp;equivocations&nbsp;from&nbsp;all&nbsp;the&nbsp;senders&nbsp;in&nbsp;vs&nbsp;recursively&nbsp;added&nbsp;to&nbsp;s1,&nbsp;in&nbsp;addition&nbsp;to&nbsp;(c,v,s1)'s&nbsp;equivocating&nbsp;partner&nbsp;message.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;we&nbsp;add&nbsp;the&nbsp;equivocating&nbsp;partner&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">remember</span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>)) :: ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>)) <span class="kwd">as</span> <span class="id">s1</span>'.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Book-keeping&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_eq_senders</span> : <span class="id">set_eq</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>') (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s1</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_useful</span> := <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>) <span class="id">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">set_eq_tran</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>. <span class="tactic">exact</span> <span class="id">H_useful</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_eq_comm</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_sorted_extend">equivocating_senders_sorted_extend</a></span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s_inter_weight</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span>' = <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s1</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_fault_weight_eq">equivocating_senders_fault_weight_eq</a></span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;are&nbsp;ready&nbsp;to&nbsp;construct&nbsp;s3&nbsp;from&nbsp;s1'&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;And&nbsp;if&nbsp;we&nbsp;have&nbsp;set&nbsp;up&nbsp;everything&nbsp;correctly,&nbsp;the&nbsp;premises&nbsp;at&nbsp;this&nbsp;point&nbsp;in&nbsp;the&nbsp;proof&nbsp;are&nbsp;sufficient.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">next_equivocation_rec</span>' <span class="id">s1</span>' <span class="id">vs</span> <span class="id">v</span>) <span class="kwd">as</span> <span class="id">s3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">about_s3</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s3</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">rewrite</span> <span class="id">Heqs3</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocations_add_weights">next_equivocations_add_weights</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#copy_protocol_state">copy_protocol_state</a></span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate_correct">get_estimate_correct</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_s_inter_weight</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_app">sum_weights_app</a></span> <span class="kwd">in</span> <span class="id">H_under</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">v0</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_eq_senders</span> <span class="kwd">as</span> [<span class="id">H_left</span> <span class="id">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_right</span> <span class="id">v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="id">spec</span> <span class="id">H_left</span> <span class="id">v0</span> <span class="id">H_absurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>. <span class="tactic">intro</span> <span class="id">H_absurd</span>. <span class="tactic">subst</span>. <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s3</span> <span class="id">about_s3</span>).<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;s1&nbsp;and&nbsp;s3&nbsp;share&nbsp;a&nbsp;common&nbsp;future&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state">protocol_state</a></span> <span class="id">s3</span> <span class="id">about_s3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">simpl</span>. <span class="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">m0</span> <span class="id">H_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Need&nbsp;to&nbsp;prove&nbsp;that&nbsp;next_equivocation_rec'&nbsp;doesn't&nbsp;drop&nbsp;messages&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocations_keeps_messages">next_equivocations_keeps_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;s2&nbsp;and&nbsp;s3&nbsp;don't&nbsp;share&nbsp;a&nbsp;common&nbsp;future&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Arbitrary&nbsp;state&nbsp;in&nbsp;both&nbsp;s2&nbsp;and&nbsp;s3&nbsp;leads&nbsp;to&nbsp;a&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>. <span class="tactic">intros</span> [<span class="id">s</span> <span class="id">about_s</span>] <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">H_in2</span> <span class="id">H_in3</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_in2_copy</span> := <span class="id">H_in2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_in3_copy</span> := <span class="id">H_in3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;show&nbsp;that&nbsp;two&nbsp;equivocating&nbsp;messages&nbsp;are&nbsp;in&nbsp;s&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in2</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_eq">in_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Second&nbsp;message&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in3</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>), <span class="id">v</span>,<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) ::  <span class="id">s1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_in3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proving&nbsp;that&nbsp;this&nbsp;message&nbsp;is&nbsp;in&nbsp;s3&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_obv</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) ::  <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) ::  <span class="id">s1</span>)) <span class="id">s1</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocations_keeps_messages">next_equivocations_keeps_messages</a></span> <span class="id">s1</span>' <span class="id">vs</span> <span class="id">v</span>) <span class="kwd">in</span> <span class="id">H_obv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;prove&nbsp;that&nbsp;these&nbsp;two&nbsp;messages&nbsp;are&nbsp;equivocating&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_equiv</span> : <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_messages_prop">equivocating_messages_prop</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>,<span class="id">v</span>,<span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#about_equivocating_messages">about_equivocating_messages</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender_correct">get_distinct_sender_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;say&nbsp;that&nbsp;v&nbsp;will&nbsp;be&nbsp;an&nbsp;equivocating&nbsp;sender&nbsp;inside&nbsp;s&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_v_in</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_correct">equivocating_senders_correct</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> ((<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>), <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> ( (<span class="id"><a href="CasperCBC.CBC.Common.html#get_estimate">get_estimate</a></span> <span class="id">s1</span>, <span class="id"><a href="CasperCBC.CBC.Common.html#get_distinct_sender">get_distinct_sender</a></span> <span class="id">v</span>, <span class="id"><a href="CasperCBC.CBC.LightNode.html#hash_state">hash_state</a></span> <span class="id">s1</span>) :: <span class="id">s1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">assumption</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">H_in2</span> <span class="id">H_in3</span> <span class="id">H_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;say&nbsp;that&nbsp;v's&nbsp;weight&nbsp;will&nbsp;be&nbsp;inside&nbsp;s's&nbsp;fault&nbsp;weight&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;part&nbsp;is&nbsp;a&nbsp;little&nbsp;tricky&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_equivocators_s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id">v</span> :: (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>) ++ <span class="id">vs</span>)) (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">v0</span> <span class="id">H_in0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in0</span> <span class="kwd">as</span> [<span class="id">H_hd</span> | <span class="id">H_tl</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H_tl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_tl</span> <span class="kwd">as</span> [<span class="id">H_left</span> | <span class="id">H_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_incl">equivocating_senders_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H_in2_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assert</span> (<span class="id">H_in_v0</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">v0</span> (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id">next_equivocation_rec</span>' <span class="id">s1</span>' <span class="id">vs</span> <span class="id">v</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#next_equivocations_equivocating_senders_left_weak">next_equivocations_equivocating_senders_left_weak</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">assumption</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H_absurd</span>; <span class="tactic">subst</span>; <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heqs3</span> <span class="kwd">in</span> <span class="id">H_in_v0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders_incl">equivocating_senders_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">H_in3_copy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_s_overweight</span> : (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>) + <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>) + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span> &lt;= <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="id">s</span>)%<span class="id">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">replace</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>) + <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>) + <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> <span class="id">vs</span>))%<span class="id">R</span> <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights">sum_weights</a></span> ([<span class="id">v</span>] ++ (<span class="id"><a href="CasperCBC.CBC.LightNode.html#equivocating_senders">equivocating_senders</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s2</span>)) ++ <span class="id">vs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_incl">sum_weights_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proving&nbsp;mutual&nbsp;NoDup&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nodup_append</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_cons">NoDup_cons</a></span>. <span class="tactic">intros</span>; <span class="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">nodup_append</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">a</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">H</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>. <span class="id">spec</span> <span class="id">H_disjoint</span> <span class="id">a</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">Habsurd</span>. <span class="id">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Habsurd</span>. <span class="tactic">destruct</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">inversion</span> <span class="id">H0</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">intro</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Habsurd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_s1_s2_senders</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">H_useful</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">H_useful</span> <span class="id">a</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">subst</span>; <span class="id">contradiction</span>. <span class="tactic">inversion</span> <span class="id">H0</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">set_map_nodup</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_app">sum_weights_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">ring</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#protocol_state_not_heavy">protocol_state_not_heavy</a></span> <span class="kwd">in</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">about_s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H_finale</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H_s_overweight</span> <span class="id">about_s</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">H_finale</span> <span class="id">H_over</span> <span class="id">H_s1_s2_weight</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.CBC.Common.html#sum_weights_app">sum_weights_app</a></span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.CBC.LightNode.html#fault_weight_state">fault_weight_state</a></span> <span class="kwd">in</span> <span class="id">H_s1_s2_weight</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H_s1_s2_weight</span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rplus_gt_compat_l">Rplus_gt_compat_l</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>))) <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>) + (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span> - <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.CBC.Common.html#weight">weight</a></span> <span class="id">v</span>)))%<span class="id">R</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.CBC.Common.html#threshold">threshold</a></span>)%<span class="id">R</span> <span class="kwd">in</span> <span class="id">H_over</span> <span class="tactic">by</span> <span class="tactic">ring</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Raxioms.html#Rplus_assoc">Rplus_assoc</a></span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rgt_not_le">Rgt_not_le</a></span> <span class="kwd">in</span> <span class="id">H_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
