
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.VLSM.ObservableEquivocation</title>
<meta name="description" content="Documentation of Coq module CasperCBC.VLSM.ObservableEquivocation" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.VLSM.ObservableEquivocation</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html">FinFun</a></span><br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.Reals.html">Reals</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Preamble</span> <span class="id">ListExtras</span> <span class="id">ListSetExtras</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Lib.Classes</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">CBC.Common</span> <span class="id">CBC.Equivocation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html">VLSM.Common</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html">VLSM.Composition</a></span> <span class="id"><a href="CasperCBC.VLSM.Equivocation.html">VLSM.Equivocation</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ProjectionTraces.html">VLSM.ProjectionTraces</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<h1> Observable equivocation
In this section we define a notion of equivocation based on observations.
This approach is based on the intuition that a participant to the protocol
stores in its state knowledge about validators, obtained either directly or
through third parties.
We will consider this items of knowledge to be abstract objects of a
type &lt;&lt;event&gt;&gt;.
</h1>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="observable_events">observable_events</a></span><br/>
&nbsp;&nbsp;(<span class="id">state</span> <span class="id">event</span> : <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="has_been_observed">has_been_observed</a></span> : <span class="id">state</span> -&gt; <span class="id">event</span> -&gt; <span class="kwd">Prop</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="has_been_observed_dec">has_been_observed_dec</a></span> : <span class="id">RelDecision</span> <span class="id">has_been_observed</span>;<br/>
&nbsp;&nbsp;}.<br/>
<span class="kwd">Hint</span> <span class="id">Mode</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> ! ! : <span class="id">typeclass_instances</span>.<br/>
<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;(<span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;(<span class="id">state_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">state</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">event_eq</span> : <span class="id">EqDecision</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">happens_before</span> : <span class="id">event</span> -&gt; <span class="id">event</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">happens_before_dec</span> : <span class="id">RelDecision</span> <span class="id">happens_before</span>)<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">equivocation_evidence</span> (<span class="id">s</span> : <span class="id">state</span>) (<span class="id">v</span> : <span class="id">validator</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e1</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subject_of_observation</span> <span class="id">e1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">e2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">subject_of_observation</span> <span class="id">e2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">comparable</span> <span class="id">happens_before</span> <span class="id">e1</span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="observable_events_fn">observable_events_fn</a></span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;(<span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;(<span class="id">event_eq</span> : <span class="id">EqDecision</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">observable_events_fn</span> : <span class="id">state</span> -&gt; <span class="id">validator</span> -&gt; <span class="tactic">set</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">validators</span> : <span class="id">state</span> -&gt; <span class="tactic">set</span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="state_observable_events_fn">state_observable_events_fn</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.state">state</a></span>)<br/>
&nbsp;&nbsp;: <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event">event</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union">set_union</a></span> <span class="id">decide_eq</span>) [] (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.observable_events_fn">observable_events_fn</a></span> <span class="id">s</span> <span class="id">v</span>) (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.validators">validators</a></span> <span class="id">s</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="observable_events_has_been_observed">observable_events_has_been_observed</a></span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.state">state</a></span>) (<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event">event</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">e</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#state_observable_events_fn">state_observable_events_fn</a></span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="observable_events_has_been_observed_dec">observable_events_has_been_observed_dec</a></span> : <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_has_been_observed">observable_events_has_been_observed</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof242')">Proof.</div>
<div class="proofscript" id="proof242">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Local</span> <span class="kwd">Instance</span> <span class="id"><a name="state_observable_events_instance">state_observable_events_instance</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.state">state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event">event</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_has_been_observed">observable_events_has_been_observed</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_has_been_observed_dec">observable_events_has_been_observed_dec</a></span><br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;(<span class="id">validator_eq</span> : <span class="id">EqDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">happens_before</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event">event</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event">event</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">happens_before_dec</span> : <span class="id">RelDecision</span> <span class="id">happens_before</span>)<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event">event</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.validator">validator</a></span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Instance</span> <span class="id"><a name="observable_events_equivocation_evidence">observable_events_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.validator">validator</a></span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#state_observable_events_instance">state_observable_events_instance</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.event_eq">event_eq</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.happens_before_dec">happens_before_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn.subject_of_observation">subject_of_observation</a></span><br/>
&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#Build_observation_based_equivocation_evidence">Build_observation_based_equivocation_evidence</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="observable_events_equivocation_evidence_dec">observable_events_equivocation_evidence_dec</a></span> : <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof243')">Proof.</div>
<div class="proofscript" id="proof243">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_has_been_observed">observable_events_has_been_observed</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Decision_iff</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> @<span class="id">Exists_dec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">m1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Decision_and</span>; [<span class="tactic">apply</span> <span class="id">option_eq_dec</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Decision_iff</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> @<span class="id">Exists_dec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">m2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Decision_and</span>; [<span class="tactic">apply</span> <span class="id">option_eq_dec</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Decision_not</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">comparable_dec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn">observable_events_fn</a></span>.<br/>
<br/>
<div class="doc">We can use this notion of <span class="bracket"><span class="id">observation_based_equivocation_evidence</span></span>
 to obtain the <span class="bracket"><span class="id">basic_equivocation</span></span> between states and validators.
 </div>
<span class="kwd">Definition</span> <span class="id"><a name="basic_observable_equivocation">basic_observable_equivocation</a></span><br/>
&nbsp;&nbsp;(<span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;{<span class="id">event_eq</span>: <span class="id">EqDecision</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;(<span class="id">happens_before</span> : <span class="id">event</span> -&gt; <span class="id">event</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;{<span class="id">happens_before_dec</span> : <span class="id">RelDecision</span> <span class="id">happens_before</span>}<br/>
&nbsp;&nbsp;(<span class="id">state_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">state</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;{<span class="id">Hevidence</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span> <span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> <span class="id">state_events</span> <span class="id">event_eq</span> <span class="id">happens_before</span> <span class="id">happens_before_dec</span> <span class="id">subject_of_observation</span>}<br/>
&nbsp;&nbsp;{<span class="id">equivocation_evidence_dec</span> : <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>}<br/>
&nbsp;&nbsp;{<span class="id">measurable_V</span> : <span class="id">Measurable</span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;{<span class="id">reachable_threshold</span> : <span class="id">ReachableThreshold</span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;(<span class="id">validators</span> : <span class="id">state</span> -&gt; <span class="tactic">set</span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;(<span class="id">validators_nodup</span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id">state</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">validators</span> <span class="id">s</span>))<br/>
&nbsp;&nbsp;: <span class="id">basic_equivocation</span> <span class="id">state</span> <span class="id">validator</span><br/>
&nbsp;&nbsp;:= {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_equivocating</span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_equivocating_dec</span> := <span class="id">equivocation_evidence_dec</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_validators</span> := <span class="id">validators</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">state_validators_nodup</span> := <span class="id">validators_nodup</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="not_heavy_incl">not_heavy_incl</a></span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;(<span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;(<span class="id">v_eq</span> : <span class="id">EqDecision</span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;{<span class="id">happens_before</span> : <span class="id">event</span> -&gt; <span class="id">event</span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before_dec</span> : <span class="id">RelDecision</span> <span class="id">happens_before</span>}<br/>
&nbsp;&nbsp;(<span class="id">state_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">state</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;{<span class="id">Hevidence</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span> <span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> <span class="id">state_events</span> <span class="id">decide_eq</span> <span class="id">happens_before</span> <span class="id">happens_before_dec</span> <span class="id">subject_of_observation</span>}<br/>
&nbsp;&nbsp;{<span class="id">equivocation_evidence_dec</span> : <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>}<br/>
&nbsp;&nbsp;{<span class="id">measurable_V</span> : <span class="id">Measurable</span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;{<span class="id">reachable_threshold</span> : <span class="id">ReachableThreshold</span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;(<span class="id">validators</span> : <span class="id">state</span> -&gt; <span class="tactic">set</span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;(<span class="id">validators_nodup</span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id">state</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">validators</span> <span class="id">s</span>))<br/>
&nbsp;&nbsp;(<span class="id">basic_eqv</span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#basic_observable_equivocation">basic_observable_equivocation</a></span> <span class="id">state</span> <span class="id">validator</span> <span class="id">event</span> <span class="id">happens_before</span> <span class="id">state_events</span> <span class="id">subject_of_observation</span> <span class="id">validators</span> <span class="id">validators_nodup</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">basic_eqv</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocation_fault_incl">equivocation_fault_incl</a></span><br/>
&nbsp;&nbsp;(<span class="id">sigma</span> <span class="id">sigma</span>' : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hincl_validators</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.validators">validators</a></span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.validators">validators</a></span> <span class="id">sigma</span>'))<br/>
&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="kwd">forall</span> <span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.event">event</a></span>, <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">sigma</span> <span class="id">e</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">sigma</span>' <span class="id">e</span>)<br/>
&nbsp;&nbsp;: (<span class="id">equivocation_fault</span> <span class="id">sigma</span> &lt;= <span class="id">equivocation_fault</span> <span class="id">sigma</span>')%<span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof244')">Proof.</div>
<div class="proofscript" id="proof244">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">equivocation_fault</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">equivocating_validators</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">sum_weights_incl</span>; <span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup_filter">NoDup_filter</a></span>; <span class="tactic">apply</span> <span class="id">state_validators_nodup</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="kwd">fun</span> <span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.validator">validator</a></span> =&gt; <span class="id">bool_decide</span> (<span class="id">is_equivocating</span> <span class="id">sigma</span>' <span class="id">v</span>))<br/>
&nbsp;&nbsp;(<span class="id">state_validators</span> <span class="id">sigma</span>))<br/>
&nbsp;&nbsp;; [|<span class="tactic">apply</span> <span class="id">filter_incl</span>; <span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_incl_fn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">bool_decide_eq_true</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">Hincl</span>;<span class="tactic">firstorder</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_heavy_incl">not_heavy_incl</a></span><br/>
&nbsp;&nbsp;(<span class="id">sigma</span> <span class="id">sigma</span>' : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.state">state</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hincl_validators</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.validators">validators</a></span> <span class="id">sigma</span>) (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.validators">validators</a></span> <span class="id">sigma</span>'))<br/>
&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="kwd">forall</span> <span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl.event">event</a></span>, <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">sigma</span> <span class="id">e</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">sigma</span>' <span class="id">e</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hsigma</span>' : <span class="id">not_heavy</span> <span class="id">sigma</span>')<br/>
&nbsp;&nbsp;: <span class="id">not_heavy</span> <span class="id">sigma</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof245')">Proof.</div>
<div class="proofscript" id="proof245">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rle_trans">Rle_trans</a></span> <span class="kwd">with</span> (<span class="id">equivocation_fault</span> <span class="id">sigma</span>'); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_fault_incl">equivocation_fault_incl</a></span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_heavy_incl">not_heavy_incl</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="vlsm_observable_events">vlsm_observable_events</a></span>.<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="vlsm_observable_events">vlsm_observable_events</a></span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;{<span class="id">event</span> <span class="id">validator</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">state_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;{<span class="id">message_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">message</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="no_event_subject_in_initial_state">no_event_subject_in_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">His</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id">X</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">e</span> : <span class="id">event</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">He</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">subject_of_observation</span> <span class="id">e</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="no_event_subject_in_initial_message">no_event_subject_in_initial_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">His</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message_prop">vinitial_message_prop</a></span> <span class="id">X</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">e</span> : <span class="id">event</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">He</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">m</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">subject_of_observation</span> <span class="id">e</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="message_observable_consistency">message_observable_consistency</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>' : <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id">X</span> <span class="id">l</span> <span class="id">som</span> = (<span class="id">s</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">forall</span> <span class="id">e</span> : <span class="id">event</span>, <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">m</span>' <span class="id">e</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span>' <span class="id">e</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;{<span class="id">event</span> <span class="id">validator</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">state_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;{<span class="id">message_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">message</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;{<span class="id">vlsm_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events">vlsm_observable_events</a></span> <span class="id">X</span> <span class="id">subject_of_observation</span>}<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_observable_events_first">in_observable_events_first</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">He</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;: <span class="id">s</span> = <span class="id">is</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">pre</span> <span class="id">suf</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tr</span> = <span class="id">pre</span> ++ [<span class="id">item</span>] ++ <span class="id">suf</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>) <span class="id">e</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">item</span> =&gt; ~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>) <span class="id">e</span>) <span class="id">pre</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof246')">Proof.</div>
<div class="proofscript" id="proof246">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">null_dec</span> <span class="id">tr</span>) <span class="kwd">as</span> [<span class="id">Htr0</span> | <span class="id">Htr0</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#exists_last">exists_last</a></span> <span class="id">Htr0</span>) <span class="kwd">as</span> [<span class="id">l</span>' [<span class="id">a</span> <span class="id">Heq</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Exists_first</span> <span class="id">tr</span> (<span class="kwd">fun</span> <span class="id">item</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>) <span class="id">e</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Hfirst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hfirst</span>. { <span class="tactic">intro</span> <span class="id">item</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hfirst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>. <span class="id">exists</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span> <span class="id">tr</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id">s</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">s</span>. <span class="tactic">rewrite</span> <span class="id">Heq</span> <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">He</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">He</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last_last">last_last</a></span> <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfirst</span> <span class="kwd">as</span> [<span class="id">pre</span> [<span class="id">suf</span> [<span class="id">a</span>' [<span class="id">He</span>' [<span class="id">Heq</span>' <span class="id">Hfirst</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">pre</span>, <span class="id">suf</span>, <span class="id">a</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">split</span>; [<span class="tactic">assumption</span>|]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_Exists_neg">Forall_Exists_neg</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="option_message_has_been_observed">option_message_has_been_observed</a></span><br/>
&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.message">message</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">om</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">m</span> <span class="id">e</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="option_message_has_been_observed_dec">option_message_has_been_observed_dec</a></span><br/>
&nbsp;&nbsp;: <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#option_message_has_been_observed">option_message_has_been_observed</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof247')">Proof.</div>
<div class="proofscript" id="proof247">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">om</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>; <span class="tactic">simpl</span>; [|<span class="id">right</span>; <span class="tactic">intuition</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span>.<br/>
Qed.</div>
<br/>
<h2> Defining observable equivocation based on observable messages
</h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="transition_generated_event">transition_generated_event</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.message">message</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span>' <span class="id">e</span> /\<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e</span> /\<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#option_message_has_been_observed">option_message_has_been_observed</a></span> <span class="id">om</span> <span class="id">e</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="transition_generated_event_dec">transition_generated_event_dec</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.message">message</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="id">Decision</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#transition_generated_event">transition_generated_event</a></span> <span class="id">s</span> <span class="id">om</span> <span class="id">s</span>' <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof248')">Proof.</div>
<div class="proofscript" id="proof248">
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id">Decision_and</span>; <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id">Decision_not</span>; <span class="tactic">repeat</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#option_message_has_been_observed_dec">option_message_has_been_observed_dec</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="trace_generated_event">trace_generated_event</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;(<span class="id">prefix</span> <span class="id">suffix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix</span>) <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>),<br/>
&nbsp;&nbsp;<span class="id">tr</span> = <span class="id">prefix</span> ++ [<span class="id">item</span>] ++ <span class="id">suffix</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#transition_generated_event">transition_generated_event</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span>) <span class="id">s</span>' <span class="id">e</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="trace_generated_event_dec">trace_generated_event_dec</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="id">Decision</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof249')">Proof.</div>
<div class="proofscript" id="proof249">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Decision_iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefix</span>, <span class="id">item</span>, <span class="id">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#transition_generated_event">transition_generated_event</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix</span>) <span class="id">is</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>) <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">one_element_decompositions</span> <span class="id">tr</span>)))<br/>
&nbsp;&nbsp;; [<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="tactic">split</span>|].<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [((<span class="id">prefix</span>, <span class="id">item</span>), <span class="id">suffix</span>) <span class="id">H</span>]. <span class="id">exists</span> <span class="id">prefix</span>, <span class="id">suffix</span>, <span class="id">item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">in_one_element_decompositions_iff</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [<span class="id">prefix</span> [<span class="id">suffix</span> [<span class="id">item</span> <span class="id">H</span>]]]. <span class="id">exists</span> (<span class="id">prefix</span>, <span class="id">item</span>, <span class="id">suffix</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">in_one_element_decompositions_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> @<span class="id">Exists_dec</span>. <span class="tactic">intros</span> [(<span class="id">prefix</span>, <span class="id">item</span>) <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#transition_generated_event_dec">transition_generated_event_dec</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="trace_generated_prefix">trace_generated_prefix</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">pre</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hgen</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">pre</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;(<span class="id">suf</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> (<span class="id">pre</span> ++ <span class="id">suf</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof250')">Proof.</div>
<div class="proofscript" id="proof250">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hgen</span> <span class="kwd">as</span> [<span class="id">pre</span>' [<span class="id">suf</span>' [<span class="id">item</span> [<span class="id">Heq</span> <span class="id">Hgen</span>]]]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">pre</span>'. <span class="id">exists</span> (<span class="id">suf</span>' ++ <span class="id">suf</span>). <span class="id">exists</span> <span class="id">item</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">pre</span>. <span class="tactic">repeat</span> <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_trace_generated_prefix">not_trace_generated_prefix</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">pre</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">suf</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hngen</span> : ~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> (<span class="id">pre</span> ++ <span class="id">suf</span>) <span class="id">e</span>)<br/>
&nbsp;&nbsp;: ~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">pre</span> <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof251')">Proof.</div>
<div class="proofscript" id="proof251">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">elim</span> <span class="id">Hngen</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_prefix">trace_generated_prefix</a></span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_trace_generated_event">not_trace_generated_event</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hne</span> : ~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;(<span class="id">prefix</span> <span class="id">suffix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">prefix</span> ++ [<span class="id">item</span>] ++ <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix</span>) <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hin</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span>' <span class="id">e</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e</span> \/ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#option_message_has_been_observed">option_message_has_been_observed</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span>) <span class="id">e</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof252')">Proof.</div>
<div class="proofscript" id="proof252">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span> <span class="id">s</span> <span class="id">e</span>) <span class="kwd">as</span> [|<span class="id">Hsi</span>]; [<span class="id">left</span>; <span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#option_message_has_been_observed_dec">option_message_has_been_observed_dec</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span>) <span class="id">e</span>) <span class="kwd">as</span> [|<span class="id">Hitem</span>]; [<span class="id">right</span>; <span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">Hne</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">prefix</span>, <span class="id">suffix</span>, <span class="id">item</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#transition_generated_event">transition_generated_event</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_trace_last">equivocating_in_trace_last</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_equivocating_in_trace_last_initial">not_equivocating_in_trace_last_initial</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: ~ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">s</span> [] <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof253')">Proof.</div>
<div class="proofscript" id="proof253">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">e</span> [<span class="id">Hv</span> [<span class="id">He</span> <span class="id">Hne</span>]]].<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#no_event_subject_in_initial_state">no_event_subject_in_initial_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> []) <span class="id">s</span>) <span class="id">Hs</span>) <span class="kwd">as</span> <span class="id">Hno</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hno</span> <span class="id">e</span> <span class="id">He</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_trace">equivocating_in_trace</a></span><br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace">protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">last</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_prefix">trace_prefix</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>) <span class="id">last</span> <span class="id">prefix</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#trace_first">trace_first</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">tr</span>)) <span class="id">prefix</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="equivocating_in_all_traces_ending_in_state">equivocating_in_all_traces_ending_in_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state">protocol_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:= <span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlast</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">is</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="not_equivocating_in_some_traces_ending_in_state">not_equivocating_in_some_traces_ending_in_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state">protocol_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:= <span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">is</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="not_equivocating_in_all_traces_ending_in_state">not_equivocating_in_all_traces_ending_in_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state">protocol_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:= <span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hlast</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">is</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">s</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="not_equivocating_in_traces_ending_in_state">not_equivocating_in_traces_ending_in_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state">protocol_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hall</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_equivocating_in_all_traces_ending_in_state">not_equivocating_in_all_traces_ending_in_state</a></span> <span class="id">s</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_equivocating_in_some_traces_ending_in_state">not_equivocating_in_some_traces_ending_in_state</a></span> <span class="id">s</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof254')">Proof.</div>
<div class="proofscript" id="proof254">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span> <span class="kwd">as</span> [<span class="id">s</span> [<span class="id">_om</span> <span class="id">Hs</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_is_trace">protocol_is_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">s</span> <span class="id">_om</span> <span class="id">Hs</span>) <span class="kwd">as</span> [<span class="id">Hinit</span> | [<span class="id">is</span> [<span class="id">tr</span> [<span class="id">Htr</span> [<span class="id">Hlast</span> <span class="id">_</span>]]]]].<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">s</span>. <span class="id">exists</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_equivocating_in_trace_last_initial">not_equivocating_in_trace_last_initial</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hlst</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#last_error_destination_last">last_error_destination_last</a></span> <span class="id">tr</span> <span class="id">s</span> <span class="id">Hlast</span> <span class="id">is</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">is</span>. <span class="id">exists</span> <span class="id">tr</span>. <span class="tactic">split</span>; [<span class="tactic">assumption</span>|].  <span class="tactic">split</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Hall</span> <span class="id">is</span> <span class="id">tr</span>); <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<h2> Linking observable equivocation to message-based equivocation
</h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="event_equivocation_implies_message_equivocation">event_equivocation_implies_message_equivocation</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Heqv</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Equivocation.html#equivocation_in_trace">VLSM.Equivocation.equivocation_in_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">m</span> <span class="id">tr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ ~<span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message_prop">vinitial_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof255')">Proof.</div>
<div class="proofscript" id="proof255">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Heqv</span> <span class="kwd">as</span> [<span class="id">e</span> [<span class="id">Hv</span> [<span class="id">He</span> <span class="id">Hne</span>]]].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="kwd">in</span> <span class="id">Hne</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hcon</span> : ~ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">is</span> <span class="id">e</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intro</span> <span class="id">contra</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#no_event_subject_in_initial_state">no_event_subject_in_initial_state</a></span> <span class="kwd">in</span> <span class="id">contra</span>; [|<span class="tactic">apply</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj2">proj2</a></span> <span class="id">Htr</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">He</span>' := <span class="id">He</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#in_observable_events_first">in_observable_events_first</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">e</span>) <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">He</span> <span class="kwd">as</span> [<span class="id">He</span> | <span class="id">He</span>]; [<span class="tactic">rewrite</span> <span class="id">He</span> <span class="kwd">in</span> <span class="id">He</span>'; <span class="tactic">intuition</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">He</span> <span class="kwd">as</span> [<span class="id">pre</span> [<span class="id">suf</span> [<span class="id">item</span> [<span class="id">Heq</span> [<span class="id">He</span> <span class="id">Hpre</span>]]]]].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_trace_generated_prefix">not_trace_generated_prefix</a></span> <span class="kwd">in</span> <span class="id">Hne</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">His</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span> <span class="id">item</span> <span class="id">tl</span> <span class="id">s</span>'. <span class="tactic">clear</span> <span class="id">Ht</span> <span class="id">H2</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hnpre</span> : ~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">pre</span>) <span class="id">is</span>) <span class="id">e</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> (<span class="id">null_dec</span> <span class="id">pre</span>) <span class="kwd">as</span> [<span class="id">Hpre0</span> | <span class="id">Hpre0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span> <span class="id">pre</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#exists_last">exists_last</a></span> <span class="id">Hpre0</span>) <span class="kwd">as</span> [<span class="id">pre</span>' [<span class="id">item</span>' <span class="id">Heq</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last_last">last_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Hpre</span> <span class="id">item</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_trace_generated_event">not_trace_generated_event</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hne</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> [] {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;) <span class="kwd">as</span> <span class="id">Hng</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hng</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hng</span> <span class="id">He</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hng</span> <span class="kwd">as</span> [<span class="id">Hng</span> | <span class="id">Hng</span>]; [<span class="tactic">elim</span> <span class="id">Hnpre</span>; <span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">iom</span> <span class="kwd">as</span> [<span class="id">m</span>|]; [|<span class="tactic">inversion</span> <span class="id">Hng</span>].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">m</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">pre</span>. <span class="id">exists</span> <span class="id">suf</span>. <span class="id">exists</span> {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>. <span class="tactic">repeat</span> (<span class="tactic">split</span>; [<span class="tactic">reflexivity</span>|]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">item</span>' [<span class="id">Hout</span> <span class="id">Hitem</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hpre</span> <span class="id">item</span>' <span class="id">Hitem</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">Hpre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_split">in_split</a></span> <span class="kwd">in</span> <span class="id">Hitem</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hitem</span>' <span class="kwd">as</span> [<span class="id">pre</span>' [<span class="id">suf</span>' <span class="id">Hitem</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Htr</span>]. <span class="tactic">inversion</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s</span>' <span class="id">item</span>' <span class="id">tl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hout</span>. <span class="tactic">subst</span> <span class="id">oom0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> [<span class="id">Hvalid</span> <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#message_observable_consistency">message_observable_consistency</a></span>  <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ht</span>) <span class="kwd">in</span> <span class="id">Hng</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hng</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#no_event_subject_in_initial_message">no_event_subject_in_initial_message</a></span> <span class="id">_</span> <span class="id">contra</span> <span class="id">e</span> <span class="id">Hng</span>) <span class="kwd">as</span> <span class="id">contra1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="event_equivocation_implies_message_equivocation_converse">event_equivocation_implies_message_equivocation_converse</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hneqv</span> : <span class="kwd">forall</span> (<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.message">message</a></span>), ~<span class="id"><a href="CasperCBC.VLSM.Equivocation.html#equivocation_in_trace">VLSM.Equivocation.equivocation_in_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">m</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: ~<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof256')">Proof.</div>
<div class="proofscript" id="proof256">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#event_equivocation_implies_message_equivocation">event_equivocation_implies_message_equivocation</a></span> <span class="kwd">in</span> <span class="id">contra</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">m</span> [<span class="id">contra</span> <span class="id">Hnoinitial</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> (<span class="id">Hneqv</span> <span class="id">m</span>). <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<h2> Linking evidence of equivocation with observable equivocation
</h2>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before</span>: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before_dec</span>: <span class="id">RelDecision</span> <span class="id">happens_before</span>}<br/>
&nbsp;&nbsp;.<br/>
<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="vlsm_comparable_generated_events">vlsm_comparable_generated_events</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="comparable_generated_events">comparable_generated_events</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">e1</span> <span class="id">e2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">He1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">He2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">comparable</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.happens_before">happens_before</a></span> <span class="id">e1</span> <span class="id">e2</span>;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">Hcomparable_generated_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_comparable_generated_events">vlsm_comparable_generated_events</a></span>}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="uncomparable_with_generated_event_equivocation">uncomparable_with_generated_event_equivocation</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e1</span> <span class="id">e2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">tr</span>) <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">He1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e1</span>)<br/>
&nbsp;&nbsp;(<span class="id">He2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hnc</span> : ~<span class="id">comparable</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.happens_before">happens_before</a></span> <span class="id">e1</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hgen1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event">trace_generated_event</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e1</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_trace_last">equivocating_in_trace_last</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof257')">Proof.</div>
<div class="proofscript" id="proof257">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event_dec">trace_generated_event_dec</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e2</span>) <span class="kwd">as</span> [<span class="id">Hgen2</span>|<span class="id">Hgen2</span>].<br/>
&nbsp;&nbsp;- <span class="id">contradict</span> <span class="id">Hnc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#comparable_generated_events">comparable_generated_events</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">v</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">Hgen1</span> <span class="id">Hgen2</span> <span class="id">Hv1</span> <span class="id">Hv2</span>).<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">e2</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="evidence_implies_equivocation">evidence_implies_equivocation</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e1</span> <span class="id">e2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">He1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e1</span>)<br/>
&nbsp;&nbsp;(<span class="id">He2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">Heqv</span> : ~<span class="id">comparable</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.happens_before">happens_before</a></span> <span class="id">e1</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_all_traces_ending_in_state">equivocating_in_all_traces_ending_in_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">Hs</span>) <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof258')">Proof.</div>
<div class="proofscript" id="proof258">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">is</span>; <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#trace_generated_event_dec">trace_generated_event_dec</a></span> <span class="id">is</span> <span class="id">tr</span> <span class="id">e1</span>) <span class="kwd">as</span> [<span class="id">Hgen1</span>| <span class="id">Hgen1</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#uncomparable_with_generated_event_equivocation">uncomparable_with_generated_event_equivocation</a></span> <span class="kwd">with</span> <span class="id">e1</span> <span class="id">e2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">e1</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="evidence_implies_equivocation_converse">evidence_implies_equivocation_converse</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hneqv</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_equivocating_in_some_traces_ending_in_state">not_equivocating_in_some_traces_ending_in_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">Hs</span>) <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">e1</span> <span class="id">e2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">He1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e1</span>)<br/>
&nbsp;&nbsp;(<span class="id">He2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;: <span class="id">comparable</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.happens_before">happens_before</a></span> <span class="id">e1</span> <span class="id">e2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof259')">Proof.</div>
<div class="proofscript" id="proof259">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">comparable_dec</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.happens_before">happens_before</a></span> <span class="id">e1</span> <span class="id">e2</span>) <span class="kwd">as</span> [|<span class="id">Hcmp</span>]; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#evidence_implies_equivocation">evidence_implies_equivocation</a></span> <span class="id">s</span> <span class="id">Hs</span> <span class="id">v</span> <span class="id">e1</span> <span class="id">e2</span> <span class="id">He1</span> <span class="id">He2</span> <span class="id">Hv1</span> <span class="id">Hv2</span> <span class="id">Hcmp</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Heqv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hneqv</span> <span class="kwd">as</span> [<span class="id">is</span> [<span class="id">tr</span> [<span class="id">Htr</span> [<span class="id">Hlast</span> <span class="id">Hneqv</span>]]]]. <span class="tactic">elim</span> <span class="id">Hneqv</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Heqv</span> <span class="id">is</span> <span class="id">tr</span> <span class="id">Htr</span> <span class="id">Hlast</span>). <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<h2> No-equivocation composition constraint guarantees no equivocations
</h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_equivocation_constraint_implies_no_equivocations">no_equivocation_constraint_implies_no_equivocations</a></span><br/>
&nbsp;&nbsp;(<span class="id">Xhbs</span> : <span class="id"><a href="CasperCBC.VLSM.Equivocation.html#has_been_sent_capability">has_been_sent_capability</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hno_equiv</span> : <span class="kwd">forall</span> <span class="id">l</span> <span class="id">som</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">l</span> <span class="id">som</span> -&gt; (<span class="id"><a href="CasperCBC.VLSM.Equivocation.html#no_equivocations">no_equivocations</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">l</span> <span class="id">som</span>))<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_equivocating_in_all_traces_ending_in_state">not_equivocating_in_all_traces_ending_in_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">s</span> <span class="id">Hs</span>) <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof260')">Proof.</div>
<div class="proofscript" id="proof260">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">is</span>; <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#event_equivocation_implies_message_equivocation">event_equivocation_implies_message_equivocation</a></span> <span class="kwd">in</span> <span class="id">contra</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">m</span> [<span class="id">contra</span> <span class="id">Hnoinitial</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">pre</span> [<span class="id">suf</span> [<span class="id">item</span> [<span class="id">Heq</span> [<span class="id">Hinput</span> <span class="id">contra</span>]]]]].<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">tr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Hpre</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hinput</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> [[<span class="id">Hps</span> [<span class="id">Hpm</span> <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hno_equiv</span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> (<span class="id">Pre</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hpps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">Pre</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">pre</span>) <span class="id">is</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">destruct</span> <span class="id">Hps</span> <span class="kwd">as</span> [<span class="id">_om</span> <span class="id">Hps</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_om</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_protocol_prop">pre_loaded_with_all_messages_protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hv</span> | <span class="id">Hinitial</span>]; [|<span class="id">contradiction</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (@<span class="id"><a href="CasperCBC.VLSM.Equivocation.html#proper_sent">proper_sent</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Xhbs</span> <span class="id">_</span> <span class="id">Hpps</span>) <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hv</span> <span class="id">is</span> <span class="id">pre</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hincl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">Pre</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_incl_pre_loaded_with_all_messages_vlsm">vlsm_incl_pre_loaded_with_all_messages_vlsm</a></span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl_finite_trace">VLSM_incl_finite_trace</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hincl</span>) <span class="kwd">as</span> <span class="id">Htr_incl</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">split</span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Htr_incl</span>. <span class="tactic">clear</span> -<span class="id">Hpre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="kwd">as</span> (<span class="id">Xt</span>, (<span class="id">Xs</span>, <span class="id">Xm</span>)). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hv</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_equivocation_constraint_implies_comparable_events">no_equivocation_constraint_implies_comparable_events</a></span><br/>
&nbsp;&nbsp;(<span class="id">Xhbs</span> : <span class="id"><a href="CasperCBC.VLSM.Equivocation.html#has_been_sent_capability">has_been_sent_capability</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hno_equiv</span> : <span class="kwd">forall</span> <span class="id">l</span> <span class="id">som</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">l</span> <span class="id">som</span> -&gt; (<span class="id"><a href="CasperCBC.VLSM.Equivocation.html#no_equivocations">no_equivocations</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">l</span> <span class="id">som</span>))<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;(<span class="id">e1</span> <span class="id">e2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">He1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e1</span>)<br/>
&nbsp;&nbsp;(<span class="id">He2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> <span class="id">s</span> <span class="id">e2</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv1</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv2</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.subject_of_observation">subject_of_observation</a></span> <span class="id">e2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;: <span class="id">comparable</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.happens_before">happens_before</a></span> <span class="id">e1</span> <span class="id">e2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof261')">Proof.</div>
<div class="proofscript" id="proof261">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#evidence_implies_equivocation_converse">evidence_implies_equivocation_converse</a></span> <span class="kwd">with</span> <span class="id">s</span> <span class="id">Hs</span> <span class="id">v</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#not_equivocating_in_traces_ending_in_state">not_equivocating_in_traces_ending_in_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#no_equivocation_constraint_implies_no_equivocations">no_equivocation_constraint_implies_no_equivocations</a></span> <span class="kwd">with</span> <span class="id">Xhbs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="no_equivocation_in_initial_state">no_equivocation_in_initial_state</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hps</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events.X">X</a></span> <span class="id">is</span> <span class="id">Hs</span>)<br/>
&nbsp;&nbsp;: ~ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_all_traces_ending_in_state">equivocating_in_all_traces_ending_in_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">is</span> <span class="id">Hps</span>) <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof262')">Proof.</div>
<div class="proofscript" id="proof262">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocating_in_all_traces_ending_in_state">equivocating_in_all_traces_ending_in_state</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">contra</span> <span class="id">is</span> []).<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="id">constructor</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">contra</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">contra</span> <span class="kwd">as</span> [<span class="id">e</span> [<span class="id">Hv</span> [<span class="id">He</span> <span class="id">_</span>]]]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#no_event_subject_in_initial_state">no_event_subject_in_initial_state</a></span> <span class="id">is</span> <span class="id">Hs</span>) <span class="kwd">as</span> <span class="id">Heis</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Heis</span> <span class="id">e</span> <span class="id">He</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events">vlsm_observable_events</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="observable_events_fn_in_composition">observable_events_fn_in_composition</a></span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">index_listing</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">index</span>)<br/>
&nbsp;&nbsp;(<span class="id">finite_index</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html#Listing">Listing</a></span> <span class="id">index_listing</span>)<br/>
&nbsp;&nbsp;(<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hstate_events_fn</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>) -&gt; <span class="id">validator</span> -&gt; <span class="tactic">set</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hstate_validators</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>) -&gt; <span class="tactic">set</span> <span class="id">validator</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hstate_events</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>)) <span class="id">event</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#state_observable_events_instance">state_observable_events_instance</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">validator</span> <span class="id">event</span> <span class="id">_</span> (<span class="id">Hstate_events_fn</span> <span class="id">i</span>) (<span class="id">Hstate_validators</span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composite_state_events_fn">composite_state_events_fn</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.IM">IM</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span>)<br/>
&nbsp;&nbsp;: <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union">set_union</a></span> <span class="id">decide_eq</span>) [] (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.Hstate_events_fn">Hstate_events_fn</a></span> <span class="id">i</span> (<span class="id">s</span> <span class="id">i</span>) <span class="id">v</span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.index_listing">index_listing</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composite_validators">composite_validators</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.IM">IM</a></span>)<br/>
&nbsp;&nbsp;: <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union">set_union</a></span> <span class="id">decide_eq</span>) [] (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.Hstate_validators">Hstate_validators</a></span> <span class="id">i</span> (<span class="id">s</span> <span class="id">i</span>)) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.index_listing">index_listing</a></span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composite_state_observable_events_instance">composite_state_observable_events_instance</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#state_observable_events_instance">state_observable_events_instance</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_state_events_fn">composite_state_events_fn</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_validators">composite_validators</a></span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;(<span class="id">happens_before</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">happens_before_dec</span> : <span class="id">RelDecision</span> <span class="id">happens_before</span>)<br/>
&nbsp;&nbsp;(<span class="id">subject_of_observation</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composite_observable_events_equivocation_evidence">composite_observable_events_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_state_observable_events_instance">composite_state_observable_events_instance</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.happens_before_dec">happens_before_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.subject_of_observation">subject_of_observation</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_equivocation_evidence">observable_events_equivocation_evidence</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_state_events_fn">composite_state_events_fn</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_validators">composite_validators</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.happens_before">happens_before</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.happens_before_dec">happens_before_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.subject_of_observation">subject_of_observation</a></span>.<br/>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">composite_observable_events_equivocation_evidence</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composite_observable_events_equivocation_evidence_dec">composite_observable_events_equivocation_evidence_dec</a></span><br/>
&nbsp;&nbsp;: <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_equivocation_evidence_dec">observable_events_equivocation_evidence_dec</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.validator">validator</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.event">event</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_state_events_fn">composite_state_events_fn</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composite_validators">composite_validators</a></span> <span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.happens_before">happens_before</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.happens_before_dec">happens_before_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition.subject_of_observation">subject_of_observation</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events_fn_in_composition">observable_events_fn_in_composition</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="observable_equivocation_in_composition">observable_equivocation_in_composition</a></span>.<br/>
<br/>
<h2> Observable messages in a VLSM composition
We assume a composition of <span class="bracket"><span class="id">VLSM</span></span>s where each machine has a way to
produce <span class="bracket"><span class="id">observation_based_equivocation_evidence</span></span>.
</h2>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before</span>: <span class="id">event</span> -&gt; <span class="id">event</span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before_dec</span>: <span class="id">RelDecision</span> <span class="id">happens_before</span>}<br/>
&nbsp;&nbsp;{<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">index_listing</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">index</span>)<br/>
&nbsp;&nbsp;(<span class="id">finite_index</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html#Listing">Listing</a></span> <span class="id">index_listing</span>)<br/>
&nbsp;&nbsp;(<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hstate_events</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>)) <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hmessage</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">message</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hevents</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events">vlsm_observable_events</a></span> (<span class="id">IM</span> <span class="id">i</span>) <span class="id">subject_of_observation</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hevidence</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>)) <span class="id">validator</span> <span class="id">event</span> (<span class="id">Hstate_events</span> <span class="id">i</span>) <span class="id">decide_eq</span> <span class="id">happens_before</span> <span class="id">happens_before_dec</span> <span class="id">subject_of_observation</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;{<span class="id">i0</span> : <span class="id">Inhabited</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> <span class="id">IM</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id">IM</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;(<span class="id">PreX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composed_witness_has_been_observed">composed_witness_has_been_observed</a></span><br/>
&nbsp;&nbsp;(<span class="id">witness_set</span> : <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> <span class="id">witness_set</span> /\ <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id">s</span> <span class="id">i</span>) <span class="id">e</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="composed_witness_has_been_observed_dec">composed_witness_has_been_observed_dec</a></span><br/>
&nbsp;&nbsp;(<span class="id">witness_set</span> : <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="id">Decision</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_has_been_observed">composed_witness_has_been_observed</a></span> <span class="id">witness_set</span> <span class="id">s</span> <span class="id">e</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof263')">Proof.</div>
<div class="proofscript" id="proof263">
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Decision_iff</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="id">_</span> <span class="id">_</span> )).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> @<span class="id">Exists_dec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composed_has_been_observed">composed_has_been_observed</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span>)<br/>
&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>, <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id">s</span> <span class="id">i</span>) <span class="id">e</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="composed_has_been_observed_dec">composed_has_been_observed_dec</a></span> : <span class="id">RelDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_has_been_observed">composed_has_been_observed</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof264')">Proof.</div>
<div class="proofscript" id="proof264">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_has_been_observed_dec">composed_witness_has_been_observed_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index_listing">index_listing</a></span> <span class="id">s</span> <span class="id">e</span>) <span class="kwd">as</span> <span class="id">Hdec</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Decision_iff</span> (<span class="id">P</span> := (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_has_been_observed">composed_witness_has_been_observed</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index_listing">index_listing</a></span> <span class="id">s</span> <span class="id">e</span>)))<br/>
&nbsp;&nbsp;; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_has_been_observed">composed_witness_has_been_observed</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_has_been_observed">composed_has_been_observed</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> [<span class="id">i</span> <span class="id">He</span>]; <span class="id">exists</span> <span class="id">i</span>; <span class="tactic">intuition</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.finite_index">finite_index</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composed_witness_state_observable_events">composed_witness_state_observable_events</a></span><br/>
&nbsp;&nbsp;(<span class="id">witness_set</span> : <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> := (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_has_been_observed">composed_witness_has_been_observed</a></span> <span class="id">witness_set</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span> := (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_has_been_observed_dec">composed_witness_has_been_observed_dec</a></span> <span class="id">witness_set</span>);<br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="composed_state_observable_events">composed_state_observable_events</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_has_been_observed">composed_has_been_observed</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed_dec">has_been_observed_dec</a></span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_has_been_observed_dec">composed_has_been_observed_dec</a></span><br/>
&nbsp;&nbsp;|}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composed_witness_observation_based_equivocation_evidence">composed_witness_observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;(<span class="id">witness_set</span> : <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_witness_state_observable_events">composed_witness_state_observable_events</a></span> <span class="id">witness_set</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">decide_eq</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.happens_before">happens_before</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.happens_before_dec">happens_before_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.subject_of_observation">subject_of_observation</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof265')">Proof.</div>
<div class="proofscript" id="proof265">
 <span class="tactic">split</span>. Defined.</div>
<br/>
<span class="kwd">Instance</span> <span class="id"><a name="composed_observation_based_equivocation_evidence">composed_observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_state_observable_events">composed_state_observable_events</a></span> <span class="id">decide_eq</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.happens_before">happens_before</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.happens_before_dec">happens_before_dec</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.subject_of_observation">subject_of_observation</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof266')">Proof.</div>
<div class="proofscript" id="proof266">
 <span class="tactic">split</span>. Defined.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="equivocation_evidence_lift">equivocation_evidence_lift</a></span><br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hsi</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span> (<span class="id">s</span> <span class="id">i</span>) <span class="id">v</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span> <span class="id">s</span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof267')">Proof.</div>
<div class="proofscript" id="proof267">
&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm_observable">composite_vlsm_observable</a></span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events">vlsm_observable_events</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.X">X</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.subject_of_observation">subject_of_observation</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof268')">Proof.</div>
<div class="proofscript" id="proof268">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">He</span> <span class="kwd">as</span> [<span class="id">i</span> <span class="id">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">His</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hevents</span> <span class="id">i</span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.Hevents">Hevents</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">His</span> <span class="kwd">as</span> [<span class="id">i</span> [[<span class="id">mi</span> <span class="id">Hmi</span>] <span class="id">His</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">His</span>. <span class="tactic">subst</span> <span class="id">mi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hevents</span> <span class="id">i</span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.Hevents">Hevents</a></span>. <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> (<span class="id">i</span>, <span class="id">li</span>). <span class="tactic">destruct</span> <span class="id">som</span> <span class="kwd">as</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hevents</span> <span class="id">i</span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.Hevents">Hevents</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">message_observable_consistency0</span> <span class="id">li</span> (<span class="id">s</span> <span class="id">i</span>, <span class="id">om</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span> <span class="id">i</span>) <span class="id">li</span> (<span class="id">s</span> <span class="id">i</span>, <span class="id">om</span>)) <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">om</span>'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">Ht</span>. <span class="id">exists</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">firstorder</span>.<br/>
Qed.</div>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">composite_vlsm_observable</span>.<br/>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.message">message</a></span>}<br/>
&nbsp;&nbsp;{<span class="id">measurable_V</span> : <span class="id">Measurable</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span>}<br/>
&nbsp;&nbsp;{<span class="id">reachable_threshold</span> : <span class="id">ReachableThreshold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span>}<br/>
&nbsp;&nbsp;(<span class="id">validators</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span> -&gt; <span class="tactic">set</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">validators_nodup</span> : <span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">validators</span> <span class="id">s</span>))<br/>
&nbsp;&nbsp;(<span class="id">composed_equivocation_evidence</span> := @<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.subject_of_observation">subject_of_observation</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_observation_based_equivocation_evidence">composed_observation_based_equivocation_evidence</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">composed_equivocation_evidence_dec</span> : <span class="id">RelDecision</span> <span class="id">composed_equivocation_evidence</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="composed_observable_basic_equivocation">composed_observable_basic_equivocation</a></span><br/>
&nbsp;&nbsp;: <span class="id">basic_equivocation</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span><br/>
&nbsp;&nbsp;:= @<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#basic_observable_equivocation">basic_observable_equivocation</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.IM">IM</a></span>) <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.event">event</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">decide_eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.happens_before">happens_before</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.happens_before_dec">happens_before_dec</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.subject_of_observation">subject_of_observation</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_observation_based_equivocation_evidence">composed_observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.composed_equivocation_evidence_dec">composed_equivocation_evidence_dec</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.measurable_V">measurable_V</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.reachable_threshold">reachable_threshold</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validators">validators</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validators_nodup">validators_nodup</a></span>.<br/>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">composed_observable_basic_equivocation</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="initial_state_not_heavy">initial_state_not_heavy</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.X">X</a></span> <span class="id">is</span>)<br/>
&nbsp;&nbsp;: <span class="id">not_heavy</span> <span class="id">is</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof269')">Proof.</div>
<div class="proofscript" id="proof269">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not_heavy</span>. <span class="tactic">unfold</span> <span class="id">equivocation_fault</span>. <span class="tactic">unfold</span> <span class="id">equivocating_validators</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">state_validators</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#equivocation_evidence">equivocation_evidence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">threshold</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Reals.RIneq.html#Rge_le">Rge_le</a></span> <span class="kwd">in</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validators">validators</a></span> <span class="id">is</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition.validator">validator</a></span>)<br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">filter_nil</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>. <span class="tactic">intros</span> <span class="id">v</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">bool_decide_eq_false</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">e1</span> [<span class="id">He1</span> [<span class="id">Hv1</span> <span class="id">H</span>]]].<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#no_event_subject_in_initial_state">no_event_subject_in_initial_state</a></span> <span class="id">is</span> <span class="id">Hs</span> <span class="id">_</span> <span class="id">He1</span>) <span class="kwd">as</span> <span class="id">Hno</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_equivocation_in_composition">observable_equivocation_in_composition</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="unforgeable_messages">unforgeable_messages</a></span>.<br/>
<br/>
<h2> Unforgeability and observations </h2>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> <span class="id">validator</span> <span class="id">event</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">event</span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before</span>: <span class="id">event</span> -&gt; <span class="id">event</span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;{<span class="id">happens_before_dec</span>: <span class="id">RelDecision</span> <span class="id">happens_before</span>}<br/>
&nbsp;&nbsp;{<span class="id">subject_of_observation</span> : <span class="id">event</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">validator</span>}<br/>
&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;`{<span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">index_listing</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">index</span>)<br/>
&nbsp;&nbsp;(<span class="id">finite_index</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html#Listing">Listing</a></span> <span class="id">index_listing</span>)<br/>
&nbsp;&nbsp;(<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hstate_events</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>)) <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hmessage</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> <span class="id">message</span> <span class="id">event</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hevents</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>), <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#vlsm_observable_events">vlsm_observable_events</a></span> (<span class="id">IM</span> <span class="id">i</span>) <span class="id">subject_of_observation</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hcomposed_state_events</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observable_events">observable_events</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id">IM</span>) <span class="id">event</span> := <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#composed_state_observable_events">composed_state_observable_events</a></span> <span class="id">_</span> <span class="id">finite_index</span> <span class="id">IM</span> <span class="id">Hstate_events</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hevidence</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id">index</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#observation_based_equivocation_evidence">observation_based_equivocation_evidence</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id">IM</span> <span class="id">i</span>)) <span class="id">validator</span> <span class="id">event</span> (<span class="id">Hstate_events</span> <span class="id">i</span>) <span class="id">decide_eq</span> <span class="id">happens_before</span> <span class="id">happens_before_dec</span> <span class="id">subject_of_observation</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;{<span class="id">i0</span> : <span class="id">Inhabited</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> <span class="id">IM</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id">IM</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">A</span> : <span class="id">validator</span> -&gt; <span class="id">index</span>)<br/>
&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;(<span class="id">PreX</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>)<br/>
.<br/>
<br/>
<span class="id">Existing</span> <span class="kwd">Instance</span> <span class="id">Hcomposed_state_events</span>.<br/>
<br/>
<span class="kwd">Class</span> <span class="id"><a name="unforgeable_messages">unforgeable_messages</a></span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="sent_messages_unforgeability">sent_messages_unforgeability</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.validator">validator</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.A">A</a></span> <span class="id">v</span> &lt;&gt; <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.event">event</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">He</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id">s</span>' <span class="id">i</span>) <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.subject_of_observation">subject_of_observation</a></span> <span class="id">e</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#has_been_observed">has_been_observed</a></span> (<span class="id">s</span> <span class="id">i</span>) <span class="id">e</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#option_message_has_been_observed">option_message_has_been_observed</a></span> <span class="id">om</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;}.<br/>
<br/>
<h3> On stating unforgeability for received messages
We'd like to argue here that it's not actually possible to state a similar
property for received messages. In fact, we argue that it is not possible
to require anything more from the received messages than what we already
know, i.e., that the message was produced in an alternative protocol trace.
The reason for the above affirmation is that we can assume that all the
nodes from the current protocol run which don't behave as in the protocol
run generating the message are in fact equivocating and there is a fork of
them behaving such as to guarantee the production of the message.
</h3>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">Hunforge</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages">unforgeable_messages</a></span>}<br/>
&nbsp;&nbsp;.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="trace_generated_index">trace_generated_index</a></span><br/>
&nbsp;&nbsp;(<span class="id">is</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span>))<br/>
&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace">finite_protocol_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span> <span class="id">is</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;(<span class="id">v</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.validator">validator</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">e</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.event">event</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.subject_of_observation">subject_of_observation</a></span> <span class="id">e</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)<br/>
&nbsp;&nbsp;(<span class="id">prefix</span> <span class="id">suffix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">tr</span> = <span class="id">prefix</span> ++ [<span class="id">item</span>] ++ <span class="id">suffix</span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">item</span>))<br/>
&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">prefix</span>) <span class="id">is</span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span>' := <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">item</span>)<br/>
&nbsp;&nbsp;(<span class="id">He</span> : <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#transition_generated_event">transition_generated_event</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span>) <span class="id">s</span>' <span class="id">e</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.A">A</a></span> <span class="id">v</span> = <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof270')">Proof.</div>
<div class="proofscript" id="proof270">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> ((<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.A">A</a></span> <span class="id">v</span>) = <span class="id">i</span>)); [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_to">protocol_transition_to</a></span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.X">X</a></span> <span class="id">is</span> <span class="id">item</span> <span class="id">tr</span> <span class="id">prefix</span> <span class="id">suffix</span> <span class="id">Heq</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#proj1">proj1</a></span> <span class="id">Htr</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Hpt</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#sent_messages_unforgeability">sent_messages_unforgeability</a></span> <span class="id">s</span> <span class="id">s</span>' (<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">item</span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">item</span>) <span class="id">Hpt</span> <span class="id">v</span> <span class="id">n</span> <span class="id">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hpt</span> <span class="kwd">as</span> [<span class="id">Hvalid</span> <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">item</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> (<span class="id">j</span>, <span class="id">li</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">i</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">Ht</span> <span class="kwd">with</span> (<span class="kwd">let</span> (<span class="id">si</span>', <span class="id">om</span>') := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span>) = <span class="id">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">om</span>') <span class="id">eqn</span>:<span class="id">Hti</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages.Hevents">Hevents</a></span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">He</span> <span class="kwd">as</span> [[<span class="id">i</span> <span class="id">He</span>] [<span class="id">Hnse</span> <span class="id">Hnme</span>]].<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>' <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span> <span class="kwd">in</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id">j</span>)).<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span> <span class="kwd">in</span> <span class="id">He</span>. <span class="id">spec</span> <span class="id">Hincl</span> <span class="id">He</span> <span class="id">Hv</span>. <span class="tactic">clear</span> -<span class="id">Hnse</span> <span class="id">Hnme</span> <span class="id">Hincl</span>. <span class="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span> <span class="kwd">in</span> <span class="id">He</span> <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">Hnse</span>. <span class="id">exists</span> <span class="id">i</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.ObservableEquivocation.html#unforgeable_messages">unforgeable_messages</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
