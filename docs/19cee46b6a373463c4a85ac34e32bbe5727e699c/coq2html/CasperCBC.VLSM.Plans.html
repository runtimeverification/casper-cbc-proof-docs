
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.VLSM.Plans</title>
<meta name="description" content="Documentation of Coq module CasperCBC.VLSM.Plans" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.VLSM.Plans</h1>
<div class="coq">
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<br/>
<span class="id">From</span> <span class="id">CasperCBC</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Lib.ListExtras</span> <span class="id"><a href="CasperCBC.VLSM.Common.html">VLSM.Common</a></span>.<br/>
<br/>
<h1> VLSM Plans </h1>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="plans">plans</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}.<br/>
<br/>
<div class="doc">A plan is a (sequence of actions) which can be attempted on a
  given state to yield a trace.
  A <span class="bracket"><span class="id">plan_item</span></span> is a singleton plan, and contains a label and an input
  which would allow to transition from any given state
  (note that we don't address validity for now)
  </div>
&nbsp;&nbsp;<span class="kwd">Record</span> <span class="id"><a name="plan_item">plan_item</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id"><a name="label_a">label_a</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="input_a">input_a</a></span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plans.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plans">plans</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="apply_plans">apply_plans</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">T</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">transition</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<div class="doc">If we don't concern ourselves with the validity of the traces obtained
  upon applying a plan, then a <span class="bracket"><span class="id">VLSM_type</span></span> and a <span class="bracket"><span class="id">transition</span></span> function
  suffice for defining plan application and related results.
  The advantage of this approach is that the same definition works for
  pre_loaded versions as well as for all constrained variants of a composition.
  </div>
<br/>
<div class="doc">Applying a plan (list of <span class="bracket"><span class="id">plan_item</span></span>s) to a state we obtain a
  final state and a trace. We define that in the <span class="bracket"><span class="id">_apply_plan</span></span> definition below
  using a folding operation on the <span class="bracket"><span class="id">_apply_plan_folder</span></span> function.
  </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_apply_plan_folder">_apply_plan_folder</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sl</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>, <span class="id">items</span>) := <span class="id">sl</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span> {| <span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> := <span class="id">l</span>'; <span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> := <span class="id">input</span>' |} =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="kwd">dest</span>, <span class="id">out</span>) := (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plans.transition">transition</a></span> <span class="id">l</span>' (<span class="id">s</span>, <span class="id">input</span>')) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;, {| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id">l</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">input</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">out</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="kwd">dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} :: <span class="id">items</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="_apply_plan_folder_additive">_apply_plan_folder_additive</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">aitems</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">seed_items</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">let</span> (<span class="id">final</span>, <span class="id">items</span>) := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (<span class="id">start</span>, []) <span class="id">aitems</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (<span class="id">start</span>, <span class="id">seed_items</span>) <span class="id">aitems</span> = (<span class="id">final</span>, <span class="id">items</span> ++ <span class="id">seed_items</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof332')">Proof.</div>
<div class="proofscript" id="proof332">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">seed_items</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">aitems</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (<span class="id">start</span>, []) <span class="id">aitems</span>) <span class="kwd">as</span> (<span class="id">afinal</span>, <span class="id">aitemsX</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHaitems</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plans.transition">transition</a></span> <span class="id">label_a0</span> (<span class="id">afinal</span>, <span class="id">input_a0</span>)) <span class="kwd">as</span> (<span class="kwd">dest</span>, <span class="id">out</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_apply_plan">_apply_plan</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> * <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">final</span>, <span class="id">items</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">_</span> <span class="id">start</span> []) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">rev</a></span> <span class="id">a</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">rev</a></span> <span class="id">items</span>, <span class="id">final</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="_apply_plan_last">_apply_plan_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">after_a</span> := <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">start</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">start</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">after_a</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">after_a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof333')">Proof.</div>
<div class="proofscript" id="proof333">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">after_a</span>. <span class="tactic">clear</span> <span class="id">after_a</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_unit">rev_unit</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="kwd">in</span> <span class="id">IHa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (<span class="id">start</span>, []) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">rev</a></span> <span class="id">a</span>)) <span class="kwd">as</span> (<span class="id">final</span>, <span class="id">items</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:<span class="id">Happly</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plans.transition">transition</a></span> <span class="id">label_a0</span> (<span class="id">final</span>, <span class="id">input_a0</span>)) <span class="kwd">as</span> (<span class="kwd">dest</span>,<span class="id">out</span>) <span class="id">eqn</span>:<span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last_is_last">finite_trace_last_is_last</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="_apply_plan_app">_apply_plan_app</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> <span class="id">a</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">start</span> (<span class="id">a</span> ++ <span class="id">a</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">aitems</span>, <span class="id">afinal</span>) := <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">start</span> <span class="id">a</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>) := <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">afinal</span> <span class="id">a</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">aitems</span> ++ <span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof334')">Proof.</div>
<div class="proofscript" id="proof334">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_app_distr">rev_app_distr</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right_app">fold_right_app</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">_</span> <span class="id">start</span> []) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">rev</a></span>  <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">afinal</span>, <span class="id">aitems</span>) <span class="id">eqn</span>:<span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder">_apply_plan_folder</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id">_</span> <span class="id">afinal</span> []) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">rev</a></span> <span class="id">a</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">final</span>, <span class="id">items</span>) <span class="id">eqn</span>:<span class="id">Ha</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> - <span class="id">Ha</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_folder_additive">_apply_plan_folder_additive</a></span> <span class="id">afinal</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev">rev</a></span> <span class="id">a</span>') <span class="id">aitems</span>) <span class="kwd">as</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ha</span>' <span class="kwd">in</span> <span class="id">Hadd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hadd</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_app_distr">rev_app_distr</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="_apply_plan_cons">_apply_plan_cons</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ai</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">start</span> (<span class="id">ai</span> :: <span class="id">a</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">aitems</span>, <span class="id">afinal</span>) := <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">start</span> [<span class="id">ai</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>) := <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">afinal</span> <span class="id">a</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">aitems</span> ++ <span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof335')">Proof.</div>
<div class="proofscript" id="proof335">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">ai</span> :: <span class="id">a</span>') <span class="kwd">with</span> ([<span class="id">ai</span>] ++ <span class="id">a</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_app">_apply_plan_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">We can forget information from a trace to obtain a plan. </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_transition_item_to_plan_item">_transition_item_to_plan_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= {| <span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> <span class="id">item</span>; <span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> <span class="id">item</span> |}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_trace_to_plan">_trace_to_plan</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">items</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_transition_item_to_plan_item">_transition_item_to_plan_item</a></span> <span class="id">items</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_messages_a">_messages_a</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plans.message">message</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ListExtras.cat_option</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> <span class="id">a</span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plans">apply_plans</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="protocol_plans">protocol_plans</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="vplan_item">vplan_item</a></span> := (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="plan">plan</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#vplan_item">vplan_item</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_plan">apply_plan</a></span> := (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="trace_to_plan">trace_to_plan</a></span> := (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_trace_to_plan">_trace_to_plan</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)).<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_plan_app">apply_plan_app</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> <span class="id">a</span>' : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">start</span> (<span class="id">a</span> ++ <span class="id">a</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">aitems</span>, <span class="id">afinal</span>) := <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">start</span> <span class="id">a</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>) := <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">afinal</span> <span class="id">a</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">aitems</span> ++ <span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_app">_apply_plan_app</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>) <span class="id">start</span> <span class="id">a</span> <span class="id">a</span>').<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="apply_plan_last">apply_plan_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">after_a</span> := <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">start</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">start</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">after_a</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">after_a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_last">_apply_plan_last</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>) <span class="id">start</span> <span class="id">a</span>).<br/>
<br/>
<div class="doc">A plan is protocol w.r.t. a state if by applying it to that state we
  obtain a protocol trace sequence.
  </div>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="finite_protocol_plan_from">finite_protocol_plan_from</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id">_</span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>)).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_plan_from_app_iff">finite_protocol_plan_from_app_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> <span class="id">b</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s_a</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span> /\ <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s_a</span> <span class="id">b</span> &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> (<span class="id">a</span> ++ <span class="id">b</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof336')">Proof.</div>
<div class="proofscript" id="proof336">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_app">apply_plan_app</a></span> <span class="id">s</span> <span class="id">a</span> <span class="id">b</span>) <span class="kwd">as</span> <span class="id">Happ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_last">apply_plan_last</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="kwd">as</span> (<span class="id">aitems</span>, <span class="id">afinal</span>) <span class="id">eqn</span>:<span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s_a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">afinal</span> <span class="id">b</span>) <span class="kwd">as</span> (<span class="id">bitems</span>, <span class="id">bfinal</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Happ</span>. <span class="tactic">simpl</span>. <span class="tactic">clear</span> <span class="id">Happ</span>. <span class="tactic">subst</span> <span class="id">afinal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_plan_empty">finite_protocol_plan_empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span>)  :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof337')">Proof.</div>
<div class="proofscript" id="proof337">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="apply_plan_last_protocol">apply_plan_last_protocol</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpra</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">after_a</span> := <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">after_a</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof338')">Proof.</div>
<div class="proofscript" id="proof338">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">after_a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_last">apply_plan_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_last_pstate">finite_ptrace_last_pstate</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">By extracting a plan from a <span class="bracket"><span class="id">protocol_trace</span></span> based on a state @s@
  and reapplying the plan to the same state @s@ we obtain the original trace
  </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="trace_to_plan_to_trace">trace_to_plan_to_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#trace_to_plan">trace_to_plan</a></span> <span class="id">tr</span>)) = <span class="id">tr</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof339')">Proof.</div>
<div class="proofscript" id="proof339">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tr</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_app_iff">finite_protocol_trace_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Htr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htr</span> <span class="kwd">as</span> [<span class="id">Htr</span> <span class="id">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHtr</span> <span class="id">Htr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_app">apply_plan_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_last">apply_plan_last</a></span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_transition_item_to_plan_item">_transition_item_to_plan_item</a></span> <span class="id">tr</span>)) <span class="kwd">as</span> <span class="id">Hlst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_transition_item_to_plan_item">_transition_item_to_plan_item</a></span> <span class="id">tr</span>)) <span class="kwd">as</span> (<span class="id">aitems</span>, <span class="id">afinal</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eqn</span>:<span class="id">Hapl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">Hapl</span> <span class="kwd">in</span> <span class="id">IHtr</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IHtr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#first_transition_valid">first_transition_valid</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hx</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#_transition_item_to_plan_item">_transition_item_to_plan_item</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span>[<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> ?<span class="id">l</span> ?<span class="id">lst</span>] =&gt; <span class="tactic">replace</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">l</span> <span class="id">lst</span>) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> <span class="id">x</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">The plan extracted from a protocol trace is protocol w.r.t. the starting
  state of the trace.
  </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_trace_from_to_plan">finite_protocol_trace_from_to_plan</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">tr</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span> <span class="id">tr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#trace_to_plan">trace_to_plan</a></span> <span class="id">tr</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof340')">Proof.</div>
<div class="proofscript" id="proof340">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#trace_to_plan_to_trace">trace_to_plan_to_trace</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Characterization of protocol plans. </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_plan_iff">finite_protocol_plan_iff</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">ai</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> <span class="id">ai</span>)) <span class="id">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">prefa</span> <span class="id">suffa</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ai</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heqa</span> : <span class="id">a</span> = <span class="id">prefa</span> ++ [<span class="id">ai</span>] ++ <span class="id">suffa</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lst</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">prefa</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">ai</span>) (<span class="id">lst</span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> <span class="id">ai</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof341')">Proof.</div>
<div class="proofscript" id="proof341">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from_app_iff">finite_protocol_plan_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Ha</span> <span class="id">Hx</span>]; <span class="tactic">apply</span> <span class="id">IHa</span> <span class="kwd">in</span> <span class="id">Ha</span> <span class="kwd">as</span> <span class="id">Ha</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">prefa</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqa</span>; <span class="tactic">discriminate</span> <span class="id">Heqa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hs</span> <span class="id">_</span>]. <span class="id">constructor</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Ha</span>' <span class="kwd">as</span> [<span class="id">Hs</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Ha</span>' <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">Hmsgs</span> <span class="id">_</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>)) <span class="kwd">as</span> <span class="id">lst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ( <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">label_a0</span> (<span class="id">lst</span>, <span class="id">input_a0</span>)) <span class="kwd">as</span> (<span class="kwd">dest</span>, <span class="id">out</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">inversion</span> <span class="id">Hx</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [[<span class="id">_</span> [<span class="id">Hom</span> <span class="id">_</span>]] <span class="id">_</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hsuffa</span> : <span class="id">suffa</span> = [] \/ <span class="id">suffa</span> &lt;&gt; []) <span class="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">destruct</span> <span class="id">suffa</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">congruence</span>); <span class="id">right</span>; <span class="tactic">congruence</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hsuffa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Heqa</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Heqa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inj_tail">app_inj_tail</a></span> <span class="kwd">in</span> <span class="id">Heqa</span>. <span class="tactic">destruct</span> <span class="id">Heqa</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">lst</span>. <span class="tactic">clear</span> <span class="id">lst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">prefa</span>)) <span class="kwd">as</span> <span class="id">lst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>,<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ai</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> ( <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">label_a0</span> (<span class="id">lst</span>, <span class="id">input_a0</span>)) <span class="kwd">as</span> (<span class="kwd">dest</span>, <span class="id">out</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hx</span>. <span class="tactic">inversion</span> <span class="id">Hx</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [[<span class="id">_</span> [<span class="id">_</span> <span class="id">Hv</span>]] <span class="id">_</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#exists_last">exists_last</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">suffa</span>' [<span class="id">x</span>' <span class="id">Heq</span>]]. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Heqa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inj_tail">app_inj_tail</a></span> <span class="kwd">in</span> <span class="id">Heqa</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Heqa</span>. <span class="tactic">destruct</span> <span class="id">Heqa</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span>' <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">Ha</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Ha</span>' <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Hs</span> [<span class="id">Hinput</span> <span class="id">Hvalid</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_app">Forall_app</a></span> <span class="kwd">in</span> <span class="id">Hinput</span>. <span class="tactic">destruct</span> <span class="id">Hinput</span> <span class="kwd">as</span> [<span class="id">Hinput</span> <span class="id">Hinput_ai</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from_app_iff">finite_protocol_plan_from_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Ha</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span>); <span class="tactic">try</span> (<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">IHa</span>; <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvalid</span> <span class="id">prefa</span> (<span class="id">suffa</span> ++ [<span class="id">x</span>]) <span class="id">ai</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvalid</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvalid</span> <span class="id">a</span> [] <span class="id">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_nil_r">app_nil_r</a></span> <span class="kwd">in</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hvalid</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>)) <span class="kwd">as</span> <span class="id">sa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">label_a0</span> (<span class="id">sa</span>, <span class="id">input_a0</span>)) <span class="kwd">as</span> (<span class="kwd">dest</span>, <span class="id">out</span>) <span class="id">eqn</span>:<span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_inv">Forall_inv</a></span> <span class="kwd">in</span> <span class="id">Hinput_ai</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hinput_ai</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_last_pstate">finite_ptrace_last_pstate</a></span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_last">apply_plan_last</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Hlst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlst</span>, <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">Hlst</span> <span class="kwd">in</span> <span class="id">Ha</span>. <span class="tactic">setoid_rewrite</span> &lt;- <span class="id">Heqsa</span> <span class="kwd">in</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">out</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.message">message</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.message">message</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.message">message</a></span>) <span class="kwd">dest</span> <span class="id">out</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">label_a0</span> (<span class="id">sa</span>, <span class="id">input_a0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ha</span> <span class="kwd">as</span> [<span class="id">_oma</span> <span class="id">Hsa</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hinput_ai</span> <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">Hinput_a0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="kwd">with</span> <span class="id">_oma</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Characterizing a singleton protocol plan as a protocol transition. </div>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="finite_protocol_plan_from_one">finite_protocol_plan_from_one</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">a</span>) (<span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> <span class="id">a</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> [<span class="id">a</span>] &lt;-&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">a</span>) (<span class="id">s</span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#input_a">input_a</a></span> <span class="id">a</span>) <span class="id">res</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof342')">Proof.</div>
<div class="proofscript" id="proof342">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>,<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">H</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">context</span>[<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span> <span class="kwd">in</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [<span class="kwd">dest</span> <span class="id">output</span>] <span class="id">eqn</span> : <span class="id">eq_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">setoid_rewrite</span> <span class="id">eq_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">H</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> ?<span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [<span class="kwd">dest</span> <span class="id">output</span>] <span class="id">eqn</span> : <span class="id">eq_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">eq_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="preserves">preserves</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> -&gt; <span class="kwd">Prop</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span> -&gt; <span class="id">P</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>))).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="ensures">ensures</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> -&gt; <span class="kwd">Prop</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span> -&gt; <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="plan_independence">plan_independence</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> <span class="id">b</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Pb</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ha</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hhave</span> : <span class="id">Pb</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hensures</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#ensures">ensures</a></span> <span class="id">b</span> <span class="id">Pb</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpreserves</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#preserves">preserves</a></span> <span class="id">a</span> <span class="id">Pb</span>) :<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id">s</span> (<span class="id">a</span> ++ <span class="id">b</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof343')">Proof.</div>
<div class="proofscript" id="proof343">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#ensures">ensures</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#preserves">preserves</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from_app_iff">finite_protocol_plan_from_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id">s</span> <span class="id">a</span>)) <span class="kwd">as</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hensures</span> <span class="id">s</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hensures</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_last_protocol">apply_plan_last_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heqs</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hpreserves</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span> : <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#protocol_plans">protocol_plans</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
