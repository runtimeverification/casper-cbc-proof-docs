
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.VLSM.Composition</title>
<meta name="description" content="Documentation of Coq module CasperCBC.VLSM.Composition" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.VLSM.Composition</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html">Streams</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Nat.html">Nat</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">Logic.FunctionalExtensionality</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html">Coq.Logic.FinFun</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.Eqdep.html">Coq.Logic.Eqdep</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Basics.html">Coq.Program.Basics</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span>.<br/>
<br/>
<span class="id">From</span> <span class="id">CasperCBC</span><br/>
&nbsp;&nbsp;<span class="kwd">Require</span> <span class="kwd">Import</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">StreamExtras</span> <span class="id">ListExtras</span> <span class="id">Preamble</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html">VLSM.Common</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Plans.html">VLSM.Plans</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<h1> VLSM Composition </h1>
<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition">VLSM_composition</a></span>.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">IndEqDec</span> : <span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition.composite_type">composite_type</a></span>.<br/>
<br/>
<h2> The type of a composite VLSM
Let IM be a family of VLSMs indexed by &lt;&lt;index&gt;&gt;. Note that all
<span class="bracket"><span class="id">VLSM</span></span>s share the same type of &lt;&lt;message&gt;&gt;s.
</h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_composite_state">_composite_state</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">n</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="_composite_label">_composite_label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sigT">sigT</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">n</span>)).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_type">composite_type</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_type">VLSM_type</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#_composite_state">_composite_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#_composite_label">_composite_label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_state">composite_state</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_label">composite_label</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_transition_item">composite_transition_item</a></span> : <span class="kwd">Type</span> := @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="state_update">state_update</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">decide</span> (<span class="id">j</span> = <span class="id">i</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#left">left</a></span> <span class="id">e</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_rect_r">eq_rect_r</a></span> (<span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>)) <span class="id">si</span> <span class="id">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">s</span> <span class="id">j</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="state_update_neq">state_update_neq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hneq</span> : <span class="id">j</span> &lt;&gt; <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span> <span class="id">j</span> = <span class="id">s</span> <span class="id">j</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof161')">Proof.</div>
<div class="proofscript" id="proof161">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span>. <span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">j</span> = <span class="id">i</span>)); <span class="tactic">try</span> <span class="id">contradiction</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="state_update_eq">state_update_eq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span> <span class="id">i</span> = <span class="id">si</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof162')">Proof.</div>
<div class="proofscript" id="proof162">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">decide</span>, <span class="id">decide_rel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_dec_refl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="state_update_id">state_update_id</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">s</span> <span class="id">i</span> = <span class="id">si</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span> = <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof163')">Proof.</div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality_dep_good">functional_extensionality_dep_good</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">j</span> = <span class="id">i</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="state_update_twice">state_update_twice</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> <span class="id">si</span>': <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>) <span class="id">i</span> <span class="id">si</span>' = <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof164')">Proof.</div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality_dep_good">functional_extensionality_dep_good</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">j</span> = <span class="id">i</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="state_update_twice_neq">state_update_twice_neq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> <span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hij</span> : <span class="id">j</span> &lt;&gt; <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>) <span class="id">j</span> <span class="id">sj</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">j</span> <span class="id">sj</span>) <span class="id">i</span> <span class="id">si</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof165')">Proof.</div>
<div class="proofscript" id="proof165">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality_dep_good">functional_extensionality_dep_good</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">k</span> = <span class="id">j</span>)); <span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">k</span> = <span class="id">i</span>)); <span class="tactic">subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span> ; <span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_type">composite_type</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition.composite_sig">composite_sig</a></span>.<br/>
<h2> The signature of a composite VLSM
Assume an non-empty &lt;&lt;index&gt;&gt; type and let &lt;&lt;IT&gt;&gt; be
an &lt;&lt;index&gt;&gt;ed family of <span class="bracket"><span class="id">VLSM_type</span></span>s, and for each index &lt;&lt;i&gt;&gt;, let &lt;&lt;IS i&gt;&gt; be
a <span class="bracket"><span class="id">VLSM_sign</span></span>ature of type &lt;&lt;IT i&gt;&gt;.
</h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> `{<span class="id">i0</span>: <span class="id">Inhabited</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_initial_state_prop">composite_initial_state_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">n</span>) (<span class="id">s</span> <span class="id">n</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_initial_state">composite_initial_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_initial_state_prop">composite_initial_state_prop</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_s0">composite_s0</a></span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_initial_state">composite_initial_state</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof166')">Proof.</div>
<div class="proofscript" id="proof166">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="kwd">fun</span> (<span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>) =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hs</span>]. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Defined.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_initial_message_prop">composite_initial_message_prop</a></span> (<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>) : <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>) (<span class="id">mi</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message">vinitial_message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">n</span>)), <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">mi</span> = <span class="id">m</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_m0">composite_m0</a></span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vm0">vm0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">inhabitant</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_l0">composite_l0</a></span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">inhabitant</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vl0">vl0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">inhabitant</span>)) .<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_sig">composite_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|   <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_initial_state_prop">composite_initial_state_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_s0">composite_s0</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_initial_message_prop">composite_initial_message_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_m0">composite_m0</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_l0">composite_l0</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lift_to_composite_state">lift_to_composite_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s0X</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_s0">composite_s0</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s0X</span> <span class="id">j</span> <span class="id">sj</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lift_to_composite_transition_item">lift_to_composite_transition_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s0X</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_s0">composite_s0</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof167')">Proof.</div>
<div class="proofscript" id="proof167">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">j</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">input</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">destination</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">output</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Defined.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">lift_to_composite_state</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">j</span> <span class="id">sj</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id">lift_to_composite_transition_item</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">item</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof168')">Proof.</div>
<div class="proofscript" id="proof168">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">item</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">j</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">input</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id">lift_to_composite_state</span>' <span class="id">s</span> <span class="id">j</span> <span class="id">destination</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">output</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Defined.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_plan_item">composite_plan_item</a></span> := @<span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_plan">composite_plan</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_plan_item">composite_plan_item</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lift_to_composite_plan_item">lift_to_composite_plan_item</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#vplan_item">vplan_item</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_plan_item">composite_plan_item</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof169')">Proof.</div>
<div class="proofscript" id="proof169">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">i</span> <span class="id">label_a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">exact</span> <span class="id">input_a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Defined.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lift_to_composite_finite_trace">lift_to_composite_finite_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">trj</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition_item">vtransition_item</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_transition_item">lift_to_composite_transition_item</a></span> <span class="id">j</span>) <span class="id">trj</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="lift_to_composite_trace">lift_to_composite_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">trj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vTrace">vTrace</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: @<span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">trj</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> <span class="id">s</span> <span class="id">l</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Finite">Finite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">s</span>) (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_finite_trace">lift_to_composite_finite_trace</a></span> <span class="id">j</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> <span class="id">s</span> <span class="id">l</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#Infinite">Infinite</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">s</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_transition_item">lift_to_composite_transition_item</a></span> <span class="id">j</span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_sig">composite_sig</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition.composite_vlsm">composite_vlsm</a></span>.<br/>
<h2> Constrained VLSM composition
Assume an non-empty &lt;&lt;index&gt;&gt; type, let
&lt;&lt;IT&gt;&gt; be an &lt;&lt;index&gt;&gt;ed family of <span class="bracket"><span class="id">VLSM_type</span></span>s, and for each index &lt;&lt;i&gt;&gt;, let
&lt;&lt;IS i&gt;&gt; be a <span class="bracket"><span class="id">VLSM_sign</span></span>ature of type &lt;&lt;IT i&gt;&gt; and &lt;&lt;IM i&gt;&gt; be a VLSM of
signature &lt;&lt;IS i&gt;&gt;.
</h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span> `{<span class="id">i0</span> : <span class="id">Inhabited</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_transition">composite_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>, <span class="id">om</span>) := <span class="id">som</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">i</span>, <span class="id">li</span>) := <span class="id">l</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">si</span>', <span class="id">om</span>') := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>) <span class="id">li</span> (<span class="id">s</span> <span class="id">i</span>, <span class="id">om</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>',  <span class="id">om</span>').<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_valid">composite_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">s</span>, <span class="id">om</span>) := <span class="id">som</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">i</span>, <span class="id">li</span>) := <span class="id">l</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>) <span class="id">li</span> (<span class="id">s</span> <span class="id">i</span>, <span class="id">om</span>).<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="constrained_composite_valid">constrained_composite_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_valid">composite_valid</a></span> <span class="id">l</span> <span class="id">som</span> /\ <span class="id">constraint</span> <span class="id">l</span> <span class="id">som</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm_machine">composite_vlsm_machine</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_sig">composite_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|  <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_transition">composite_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;  <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#constrained_composite_valid">constrained_composite_valid</a></span> <span class="id">constraint</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm">composite_vlsm</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_machine">composite_vlsm_machine</a></span> <span class="id">constraint</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="composite_transition_state_neq">composite_transition_state_neq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint</span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hi</span> : <span class="id">i</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">s</span>' <span class="id">i</span> = <span class="id">s</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof170')">Proof.</div>
<div class="proofscript" id="proof170">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Ht</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> (<span class="id">il</span>, <span class="id">l</span>). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">il</span>) <span class="id">l</span> (<span class="id">s</span> <span class="id">il</span>, <span class="id">om</span>)) <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">omi</span>') <span class="id">eqn</span>:<span class="id">Ht</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span> <span class="id">omi</span>'. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="composite_transition_state_eq">composite_transition_state_eq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> <span class="id">om</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint</span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) (<span class="id">s</span>', <span class="id">om</span>'))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">il</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">s</span>' <span class="id">il</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">il</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">l</span>) (<span class="id">s</span> <span class="id">il</span>, <span class="id">om</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof171')">Proof.</div>
<div class="proofscript" id="proof171">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [<span class="id">_</span> <span class="id">Ht</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">il</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">il</span>. <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> (<span class="id">il</span>, <span class="id">l</span>). <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">il</span>) <span class="id">l</span> (<span class="id">s</span> <span class="id">il</span>, <span class="id">om</span>)) <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">omi</span>') <span class="id">eqn</span>:<span class="id">Ht</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Composite versions for the generic <span class="bracket"><span class="id">_apply_plan</span></span>-related definitions and
    results.
    </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_apply_plan">composite_apply_plan</a></span> := (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_transition">composite_transition</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_apply_plan_app">composite_apply_plan_app</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> <span class="id">a</span>' : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id">start</span> (<span class="id">a</span> ++ <span class="id">a</span>') =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">aitems</span>, <span class="id">afinal</span>) := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id">start</span> <span class="id">a</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>) := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id">afinal</span> <span class="id">a</span>' <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">aitems</span> ++ <span class="id">a</span>'<span class="id">items</span>, <span class="id">a</span>'<span class="id">final</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_app">_apply_plan_app</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_transition">composite_transition</a></span> <span class="id">start</span> <span class="id">a</span> <span class="id">a</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_apply_plan_last">composite_apply_plan_last</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">start</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan_item">plan_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">after_a</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id">start</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_trace_last">finite_trace_last</a></span> <span class="id">start</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">after_a</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">after_a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan_last">_apply_plan_last</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_transition">composite_transition</a></span> <span class="id">start</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_trace_to_plan">composite_trace_to_plan</a></span> := (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#_trace_to_plan">_trace_to_plan</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition.composite_vlsm.constraint_subsumption_part_one">constraint_subsumption_part_one</a></span>.<br/>
<h2> Constraint subsumption
A &lt;&lt;constraint1&gt;&gt; is subssumed by &lt;&lt;constraint2&gt;&gt; if &lt;&lt;constraint1&gt; is stronger
than &lt;&lt;constraint2&gt;&gt; for any input.
</h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="constraint_subsumption">constraint_subsumption</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint1</span> <span class="id">constraint2</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>) (<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constraint1</span> <span class="id">l</span> <span class="id">som</span> -&gt; <span class="id">constraint2</span> <span class="id">l</span> <span class="id">som</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint1</span> <span class="id">constraint2</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsubsumption</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_subsumption">constraint_subsumption</a></span> <span class="id">constraint1</span> <span class="id">constraint2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X1</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X2</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_protocol_valid">constraint_subsumption_protocol_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.X1">X1</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.X2">X2</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof172')">Proof.</div>
<div class="proofscript" id="proof172">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hps</span> [<span class="id">Hopm</span> [<span class="id">Hv</span> <span class="id">Hctr</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.Hsubsumption">Hsubsumption</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_protocol_prop">constraint_subsumption_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.X1">X1</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.X2">X2</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof173')">Proof.</div>
<div class="proofscript" id="proof173">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.X2">X2</a></span>);<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one.X2">X2</a></span>) <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_subsumption_protocol_valid">constraint_subsumption_protocol_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_one">constraint_subsumption_part_one</a></span>.<br/>
<br/>
<h2> Free VLSM composition
The <span class="bracket"><span class="id">free_constraint</span></span> is defined to be <span class="bracket"><span class="id">True</span></span> for all inputs.
Thus, the <span class="bracket"><span class="id">free_composite_vlsm</span></span> is the <span class="bracket"><span class="id">composite_vlsm</span></span> using the
<span class="bracket"><span class="id">free_constraint</span></span>.
</h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="free_constraint">free_constraint</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="kwd">Prop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="free_composite_vlsm">free_composite_vlsm</a></span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_constraint">free_constraint</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_free_protocol_prop">constraint_free_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">som</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsom</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint</span>) <span class="id">som</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">som</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof174')">Proof.</div>
<div class="proofscript" id="proof174">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">som</span> <span class="kwd">as</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_subsumption_protocol_prop">constraint_subsumption_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">l</span>; <span class="tactic">intros</span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition.composite_vlsm.preloaded_constraint_subsumption">preloaded_constraint_subsumption</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="preloaded_constraint_subsumption">preloaded_constraint_subsumption</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint1</span> <span class="id">constraint2</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span>) (<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constraint1</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>) -&gt; <span class="id">constraint2</span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint1</span> <span class="id">constraint2</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_subsumption">constraint_subsumption</a></span> <span class="id">constraint1</span> <span class="id">constraint2</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption">preloaded_constraint_subsumption</a></span> <span class="id">constraint1</span> <span class="id">constraint2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof175')">Proof.</div>
<div class="proofscript" id="proof175">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Hcs</span> <span class="id">s</span> <span class="id">Hs</span> <span class="id">l</span> <span class="id">om</span> <span class="id">Hc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hcs</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint1</span> <span class="id">constraint2</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsubsumption</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption">preloaded_constraint_subsumption</a></span> <span class="id">constraint1</span> <span class="id">constraint2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X1</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X2</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_protocol_valid">preloaded_constraint_subsumption_protocol_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof176')">Proof.</div>
<div class="proofscript" id="proof176">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hps</span> [<span class="id">Hopm</span> [<span class="id">Hv</span> <span class="id">Hctr</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.Hsubsumption">Hsubsumption</a></span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hps</span> <span class="kwd">as</span> [<span class="id">_om</span> <span class="id">Hps</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_weaken_protocol_prop">preloaded_weaken_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_free_protocol_prop">constraint_free_protocol_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.constraint1">constraint1</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_protocol_prop">preloaded_constraint_subsumption_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof177')">Proof.</div>
<div class="proofscript" id="proof177">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>);<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>) <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_protocol_valid">preloaded_constraint_subsumption_protocol_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_can_emit">preloaded_constraint_subsumption_can_emit</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof178')">Proof.</div>
<div class="proofscript" id="proof178">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [(<span class="id">s0</span>,<span class="id">om0</span>) [<span class="id">l</span> [<span class="id">s</span> [<span class="id">Hv1</span> <span class="id">Ht</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hv2</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_protocol_valid">preloaded_constraint_subsumption_protocol_valid</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hv1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv1</span> <span class="kwd">as</span> [[<span class="id">_om0</span> <span class="id">Hs0</span>] [[<span class="id">_s0</span> <span class="id">Hom0</span>] <span class="id">Hv1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_protocol_prop">preloaded_constraint_subsumption_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_protocol_prop">preloaded_constraint_subsumption_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hom0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s0</span>, <span class="id">om0</span>). <span class="id">exists</span> <span class="id">l</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv2</span> <span class="kwd">as</span> [<span class="id">Hv2</span> <span class="id">Hc2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_om0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_s0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_preloaded_protocol_valid">preloaded_constraint_subsumption_preloaded_protocol_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof179')">Proof.</div>
<div class="proofscript" id="proof179">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hps</span> [<span class="id">Hopm</span> [<span class="id">Hv</span> <span class="id">Hctr</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.Hsubsumption">Hsubsumption</a></span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_state_prop_iff">preloaded_protocol_state_prop_iff</a></span> <span class="kwd">in</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_state_prop_iff">preloaded_protocol_state_prop_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>; [<span class="id">constructor</span>; <span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_generated">preloaded_protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span>); [<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">apply</span> <span class="id">Hv</span>|<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_preloaded_protocol_prop">preloaded_constraint_subsumption_preloaded_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span>) (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>) (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof180')">Proof.</div>
<div class="proofscript" id="proof180">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>));<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>)) <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>;[<span class="tactic">assumption</span>..|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_valid">preloaded_constraint_subsumption_preloaded_protocol_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hv</span> <span class="id">Hc1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_om</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">_s</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_byzantine_message_prop">preloaded_constraint_subsumption_byzantine_message_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#byzantine_message_prop">byzantine_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#byzantine_message_prop">byzantine_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof181')">Proof.</div>
<div class="proofscript" id="proof181">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [(<span class="id">s0</span>,<span class="id">om0</span>) [<span class="id">l</span> [<span class="id">s</span> [<span class="id">Hv1</span> <span class="id">Ht</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hv2</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_valid">preloaded_constraint_subsumption_preloaded_protocol_valid</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hv1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv1</span> <span class="kwd">as</span> [[<span class="id">_om0</span> <span class="id">Hs0</span>] [[<span class="id">_s0</span> <span class="id">Hom0</span>] <span class="id">Hv1</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_prop">preloaded_constraint_subsumption_preloaded_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hs0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_prop">preloaded_constraint_subsumption_preloaded_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hom0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s0</span>, <span class="id">om0</span>). <span class="id">exists</span> <span class="id">l</span>. <span class="id">exists</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv2</span> <span class="kwd">as</span> [<span class="id">Hv2</span> <span class="id">Hc2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_om0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">_s0</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_incl">preloaded_constraint_subsumption_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof182')">Proof.</div>
<div class="proofscript" id="proof182">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span>; <span class="tactic">try</span> (<span class="tactic">assumption</span> || <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_protocol_valid">preloaded_constraint_subsumption_protocol_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_constraint_subsumption_pre_loaded_with_all_messages_incl">preloaded_constraint_subsumption_pre_loaded_with_all_messages_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof183')">Proof.</div>
<div class="proofscript" id="proof183">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X1">X1</a></span>)) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption.X2">X2</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span>; <span class="tactic">try</span> (<span class="tactic">assumption</span> || <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_valid">preloaded_constraint_subsumption_preloaded_protocol_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.preloaded_constraint_subsumption">preloaded_constraint_subsumption</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="VLSM_composition.composite_vlsm.constraint_subsumption_part_two">constraint_subsumption_part_two</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint1</span> <span class="id">constraint2</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsubsumption</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_subsumption">constraint_subsumption</a></span> <span class="id">constraint1</span> <span class="id">constraint2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X1</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X2</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_can_emit">constraint_subsumption_can_emit</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X1">X1</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X2">X2</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof184')">Proof.</div>
<div class="proofscript" id="proof184">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_can_emit">preloaded_constraint_subsumption_can_emit</a></span> <span class="kwd">with</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.constraint1">constraint1</a></span> ; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_preloaded_protocol_valid">constraint_subsumption_preloaded_protocol_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X1">X1</a></span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X2">X2</a></span>) <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof185')">Proof.</div>
<div class="proofscript" id="proof185">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_valid">preloaded_constraint_subsumption_preloaded_protocol_valid</a></span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_preloaded_protocol_prop">constraint_subsumption_preloaded_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X1">X1</a></span>) (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X2">X2</a></span>) (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof186')">Proof.</div>
<div class="proofscript" id="proof186">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_preloaded_protocol_prop">preloaded_constraint_subsumption_preloaded_protocol_prop</a></span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_byzantine_message_prop">constraint_subsumption_byzantine_message_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#byzantine_message_prop">byzantine_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X1">X1</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#byzantine_message_prop">byzantine_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X2">X2</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof187')">Proof.</div>
<div class="proofscript" id="proof187">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_byzantine_message_prop">preloaded_constraint_subsumption_byzantine_message_prop</a></span> <span class="kwd">with</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.constraint1">constraint1</a></span>; [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_incl">constraint_subsumption_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X1">X1</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X2">X2</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof188')">Proof.</div>
<div class="proofscript" id="proof188">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_incl">preloaded_constraint_subsumption_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_subsumption_pre_loaded_with_all_messages_incl">constraint_subsumption_pre_loaded_with_all_messages_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X1">X1</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two.X2">X2</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof189')">Proof.</div>
<div class="proofscript" id="proof189">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_pre_loaded_with_all_messages_incl">preloaded_constraint_subsumption_pre_loaded_with_all_messages_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_constraint_subsumption_weaker">preloaded_constraint_subsumption_weaker</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm.constraint_subsumption_part_two">constraint_subsumption_part_two</a></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="constraint_free_incl">constraint_free_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span>  * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">constraint</span>) <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof190')">Proof.</div>
<div class="proofscript" id="proof190">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#constraint_subsumption_incl">constraint_subsumption_incl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">l</span>; <span class="tactic">intros</span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_composite_free_lift_generalized_initial">protocol_prop_composite_free_lift_generalized_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">Q</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PimpliesQ</span> : <span class="kwd">forall</span> <span class="id">m</span>, <span class="id">P</span> <span class="id">m</span> -&gt; <span class="id">Q</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>) <span class="id">P</span>) (<span class="id">sj</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">sj</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">Q</span>) (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof191')">Proof.</div>
<div class="proofscript" id="proof191">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">sj</span>, <span class="id">om</span>) <span class="kwd">as</span> <span class="id">sjom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">om</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">sj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hp</span>; <span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">Heqsjom</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heqsjom</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span>; <span class="tactic">clear</span> <span class="id">s0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">intro</span> <span class="id">i</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id">j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>; <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span> <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_s0">composite_s0</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om0</span> <span class="kwd">as</span> [<span class="id">m</span>|];[|<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hom</span> |- *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hom</span>;[<span class="id">left</span>|<span class="id">right</span>;<span class="tactic">apply</span> <span class="id">PimpliesQ</span>;<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">j</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">H</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHHp1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHHp2</span> <span class="id">_s</span> <span class="id">om</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">sj</span>) <span class="id">om0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">Q</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">j</span> <span class="id">l</span>) (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">s</span>, <span class="id">om</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">Q</span>)) <span class="kwd">with</span> <span class="id">_om</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">_s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; [<span class="tactic">assumption</span> | <span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- (<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span>) = <span class="id">_</span> =&gt; <span class="tactic">replace</span> <span class="id">t</span> <span class="kwd">with</span> (<span class="id">sj</span>, <span class="id">om0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_twice">state_update_twice</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_prop_composite_free_lift">protocol_prop_composite_free_lift</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>) (<span class="id">sj</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">sj</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof192')">Proof.</div>
<div class="proofscript" id="proof192">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_is_pre_loaded_with_False_protocol_prop">vlsm_is_pre_loaded_with_False_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vlsm_is_pre_loaded_with_False_protocol_prop">vlsm_is_pre_loaded_with_False_protocol_prop</a></span> <span class="kwd">in</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="kwd">fun</span> <span class="id">_</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span>) <span class="kwd">as</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_prop_composite_free_lift_generalized_initial">protocol_prop_composite_free_lift_generalized_initial</a></span> <span class="id">P</span> <span class="id">P</span>); [|<span class="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">m</span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#id">id</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_message_prop_composite_free_lift">protocol_message_prop_composite_free_lift</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>) <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof193')">Proof.</div>
<div class="proofscript" id="proof193">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message_prop">protocol_message_prop</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hp</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hprop</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_prop_composite_free_lift">protocol_prop_composite_free_lift</a></span> <span class="kwd">in</span> <span class="id">Hprop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="can_emit_composite_free_lift">can_emit_composite_free_lift</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">Q</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PimpliesQ</span> : <span class="kwd">forall</span> <span class="id">m</span>, <span class="id">P</span> <span class="id">m</span> -&gt; <span class="id">Q</span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Htrj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>) <span class="id">P</span>) <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#can_emit">can_emit</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_vlsm">pre_loaded_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">Q</span>) <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof194')">Proof.</div>
<div class="proofscript" id="proof194">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Htrj</span> <span class="kwd">as</span> [(<span class="id">s</span>,<span class="id">om</span>) [<span class="id">l</span> [<span class="id">s</span>' [[[<span class="id">_om</span> <span class="id">Hs</span>] [[<span class="id">_s</span> <span class="id">Hom</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> ((<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">s</span>), <span class="id">om</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">j</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">s</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_prop_composite_free_lift_generalized_initial">protocol_prop_composite_free_lift_generalized_initial</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">PimpliesQ</span>) <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_prop_composite_free_lift_generalized_initial">protocol_prop_composite_free_lift_generalized_initial</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">PimpliesQ</span>) <span class="kwd">in</span> <span class="id">Hom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; [<span class="id">exists</span> <span class="id">_om</span>;<span class="tactic">assumption</span>| <span class="id">exists</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id">j</span> <span class="id">_s</span>); <span class="tactic">assumption</span>| ..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- (<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span>) = <span class="id">_</span> =&gt; <span class="tactic">replace</span> <span class="id">t</span> <span class="kwd">with</span> (<span class="id">s</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_twice">state_update_twice</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Updating a composite initial state with a component initial state
    yields a composite initial state </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="composite_free_update_initial_state_with_initial">composite_free_update_initial_state_with_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsi</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>) <span class="id">si</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof195')">Proof.</div>
<div class="proofscript" id="proof195">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">j</span>. <span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">j</span> = <span class="id">i</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">apply</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
<div class="doc">Updating a composite protocol state for the free composition with
    a component initial state yields a composite protocol state </div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="composite_free_update_state_with_initial">composite_free_update_state_with_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">si</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsi</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">i</span>) <span class="id">si</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof196')">Proof.</div>
<div class="proofscript" id="proof196">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop_ind">protocol_state_prop_ind</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">remember</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update">state_update</a></span> <span class="id">s</span> <span class="id">i</span> <span class="id">si</span>) <span class="kwd">as</span> <span class="id">s</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hs</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">s</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">subst</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_free_update_initial_state_with_initial">composite_free_update_initial_state_with_initial</a></span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_is_protocol">initial_is_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">Hps</span> [<span class="id">Hom</span> <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hv</span> <span class="id">_</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> (<span class="id">j</span>, <span class="id">lj</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.IM">IM</a></span> <span class="id">j</span>) <span class="id">lj</span> (<span class="id">s</span> <span class="id">j</span>, <span class="id">om</span>)) <span class="kwd">as</span> (<span class="id">sj</span>', <span class="id">omj</span>') <span class="id">eqn</span>:<span class="id">Htj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span> <span class="id">s</span>' <span class="id">om</span>'. <span class="tactic">clear</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id">j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_twice">state_update_twice</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_twice_neq">state_update_twice_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span> <span class="kwd">as</span> [<span class="id">_om</span> <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hom</span> <span class="kwd">as</span> [<span class="id">_s</span> <span class="id">Hom</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">j</span> <span class="id">lj</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">Hs</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hom</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> <span class="id">Hgen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">n</span>' : <span class="id">j</span> &lt;&gt; <span class="id">i</span>) <span class="tactic">by</span> (<span class="tactic">intro</span> <span class="id">contra</span>; <span class="tactic">subst</span>; <span class="tactic">elim</span> <span class="id">n</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hgen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hgen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span> <span class="kwd">in</span> <span class="id">Hgen</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Htj</span> <span class="kwd">in</span> <span class="id">Hgen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span> <span class="id">_</span>. <span class="tactic">apply</span> <span class="id">Hgen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition.composite_vlsm">composite_vlsm</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#VLSM_composition">VLSM_composition</a></span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_project_preloaded_to_preloaded">protocol_state_project_preloaded_to_preloaded</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">message</span> `{<span class="id">EqDecision</span> <span class="id">index</span>} `{<span class="id">Inhabited</span> <span class="id">index</span>} (<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>) <span class="id">constraint</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span>:=<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>)) <span class="id">i</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>) <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">IM</span> <span class="id">i</span>)) (<span class="id">s</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof197')">Proof.</div>
<div class="proofscript" id="proof197">
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">om</span> <span class="id">Hproto</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_state_prop_iff">preloaded_protocol_state_prop_iff</a></span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">_</span>) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span> (<span class="id">VLSM_type</span>:=(@<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> <span class="id">_</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>)))) <span class="kwd">in</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">som</span>:=(<span class="id">s</span>,<span class="id">om</span>)) <span class="kwd">in</span> <span class="id">Hproto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> <span class="id">s</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">som</span>).<br/>
&nbsp;&nbsp;<span class="id">clearbody</span> <span class="id">som</span>;<span class="tactic">clear</span> <span class="id">s</span> <span class="id">om</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hproto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_initial_state">preloaded_protocol_initial_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">Hs</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">j</span> <span class="id">lj</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#surjective_pairing">surjective_pairing</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id">IM</span> <span class="id">j</span>) <span class="id">lj</span> (<span class="id">s</span> <span class="id">j</span>, <span class="id">om</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id">j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_protocol_generated">preloaded_protocol_generated</a></span>;[<span class="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span> <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">IHHproto1</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_state_project_preloaded">protocol_state_project_preloaded</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">message</span> `{<span class="id">EqDecision</span> <span class="id">index</span>} `{<span class="id">Inhabited</span> <span class="id">index</span>} (<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>) <span class="id">constraint</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span>:=<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>) <span class="id">i</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id">X</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">IM</span> <span class="id">i</span>)) (<span class="id">s</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof198')">Proof.</div>
<div class="proofscript" id="proof198">
&nbsp;&nbsp;<span class="id">change</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id">X</span>) <span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>)) <span class="kwd">in</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> [<span class="id">om</span> <span class="id">Hproto</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_state_project_preloaded_to_preloaded">protocol_state_project_preloaded_to_preloaded</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_weaken_protocol_prop">preloaded_weaken_protocol_prop</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_preloaded_project_active">protocol_transition_preloaded_project_active</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span>} `{<span class="id">EqDecision</span> <span class="id">V</span>} `{<span class="id">Inhabited</span> <span class="id">V</span>} {<span class="id">IM</span>: <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>} {<span class="id">constraint</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> <span class="id">s</span> <span class="id">im</span> <span class="id">s</span>' <span class="id">om</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>) <span class="id">l</span> (<span class="id">s</span>,<span class="id">im</span>) (<span class="id">s</span>',<span class="id">om</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">IM</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>))) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>), <span class="id">im</span>) (<span class="id">s</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>), <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof199')">Proof.</div>
<div class="proofscript" id="proof199">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hptrans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">j</span> <span class="id">lj</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hptrans</span> <span class="kwd">as</span> [<span class="id">Hpvalid</span> <span class="id">Htrans</span>].<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hpvalid</span> <span class="kwd">as</span> [<span class="id">Hproto_s</span> [<span class="id">_</span> <span class="id">Hcvalid</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[|<span class="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">revert</span> <span class="id">Hproto_s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_state_project_preloaded_to_preloaded">protocol_state_project_preloaded_to_preloaded</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#any_message_is_protocol_in_preloaded">any_message_is_protocol_in_preloaded</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hcvalid</span> <span class="kwd">as</span> [<span class="id">Hvalid</span> <span class="id">Hconstraint</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">Hvalid</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Htrans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id">IM</span> <span class="id">j</span>) <span class="id">lj</span> (<span class="id">s</span> <span class="id">j</span>, <span class="id">im</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> <span class="id">Htrans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_project_active">protocol_transition_project_active</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span>} `{<span class="id">EqDecision</span> <span class="id">V</span>} `{<span class="id">Inhabited</span> <span class="id">V</span>} {<span class="id">IM</span>: <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>} {<span class="id">constraint</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> <span class="id">s</span> <span class="id">im</span> <span class="id">s</span>' <span class="id">om</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">im</span>) (<span class="id">s</span>',<span class="id">om</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">IM</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>))) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>), <span class="id">im</span>) (<span class="id">s</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>), <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof200')">Proof.</div>
<div class="proofscript" id="proof200">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hptrans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_weaken_protocol_transition">preloaded_weaken_protocol_transition</a></span> <span class="kwd">in</span> <span class="id">Hptrans</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hptrans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_transition_preloaded_project_active">protocol_transition_preloaded_project_active</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_preloaded_project_any">protocol_transition_preloaded_project_any</a></span> {<span class="id">V</span>} (<span class="id">i</span>:<span class="id">V</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span>} `{<span class="id">EqDecision</span> <span class="id">V</span>} `{<span class="id">Inhabited</span> <span class="id">V</span>} {<span class="id">IM</span>: <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>} {<span class="id">constraint</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span>:<span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> <span class="id">X</span>) <span class="id">s</span> <span class="id">im</span> <span class="id">s</span>' <span class="id">om</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id">X</span>) <span class="id">l</span> (<span class="id">s</span>,<span class="id">im</span>) (<span class="id">s</span>',<span class="id">om</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id">s</span> <span class="id">i</span> = <span class="id">s</span>' <span class="id">i</span> \/<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">li</span>, (<span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">i</span> <span class="id">li</span>) /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">IM</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">li</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">i</span>,<span class="id">im</span>) (<span class="id">s</span>' <span class="id">i</span>,<span class="id">om</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof201')">Proof.</div>
<div class="proofscript" id="proof201">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hptrans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">j</span> <span class="id">lj</span>].<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id">j</span>)).<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span> <span class="id">j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">lj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;[<span class="tactic">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hptrans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_transition_preloaded_project_active">protocol_transition_preloaded_project_active</a></span>.<br/>
&nbsp;&nbsp;- <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hptrans</span> <span class="kwd">as</span> [<span class="id">Hpvalid</span> <span class="id">Htrans</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Htrans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id">IM</span> <span class="id">j</span>) <span class="id">lj</span> (<span class="id">s</span> <span class="id">j</span>, <span class="id">im</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion_clear</span> <span class="id">Htrans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span> <span class="tactic">by</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="protocol_transition_project_any">protocol_transition_project_any</a></span> {<span class="id">V</span>} (<span class="id">i</span>:<span class="id">V</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span>} `{<span class="id">EqDecision</span> <span class="id">V</span>} `{<span class="id">Inhabited</span> <span class="id">V</span>} {<span class="id">IM</span>: <span class="id">V</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>} {<span class="id">constraint</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span>:<span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> <span class="id">X</span>) <span class="id">s</span> <span class="id">im</span> <span class="id">s</span>' <span class="id">om</span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id">X</span> <span class="id">l</span> (<span class="id">s</span>,<span class="id">im</span>) (<span class="id">s</span>',<span class="id">om</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id">s</span> <span class="id">i</span> = <span class="id">s</span>' <span class="id">i</span> \/<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">li</span>, (<span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">i</span> <span class="id">li</span>) /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id">IM</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">li</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">i</span>,<span class="id">im</span>) (<span class="id">s</span>' <span class="id">i</span>,<span class="id">om</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof202')">Proof.</div>
<div class="proofscript" id="proof202">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hproto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#preloaded_weaken_protocol_transition">preloaded_weaken_protocol_transition</a></span> <span class="kwd">in</span> <span class="id">Hproto</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">Hproto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#protocol_transition_preloaded_project_any">protocol_transition_preloaded_project_any</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="projections">projections</a></span>.<br/>
<br/>
<h2> Composite VLSM projections
Let us fix an indexed set of VLSMs &lt;&lt;IM&gt;&gt; and their composition &lt;&lt;X&gt;&gt; using &lt;&lt;constraint&gt;&gt;.
</h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">IndEqDec</span> : <span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id">i0</span> : <span class="id">Inhabited</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">T</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_type">composite_type</a></span> <span class="id">IM</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">constraint</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_label">composite_label</a></span> <span class="id">IM</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_state">composite_state</a></span> <span class="id">IM</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">message</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm">composite_vlsm</a></span> <span class="id">IM</span> <span class="id">constraint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm_constrained_projection_sig">composite_vlsm_constrained_projection_sig</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_sign">VLSM_sign</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#type">type</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|   <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_state_prop">initial_state_prop</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_prop">initial_message_prop</a></span> := <span class="kwd">fun</span> <span class="id">pmi</span> =&gt; <span class="id">exists</span> <span class="id">xm</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_message">protocol_message</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">xm</span> = <span class="id">pmi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#m0">m0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vm0">vm0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;   <span class="id"><a href="CasperCBC.VLSM.Common.html#l0">l0</a></span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#vl0">vl0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="projection_valid">projection_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">li</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">siomi</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>) * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="id">si</span>, <span class="id">omi</span>) := <span class="id">siomi</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">s</span> <span class="id">i</span> = <span class="id">si</span> /\ <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id">i</span> <span class="id">li</span>) (<span class="id">s</span>, <span class="id">omi</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_valid_implies_valid">projection_valid_implies_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">li</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">siomi</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>) * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hcomposite</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_valid">projection_valid</a></span> <span class="id">i</span> <span class="id">li</span> <span class="id">siomi</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>) <span class="id">li</span> <span class="id">siomi</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof203')">Proof.</div>
<div class="proofscript" id="proof203">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">siomi</span> <span class="kwd">as</span> [<span class="id">si</span> <span class="id">omi</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hcomposite</span> <span class="kwd">as</span> [<span class="id">s</span> [<span class="id">Hsi</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">Hvalid</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hvalid</span> <span class="kwd">as</span> [<span class="id">Hvalid</span> <span class="id">Hconstraint</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm_constrained_projection_machine">composite_vlsm_constrained_projection_machine</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_class">VLSM_class</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_constrained_projection_sig">composite_vlsm_constrained_projection_sig</a></span> <span class="id">i</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|  <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span> :=  <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;  <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_valid">projection_valid</a></span> <span class="id">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm_constrained_projection">composite_vlsm_constrained_projection</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Common.html#mk_vlsm">mk_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_constrained_projection_machine">composite_vlsm_constrained_projection_machine</a></span> <span class="id">i</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="projections.fixed_projection">fixed_projection</a></span>.<br/>
<br/>
<h2> Projection traces are Byzantine
Let us fix an index &lt;&lt;j&gt;&gt; and let &lt;&lt;Xj&gt;&gt; be the projection of &lt;&lt;X&gt;&gt; on
component &lt;&lt;j&gt;&gt;.
In this section we establish some basic properties for projections, building up
to Lemma <span class="bracket"><span class="id">proj_pre_loaded_with_all_messages_incl</span></span>, which guarantees that all
<span class="bracket"><span class="id">protocol_trace</span></span>s of &lt;&lt;Xj&gt;&gt; are also <span class="bracket"><span class="id">protocol_trace</span></span>s for the
<span class="bracket"><span class="id">pre_loaded_with_all_messages_vlsm</span></span> associated to the component &lt;&lt;IM j&gt;&gt;.
In particular this ensures that the byzantine traces of &lt;&lt;IM j&gt;&gt; include all
<span class="bracket"><span class="id">protocol_trace</span></span>s of &lt;&lt;Xj&gt;&gt; (see Lemma <span class="bracket"><span class="id">pre_loaded_with_all_messages_alt_eq</span></span>).
</h2>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Xj</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_constrained_projection">composite_vlsm_constrained_projection</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="initial_state_projection">initial_state_projection</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinit</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.Xj">Xj</a></span> (<span class="id">s</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.j">j</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof204')">Proof.</div>
<div class="proofscript" id="proof204">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hinit</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.j">j</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_message_projection">protocol_message_projection</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">iom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HpmX</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> <span class="id">iom</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.Xj">Xj</a></span> <span class="id">iom</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof205')">Proof.</div>
<div class="proofscript" id="proof205">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#option_initial_message_is_protocol">option_initial_message_is_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">iom</span> <span class="kwd">as</span> [<span class="id">m</span>|];[|<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">m</span> <span class="id">HpmX</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="protocol_message_projection_rev">protocol_message_projection_rev</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">iom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpmj</span>: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.Xj">Xj</a></span> <span class="id">iom</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> <span class="id">iom</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof206')">Proof.</div>
<div class="proofscript" id="proof206">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">iom</span> <span class="kwd">as</span> [<span class="id">m</span>|];[|<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_None">option_protocol_message_None</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hpmj</span> <span class="kwd">as</span> [<span class="id">sj</span> <span class="id">Hpmj</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpmj</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hom</span> <span class="kwd">as</span> [<span class="id">pm</span> &lt;-]. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">sX</span> [<span class="id">Heqs</span> <span class="id">Hv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">lX</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">n</span>)) <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.j">j</a></span> <span class="id">l</span>) <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop_valid_out">protocol_prop_valid_out</a></span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">exact</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="proj_pre_loaded_with_all_messages_protocol_prop">proj_pre_loaded_with_all_messages_protocol_prop</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PreLoaded</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.j">j</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hps</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.Xj">Xj</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id">PreLoaded</span> (<span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof207')">Proof.</div>
<div class="proofscript" id="proof207">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id">PreLoaded</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>. <span class="tactic">destruct</span> <span class="id">om0</span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id">PreLoaded</span>) <span class="kwd">with</span> <span class="id">_om</span> <span class="id">_s</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_valid_implies_valid">projection_valid_implies_valid</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="proj_pre_loaded_with_all_messages_incl">proj_pre_loaded_with_all_messages_incl</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">PreLoaded</span> := <span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.j">j</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM_incl">VLSM_incl</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.Xj">Xj</a></span> <span class="id">PreLoaded</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof208')">Proof.</div>
<div class="proofscript" id="proof208">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#basic_VLSM_incl">basic_VLSM_incl</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection.Xj">Xj</a></span>) (<span class="id"><a href="CasperCBC.VLSM.Common.html#machine">machine</a></span> <span class="id">PreLoaded</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span>; <span class="tactic">try</span> (<span class="tactic">assumption</span> || <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#initial_message_is_protocol">initial_message_is_protocol</a></span>; <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_valid_implies_valid">projection_valid_implies_valid</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">Hv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.fixed_projection">fixed_projection</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Section</span> <span class="id"><a name="projections.projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>.<br/>
<br/>
<h2> A sufficient condition for being <span class="bracket"><span class="id">projection_friendly</span></span>. </h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;(<span class="id">j</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Xj</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_constrained_projection">composite_vlsm_constrained_projection</a></span> <span class="id">j</span>)<br/>
&nbsp;&nbsp;.<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="kwd">forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">lj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">lj</span> (<span class="id">sj</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hsi</span> : <span class="id">s</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> = <span class="id">sj</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;, <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> <span class="id">_</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">lj</span>) (<span class="id">s</span>, <span class="id">om</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_protocol_message">projection_friendliness_sufficient_condition_protocol_message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#option_protocol_message_prop">option_protocol_message_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> <span class="id">om</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof209')">Proof.</div>
<div class="proofscript" id="proof209">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [<span class="id">Hpsj</span> [<span class="id">Hpmj</span> [<span class="id">sx</span> [<span class="id">Hs</span> [<span class="id">HpsX</span> [<span class="id">HpmX</span> <span class="id">Hv</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="lift_to_composite_state_initial">lift_to_composite_state_initial</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">sj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hinitj</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>) <span class="id">sj</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">sj</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof210')">Proof.</div>
<div class="proofscript" id="proof210">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span>. <span class="tactic">destruct</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#s0">s0</a></span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_protocol_state">projection_friendliness_sufficient_condition_protocol_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfr</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hp</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_prop">protocol_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof211')">Proof.</div>
<div class="proofscript" id="proof211">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">s</span>, <span class="id">om</span>) <span class="kwd">as</span> <span class="id">som</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">om</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hp</span>; <span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">Heqsom</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Heqsom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span>);[|<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state_initial">lift_to_composite_state_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHHp1</span> <span class="id">s</span> <span class="id">_om</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">om0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s0</span>, <span class="id">om0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="kwd">fun</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">n</span>)) <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">l</span>) (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>, <span class="id">om</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">Hp1</span> <span class="id">Hp2</span> <span class="id">Hv</span>); <span class="tactic">intros</span> <span class="id">Hpvj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hfr</span> <span class="id">l</span> <span class="id">s</span> <span class="id">om</span> <span class="id">Hpvj</span> <span class="id">_</span> <span class="id">IHHp1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="tactic">at</span> 1 <span class="kwd">in</span> <span class="id">Hfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span> <span class="kwd">in</span> <span class="id">Hfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hfr</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_message">projection_friendliness_sufficient_condition_protocol_message</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hpvj</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span>  [<span class="id">_sX</span> <span class="id">HpmX</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHHp1</span> <span class="kwd">as</span> [<span class="id">_omX</span> <span class="id">HpsX</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated">protocol_generated</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="kwd">fun</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">n</span>)) <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_omX</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">HpsX</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">_sX</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">om</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">HpmX</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hfr</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="tactic">at</span> 1. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>) <span class="id">l</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>) <span class="id">s</span> <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">s0</span>, <span class="id">om0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_twice">state_update_twice</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_valid">projection_friendliness_sufficient_condition_valid</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfr</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hv</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">om</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="kwd">fun</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">n</span>)) <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">l</span>) (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>, <span class="id">om</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof212')">Proof.</div>
<div class="proofscript" id="proof212">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_state">projection_friendliness_sufficient_condition_protocol_state</a></span> <span class="id">Hfr</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intros</span> <span class="id">HpsX</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hfr</span> <span class="id">l</span> <span class="id">s</span> <span class="id">om</span> <span class="id">Hv</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hv</span> <span class="kwd">as</span> [[<span class="id">_om</span> <span class="id">Hpsj</span>] [<span class="id">Hpmj</span> [<span class="id">_sx</span> [<span class="id">Hs</span> [<span class="id">_HpsX</span> [<span class="id">HpmX</span> <span class="id">Hv</span>]]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">HpsX</span> <span class="id">_om</span> <span class="id">Hpsj</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="tactic">at</span> 2 <span class="kwd">in</span> <span class="id">Hfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span> <span class="kwd">in</span> <span class="id">Hfr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hfr</span> <span class="id">HpsX</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_protocol_transition">projection_friendliness_sufficient_condition_protocol_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfr</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">is</span> <span class="id">os</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">iom</span> <span class="id">oom</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">l</span> (<span class="id">is</span>, <span class="id">iom</span>) (<span class="id">os</span>, <span class="id">oom</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#existT">existT</a></span> (<span class="kwd">fun</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.index">index</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id">n</span>)) <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">is</span>, <span class="id">iom</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">os</span>, <span class="id">oom</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof213')">Proof.</div>
<div class="proofscript" id="proof213">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[[<span class="id">_om</span> <span class="id">Hps</span>] [[<span class="id">_s</span> <span class="id">Hpm</span>] <span class="id">Hv</span>]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_generated_valid">protocol_generated_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">Hps</span> <span class="id">Hpm</span> <span class="id">Hv</span>); <span class="tactic">intros</span> <span class="id">Hpv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_state">projection_friendliness_sufficient_condition_protocol_state</a></span> <span class="kwd">with</span> <span class="id">_om</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_message">projection_friendliness_sufficient_condition_protocol_message</a></span> <span class="kwd">in</span> <span class="id">Hpv</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_valid">projection_friendliness_sufficient_condition_valid</a></span> <span class="id">Hfr</span> <span class="id">l</span> <span class="id">is</span> <span class="id">iom</span> <span class="id">Hpv</span>); <span class="tactic">intros</span> [<span class="id">HvX</span> <span class="id">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_valid">projection_friendliness_sufficient_condition_valid</a></span> <span class="id">Hfr</span> <span class="id">l</span> <span class="id">is</span> <span class="id">iom</span> <span class="id">Hpv</span>); <span class="tactic">intros</span> [<span class="id">_</span> <span class="id">Hctr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="tactic">at</span> 1. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>) <span class="id">l</span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#pair">pair</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.message">message</a></span>) <span class="id">is</span> <span class="id">iom</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> (<span class="id">os</span>, <span class="id">oom</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_twice">state_update_twice</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_finite_ptrace">projection_friendliness_sufficient_condition_finite_ptrace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfr</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpxt</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from">finite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_transition_item">lift_to_composite_transition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>) <span class="id">ls</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof214')">Proof.</div>
<div class="proofscript" id="proof214">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hpxt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">m</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_state">projection_friendliness_sufficient_condition_protocol_state</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_transition">projection_friendliness_sufficient_condition_protocol_transition</a></span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_infinite_ptrace">projection_friendliness_sufficient_condition_infinite_ptrace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfr</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ls</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition_item">transition_item</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpxt</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">s</span> <span class="id">ls</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#infinite_protocol_trace_from">infinite_protocol_trace_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state">lift_to_composite_state</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.Streams.html#map">Streams.map</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_transition_item">lift_to_composite_transition_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span>) <span class="id">ls</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof215')">Proof.</div>
<div class="proofscript" id="proof215">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ls</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> [[<span class="id">l</span> <span class="id">input</span> <span class="id">destination</span> <span class="id">output</span>] <span class="id">ls</span>] <span class="id">s</span> <span class="id">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hx</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">map_Cons</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_protocol_transition">projection_friendliness_sufficient_condition_protocol_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="projection_friendliness_sufficient_condition_protocol_trace">projection_friendliness_sufficient_condition_protocol_trace</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfr</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">t</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#Trace">Trace</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpt</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.Xj">Xj</a></span> <span class="id">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_trace_prop">protocol_trace_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.X">X</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_trace">lift_to_composite_trace</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.IM">IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition.j">j</a></span> <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof216')">Proof.</div>
<div class="proofscript" id="proof216">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="kwd">as</span> [<span class="id">s</span> <span class="id">ls</span>| <span class="id">s</span> <span class="id">ss</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">destruct</span> <span class="id">Hpt</span> <span class="kwd">as</span> [<span class="id">Hxt</span> <span class="id">Hinit</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_finite_ptrace">projection_friendliness_sufficient_condition_finite_ptrace</a></span> <span class="kwd">in</span> <span class="id">Hxt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state_initial">lift_to_composite_state_initial</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projection_friendliness_sufficient_condition_infinite_ptrace">projection_friendliness_sufficient_condition_infinite_ptrace</a></span> <span class="kwd">in</span> <span class="id">Hxt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#lift_to_composite_state_initial">lift_to_composite_state_initial</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections.projection_friendliness_sufficient_condition">projection_friendliness_sufficient_condition</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#projections">projections</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="free_projections">free_projections</a></span>.<br/>
<br/>
<h2> Projections of free compositions
These projections are simple instances of the projections defined above in which
the composition constraint is taken to be <span class="bracket"><span class="id">True</span></span>.
All results from regular projections carry to these "free" projections.
</h2>
<br/>
&nbsp;&nbsp;<span class="kwd">Context</span> {<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">IndEqDec</span> : <span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IM</span> :<span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">i0</span> : <span class="id">Inhabited</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> := <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id">IM</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="composite_vlsm_free_projection">composite_vlsm_free_projection</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_constrained_projection">composite_vlsm_constrained_projection</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_constraint">free_constraint</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span>) <span class="id">i</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="preloaded_composed_protocol_state">preloaded_composed_protocol_state</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">i</span>)) (<span class="id">s</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof217')">Proof.</div>
<div class="proofscript" id="proof217">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">revert</span> <span class="id">i</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> 1 <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop_ind">protocol_state_prop_ind</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop_iff">protocol_state_prop_iff</a></span>. <span class="id">left</span>. <span class="id">specialize</span> (<span class="id">Hs</span> <span class="id">i</span>). <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_state_prop">vinitial_state_prop</a></span> <span class="kwd">in</span> <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id">s</span> <span class="id">i</span>) <span class="id">Hs</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">Hps</span> [<span class="id">Hpm</span> [<span class="id">Hv</span> <span class="id">_</span>]]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> (<span class="id">i</span>', <span class="id">li</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">i</span>') <span class="id">li</span>' (<span class="id">s</span> <span class="id">i</span>', <span class="id">om</span>)) <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">omi</span>') <span class="id">eqn</span>:<span class="id">Ht</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span> <span class="id">s</span>' <span class="id">omi</span>'; <span class="tactic">clear</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id">i</span>')).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">i</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHHs</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop_iff">protocol_state_prop_iff</a></span>. <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">li</span>'. <span class="id">exists</span> (<span class="id">s</span> <span class="id">i</span>, <span class="id">om</span>). <span class="id">exists</span> <span class="id">om</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vs0">vs0</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">i</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_initial">protocol_initial</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj2_sig">proj2_sig</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">om</span>;<span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#I">I</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">apply</span> <span class="id">IHHs</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="relevant_component_transition">relevant_component_transition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">input</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : (<span class="id">s</span> <span class="id">i</span>) = (<span class="id">s</span>' <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpr</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">input</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">input</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof218')">Proof.</div>
<div class="proofscript" id="proof218">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_valid">protocol_valid</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [<span class="tactic">intuition</span>|<span class="tactic">intuition</span>|..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#valid">valid</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#constrained_composite_valid">constrained_composite_valid</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_valid">composite_valid</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_constraint">free_constraint</a></span> <span class="kwd">in</span> *; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vvalid">vvalid</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">i</span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="relevant_component_transition2">relevant_component_transition2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">input</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : (<span class="id">s</span> <span class="id">i</span>) = (<span class="id">s</span>' <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprs</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>') :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="kwd">dest</span>, <span class="id">output</span>) := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>, <span class="id">input</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> (<span class="kwd">dest</span>', <span class="id">output</span>') := <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">l</span> (<span class="id">s</span>', <span class="id">input</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">output</span> = <span class="id">output</span>' /\ (<span class="kwd">dest</span> <span class="id">i</span>) = (<span class="kwd">dest</span>' <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof219')">Proof.</div>
<div class="proofscript" id="proof219">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#transition">transition</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">i</span> <span class="kwd">in</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">x</span>) <span class="id">v</span> (<span class="id">s</span>' <span class="id">x</span>, <span class="id">input</span>)); [<span class="tactic">intuition</span>|..].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="relevant_components_one">relevant_components_one</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprs</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ai</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#vplan_item">vplan_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">ai</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : (<span class="id">s</span> <span class="id">i</span>) = (<span class="id">s</span>' <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpr</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span> [<span class="id">ai</span>]) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span>' := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>' [<span class="id">ai</span>]) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span> [<span class="id">ai</span>]) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>' [<span class="id">ai</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">res</span>' <span class="id">i</span>) = <span class="id">res</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof220')">Proof.</div>
<div class="proofscript" id="proof220">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ai</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span> [<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span> <span class="kwd">in</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="id">eqn</span> : <span class="id">eq_trans</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span> [<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span> <span class="kwd">in</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="id">eqn</span> : <span class="id">eq_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hpr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">label_a</span> (<span class="id">s</span>', <span class="id">input_a</span>) (<span class="id">s0</span>, <span class="id">o</span>)). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H6</span> <span class="kwd">as</span> [<span class="id">Hpr_valid</span> <span class="id">Htrans</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#relevant_component_transition">relevant_component_transition</a></span> <span class="kwd">with</span> (<span class="id">s</span>' := <span class="id">s</span>') <span class="kwd">in</span> <span class="id">Hpr_valid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span> : <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_extend">finite_ptrace_extend</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_empty">finite_ptrace_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition_destination">protocol_transition_destination</a></span> <span class="kwd">in</span> <span class="id">H7</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#relevant_component_transition2">relevant_component_transition2</a></span> <span class="id">s</span> <span class="id">s</span>' <span class="id">l</span> <span class="id">input_a</span>) <span class="kwd">as</span> <span class="id">Hrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hrel</span>. <span class="tactic">unfold</span> <span class="id">i</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="id">specialize</span> (<span class="id">Hrel</span> <span class="id">Heq</span> <span class="id">Hprs</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">Hrel</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span> =&gt; <span class="tactic">replace</span> <span class="id">t</span> <span class="kwd">with</span> (<span class="id">s1</span>, <span class="id">o0</span>) <span class="kwd">in</span> <span class="id">Hrel</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">Hrel</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span> =&gt; <span class="tactic">replace</span> <span class="id">t</span> <span class="kwd">with</span> (<span class="id">s0</span>, <span class="id">o</span>) <span class="kwd">in</span> <span class="id">Hrel</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="irrelevant_components_one">irrelevant_components_one</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ai</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_plan_item">composite_plan_item</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hdif</span> : <span class="id">i</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">ai</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">s</span> [<span class="id">ai</span>]) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">res</span> <span class="id">i</span>) = (<span class="id">s</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof221')">Proof.</div>
<div class="proofscript" id="proof221">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span>, <span class="id"><a href="CasperCBC.VLSM.Plans.html#_apply_plan">_apply_plan</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">ai</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">context</span> [<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := <span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span> <span class="kwd">in</span> <span class="id">_</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span> <span class="id">eqn</span> : <span class="id">eq_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">eq_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">eq_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">label_a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">eq_trans</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="kwd">let</span> (<span class="id">si</span>', <span class="id">om</span>') := ?<span class="id">t</span> <span class="kwd">in</span> <span class="id">_</span>) = <span class="id">_</span> =&gt; <span class="tactic">destruct</span> <span class="id">t</span> <span class="kwd">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">eq_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="irrelevant_components">irrelevant_components</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#state">state</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_plan">composite_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a_indices</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">_</span> <span class="id">_</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hdif</span> : ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> <span class="id">a_indices</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">res</span> <span class="id">i</span>) = (<span class="id">s</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof222')">Proof.</div>
<div class="proofscript" id="proof222">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan_app">composite_apply_plan_app</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="kwd">as</span> (<span class="id">tra</span>, <span class="id">sa</span>) <span class="id">eqn</span> : <span class="id">eq_a</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">sa</span> [<span class="id">x</span>]) <span class="kwd">as</span> (<span class="id">trx</span>, <span class="id">sx</span>) <span class="id">eqn</span> : <span class="id">eq_x</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">a_indices</span> <span class="kwd">in</span> <span class="id">Hdif</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hdif</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span> <span class="kwd">in</span> <span class="id">Hdif</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHa</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">sx</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">sa</span> [<span class="id">x</span>])) <span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id">eq_x</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#irrelevant_components_one">irrelevant_components_one</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">contra</span> <span class="kwd">in</span> <span class="id">Hdif</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hdif</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hdif</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="relevant_components">relevant_components</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hprs</span>' : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_state_prop">protocol_state_prop</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#plan">plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a_indices</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">_</span> <span class="id">_</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> (@<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">li</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="kwd">forall</span> (<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> <span class="id">li</span> -&gt; (<span class="id">s</span>' <span class="id">i</span>) = (<span class="id">s</span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hincl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">a_indices</span> <span class="id">li</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hpr</span> : <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span> <span class="id">a</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span>' := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>' <span class="id">a</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">res</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span> <span class="id">a</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from">finite_protocol_plan_from</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>' <span class="id">a</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">i</span> <span class="id">li</span> -&gt; (<span class="id">res</span>' <span class="id">i</span>) = <span class="id">res</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof223')">Proof.</div>
<div class="proofscript" id="proof223">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span> <span class="kwd">using</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#rev_ind">rev_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_empty">finite_protocol_plan_empty</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from_app_iff">finite_protocol_plan_from_app_iff</a></span> <span class="kwd">in</span> <span class="id">Hpr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hpr</span> <span class="kwd">as</span> [<span class="id">Hrem</span> <span class="id">Hsingle</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHa</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id">P</span>:=<span class="kwd">fun</span> <span class="id">n</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vlabel">vlabel</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">n</span>))) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">a</span>)) <span class="kwd">as</span> <span class="id">small</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id">m</span> := <span class="id">a_indices</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">a_indices</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span> : <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHa</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHa</span> <span class="kwd">as</span> [<span class="id">IHapr</span> <span class="id">IHaind</span>].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#relevant_components_one">relevant_components_one</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span> <span class="id">a</span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>' <span class="id">a</span>))) <span class="kwd">as</span> <span class="id">Hrel</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hrel</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_last_protocol">apply_plan_last_protocol</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">all</span> : <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hrel</span> <span class="id">x</span>); <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">spec</span> <span class="id">Hrel</span>. {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHaind</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHaind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="kwd">in</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hincl</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hincl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">a_indices</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_app">map_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>; <span class="tactic">simpl</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hrel</span> <span class="id">Hsingle</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hrel</span> <span class="kwd">as</span> [<span class="id">Hrelpr</span> <span class="id">Hrelind</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Plans.html#finite_protocol_plan_from_app_iff">finite_protocol_plan_from_app_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">i</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHaind</span> <span class="id">i</span> <span class="id">Hi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Heq</span> <span class="id">i</span> <span class="id">Hi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> !<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan_app">apply_plan_app</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span>' <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">tra</span>', <span class="id">sa</span>') <span class="id">eqn</span> : <span class="id">eq_as</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">s</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">tra</span>, <span class="id">sa</span>) <span class="id">eqn</span> : <span class="id">eq_as</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">sa</span> [<span class="id">x</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">trx</span>, <span class="id">sx</span>) <span class="id">eqn</span> : <span class="id">eq_xsa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#apply_plan">apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span> <span class="id">sa</span>' [<span class="id">x</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> (<span class="id">trx</span>', <span class="id">sx</span>') <span class="id">eqn</span> : <span class="id">eq_xsa</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> (<span class="id"><a href="CasperCBC.VLSM.Plans.html#label_a">label_a</a></span> <span class="id">x</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">rewrite</span> <span class="id">e</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#irrelevant_components_one">irrelevant_components_one</a></span> <span class="id">sa</span>) <span class="kwd">as</span> <span class="id">Hdiff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hdiff</span> <span class="id">x</span> <span class="id">i</span> <span class="id">n</span>).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#irrelevant_components_one">irrelevant_components_one</a></span> <span class="id">sa</span>') <span class="kwd">as</span> <span class="id">Hdiff0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hdiff0</span> <span class="id">x</span> <span class="id">i</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="tactic">f_equal</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span>) <span class="kwd">in</span> <span class="id">eq_xsa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="tactic">f_equal</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span>) <span class="kwd">in</span> <span class="id">eq_xsa</span>'.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">sx</span>' <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">sa</span>' [<span class="id">x</span>])).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">sx</span> <span class="kwd">with</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_apply_plan">composite_apply_plan</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">sa</span> [<span class="id">x</span>])).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">Hdiff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">setoid_rewrite</span> <span class="id">Hdiff0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_projection_protocol_transition_eq">pre_loaded_with_all_messages_projection_protocol_transition_eq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">om1</span> <span class="id">om2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.message">message</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>) <span class="id">l</span> (<span class="id">s1</span>, <span class="id">om1</span>) (<span class="id">s2</span>, <span class="id">om2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">i</span>)) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">l</span>) (<span class="id">s1</span> <span class="id">i</span>, <span class="id">om1</span>) (<span class="id">s2</span> <span class="id">i</span>, <span class="id">om2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof224')">Proof.</div>
<div class="proofscript" id="proof224">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">Hs1</span> [<span class="id">Hom1</span> [<span class="id">Hv</span> <span class="id">_</span>]]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hv</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">il</span> <span class="id">l</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">unfold</span> <span class="id">i</span> <span class="kwd">in</span> *. <span class="tactic">clear</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">il</span>) <span class="id">l</span> (<span class="id">s1</span> <span class="id">il</span>, <span class="id">om1</span>)) <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">om</span>') <span class="id">eqn</span>:<span class="id">Htj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_eq">state_update_eq</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_composed_protocol_state">preloaded_composed_protocol_state</a></span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#any_message_is_protocol_in_preloaded">any_message_is_protocol_in_preloaded</a></span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_projection_protocol_transition_neq">pre_loaded_with_all_messages_projection_protocol_transition_neq</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">om1</span> <span class="id">om2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.message">message</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">l</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#label">label</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Ht</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#protocol_transition">protocol_transition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>) <span class="id">l</span> (<span class="id">s1</span>, <span class="id">om1</span>) (<span class="id">s2</span>, <span class="id">om2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hi</span> : <span class="id">i</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id">s1</span> <span class="id">i</span> = <span class="id">s2</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof225')">Proof.</div>
<div class="proofscript" id="proof225">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Ht</span> <span class="kwd">as</span> [[<span class="id">Hs1</span> [<span class="id">Hom1</span> [<span class="id">Hv</span> <span class="id">_</span>]]] <span class="id">Ht</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hv</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> <span class="kwd">in</span> <span class="id">Ht</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [<span class="id">il</span> <span class="id">l</span>]. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#vtransition">vtransition</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">il</span>) <span class="id">l</span> (<span class="id">s1</span> <span class="id">il</span>, <span class="id">om1</span>)) <span class="kwd">as</span> (<span class="id">si</span>', <span class="id">om</span>') <span class="id">eqn</span>:<span class="id">Htj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>. <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#state_update_neq">state_update_neq</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
&nbsp;&nbsp;<span class="kwd">Lemma</span> <span class="id"><a name="pre_loaded_with_all_messages_projection_in_futures">pre_loaded_with_all_messages_projection_in_futures</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s1</span> <span class="id">s2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#vstate">vstate</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Hfutures</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.X">X</a></span>) <span class="id">s1</span> <span class="id">s2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.index">index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#in_futures">in_futures</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> <span class="id">i</span>))  (<span class="id">s1</span> <span class="id">i</span>) (<span class="id">s2</span> <span class="id">i</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof226')">Proof.</div>
<div class="proofscript" id="proof226">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hfutures</span> <span class="kwd">as</span> [<span class="id">tr</span> <span class="id">Htr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Htr</span> <span class="kwd">using</span> <span class="id"><a href="CasperCBC.VLSM.Common.html#finite_protocol_trace_from_to_ind">finite_protocol_trace_from_to_ind</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exists</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#preloaded_composed_protocol_state">preloaded_composed_protocol_state</a></span>;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">decide</span> (<span class="id">i</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#pre_loaded_with_all_messages_projection_protocol_transition_eq">pre_loaded_with_all_messages_projection_protocol_transition_eq</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHHtr</span> <span class="kwd">as</span> [<span class="id">tri</span> <span class="id">Htri</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({| <span class="id"><a href="CasperCBC.VLSM.Common.html#l">l</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT2">projT2</a></span> <span class="id">l</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#input">input</a></span> := <span class="id">iom</span>; <span class="id"><a href="CasperCBC.VLSM.Common.html#destination">destination</a></span> := <span class="id">s</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>); <span class="id"><a href="CasperCBC.VLSM.Common.html#output">output</a></span> := <span class="id">oom</span> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::<span class="id">tri</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#finite_ptrace_from_to_extend">finite_ptrace_from_to_extend</a></span> (<span class="id"><a href="CasperCBC.VLSM.Common.html#pre_loaded_with_all_messages_vlsm">pre_loaded_with_all_messages_vlsm</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections.IM">IM</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#projT1">projT1</a></span> <span class="id">l</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> (<span class="id">s</span>' <span class="id">i</span>) <span class="kwd">with</span> (<span class="id">s</span> <span class="id">i</span>). <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#pre_loaded_with_all_messages_projection_protocol_transition_neq">pre_loaded_with_all_messages_projection_protocol_transition_neq</a></span> <span class="id">H</span> <span class="id">n</span>).<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_projections">free_projections</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="binary_free_composition">binary_free_composition</a></span>.<br/>
<br/>
<h2> Free composition of two VLSMs
This serves an example of how composition can be built, but is also being
used in definiting the <span class="bracket"><span class="id">byzantine_trace_prop</span></span>erties.
This instantiates the regular composition using the <span class="bracket"><span class="id">bool</span></span> type as an &lt;&lt;index&gt;&gt;.
</h2>
&nbsp;&nbsp;<span class="kwd">Context</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">M1</span> <span class="id">M2</span> : <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="binary_index">binary_index</a></span> : <span class="kwd">Set</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="first">first</a></span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_index">binary_index</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="second">second</a></span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_index">binary_index</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="binary_index_dec">binary_index_dec</a></span> :  <span class="id">EqDecision</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_index">binary_index</a></span> := <span class="id">_</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Global</span> <span class="kwd">Instance</span> <span class="id"><a name="binary_index_inhabited">binary_index_inhabited</a></span> : <span class="id">Inhabited</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_index">binary_index</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">populate</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#first">first</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="binary_IM">binary_IM</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_index">binary_index</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_free_composition.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">i</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_free_composition.M1">M1</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_free_composition.M2">M2</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="binary_free_composition">binary_free_composition</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_free_composition.message">message</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Composition.html#free_composite_vlsm">free_composite_vlsm</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_IM">binary_IM</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="binary_free_composition_fst">binary_free_composition_fst</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_free_projection">composite_vlsm_free_projection</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_IM">binary_IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#first">first</a></span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="binary_free_composition_snd">binary_free_composition_snd</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_vlsm_free_projection">composite_vlsm_free_projection</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_IM">binary_IM</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#second">second</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#binary_free_composition">binary_free_composition</a></span>.<br/>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="composite_decidable_initial_message">composite_decidable_initial_message</a></span>.<br/>
<br/>
<h2> Composite decidable initial message
Here we show that if the <span class="bracket"><span class="id">initial_message_prop</span></span>erty is decidable for every
component, then it is decidable for a finite composition as well.
</h2>
<br/>
<span class="kwd">Context</span><br/>
&nbsp;&nbsp;{<span class="id">message</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">IndEqDec</span> : <span class="id">EqDecision</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">IM</span> : <span class="id">index</span> -&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#VLSM">VLSM</a></span> <span class="id">message</span>)<br/>
&nbsp;&nbsp;{<span class="id">i0</span> : <span class="id">Inhabited</span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;{<span class="id">index_listing</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">finite_index</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html#Listing">Listing</a></span> <span class="id">index_listing</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="composite_decidable_initial_message">composite_decidable_initial_message</a></span><br/>
&nbsp;&nbsp;(<span class="id">Hdec_init</span> : <span class="kwd">forall</span> <span class="id">i</span>, <span class="id"><a href="CasperCBC.VLSM.Common.html#vdecidable_initial_messages_prop">vdecidable_initial_messages_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_decidable_initial_message.IM">IM</a></span> <span class="id">i</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.VLSM.Common.html#decidable_initial_messages_prop">decidable_initial_messages_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_sig">composite_sig</a></span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_decidable_initial_message.IM">IM</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof227')">Proof.</div>
<div class="proofscript" id="proof227">
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">m</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_initial_message_prop">composite_initial_message_prop</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Decision_iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> (<span class="kwd">fun</span> <span class="id">i</span> =&gt; <span class="id"><a href="CasperCBC.VLSM.Common.html#vinitial_message_prop">vinitial_message_prop</a></span> (<span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_decidable_initial_message.IM">IM</a></span> <span class="id">i</span>) <span class="id">m</span>) <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_decidable_initial_message.index_listing">index_listing</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">exists_finite</span> <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_decidable_initial_message.finite_index">finite_index</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> [<span class="id">i</span> <span class="id">Hm</span>]; <span class="id">exists</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hm</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hm</span> <span class="kwd">as</span> [[<span class="id">im</span> <span class="id">Hinit</span>] <span class="id">Him</span>]. <span class="tactic">subst</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> @<span class="id">Exists_dec</span>. <span class="tactic">intro</span> <span class="id">i</span>. <span class="tactic">apply</span> <span class="id">Hdec_init</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CasperCBC.VLSM.Composition.html#composite_decidable_initial_message">composite_decidable_initial_message</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
