
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module CasperCBC.Lib.ListExtras</title>
<meta name="description" content="Documentation of Coq module CasperCBC.Lib.ListExtras" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module CasperCBC.Lib.ListExtras</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Coq.Bool.Bool</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html">ListSet</a></span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Lia.html">Lia</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html">Coq.Logic.FinFun</a></span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html">CasperCBC.Lib.Preamble</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="last_error">last_error</a></span> {<span class="id">S</span>} (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">S</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">S</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">t</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">t</span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unfold_last_hd">unfold_last_hd</a></span> {<span class="id">S</span>} : <span class="kwd">forall</span> (<span class="id">random</span> <span class="id">a</span> <span class="id">b</span> : <span class="id">S</span>) (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">S</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">a</span> :: (<span class="id">b</span> :: <span class="id">l</span>)) <span class="id">random</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">b</span> :: <span class="id">l</span>) <span class="id">random</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</div>
<div class="proofscript" id="proof3">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">random</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">tl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="swap_head_last">swap_head_last</a></span> {<span class="id">S</span>} : <span class="kwd">forall</span> (<span class="id">random</span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> : <span class="id">S</span>) (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">S</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">a</span> :: <span class="id">b</span> :: <span class="id">c</span> :: <span class="id">l</span>) <span class="id">random</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">b</span> :: <span class="id">a</span> :: <span class="id">c</span> :: <span class="id">l</span>) <span class="id">random</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</div>
<div class="proofscript" id="proof4">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">random</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">s</span> <span class="id">tl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">tl</span> <span class="kwd">as</span> [| <span class="id">hd</span> <span class="id">tl</span> <span class="id">IHl</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="remove_hd_last">remove_hd_last</a></span> {<span class="id">X</span>} :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">hd1</span> <span class="id">hd2</span> <span class="id">d1</span> <span class="id">d2</span> : <span class="id">X</span>) (<span class="id">tl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">hd1</span> :: <span class="id">hd2</span> :: <span class="id">tl</span>) <span class="id">d1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">hd2</span> :: <span class="id">tl</span>) <span class="id">d2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</div>
<div class="proofscript" id="proof5">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">tl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span> <span class="kwd">in</span> <span class="id">IHtl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">tl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span> <span class="kwd">in</span> <span class="id">IHtl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 2 <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="unroll_last">unroll_last</a></span> {<span class="id">S</span>} : <span class="kwd">forall</span> (<span class="id">random</span> <span class="id">a</span> : <span class="id">S</span>) (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">S</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">a</span> :: <span class="id">l</span>) <span class="id">random</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">l</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#swap_head_last">swap_head_last</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span>. <span class="tactic">rewrite</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unfold_last_hd">unfold_last_hd</a></span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="last_app">last_app</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">def</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) <span class="id">def</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">l2</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">l1</span> <span class="id">def</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">def</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intro</span> <span class="id">def</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="kwd">as</span> <span class="id">lst</span>; <span class="tactic">simpl</span>; <span class="tactic">subst</span> <span class="id">lst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl1</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="last_map">last_map</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">h</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">t</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">def</span> : <span class="id">B</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">f</span> (<span class="id">h</span> :: <span class="id">t</span>)) <span class="id">def</span> = <span class="id">f</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">t</span> <span class="id">h</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">def</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">t</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map_cons">map_cons</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHt</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="incl_empty">incl_empty</a></span> : <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">l</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span> -&gt; <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nil">nil</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">a</span>). <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="incl_singleton">incl_singleton</a></span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">a</span> : <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">l</span> [<span class="id">a</span>] -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> <span class="id">l</span> -&gt; <span class="id">b</span> = <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">clear</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">H</span> <span class="id">b</span>); <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>); <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tran">incl_tran</a></span> <span class="kwd">with</span> (<span class="id">a0</span> :: <span class="id">l</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_tl">incl_tl</a></span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_in">filter_in</a></span> : <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) <span class="id">x</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">f</span> <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter_In">filter_In</a></span>. <span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_incl">filter_incl</a></span> {<span class="id">A</span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) : <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s1</span> <span class="id">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">s1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">s2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s1</span>; <span class="tactic">intros</span>; <span class="tactic">intro</span> <span class="id">x</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#filter_in">filter_in</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">IHs1</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">intro</span> <span class="id">y</span>; <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHs1</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">intro</span> <span class="id">y</span>; <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_incl_fn">filter_incl_fn</a></span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">f</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">g</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">s</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">g</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl_refl">incl_refl</a></span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">x</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hfa</span>. <span class="tactic">rewrite</span> <span class="id">Hfa</span>. <span class="tactic">destruct</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">apply</span> <span class="id">IHs</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHs</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> (<span class="id">g</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_length_fn">filter_length_fn</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hfg</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">f</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt; <span class="id">g</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">s</span>) &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">g</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hfg</span>; <span class="tactic">subst</span>. <span class="id">specialize</span> (<span class="id">IHs</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">H1</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">g</span> <span class="id">a</span>); <span class="tactic">simpl</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_eq_fn">filter_eq_fn</a></span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) <span class="id">s</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">s</span> -&gt; <span class="id">f</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id">g</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">g</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">s</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IHs</span>' : <span class="kwd">forall</span> <span class="id">a</span> : <span class="id">A</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">s</span> -&gt; <span class="id">f</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id">g</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHs</span> <span class="kwd">in</span> <span class="id">IHs</span>'. <span class="tactic">clear</span> <span class="id">IHs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hf</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hf</span> <span class="kwd">as</span> <span class="id">Hg</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>). <span class="tactic">rewrite</span> <span class="id">Hg</span>. <span class="tactic">rewrite</span> <span class="id">IHs</span>'. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hg</span> : <span class="id">g</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{  <span class="tactic">destruct</span> (<span class="id">g</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hg</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">Hg</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hg</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hg</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="filter_nil">filter_nil</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">A</span> =&gt; <span class="id">f</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) <span class="id">l</span><br/>
&nbsp;&nbsp;&lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">l</span> = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">Hnone</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hno_a</span> := <span class="id">Hnone</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hin_a</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> (<span class="id">a</span> :: <span class="id">l</span>)) <span class="tactic">by</span> (<span class="id">left</span>;<span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hno_a</span> <span class="id">Hin_a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Hno_a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">Hin_b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hnone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="tactic">inversion</span> <span class="id">Hx</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">x</span>) <span class="id">eqn</span>:<span class="id">Hx</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">inversion</span> <span class="id">Hnone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Ha</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">Hnone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="existsb_first">existsb_first</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hsomething</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id">f</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) :<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">suffix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> : <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span> <span class="id">first</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> = <span class="id">prefix</span> ++ [<span class="id">first</span>] ++ <span class="id">suffix</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id">f</span> <span class="id">prefix</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>).<br/>
<br/>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">discriminate</span> <span class="id">Hsomething</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="kwd">in</span> <span class="id">Hsomething</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span> : <span class="id">eq_a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hsomething</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">Hsomething</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">prefix</span> [<span class="id">suffix</span> [<span class="id">first</span> [<span class="id">Hf</span> [<span class="id">Hconcat</span> <span class="id">Hnone_before</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">a</span> :: <span class="id">prefix</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">suffix</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hconcat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq_a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="kwd">in</span> <span class="id">Hnone_before</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_not_in">in_not_in</a></span> : <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">x</span> <span class="id">y</span> : <span class="id">A</span>) <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">y</span> <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">x</span> &lt;&gt; <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intro</span>; <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">H0</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="inb">inb</a></span> {<span class="id">A</span>} (<span class="id">Aeq_dec</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>:<span class="id">A</span>, {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>}) (<span class="id">x</span> : <span class="id">A</span>) (<span class="id">xs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id">Aeq_dec</span> <span class="id">x</span> <span class="id">xs</span> <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> <span class="kwd">else</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_function">in_function</a></span> {<span class="id">A</span>}  (<span class="id">Aeq_dec</span> : <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span>:<span class="id">A</span>, {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>}) :<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.Lib.Preamble.html#PredicateFunction2">PredicateFunction2</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">A</span>) (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#inb">inb</a></span> <span class="id">Aeq_dec</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">xs</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#inb">inb</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_dec">in_dec</a></span> <span class="id">Aeq_dec</span> <span class="id">x</span> <span class="id">xs</span>); <span class="tactic">split</span>; <span class="tactic">intros</span><br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">discriminate</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_correct">in_correct</a></span> {<span class="id">X</span>} `{<span class="id"><a href="CasperCBC.Lib.Preamble.html#EqDec">EqDec</a></span> <span class="id">X</span>} :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">X</span>) (<span class="id">x</span> : <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> &lt;-&gt; <span class="id"><a href="CasperCBC.Lib.ListExtras.html#inb">inb</a></span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#eq_dec">eq_dec</a></span> <span class="id">x</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_function">in_function</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">in_correct</span>' {<span class="id">X</span>} `{<span class="id"><a href="CasperCBC.Lib.Preamble.html#EqDec">EqDec</a></span> <span class="id">X</span>} :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">X</span>) (<span class="id">x</span> : <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> &lt;-&gt; <span class="id"><a href="CasperCBC.Lib.ListExtras.html#inb">inb</a></span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#eq_dec">eq_dec</a></span> <span class="id">x</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">msg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#mirror_reflect_curry">mirror_reflect_curry</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="id">now</span> <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_correct">in_correct</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="inclb">inclb</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">Heq</span> : <span class="id"><a href="CasperCBC.Lib.Preamble.html#EqDec">EqDec</a></span> <span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span><br/>
&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#forallb">forallb</a></span> (<span class="kwd">fun</span> <span class="id">x</span> : <span class="id">A</span> =&gt; <span class="id"><a href="CasperCBC.Lib.ListExtras.html#inb">inb</a></span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#eq_dec">eq_dec</a></span> <span class="id">x</span> <span class="id">l2</span>) <span class="id">l1</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="incl_function">incl_function</a></span> {<span class="id">A</span>} {<span class="id">Heq</span> : <span class="id"><a href="CasperCBC.Lib.Preamble.html#EqDec">EqDec</a></span> <span class="id">A</span>} : <span class="id"><a href="CasperCBC.Lib.Preamble.html#PredicateFunction2">PredicateFunction2</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">A</span>) (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#inclb">inclb</a></span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l1</span> <span class="id">l2</span>. <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#inclb">inclb</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#forallb_forall">forallb_forall</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">Hincl</span> <span class="id">x</span> <span class="id">Hx</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_correct">in_correct</a></span>; <span class="tactic">apply</span> <span class="id">Hincl</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="incl_correct">incl_correct</a></span> {<span class="id">A</span>} {<span class="id">Heq</span> : <span class="id"><a href="CasperCBC.Lib.Preamble.html#EqDec">EqDec</a></span> <span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">l1</span> <span class="id">l2</span> &lt;-&gt; <span class="id"><a href="CasperCBC.Lib.ListExtras.html#inclb">inclb</a></span> <span class="id">l1</span> <span class="id">l2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.Lib.ListExtras.html#incl_function">incl_function</a></span> <span class="id">l1</span> <span class="id">l2</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="map_injective">map_injective</a></span> : <span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.Lib.Preamble.html#Injective">Injective</a></span> <span class="id">f</span> -&gt; <span class="id"><a href="CasperCBC.Lib.Preamble.html#Injective">Injective</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">f</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">xs</span> <span class="id">ys</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">ys</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">xs</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">ys</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">inversion</span> <span class="id">H0</span> . <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">IHxs</span> <span class="kwd">in</span> <span class="id">H3</span>; <span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H0</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="map_incl">map_incl</a></span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">f</span> : <span class="id">B</span> -&gt; <span class="id">A</span>) : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> <span class="id">s</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#incl">incl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">f</span> <span class="id">s</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span> <span class="id">f</span> <span class="id">s</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">Hincl</span> <span class="id">fx</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> .<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">x</span> [<span class="id">Heq</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">x</span>. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">apply</span> <span class="id">Hincl</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="existsb_forall">existsb_forall</a></span> {<span class="id">A</span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>):<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#existsb">existsb</a></span> <span class="id">f</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">f</span> <span class="id">x</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html#orb_false_iff">orb_false_iff</a></span> <span class="kwd">in</span>  <span class="id">H2</span>. <span class="tactic">destruct</span> <span class="id">H2</span> <span class="kwd">as</span> [<span class="id">Hfa</span> <span class="id">Hex</span>]. <span class="tactic">rewrite</span> <span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hex</span>. <span class="tactic">simpl</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">try</span> (<span class="id">left</span>; <span class="tactic">reflexivity</span>). <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="app_cons">app_cons</a></span> {<span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: [<span class="id">a</span>] ++ <span class="id">l</span> = <span class="id">a</span> :: <span class="id">l</span><br/>
&nbsp;&nbsp;:= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="append_nodup_left">append_nodup_left</a></span> {<span class="id">A</span>}:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">l1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">IHl1</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="id">constructor</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="append_nodup_right">append_nodup_right</a></span> {<span class="id">A</span>}:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>) -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">IHl1</span> <span class="kwd">in</span> <span class="id">H3</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nodup_append">nodup_append</a></span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">l1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> <span class="id">l2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">l1</span> -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">l2</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">l2</span> -&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">l1</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#NoDup">NoDup</a></span> (<span class="id">l1</span> ++ <span class="id">l2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</div>
<div class="proofscript" id="proof28">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">H</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Inl1</span> | <span class="id">InL2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">H5</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> (<span class="id">H1</span> <span class="id">a</span>); <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">IHl1</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">H1</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">intro</span>. <span class="tactic">apply</span> <span class="id">H</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="last_is_last">last_is_last</a></span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">x</span> <span class="id">dummy</span>: <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id">l</span> ++ [<span class="id">x</span>]) <span class="id">dummy</span> = <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span>. <span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">x</span> <span class="id">dummy</span>). <span class="tactic">rewrite</span> &lt;- <span class="id">IHl</span> <span class="tactic">at</span> 2. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="last_error_is_last">last_error_is_last</a></span> {<span class="id">A</span>} : <span class="kwd">forall</span> (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>) (<span class="id">x</span> : <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.Lib.ListExtras.html#last_error">last_error</a></span> (<span class="id">l</span> ++ [<span class="id">x</span>]) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#last_is_last">last_is_last</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Polymorphic list library *</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="is_member">is_member</a></span> {<span class="id">W</span>} `{<span class="id"><a href="CasperCBC.Lib.Preamble.html#StrictlyComparable">StrictlyComparable</a></span> <span class="id">W</span>} (<span class="id">w</span> : <span class="id">W</span>) (<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">W</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| <span class="id">hd</span> :: <span class="id">tl</span> =&gt; <span class="kwd">match</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#compare">compare</a></span> <span class="id">w</span> <span class="id">hd</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">is_member</span> <span class="id">w</span> <span class="id">tl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="compareb">compareb</a></span> {<span class="id">A</span>} `{<span class="id"><a href="CasperCBC.Lib.Preamble.html#StrictlyComparable">StrictlyComparable</a></span> <span class="id">A</span>} (<span class="id">a1</span> <span class="id">a2</span> : <span class="id">A</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#compare">compare</a></span> <span class="id">a1</span> <span class="id">a2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Eq">Eq</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="is_member_correct">is_member_correct</a></span> {<span class="id">W</span>} `{<span class="id"><a href="CasperCBC.Lib.Preamble.html#StrictlyComparable">StrictlyComparable</a></span> <span class="id">W</span>} : <span class="kwd">forall</span> <span class="id">l</span> <span class="id">w</span>, <span class="id"><a href="CasperCBC.Lib.ListExtras.html#is_member">is_member</a></span> <span class="id">w</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">w</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</div>
<div class="proofscript" id="proof31">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l</span> <span class="id">w</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [|<span class="id">hd</span> <span class="id">tl</span> <span class="id">IHl</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#is_member">is_member</a></span> <span class="kwd">in</span> <span class="id">H</span>'; <span class="tactic">inversion</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;- <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.Preamble.html#compare">compare</a></span> <span class="id">w</span> <span class="id">hd</span>) <span class="id">eqn</span>:<span class="id">Hcmp</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">right</span>; <span class="tactic">apply</span> <span class="id">IHl</span>; <span class="tactic">assumption</span> ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#StrictOrder_Reflexive">StrictOrder_Reflexive</a></span> <span class="kwd">in</span> <span class="id">Hcmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">symmetry</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_inv">in_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> [<span class="id">eq</span> | <span class="id">neq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#compare_eq_refl">compare_eq_refl</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">neq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">assert</span> (<span class="id">H_dec</span> := <span class="id"><a href="CasperCBC.Lib.Preamble.html#compare_eq_dec">compare_eq_dec</a></span> <span class="id">w</span> <span class="id">hd</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_dec</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hneq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Heq</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#compare_eq_refl">compare_eq_refl</a></span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.Preamble.html#compare">compare</a></span> <span class="id">w</span> <span class="id">hd</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">is_member_correct</span>' {<span class="id">W</span>} `{<span class="id"><a href="CasperCBC.Lib.Preamble.html#StrictlyComparable">StrictlyComparable</a></span> <span class="id">W</span>} : <span class="kwd">forall</span> <span class="id">l</span> <span class="id">w</span>, <span class="id"><a href="CasperCBC.Lib.ListExtras.html#is_member">is_member</a></span> <span class="id">w</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> &lt;-&gt; ~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">w</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</div>
<div class="proofscript" id="proof32">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#mirror_reflect">mirror_reflect</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#is_member_correct">is_member_correct</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="In_app_comm">In_app_comm</a></span> {<span class="id">X</span>} : <span class="kwd">forall</span> <span class="id">l1</span> <span class="id">l2</span> (<span class="id">x</span> : <span class="id">X</span>), <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id">l1</span> ++ <span class="id">l2</span>) &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">x</span> (<span class="id">l2</span> ++ <span class="id">l1</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</div>
<div class="proofscript" id="proof33">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">l1</span> <span class="id">l2</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">intro</span> <span class="id">H_in</span>;<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_or_app">in_or_app</a></span>; <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_or">in_app_or</a></span> <span class="kwd">in</span> <span class="id">H_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H_in</span> <span class="kwd">as</span> [<span class="id">cat</span> | <span class="id">dog</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_last">nth_error_last</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hlast</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">_last</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">l</span> <span class="id">_last</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</div>
<div class="proofscript" id="proof34">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">_last</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">inversion</span> <span class="id">Hlast</span>. <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length_zero_iff_nil">length_zero_iff_nil</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">inversion</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHn</span> <span class="id">l</span> <span class="id">H0</span> <span class="id">_last</span>). <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHn</span>. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="list_suffix">list_suffix</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span><br/>
&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">n</span>,<span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0,<span class="id">_</span> =&gt; <span class="id">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>,[] =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>, <span class="id">a</span> :: <span class="id">l</span> =&gt; <span class="id">list_suffix</span> <span class="id">l</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_suffix_map">list_suffix_map</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id">f</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">l</span> <span class="id">n</span>) = <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id">f</span> <span class="id">l</span>) <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</div>
<div class="proofscript" id="proof35">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>]; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHn</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="list_prefix">list_prefix</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span><br/>
&nbsp;&nbsp;:= <span class="kwd">match</span> <span class="id">n</span>,<span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0,<span class="id">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span>,[] =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>, <span class="id">a</span> :: <span class="id">l</span> =&gt; <span class="id">a</span> :: <span class="id">list_prefix</span> <span class="id">l</span> <span class="id">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_split">list_prefix_split</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> <span class="id">left</span> <span class="id">right</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">left_len</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hlen</span> : <span class="id">left_len</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">left</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hsplit</span> : <span class="id">l</span> = <span class="id">left</span> ++ <span class="id">right</span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">left_len</span> = <span class="id">left</span>.<br/>
<br/>
<div class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</div>
<div class="proofscript" id="proof36">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">left_len</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">left_len</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#length_zero_iff_nil">length_zero_iff_nil</a></span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">discriminate</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">left_len</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">left</span>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHleft_len</span> <span class="id">right</span> <span class="id">left</span> <span class="id">H</span> (<span class="id">left</span> ++ <span class="id">right</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hsplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHleft_len</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_map">list_prefix_map</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id">f</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n</span>) = <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id">f</span> <span class="id">l</span>) <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</div>
<div class="proofscript" id="proof37">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>]; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHn</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_length">list_prefix_length</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hlen</span> : <span class="id">n</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n</span>) = <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</div>
<div class="proofscript" id="proof38">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>] <span class="id">Hlen</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_suffix_length">list_suffix_length</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">l</span> <span class="id">n</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span> - <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</div>
<div class="proofscript" id="proof39">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>]; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">IHn</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_prefix">list_prefix_prefix</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hn</span>: <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n2</span>) <span class="id">n1</span> = <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</div>
<div class="proofscript" id="proof40">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n1</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> [|<span class="id">n2</span>] [|<span class="id">n1</span>] <span class="id">Hn</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hn</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">IHl</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_suffix">list_prefix_suffix</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n</span> ++ <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">l</span> <span class="id">n</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</div>
<div class="proofscript" id="proof41">
&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> [|<span class="id">n</span>]; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="list_segment">list_segment</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;:= <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n2</span>) <span class="id">n1</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_segment_suffix">list_prefix_segment_suffix</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hn</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n1</span> ++ <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span> ++ <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">l</span> <span class="id">n2</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</div>
<div class="proofscript" id="proof42">
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_suffix">list_prefix_suffix</a></span> <span class="id">l</span> <span class="id">n2</span>) <span class="tactic">at</span> 4.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_suffix">list_prefix_suffix</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n2</span>) <span class="id">n1</span>) <span class="tactic">at</span> 2.<br/>
&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_prefix">list_prefix_prefix</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Forall_hd">Forall_hd</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;{<span class="id">a</span> : <span class="id">A</span>}<br/>
&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> (<span class="id">a</span> :: <span class="id">l</span>))<br/>
&nbsp;&nbsp;: <span class="id">P</span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</div>
<div class="proofscript" id="proof43">
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hs</span>. <span class="tactic">subst</span>. <span class="tactic">exact</span> <span class="id">H1</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Forall_tl">Forall_tl</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>}<br/>
&nbsp;&nbsp;{<span class="id">a</span> : <span class="id">A</span>}<br/>
&nbsp;&nbsp;{<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> (<span class="id">a</span> :: <span class="id">l</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</div>
<div class="proofscript" id="proof44">
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hs</span>. <span class="tactic">subst</span>. <span class="tactic">exact</span> <span class="id">H2</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="list_annotate">list_annotate</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id">P</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</div>
<div class="proofscript" id="proof45">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span> <span class="kwd">as</span> [| <span class="id">a</span> <span class="id">l</span>].<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> [].<br/>
&nbsp;&nbsp;-<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> ((<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">P</span> <span class="id">a</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_hd">Forall_hd</a></span> <span class="id">Hs</span>)) :: <span class="id">list_annotate</span> <span class="id">A</span> <span class="id">P</span> <span class="id">l</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_tl">Forall_tl</a></span> <span class="id">Hs</span>)).<br/>
Defined.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_annotate_unroll">list_annotate_unroll</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> (<span class="id">a</span> :: <span class="id">l</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate">list_annotate</a></span> <span class="id">P</span> (<span class="id">a</span> :: <span class="id">l</span>) <span class="id">Hs</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">P</span> <span class="id">a</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_hd">Forall_hd</a></span> <span class="id">Hs</span>) ::  <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate">list_annotate</a></span> <span class="id">P</span> <span class="id">l</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_tl">Forall_tl</a></span> <span class="id">Hs</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</div>
<div class="proofscript" id="proof46">
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_list_annotate_forget">in_list_annotate_forget</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">xP</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id">P</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hin</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">xP</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate">list_annotate</a></span> <span class="id">P</span> <span class="id">l</span> <span class="id">Hs</span>))<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">xP</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</div>
<div class="proofscript" id="proof47">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate_unroll">list_annotate_unroll</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span> <span class="id">xP</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">specialize</span> (<span class="id">IHl</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_tl">Forall_tl</a></span> <span class="id">Hs</span>)). <span class="tactic">apply</span> <span class="id">IHl</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_list_annotate">nth_error_list_annotate</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hs</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">oa</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#sig">sig</a></span> <span class="id">P</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate">list_annotate</a></span> <span class="id">P</span> <span class="id">l</span> <span class="id">Hs</span>) <span class="id">n</span> = <span class="id">oa</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> (@<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">oa</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">n</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</div>
<div class="proofscript" id="proof48">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> [| <span class="id">a</span> <span class="id">l</span>] <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>. <span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hs</span>; <span class="tactic">subst</span>. <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">a</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_hd">Forall_hd</a></span> <span class="id">Hs</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate_unroll">list_annotate_unroll</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>. <span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_annotate_unroll">list_annotate_unroll</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHn</span> <span class="id">l</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#Forall_tl">Forall_tl</a></span> <span class="id">Hs</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHn</span> <span class="kwd">as</span> [<span class="id">oa</span> [<span class="id">Hoa</span> <span class="id">Hnth</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">oa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="nth_error_filter_index">nth_error_filter_index</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">nth_error_filter_index</span> <span class="id">f</span> <span class="id">l</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> (<span class="id">nth_error_filter_index</span> <span class="id">f</span> <span class="id">l</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_filter_index_le">nth_error_filter_index_le</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;(<span class="id">in1</span> <span class="id">in2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hin1</span> : <span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n1</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">in1</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hin2</span> : <span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n2</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">in2</span>)<br/>
&nbsp;&nbsp;: <span class="id">in1</span> &lt;= <span class="id">in2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</div>
<div class="proofscript" id="proof49">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">in2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">in1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hin1</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin1</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">fa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">n1</span>; <span class="tactic">destruct</span> <span class="id">n2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">Hin1</span>; <span class="tactic">inversion</span> <span class="id">Hin2</span>; <span class="tactic">subst</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Hin1</span>; <span class="tactic">inversion</span> <span class="id">Hin2</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">Hle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* { <span class="tactic">destruct</span> <span class="id">in1</span>, <span class="id">in2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n2</span>); <span class="tactic">inversion</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">Hle</span>' : <span class="id">n1</span> &lt;= <span class="id">n2</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">Hle</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n1</span>) <span class="id">eqn</span>:<span class="id">Hin1</span>'; <span class="tactic">inversion</span> <span class="id">Hin1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n2</span>) <span class="id">eqn</span>:<span class="id">Hin2</span>'; <span class="tactic">inversion</span> <span class="id">Hin2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">in1</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span> <span class="id">in2</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">Hle</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n1</span>) <span class="id">eqn</span>:<span class="id">Hin1</span>'; <span class="tactic">inversion</span> <span class="id">Hin1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n2</span>) <span class="id">eqn</span>:<span class="id">Hin2</span>'; <span class="tactic">inversion</span> <span class="id">Hin2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">n</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span> <span class="id">n0</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#eq_refl">eq_refl</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_filter">nth_error_filter</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> <span class="id">f</span> <span class="id">l</span>) <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;: <span class="id">exists</span> (<span class="id">nth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_filter_index">nth_error_filter_index</a></span> <span class="id">f</span> <span class="id">l</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">nth</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">nth</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</div>
<div class="proofscript" id="proof50">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">a</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">destruct</span> <span class="id">n</span>; <span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">simpl</span> . <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">Hnth</span>; <span class="tactic">subst</span>. <span class="id">exists</span> 0; <span class="tactic">split</span>; <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">n</span> <span class="id">a0</span> <span class="id">Hnth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">nth</span> [<span class="id">Hnth</span>' <span class="id">Ha0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">nth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hnth</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">n</span> <span class="id">a0</span> <span class="id">Hnth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">nth</span> [<span class="id">Hnth</span>' <span class="id">Ha0</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">nth</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hnth</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="filter_Forall">filter_Forall</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">decP</span> : <span class="kwd">forall</span> <span class="id">a</span>:<span class="id">A</span>, {<span class="id">P</span> <span class="id">a</span>} + {~<span class="id">P</span> <span class="id">a</span>})<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#filter">filter</a></span> (<span class="id"><a href="CasperCBC.Lib.Preamble.html#predicate_to_function">predicate_to_function</a></span> <span class="id">decP</span>) <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</div>
<div class="proofscript" id="proof51">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_nil">Forall_nil</a></span> <span class="id">P</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.Preamble.html#predicate_to_function">predicate_to_function</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">filter_Forall</span> <span class="id">A</span> <span class="id">P</span> <span class="id">decP</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">decP</span> <span class="id">a</span>); <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_nth">list_prefix_nth</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hi</span> : <span class="id">i</span> &lt; <span class="id">n</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">s</span> <span class="id">n</span>) <span class="id">i</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">s</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</div>
<div class="proofscript" id="proof52">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">s</span>] [|<span class="id">n</span>] <span class="id">Hi</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hi</span>': <span class="id">i</span> &lt; <span class="id">n</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHi</span> <span class="id">s</span> <span class="id">n</span> <span class="id">Hi</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_length">nth_error_length</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof53')">Proof.</div>
<div class="proofscript" id="proof53">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">a</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>] <span class="id">b</span> <span class="id">Hnth</span>; <span class="tactic">simpl</span>; <span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;- <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHn</span> <span class="id">l</span> <span class="id">b</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_prefix_nth_last">list_prefix_nth_last</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">nth</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">nth</span>)<br/>
&nbsp;&nbsp;(<span class="id">_last</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id">nth</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) <span class="id">_last</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof54')">Proof.</div>
<div class="proofscript" id="proof54">
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_length">nth_error_length</a></span> <span class="id">l</span> <span class="id">n</span> <span class="id">nth</span> <span class="id">Hnth</span>); <span class="tactic">intro</span> <span class="id">Hlen</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_length">list_prefix_length</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">Hlen</span>); <span class="tactic">intro</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hpref_len</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_nth">list_prefix_nth</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">n</span>); <span class="tactic">intro</span> <span class="id">Hpref</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hpref</span> <span class="kwd">in</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_last">nth_error_last</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) <span class="id">n</span> <span class="id">Hpref_len</span> <span class="id">_last</span>); <span class="tactic">intro</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hlast</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_suffix_nth">list_suffix_nth</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">s</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hi</span> : <span class="id">n</span> &lt;= <span class="id">i</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">s</span> <span class="id">n</span>) (<span class="id">i</span> - <span class="id">n</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">s</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof55')">Proof.</div>
<div class="proofscript" id="proof55">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">s</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">s</span>] [|<span class="id">n</span>] <span class="id">Hi</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hi</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error_None">nth_error_None</a></span>. <span class="tactic">simpl</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_suffix_last">list_suffix_last</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hlt</span> : <span class="id">i</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">_default</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">l</span> <span class="id">i</span>) <span class="id">_default</span>  = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> <span class="id">l</span> <span class="id">_default</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof56')">Proof.</div>
<div class="proofscript" id="proof56">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>] <span class="id">Hlt</span><br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlt</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hlt</span>': <span class="id">i</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHi</span> <span class="id">l</span> <span class="id">Hlt</span>').<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHi</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hlt</span>; <span class="id">lia</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#unroll_last">unroll_last</a></span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_suffix_last_default">list_suffix_last_default</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hlast</span> : <span class="id">i</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">_default</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#last">last</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> <span class="id">l</span> <span class="id">i</span>) <span class="id">_default</span>  = <span class="id">_default</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof57')">Proof.</div>
<div class="proofscript" id="proof57">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l</span>. <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">intros</span> [|<span class="id">a</span> <span class="id">l</span>] <span class="id">Hlast</span><br/>
&nbsp;&nbsp;; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast</span>. <span class="tactic">inversion</span> <span class="id">Hlast</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHi</span> <span class="id">l</span> <span class="id">H0</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_segment_nth">list_segment_nth</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hn</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hi1</span> : <span class="id">n1</span> &lt;= <span class="id">i</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hi2</span> : <span class="id">i</span> &lt; <span class="id">n2</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span>) (<span class="id">i</span> - <span class="id">n1</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof58')">Proof.</div>
<div class="proofscript" id="proof58">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix_nth">list_suffix_nth</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_nth">list_prefix_nth</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_segment_app">list_segment_app</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n1</span> <span class="id">n2</span> <span class="id">n3</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">H12</span> : <span class="id">n1</span> &lt;= <span class="id">n2</span>)<br/>
&nbsp;&nbsp;(<span class="id">H23</span> : <span class="id">n2</span> &lt;= <span class="id">n3</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span> ++ <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span> <span class="id">l</span> <span class="id">n2</span> <span class="id">n3</span> = <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof59')">Proof.</div>
<div class="proofscript" id="proof59">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hle</span> : <span class="id">n1</span> &lt;= <span class="id">n3</span>) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_segment_suffix">list_prefix_segment_suffix</a></span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n3</span> <span class="id">Hle</span>); <span class="tactic">intro</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_segment_suffix">list_prefix_segment_suffix</a></span> <span class="id">l</span> <span class="id">n2</span> <span class="id">n3</span> <span class="id">H23</span>); <span class="tactic">intro</span> <span class="id">Hl2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hl2</span> <span class="kwd">in</span> <span class="id">Hl1</span> <span class="tactic">at</span> 4. <span class="tactic">clear</span> <span class="id">Hl2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_tail">app_inv_tail</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_suffix">list_prefix_suffix</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> <span class="id">n2</span>) <span class="id">n1</span>); <span class="tactic">intro</span> <span class="id">Hl2</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_prefix">list_prefix_prefix</a></span> <span class="id">l</span> <span class="id">n1</span> <span class="id">n2</span> <span class="id">H12</span>); <span class="tactic">intro</span> <span class="id">Hl3</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hl3</span> <span class="kwd">in</span> <span class="id">Hl2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hl2</span> <span class="kwd">in</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_assoc">app_assoc</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_inv_head">app_inv_head</a></span> <span class="kwd">in</span> <span class="id">Hl1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="list_segment_singleton">list_segment_singleton</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hnth</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span> <span class="id">l</span> <span class="id">n</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) = [<span class="id">a</span>].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof60')">Proof.</div>
<div class="proofscript" id="proof60">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_segment">list_segment</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hle</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> &lt;= <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#nth_error_length">nth_error_length</a></span> <span class="kwd">in</span> <span class="id">Hnth</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hlt</span> : <span class="id">n</span> &lt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">by</span> (<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_length">list_prefix_length</a></span>; <span class="tactic">try</span> <span class="id">constructor</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix_last">list_suffix_last</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) <span class="id">n</span> <span class="id">Hlt</span> <span class="id">a</span>); <span class="tactic">intro</span> <span class="id">Hlast1</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_nth_last">list_prefix_nth_last</a></span> <span class="id">l</span> <span class="id">n</span> <span class="id">a</span> <span class="id">Hnth</span> <span class="id">a</span>); <span class="tactic">intro</span> <span class="id">Hlast2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hlast2</span> <span class="kwd">in</span> <span class="id">Hlast1</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix_length">list_suffix_length</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) <span class="id">n</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix_length">list_prefix_length</a></span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">Hs</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span> - <span class="id">n</span> = 1) <span class="tactic">by</span> <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Hs</span> <span class="kwd">in</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_suffix">list_suffix</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#list_prefix">list_prefix</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)) <span class="id">n</span>) <span class="kwd">as</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="tactic">clear</span> -<span class="id">Hlength</span> <span class="id">Hlast1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">inversion</span> <span class="id">Hlength</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x</span>; <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hlast1</span>; <span class="tactic">subst</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_map">nth_error_map</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">List.map</a></span> <span class="id">f</span> <span class="id">l</span>) <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option_map">option_map</a></span> <span class="id">f</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l</span> <span class="id">n</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof61')">Proof.</div>
<div class="proofscript" id="proof61">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> [|<span class="id">n</span>]; <span class="tactic">try</span> <span class="tactic">reflexivity</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="forall_finite">forall_finite</a></span><br/>
&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">index_listing</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">Hfinite_index</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html#Full">Full</a></span> <span class="id">index_listing</span>)<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">index</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;: (<span class="kwd">forall</span> <span class="id">n</span> : <span class="id">index</span>, <span class="id">P</span> <span class="id">n</span>) &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> <span class="id">P</span> <span class="id">index_listing</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof62')">Proof.</div>
<div class="proofscript" id="proof62">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall_forall">Forall_forall</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id">Hfinite_index</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="exists_finite">exists_finite</a></span><br/>
&nbsp;&nbsp;{<span class="id">index</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">index_listing</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">index</span>}<br/>
&nbsp;&nbsp;(<span class="id">Hfinite_index</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FinFun.html#Full">Full</a></span> <span class="id">index_listing</span>)<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">index</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;: (<span class="id">exists</span> <span class="id">n</span> : <span class="id">index</span>, <span class="id">P</span> <span class="id">n</span>) &lt;-&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> <span class="id">P</span> <span class="id">index_listing</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof63')">Proof.</div>
<div class="proofscript" id="proof63">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">n</span> <span class="id">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">Hfinite_index</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists_exists">Exists_exists</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">n</span> [<span class="id">_</span> <span class="id">H</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">n</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Exists_dec">Exists_dec</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">P_dec</span> : <span class="kwd">forall</span> <span class="id">a</span> : <span class="id">A</span>, {<span class="id">P</span> <span class="id">a</span>} + {~ <span class="id">P</span> <span class="id">a</span>})<br/>
&nbsp;&nbsp;: {<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> <span class="id">P</span> <span class="id">l</span>} + {~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">List.Exists</a></span> <span class="id">P</span> <span class="id">l</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof64')">Proof.</div>
<div class="proofscript" id="proof64">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="id">right</span>. <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">P_dec</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">P_dec</span> <span class="kwd">as</span> [<span class="id">Pa</span> | <span class="id">Pna</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="id">left</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">Pl</span> | <span class="id">Pnl</span>] .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>. <span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Forall_dec">Forall_dec</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">P_dec</span> : <span class="kwd">forall</span> <span class="id">a</span> : <span class="id">A</span>, {<span class="id">P</span> <span class="id">a</span>} + {~ <span class="id">P</span> <span class="id">a</span>})<br/>
&nbsp;&nbsp;: {<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">List.Forall</a></span> <span class="id">P</span> <span class="id">l</span>} + {~ <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">List.Forall</a></span> <span class="id">P</span> <span class="id">l</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof65')">Proof.</div>
<div class="proofscript" id="proof65">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="id">left</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">P_dec</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">P_dec</span> <span class="kwd">as</span> [<span class="id">Pa</span> | <span class="id">Pna</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">Pl</span> | <span class="id">Pnl</span>] .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>. <span class="id">constructor</span>;  <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">intro</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="map_option">map_option</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">B</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">x</span> <span class="id">lb</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">f</span> <span class="id">x</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">lb</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">b</span> =&gt; <span class="id">b</span> :: <span class="id">lb</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[].<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="map_option_length">map_option_length</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hfl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">f</span> <span class="id">a</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#map_option">map_option</a></span> <span class="id">f</span> <span class="id">l</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof66')">Proof.</div>
<div class="proofscript" id="proof66">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfl</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHl</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>); <span class="tactic">try</span> (<span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">f_equal</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="map_option_nth">map_option_nth</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hfl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Forall">Forall</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">f</span> <span class="id">a</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">n</span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#length">length</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;(<span class="id">i</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">Hi</span> : <span class="id">i</span> &lt; <span class="id">n</span>)<br/>
&nbsp;&nbsp;(<span class="id">dummya</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">dummyb</span> : <span class="id">B</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">i</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#map_option">map_option</a></span> <span class="id">f</span> <span class="id">l</span>) <span class="id">dummyb</span>) = <span class="id">f</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth">nth</a></span> <span class="id">i</span> <span class="id">l</span> <span class="id">dummya</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof67')">Proof.</div>
<div class="proofscript" id="proof67">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *. { <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfl</span>. <span class="tactic">subst</span>. <span class="id">spec</span> <span class="id">IHl</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>: <span class="id">Hfa</span>; <span class="tactic">try</span> (<span class="tactic">elim</span> <span class="id">H1</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHl</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="id">spec</span> <span class="id">IHl</span>. { <span class="id">lia</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_map_option">in_map_option</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">b</span> : <span class="id">B</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">b</span> (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#map_option">map_option</a></span> <span class="id">f</span> <span class="id">l</span>) &lt;-&gt; <span class="id">exists</span> <span class="id">a</span> : <span class="id">A</span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">l</span> /\ <span class="id">f</span> <span class="id">a</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof68')">Proof.</div>
<div class="proofscript" id="proof68">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>]; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">Hin</span>). <span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">a</span>' [<span class="id">Hin</span>' <span class="id">Hfa</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>'. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">Hin</span>). <span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">a</span>' [<span class="id">Hin</span>' <span class="id">Hfa</span>']].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>'. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> [<span class="id">a</span>' [<span class="id">Hin</span>' <span class="id">Hfa</span>']]; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hin</span>'; <span class="tactic">subst</span>; <span class="tactic">clear</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">Hfa</span>'. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">destruct</span> (<span class="id">f</span> <span class="id">a</span>) <span class="id">eqn</span>:<span class="id">Hfa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">right</span>. <span class="tactic">apply</span> <span class="id">IHl</span>. <span class="id">exists</span> <span class="id">a</span>'. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">IHl</span>. <span class="id">exists</span> <span class="id">a</span>'. <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="nth_error_eq">nth_error_eq</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l1</span> <span class="id">l2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hnth</span>: <span class="kwd">forall</span> <span class="id">n</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l1</span> <span class="id">n</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#nth_error">nth_error</a></span> <span class="id">l2</span> <span class="id">n</span>)<br/>
&nbsp;&nbsp;: <span class="id">l1</span> = <span class="id">l2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof69')">Proof.</div>
<div class="proofscript" id="proof69">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">l2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l1</span>; <span class="tactic">intros</span> [| <span class="id">a2</span> <span class="id">l2</span>] <span class="id">Hnth</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">Hnth</span> 0); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">Hnth</span> 0); <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hnth</span>. <span class="tactic">inversion</span> <span class="id">Hnth</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">H0</span> := <span class="id">Hnth</span> 0). <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H0</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">Hnth</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="occurrences_ordering">occurrences_ordering</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">a</span> <span class="id">b</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">la1</span> <span class="id">la2</span> <span class="id">lb1</span> <span class="id">lb2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">la1</span> ++ <span class="id">a</span> :: <span class="id">la2</span> = <span class="id">lb1</span> ++ <span class="id">b</span> :: <span class="id">lb2</span>)<br/>
&nbsp;&nbsp;(<span class="id">Ha</span> : ~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> (<span class="id">b</span> :: <span class="id">lb2</span>))<br/>
&nbsp;&nbsp;: <span class="id">exists</span> <span class="id">lab</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>, <span class="id">lb1</span> = <span class="id">la1</span> ++ <span class="id">a</span> :: <span class="id">lab</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof70')">Proof.</div>
<div class="proofscript" id="proof70">
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">lb2</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">la2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">b</span>. <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">lb1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">la1</span>; <span class="tactic">intros</span>; <span class="tactic">destruct</span> <span class="id">lb1</span> <span class="kwd">as</span> [|<span class="id">b0</span> <span class="id">lb1</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *<br/>
&nbsp;&nbsp;; <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">elim</span> <span class="id">Ha</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">lb1</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">elim</span> <span class="id">Ha</span>. <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_app_iff">in_app_iff</a></span>. <span class="id">right</span>. <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id">IHla1</span> <span class="id">a0</span> <span class="id">lb1</span> <span class="id">b</span> <span class="id">la2</span> <span class="id">lb2</span> <span class="id">H1</span> <span class="id">Ha</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHla1</span> <span class="kwd">as</span> [<span class="id">la0b</span> <span class="id">Hla0b</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">la0b</span>. <span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="exists_first">exists_first</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">P</span> : <span class="id">A</span> -&gt; <span class="kwd">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id">Pdec</span> : <span class="kwd">forall</span> <span class="id">a</span> : <span class="id">A</span>, {<span class="id">P</span> <span class="id">a</span> } + {~<span class="id">P</span> <span class="id">a</span>})<br/>
&nbsp;&nbsp;(<span class="id">Hsomething</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <span class="id">P</span> <span class="id">l</span>) :<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">prefix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">suffix</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">first</span> : <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">first</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l</span> = <span class="id">prefix</span> ++ [<span class="id">first</span>] ++ <span class="id">suffix</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <span class="id">P</span> <span class="id">prefix</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof71')">Proof.</div>
<div class="proofscript" id="proof71">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hsomething</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">Pdec</span> <span class="id">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> []. <span class="id">exists</span> <span class="id">l</span>. <span class="id">exists</span> <span class="id">a</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assert</span> (<span class="id">Hl</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#Exists">Exists</a></span> <span class="id">P</span> <span class="id">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">Hsomething</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> (<span class="tactic">elim</span> <span class="id">n</span>; <span class="tactic">assumption</span>). <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">Hl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">prefix</span> [<span class="id">suffix</span> [<span class="id">first</span> [<span class="id">Hfirst</span> [<span class="id">Heq</span> <span class="id">Hprefix</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">a</span> :: <span class="id">prefix</span>). <span class="id">exists</span> <span class="id">suffix</span>. <span class="id">exists</span> <span class="id">first</span>. <span class="tactic">repeat</span> <span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>. <span class="tactic">subst</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intro</span> <span class="id">Hprefix</span>'. <span class="tactic">inversion</span> <span class="id">Hprefix</span>'; <span class="tactic">try</span> (<span class="tactic">elim</span> <span class="id">n</span>; <span class="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">Hprefix</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_fast">in_fast</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">b</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Hin</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> (<span class="id">b</span> :: <span class="id">l</span>))<br/>
&nbsp;&nbsp;(<span class="id">Hneq</span> : <span class="id">b</span> &lt;&gt; <span class="id">a</span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof72')">Proof.</div>
<div class="proofscript" id="proof72">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">elim</span> <span class="id">Hneq</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="union_fold">union_fold</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;{<span class="id">eq_dec_a</span> : <span class="id"><a href="CasperCBC.Lib.Preamble.html#EqDec">EqDec</a></span> <span class="id">A</span>}<br/>
&nbsp;&nbsp;(<span class="id">haystack</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>))<br/>
&nbsp;&nbsp;(<span class="id">a</span> : <span class="id">A</span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union">set_union</a></span> <span class="id">eq_dec_a</span>) [] <span class="id">haystack</span>)<br/>
&nbsp;&nbsp;&lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">needle</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>), (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">a</span> <span class="id">needle</span>) /\ (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> <span class="id">needle</span> <span class="id">haystack</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof73')">Proof.</div>
<div class="proofscript" id="proof73">
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">haystack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">haystack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_iff">set_union_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">exists</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">unfold</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#fold_right">fold_right</a></span> <span class="kwd">in</span> <span class="id">IHhaystack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHhaystack</span> <span class="id">a0</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHhaystack</span> <span class="kwd">as</span> [<span class="id">needle</span> [<span class="id">Hin1</span> <span class="id">Hin2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">needle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;- <span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">haystack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">haystack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">_</span> [<span class="id">_</span> <span class="id">Hfalse</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">needle</span> [<span class="id">Hin</span> <span class="id">Hin2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_iff">set_union_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.ListSet.html#set_union_iff">set_union_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHhaystack</span> <span class="id">a0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHhaystack</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">needle</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="one_element_decompositions">one_element_decompositions</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span> * <span class="id">A</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;| <span class="id">a</span> :: <span class="id">l</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;([], <span class="id">a</span>, <span class="id">l</span>')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span> (<span class="id">l1</span>, <span class="id">b</span>, <span class="id">l2</span>) =&gt; (<span class="id">a</span> :: <span class="id">l1</span>, <span class="id">b</span>, <span class="id">l2</span>) <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">one_element_decompositions</span> <span class="id">l</span>')<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_one_element_decompositions_iff">in_one_element_decompositions_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">pre</span> <span class="id">suf</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">x</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">pre</span>, <span class="id">x</span>, <span class="id">suf</span>) (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#one_element_decompositions">one_element_decompositions</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&lt;-&gt; <span class="id">pre</span> ++ [<span class="id">x</span>] ++ <span class="id">suf</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof74')">Proof.</div>
<div class="proofscript" id="proof74">
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">suf</span>. <span class="id">revert</span> <span class="id">x</span>. <span class="id">revert</span> <span class="id">pre</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> <span class="id">pre</span> <span class="id">x</span> <span class="id">suf</span>; <span class="tactic">split</span>; <span class="tactic">simpl</span>; <span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">specialize</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_cons_not_nil">app_cons_not_nil</a></span> <span class="id">pre</span> <span class="id">suf</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;; <span class="tactic">intro</span> <span class="id">contra</span>; <span class="tactic">elim</span> <span class="id">contra</span>. <span class="tactic">symmetry</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">Heq</span> | <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">Heq</span>. <span class="tactic">subst</span>. <span class="tactic">simpl</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">x0</span> [<span class="id">Heq</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">x0</span> <span class="kwd">as</span> ((<span class="id">prex0</span>,<span class="id">x0</span>),<span class="id">sufx0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">prex0</span> <span class="id">x0</span> <span class="id">sufx0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heq</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_comm_cons">app_comm_cons</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">pre</span>, <span class="id">x</span>, <span class="id">suf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHl</span>. <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="two_element_decompositions">two_element_decompositions</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span> * <span class="id">A</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span> * <span class="id">A</span> * <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#flat_map">flat_map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">l1</span>, <span class="id">e1</span>, <span class="id">l2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#map">map</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">t</span> =&gt; <span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span> (<span class="id">l2</span>',<span class="id">e2</span>, <span class="id">l3</span>) =&gt; (<span class="id">l1</span>, <span class="id">e1</span>, <span class="id">l2</span>', <span class="id">e2</span>, <span class="id">l3</span>) <span class="kwd">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.Lib.ListExtras.html#one_element_decompositions">one_element_decompositions</a></span> <span class="id">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CasperCBC.Lib.ListExtras.html#one_element_decompositions">one_element_decompositions</a></span> <span class="id">l</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="in_two_element_decompositions_iff">in_two_element_decompositions_iff</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">l</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">pre</span> <span class="id">mid</span> <span class="id">suf</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">x</span> <span class="id">y</span> : <span class="id">A</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#In">In</a></span> (<span class="id">pre</span>, <span class="id">x</span>, <span class="id">mid</span>, <span class="id">y</span>, <span class="id">suf</span>) (<span class="id"><a href="CasperCBC.Lib.ListExtras.html#two_element_decompositions">two_element_decompositions</a></span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;&lt;-&gt; <span class="id">pre</span> ++ [<span class="id">x</span>] ++ <span class="id">mid</span> ++ [<span class="id">y</span>] ++ <span class="id">suf</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof75')">Proof.</div>
<div class="proofscript" id="proof75">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#two_element_decompositions">two_element_decompositions</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_flat_map">in_flat_map</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> [((<span class="id">pre</span>', <span class="id">x</span>'), <span class="id">sufx</span>) [<span class="id">Hdecx</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [((<span class="id">mid</span>', <span class="id">y</span>'), <span class="id">suf</span>') [<span class="id">Hdec</span> <span class="id">Hin</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hdec</span>. <span class="tactic">subst</span>. <span class="tactic">clear</span> <span class="id">Hdec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_one_element_decompositions_iff">in_one_element_decompositions_iff</a></span> <span class="kwd">in</span> <span class="id">Hdecx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_one_element_decompositions_iff">in_one_element_decompositions_iff</a></span> <span class="kwd">in</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">sufx</span> <span class="id">l</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id">remember</span> (<span class="id">mid</span> ++ [<span class="id">y</span>] ++ <span class="id">suf</span>) <span class="kwd">as</span> <span class="id">sufx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> (<span class="id">pre</span>, <span class="id">x</span>, <span class="id">sufx</span>). <span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_one_element_decompositions_iff">in_one_element_decompositions_iff</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#in_map_iff">in_map_iff</a></span>. <span class="id">exists</span> (<span class="id">mid</span>, <span class="id">y</span>, <span class="id">suf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CasperCBC.Lib.ListExtras.html#in_one_element_decompositions_iff">in_one_element_decompositions_iff</a></span>. <span class="tactic">symmetry</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="order_decompositions">order_decompositions</a></span><br/>
&nbsp;&nbsp;{<span class="id">A</span> : <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">pre1</span> <span class="id">suf1</span> <span class="id">pre2</span> <span class="id">suf2</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list">list</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;(<span class="id">Heq</span> : <span class="id">pre1</span> ++ <span class="id">suf1</span> = <span class="id">pre2</span> ++ <span class="id">suf2</span>)<br/>
&nbsp;&nbsp;: <span class="id">pre1</span> = <span class="id">pre2</span><br/>
&nbsp;&nbsp;\/ (<span class="id">exists</span> <span class="id">suf1</span>', <span class="id">pre1</span> = <span class="id">pre2</span> ++ <span class="id">suf1</span>')<br/>
&nbsp;&nbsp;\/ (<span class="id">exists</span> <span class="id">suf2</span>', <span class="id">pre2</span> = <span class="id">pre1</span> ++ <span class="id">suf2</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof76')">Proof.</div>
<div class="proofscript" id="proof76">
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">pre1</span> ++ <span class="id">suf1</span>) <span class="kwd">as</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">Heql</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">pre1</span> <span class="id">suf1</span> <span class="id">pre2</span> <span class="id">suf2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heql</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_eq_nil">app_eq_nil</a></span> <span class="kwd">in</span> <span class="id">Heql</span>. <span class="tactic">destruct</span> <span class="id">Heql</span> <span class="kwd">as</span> [<span class="id">Hpre1</span> <span class="id">_</span>]. <span class="tactic">subst</span> <span class="id">pre1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html#app_eq_nil">app_eq_nil</a></span> <span class="kwd">in</span> <span class="id">Heq</span>. <span class="tactic">destruct</span> <span class="id">Heq</span> <span class="kwd">as</span> [<span class="id">Hpre2</span> <span class="id">_</span>]. <span class="tactic">subst</span> <span class="id">pre2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">pre1</span> <span class="kwd">as</span> [| <span class="id">a1</span> <span class="id">pre1</span>]; <span class="tactic">destruct</span> <span class="id">pre2</span> <span class="kwd">as</span> [|<span class="id">a2</span> <span class="id">pre2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">left</span>. <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">right</span>. <span class="id">exists</span> (<span class="id">a2</span> :: <span class="id">pre2</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">right</span>. <span class="id">left</span>. <span class="id">exists</span> (<span class="id">a1</span> :: <span class="id">pre1</span>). <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">Heql</span>. <span class="tactic">subst</span> <span class="id">a1</span>. <span class="tactic">clear</span> <span class="id">Heql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heq</span>. <span class="tactic">subst</span> <span class="id">a2</span>. <span class="tactic">clear</span> <span class="id">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">IHl</span> <span class="id">pre1</span> <span class="id">suf1</span> <span class="id">pre2</span> <span class="id">suf2</span> <span class="id">H1</span> <span class="id">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">IHl</span> <span class="kwd">as</span> [<span class="id">Heq</span> | [<span class="id">Hgt</span> | <span class="id">Hlt</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">left</span>. <span class="tactic">f_equal</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">Hgt</span> <span class="kwd">as</span> [<span class="id">suf1</span>' <span class="id">Hgt</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">left</span>. <span class="id">exists</span> <span class="id">suf1</span>'. <span class="tactic">simpl</span>. <span class="tactic">f_equal</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">destruct</span> <span class="id">Hlt</span> <span class="kwd">as</span> [<span class="id">suf2</span>' <span class="id">Hlt</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>. <span class="id">right</span>. <span class="id">exists</span> <span class="id">suf2</span>'. <span class="tactic">simpl</span>. <span class="tactic">f_equal</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
